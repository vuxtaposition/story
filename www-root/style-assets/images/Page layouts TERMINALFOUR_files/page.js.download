/*
 * Gritter for jQuery
 * http://www.boedesign.com/
 *
 * Copyright (c) 2012 Jordan Boesch
 * Dual licensed under the MIT and GPL licenses.
 *
 * Date: February 24, 2012
 * Version: 1.7.4
 */

// Backbone.Stickit v0.9.2, MIT Licensed
// Copyright (c) 2012-2015 The New York Times, CMS Group, Matthew DeLambo <delambo@gmail.com>

/**
 * dependsOn v1.0.1
 * a jQuery plugin to facilitate the handling of form field dependencies.
 *
 * Copyright 2014 David Street
 * Licensed under the MIT license.
 */

/*!
 * clipboard.js v1.5.5
 * https://zenorocha.github.io/clipboard.js
 *
 * Licensed MIT Â© Zeno Rocha
 */

/*
 * jQuery Iframe Transport Plugin 1.8.3
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */

/*! jQuery UI - v1.11.1+CommonJS - 2014-09-17
* http://jqueryui.com
* Includes: widget.js
* Copyright 2014 jQuery Foundation and other contributors; Licensed MIT */

/*!
 * jQuery UI Widget 1.11.1
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/jQuery.widget/
 */

/*
 * jQuery File Upload Plugin 5.42.3
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2010, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */

/*
 * jQuery Input Limiter plugin 1.3.1
 * http://rustyjeans.com/jquery-plugins/input-limiter/
 *
 * Copyright (c) 2009 Russel Fones <russel@rustyjeans.com>
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 */

/*
 * imgAreaSelect jQuery plugin
 * version 0.9.11-rc.1
 *
 * Copyright (c) 2008-2013 Michal Wojciechowski (odyniec.net)
 *
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * http://odyniec.net/projects/imgareaselect/
 *
 */

"ace"in window||(window.ace={}),"vars"in window.ace||(window.ace.vars={icon:" ace-icon ",".icon":".ace-icon"}),ace.config={cookie_expiry:604800,storage_method:2},ace.settings={is:function(e,t){return ace.data.get("settings",e+"-"+t)==1},exists:function(e,t){return ace.data.get("settings",e+"-"+t)!==null},set:function(e,t){ace.data.set("settings",e+"-"+t,1)},unset:function(e,t){ace.data.set("settings",e+"-"+t,-1)},remove:function(e,t){ace.data.remove("settings",e+"-"+t)},navbar_fixed:function(e,t,n){var r=document.getElementById("navbar");if(!r)return!1;e=e||!1;if(!e&&n!==!1){var i=null;(ace.settings.is("sidebar","fixed")||(i=document.getElementById("sidebar"))&&ace.hasClass(i,"sidebar-fixed"))&&ace.settings.sidebar_fixed(!1)}e?(ace.hasClass(r,"navbar-fixed-top")||ace.addClass(r,"navbar-fixed-top"),t!==!1&&ace.settings.set("navbar","fixed")):(ace.removeClass(r,"navbar-fixed-top"),t!==!1&&ace.settings.unset("navbar","fixed")),document.getElementById("ace-settings-navbar").checked=e,window.jQuery&&jQuery(document).trigger("settings.ace",["navbar_fixed",e])},sidebar_fixed:function(e,t,n){var r=document.getElementById("sidebar");if(!r)return!1;e=e||!1;if(!e&&n!==!1){var i=null;(ace.settings.is("breadcrumbs","fixed")||(i=document.getElementById("breadcrumbs"))&&ace.hasClass(i,"breadcrumbs-fixed"))&&ace.settings.breadcrumbs_fixed(!1)}e&&n!==!1&&!ace.settings.is("navbar","fixed")&&ace.settings.navbar_fixed(!0);if(e){if(!ace.hasClass(r,"sidebar-fixed")){ace.addClass(r,"sidebar-fixed");var s=document.getElementById("menu-toggler");s&&ace.addClass(s,"fixed")}t!==!1&&ace.settings.set("sidebar","fixed")}else{ace.removeClass(r,"sidebar-fixed");var s=document.getElementById("menu-toggler");s&&ace.removeClass(s,"fixed"),t!==!1&&ace.settings.unset("sidebar","fixed")}document.getElementById("ace-settings-sidebar").checked=e,window.jQuery&&jQuery(document).trigger("settings.ace",["sidebar_fixed",e])},breadcrumbs_fixed:function(e,t,n){var r=document.getElementById("breadcrumbs");if(!r)return!1;e=e||!1,e&&n!==!1&&!ace.settings.is("sidebar","fixed")&&ace.settings.sidebar_fixed(!0),e?(ace.hasClass(r,"breadcrumbs-fixed")||ace.addClass(r,"breadcrumbs-fixed"),t!==!1&&ace.settings.set("breadcrumbs","fixed")):(ace.removeClass(r,"breadcrumbs-fixed"),t!==!1&&ace.settings.unset("breadcrumbs","fixed")),document.getElementById("ace-settings-breadcrumbs").checked=e,window.jQuery&&jQuery(document).trigger("settings.ace",["breadcrumbs_fixed",e])},main_container_fixed:function(e,t){e=e||!1;var n=document.getElementById("main-container");if(!n)return!1;var r=document.getElementById("navbar-container");e?(ace.hasClass(n,"container")||ace.addClass(n,"container"),ace.hasClass(r,"container")||ace.addClass(r,"container"),t!==!1&&ace.settings.set("main-container","fixed")):(ace.removeClass(n,"container"),ace.removeClass(r,"container"),t!==!1&&ace.settings.unset("main-container","fixed")),document.getElementById("ace-settings-add-container").checked=e;if(navigator.userAgent.match(/webkit/i)){var i=document.getElementById("sidebar");ace.toggleClass(i,"menu-min"),setTimeout(function(){ace.toggleClass(i,"menu-min")},0)}window.jQuery&&jQuery(document).trigger("settings.ace",["main_container_fixed",e])},sidebar_collapsed:function(e,t){var n=document.getElementById("sidebar");if(!n)return!1;e=e||!1;var r=ace.isHTTMlElement(this)?this:n.querySelector(".sidebar-collapse"),i=r?r.querySelector(ace.vars[".icon"]):null,s,o;i&&(s=i.getAttribute("data-icon1"),o=i.getAttribute("data-icon2")),e?(ace.addClass(n,"menu-min"),i&&(ace.removeClass(i,s),ace.addClass(i,o)),t!==!1&&ace.settings.set("sidebar","collapsed")):(ace.removeClass(n,"menu-min"),i&&(ace.removeClass(i,o),ace.addClass(i,s)),t!==!1&&ace.settings.unset("sidebar","collapsed")),window.jQuery&&jQuery(document).trigger("settings.ace",["sidebar_collapsed",e])}},ace.settings.check=function(e,t){if(!ace.settings.exists(e,t))return;var n=ace.settings.is(e,t),r={"navbar-fixed":"navbar-fixed-top","sidebar-fixed":"sidebar-fixed","breadcrumbs-fixed":"breadcrumbs-fixed","sidebar-collapsed":"menu-min","main-container-fixed":"container"},i=document.getElementById(e);n!=ace.hasClass(i,r[e+"-"+t])&&ace.settings[e.replace("-","_")+"_"+t](n)},ace.data_storage=function(e,t){var n="ace.",r=null,i=0;(e==1||e===t)&&"localStorage"in window&&window.localStorage!==null?(r=ace.storage,i=1):r==null&&(e==2||e===t)&&"cookie"in document&&document.cookie!==null&&(r=ace.cookie,i=2),this.set=function(e,t,s,o){if(!r)return;if(s===o)s=t,t=e,s==null?r.remove(n+t):i==1?r.set(n+t,s):i==2&&r.set(n+t,s,ace.config.cookie_expiry);else if(i==1)s==null?r.remove(n+e+"."+t):r.set(n+e+"."+t,s);else if(i==2){var u=r.get(n+e),a=u?JSON.parse(u):{};if(s==null){delete a[t];if(ace.sizeof(a)==0){r.remove(n+e);return}}else a[t]=s;r.set(n+e,JSON.stringify(a),ace.config.cookie_expiry)}},this.get=function(e,t,s){if(!r)return null;if(t===s)return t=e,r.get(n+t);if(i==1)return r.get(n+e+"."+t);if(i==2){var o=r.get(n+e),u=o?JSON.parse(o):{};return t in u?u[t]:null}},this.remove=function(e,t,n){if(!r)return;t===n?(t=e,this.set(t,null)):this.set(e,t,null)}},ace.cookie={get:function(e){var t=document.cookie,n,r=e+"=",i;if(!t)return;i=t.indexOf("; "+r);if(i==-1){i=t.indexOf(r);if(i!=0)return null}else i+=2;return n=t.indexOf(";",i),n==-1&&(n=t.length),decodeURIComponent(t.substring(i+r.length,n))},set:function(e,t,n,r,i,s){var o=new Date;typeof n=="object"&&n.toGMTString?n=n.toGMTString():parseInt(n,10)?(o.setTime(o.getTime()+parseInt(n,10)*1e3),n=o.toGMTString()):n="",document.cookie=e+"="+encodeURIComponent(t)+(n?"; expires="+n:"")+(r?"; path="+r:"")+(i?"; domain="+i:"")+(s?"; secure":"")},remove:function(e,t){this.set(e,"",-1e3,t)}},ace.storage={get:function(e){return window.localStorage.getItem(e)},set:function(e,t){window.localStorage.setItem(e,t)},remove:function(e){window.localStorage.removeItem(e)}},ace.sizeof=function(e){var t=0;for(var n in e)e.hasOwnProperty(n)&&t++;return t},ace.hasClass=function(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")>-1},ace.addClass=function(e,t){if(!ace.hasClass(e,t)){var n=e.className;e.className=n+(n.length?" ":"")+t}},ace.removeClass=function(e,t){ace.replaceClass(e,t)},ace.replaceClass=function(e,t,n){var r=new RegExp("(^|\\s)"+t+"(\\s|$)","i");e.className=e.className.replace(r,function(e,t,r){return n?t+n+r:" "}).replace(/^\s+|\s+$/g,"")},ace.toggleClass=function(e,t){ace.hasClass(e,t)?ace.removeClass(e,t):ace.addClass(e,t)},ace.isHTTMlElement=function(e){return window.HTMLElement?e instanceof HTMLElement:"nodeType"in e?e.nodeType==1:!1},ace.data=new ace.data_storage(ace.config.storage_method),define("ace.extra",["ace","bootstrap"],function(){}),define("module/common/navigation/view/breadcrumb",["jquery","underscore","backbone","i18n"],function(e,t,n,r){return n.View.extend({tagName:"ul",className:"breadcrumb",manage:!1,initialize:function(e){this.registerListeners(),this.options=e||{},this.keys=this.options.keys||[];var t=this.options.showHome!==undefined?this.options.showHome:!0;t&&this.keys.unshift({key:"nav.home"})},registerListeners:function(){this.listenTo(n,"breadcrumb:subscribe",this.subscribe)},render:function(){var e=this.createNodes(this.keys);return this.refreshDom(e),this},refreshDom:function(e){this.$el.html(""),t.each(e,function(e){this.$el.append(e)},this)},subscribeForCrudOn:function(e){this.listenTo(n,e+":home",function(){this.refresh()}),this.listenTo(n,e+":add",function(){this.refresh({key:"Create new"})}),this.listenTo(n,e+":edit",function(){this.refresh({key:"Edit"})}),this.listenTo(n,e+":duplicate",function(){this.refresh({key:"Duplicate"})}),this.listenTo(n,e+":search",function(){this.refresh({key:"Search"})}),this.listenTo(n,e+":added",function(){this.refresh()}),this.listenTo(n,e+":edited",function(){this.refresh()}),this.listenTo(n,e+":erased",function(){this.refresh()}),this.listenTo(n,e+":add:cancel",function(){this.refresh()}),this.listenTo(n,e+":edit:cancel",function(){this.refresh()})},subscribe:function(e){e=e||{};if(!t.isEmpty(e)){var r=e.key?{key:e.key}:null;this.listenTo(n,e.event,function(){this.refresh(r)})}},refresh:function(e){var n=t.clone(this.keys),r;e&&n.push(e),r=this.createNodes(n),this.refreshDom(r)},createNodes:function(e){return t.map(e,function(e,t,n){return this.createNode(e,t,n)},this)},createNode:function(e,t,n){var r;return this.isRoot(e,t)?r=this.createRootNode(e.key):this.isLeaf(e,t,n)?r=this.createLeafNode(e.key):r=this.createInnerNode(e.key),r},createRootNode:function(t){return e('<li><i class="fa fa-home"></i> <a href="site-structure"> '+r.t(t)+"</a></li>")},createInnerNode:function(t){return e("<li>&nbsp;"+r.t(t)+"</li>")},createLeafNode:function(t){return e('<li class="active">&nbsp;'+r.t(t)+"</li>")},isRoot:function(e,t){return t===0},isLeaf:function(e,t,n){return n.length===t+1}})}),define("hbars!module/error/accessDenied/template/accessDenied",["Handlebars"],function(e){return e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){return'<div class="well">\n  <h1 class="grey lighter smaller center">\n    <span class="bigger-125">\n      <span class="fa-stack">\n        <i class="fa fa-key fa-stack-1x"></i>\n        <i class="fa fa-ban fa-stack-2x text-danger"></i>\n      </span>\n      403\n    </span>\n    '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.accessDenied.title",{name:"t",hash:{},data:r}))+'\n  </h1>\n\n  <div class="space"></div>\n  <hr>\n  <div class="space"></div>\n\n\n  <h4 class="lighter smaller center">\n      '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.accessDenied.text",{name:"t",hash:{},data:r}))+'\n  </h4>\n\n  <div class="space-32"></div>\n\n</div>'},useData:!0})}),define("module/error/accessDenied/view/accessDenied",["underscore","jquery","backbone","hbars!module/error/accessDenied/template/accessDenied"],function(e,t,n,r){return n.View.extend({template:r})}),define("hbars!module/common/navigation/template/bookmarker",["Handlebars"],function(e){return e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i;return'<a href="#" class="bookmarker ace-tooltip '+this.escapeExpression((i=(i=t.bookmark_class||(e!=null?e.bookmark_class:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"bookmark_class",hash:{},data:r}):i))+'" data-toggle="tooltip" data-placement="left" title="" data-original-title="Bookmark this page"><i class="fa '+this.escapeExpression((i=(i=t.bookmark_icon||(e!=null?e.bookmark_icon:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"bookmark_icon",hash:{},data:r}):i))+' bigger-150 pull-right"></i></a>'},useData:!0})}),define("module/common/navigation/view/bookmarker",["hbars!module/common/navigation/template/bookmarker","backbone"],function(e,t){var n=t.View.extend({template:e,events:{"click a.bookmarker":"toggleBookmark"},initialize:function(){this.bookmarked=!1,this.listenTo(t,"bookmark:bookmarked",this.pageBookmarked),this.listenTo(t,"bookmark:unbookmarked",this.pageUnbookmarked)},serialize:function(){return{bookmark_class:this.bookmarked?"bookmarked":"",bookmark_icon:this.bookmarked?"fa-bookmark":"fa-bookmark-o"}},pageBookmarked:function(){this.bookmarked=!0,this.render()},pageUnbookmarked:function(){this.bookmarked=!1,this.render()},toggleBookmark:function(e){e.preventDefault(),t.trigger("bookmark:toggle")}});return n}),define("module/common/page/adminPage",["jquery","underscore","backbone","i18n","ace","ace.extra","ace.elements","module/common/navigation/view/breadcrumb","module/common/navigation/model/userProfile","module/error/accessDenied/view/accessDenied","module/common/navigation/view/bookmarker"],function(e,t,n,r,i,s,o,u,a,f,l){if(sessionStorage.redirectHash){var c=sessionStorage.redirectHash;sessionStorage.removeItem("redirectHash"),window.location=window.location.toString()+c}var h={createPage:function(s){var o=n.View.extend({template:s.template,selector:s.selector||".page-content > .row > .col-xs-12",userLevel:s.userLevel,events:{"submit .form-search":"search","hidden.bs.modal .modal":"openModalChecker","shown.bs.modal .modal":"openModalChecker"},initialize:function(){this.moduleName=s.moduleName,this.user=new a;var e=t.map(s.breadcrumbKeys,function(e){return{key:e}});this.breadcrumb=new u({keys:e}),this.bookmarker=new l,this.context=s.context||{},this.listenTo(this.user,"sync:read",this.onUser),this.listenTo(n,"page:reload",this.reloadPage),this.listenTo(n,"page:render:dinamic:views",this.renderDynamicViews),this.user.fetch().done(function(e){localStorage.setItem("userHtmlEditorId",e.htmlEditorId)}),s.breadcrumbEvents&&t.each(s.breadcrumbEvents,function(e){this.breadcrumb.subscribe(e)},this),s.subscribeBreadcrumb&&s.subscribeBreadcrumb(this.breadcrumb),s.afterInitHook&&s.afterInitHook(this)},beforeRender:function(){this.insertView("#bookmarker",this.bookmarker)},afterRender:function(){this.appendBreadcrumb(),this.changeTitle(),n.PRODUCTION||(i.handle_side_menu(e),i.widget_boxes(e)),s.router&&this.setupRouter(),this.focusOnFirstItem(),s.afterRender&&s.afterRender(this)},setupRouter:function(){this.router=s.router,this.router.setPage(this),s.beforeRouterStart?s.beforeRouterStart().then(function(){n.history.start()}.bind(this)):n.history.start(),delete s.router},notFound:function(){this.router.goHome()},appendBreadcrumb:function(){this.breadcrumb.render(),this.$("#breadcrumbs").append(this.breadcrumb.$el)},notifyUser:function(){n.trigger("user",this.user.toJSON())},onUser:function(){localStorage.setItem("userLevel",Number(this.user.get("userLevel"))),this.notifyUser(),this.renderViews(),s.onUser&&s.onUser(this)},renderViews:function(){this.user.hasAccess(s.userLevel)?this.renderInnerViews():this.renderAccessDenied()},renderInnerViews:function(){var e=this;t.each(s.views,function(n,r){t.each(n,function(t){e.setView(r,t,!0).render()})})},renderAccessDenied:function(){var e=new f;this.setView(this.selector,e).render()},serialize:function(){var e=s.serialize||{},t=this.moduleName.toLowerCase();return{header:e.header||r.t(t+":page.header"),subheader:e.subheader||r.t(t+":page.subheader"),backwardCompatibility:e.backwardCompatibility||!1,linkToOldVersion:e.linkToOldVersion}},i18nText:function(e){var t=this.moduleName.toLowerCase();return r.t(t+":"+e)},openModalChecker:function(){e(".modal.in").length>0?e("body").addClass("modal-open"):e("body").removeClass("modal-open")},changeTitle:function(){document.title=this.i18nText("page.title")+r.t("common.page.title")},isListFetched:function(){var e=this.getView({id:"listView"}),t;return e?(t=e.collection||e.model,!t.isEmpty()):!1},focusOnFirstItem:function(){this.$(".first-item").focus()},reloadPage:function(){location.reload()},search:function(t){t.preventDefault();var n=e(t.target).find("input"),r=n.val();if(r.length<3)return;location.assign("search?q="+r)},renderDynamicViews:function(e){var n=this;t.each(e,function(e,r){t.each(e,function(e){n.setView(r,e,!0).render()})})}});return new o}};return h}),define("hbars!module/common/layout/template/column_12",["Handlebars"],function(e){return e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i;return'<div class="row">\n  <div id="breadcrumbs" class="breadcrumbs">\n    <div class="nav-search" id="nav-search">\n      <form class="form-search">\n        <span class="input-icon">\n          <input type="text" placeholder="Search ..." class="input-sm nav-search-input" id="nav-search-input" autocomplete="off">\n          <i class="fa fa-search nav-search-icon"></i>\n        </span>\n      </form>\n    </div>\n  </div>\n</div>\n\n<div id="page-content" class="page-content no-focus clearfix" role="main" tabindex="0">\n  <div class="warning"></div>\n  <div class="page-header position-relative row">\n    <div class="col-xs-11">\n      <h1>\n        <span class="js-header">'+this.escapeExpression((i=(i=t.header||(e!=null?e.header:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"header",hash:{},data:r}):i))+'</span>\n        <small>\n          <i class="fa fa-angle-double-right"></i> \n          <span class="js-subheader">'+this.escapeExpression((i=(i=t.subheader||(e!=null?e.subheader:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"subheader",hash:{},data:r}):i))+'</span>\n        </small>\n      </h1>\n    </div>\n    <div id="bookmarker" class="pull-right"></div>\n  </div>\n\n  <div class="row">\n    <div class="col-xs-12">\n\n    </div>\n  </div>\n</div>\n\n\n'},useData:!0})}),function(e){e.gritter={},e.gritter.options={position:"",class_name:"",fade_in_speed:"medium",fade_out_speed:1e3,time:6e3},e.gritter.add=function(e){try{return t.add(e||{})}catch(n){var r="Gritter Error: "+n;typeof console!="undefined"&&console.error?console.error(r,e):alert(r)}},e.gritter.remove=function(e,n){t.removeSpecific(e,n||{})},e.gritter.removeAll=function(e){t.stop(e||{})};var t={position:"",fade_in_speed:"",fade_out_speed:"",time:"",_custom_timer:0,_item_count:0,_is_setup:0,_tpl_close:'<div class="gritter-close"></div>',_tpl_title:'<span class="gritter-title">[[title]]</span>',_tpl_item:'<div id="gritter-item-[[number]]" class="gritter-item-wrapper [[item_class]]" style="display:none"><div class="gritter-top"></div><div class="gritter-item">[[close]][[image]]<div class="[[class_name]]">[[title]]<p>[[text]]</p></div><div style="clear:both"></div></div><div class="gritter-bottom"></div></div>',_tpl_wrap:'<div id="gritter-notice-wrapper"></div>',add:function(n){typeof n=="string"&&(n={text:n});if(n.text===null)throw'You must supply "text" parameter.';this._is_setup||this._runSetup();var r=n.title,i=n.text,s=n.image||"",o=n.sticky||!1,u=n.class_name||e.gritter.options.class_name,a=e.gritter.options.position,f=n.fade_in_speed||"medium",l=n.fade_out_speed||"medium",c=n.time||"";this._verifyWrapper(),this._item_count++;var h=this._item_count,p=this._tpl_item;e(["before_open","after_open","before_close","after_close"]).each(function(r,i){t["_"+i+"_"+h]=e.isFunction(n[i])?n[i]:function(){}}),this._custom_timer=0,c&&(this._custom_timer=c);var d=s!=""?'<img src="'+s+'" class="gritter-image" />':"",v=s!=""?"gritter-with-image":"gritter-without-image";r?r=this._str_replace("[[title]]",r,this._tpl_title):r="",p=this._str_replace(["[[title]]","[[text]]","[[close]]","[[image]]","[[number]]","[[class_name]]","[[item_class]]"],[r,i,this._tpl_close,d,this._item_count,v,u],p);if(this["_before_open_"+h]()===!1)return!1;e("#gritter-notice-wrapper").addClass(a).append(p);var m=e("#gritter-item-"+this._item_count);return m.fadeIn(f,function(){t["_after_open_"+h](e(this))}),o||this._setFadeTimer(m,h),e(m).bind("mouseenter mouseleave",function(n){n.type=="mouseenter"?o||t._restoreItemIfFading(e(this),h):o||t._setFadeTimer(e(this),h),t._hoverState(e(this),n.type)}),e(m).find(".gritter-close").click(function(){t.removeSpecific(h,{},null,!0)}),h},_countRemoveWrapper:function(t,n,r){n.remove(),this["_after_close_"+t](n,r),e(".gritter-item-wrapper").length==0&&e("#gritter-notice-wrapper").remove()},_fade:function(e,n,r,i){var r=r||{},s=typeof r.fade!="undefined"?r.fade:!0,o=r.speed||this.fade_out_speed,u=i;this["_before_close_"+n](e,u),i&&e.unbind("mouseenter mouseleave"),s?e.animate({opacity:0},o,function(){e.animate({height:0},300,function(){t._countRemoveWrapper(n,e,u)})}):this._countRemoveWrapper(n,e)},_hoverState:function(e,t){t=="mouseenter"?(e.addClass("hover"),e.find(".gritter-close").show()):(e.removeClass("hover"),e.find(".gritter-close").hide())},removeSpecific:function(t,n,r,i){if(!r)var r=e("#gritter-item-"+t);this._fade(r,t,n||{},i)},_restoreItemIfFading:function(e,t){clearTimeout(this["_int_id_"+t]),e.stop().css({opacity:"",height:""})},_runSetup:function(){for(opt in e.gritter.options)this[opt]=e.gritter.options[opt];this._is_setup=1},_setFadeTimer:function(e,n){var r=this._custom_timer?this._custom_timer:this.time;this["_int_id_"+n]=setTimeout(function(){t._fade(e,n)},r)},stop:function(t){var n=e.isFunction(t.before_close)?t.before_close:function(){},r=e.isFunction(t.after_close)?t.after_close:function(){},i=e("#gritter-notice-wrapper");n(i),i.fadeOut(function(){e(this).remove(),r()})},_str_replace:function(e,t,n,r){var i=0,s=0,o="",u="",a=0,f=0,l=[].concat(e),c=[].concat(t),h=n,p=c instanceof Array,d=h instanceof Array;h=[].concat(h),r&&(this.window[r]=0);for(i=0,a=h.length;i<a;i++){if(h[i]==="")continue;for(s=0,f=l.length;s<f;s++)o=h[i]+"",u=p?c[s]!==undefined?c[s]:"":c[0],h[i]=o.split(l[s]).join(u),r&&h[i]!==o&&(this.window[r]+=(o.length-h[i].length)/l[s].length)}return d?h:h[0]},_verifyWrapper:function(){e("#gritter-notice-wrapper").length==0&&e("body").append(this._tpl_wrap)}}}(jQuery),define("jquery.gritter",function(){}),define("module/common/feedback/view/notifier",["jquery","underscore","backbone","i18n","jquery.gritter"],function(e,t,n,r,i){var s=n.View.extend({className:"notifications",wait:3500,remoteWait:null,_events:[],initialize:function(e){this.options=e||{},this.options.isCRUD&&this.subscribeForCrudOn(this.options.moduleName),this.subscribeForError(),this.listenTo(n,"notifier:subscribe",this.subscribe)},subscribe:function(e){if(this.isEventListenedTo(e))return;this.listenToEvent(e)},isEventListenedTo:function(e){return!!this._events[e]},listenToEvent:function(e){this.listenTo(n,e,function(t){t=t||{},this.notify(e,t)}),this._events[e]=e},subscribeForCrudOn:function(e){this.subscribe(e+":added"),this.subscribe(e+":edited"),this.subscribe(e+":duplicated"),this.subscribe(e+":mirrored"),this.subscribe(e+":reordered"),this.subscribe(e+":erased"),this.subscribe(e+":cancelled"),this.subscribe(e+":reset"),this.subscribe(e+":edit:keyword_selector:warning")},subscribeForError:function(){this.subscribe("error:403"),this.subscribe("error:404"),this.subscribe("error:409"),this.subscribe("error:413"),this.subscribe("error:417"),this.subscribe("error:500")},notify:function(e,t){t&&t.response&&this.remapErrorCode(t.response);var n=this.createNotificationOptions(e,t);this.addNotification(n)},createNotificationOptions:function(e,n){var i="success";e=e.toLowerCase(),e.indexOf("error")>=0&&(i="error"),e.indexOf("warning")>=0&&(i="warning"),e.indexOf("error:417")>=0&&(i="warning");var s=this.getRootKey(e,n),o=this.getPlaceholder(n),u,a;a=this.getIcon(i)+r.t(s+".title",{item:o}),n&&n.freeTitle&&(a=n.freeTitle);if(n&&n.freeDescription)u=n.freeDescription;else if(n&&n.overwriteDescription)u=r.t(s+"."+n.overwriteDescription.text);else{var f=n?t.extend(n,{item:o}):{item:o};u=r.t(s+".description",f)}return{title:a,text:u,fade_in_speed:"fast",sticky:i==="error",time:i==="error"?0:this.wait,class_name:"gritter-"+i,type:i}},getIcon:function(e){var t="fa fa-exclamation-circle";return e==="success"&&(t="fa fa-check-circle"),e==="warning"&&(t="fa fa-warning"),'<i class="'+t+'"></i> '},addNotification:function(t){e.gritter.add(t)},getRootKey:function(e,t){var n=e.split(":"),r,i;t&&t.common?r="common":r=n.shift(),n.unshift("notification"),t&&t.response&&t.response.responseJSON&&t.response.status>=400&&(i=t.response.responseJSON.errorText||t.response.responseJSON.errorMessage,r==="error"&&(i=i.toUpperCase().replace(/ /g,"_")),n.push(i));var s=n.join(".");return s=r.toLowerCase()+":"+s,s},getPlaceholder:function(e){var t=e&&e.model,n;return t&&e.model.moduleName?n=r.t("model."+e.model.moduleName):t&&e.model.prefix?n=r.t("model."+e.model.prefix):n=r.t("model.item"),n},remapErrorCode:function(e){var t=e.responseJSON&&e.responseJSON.errorText,n=t?e.responseJSON.errorText:null;/Access denied/.test(n)&&(e.responseJSON.errorText="ACCESS_DENIED")}});return s}),define("helper/settings",["backbone"],function(e){var t=e.Model.extend({defaults:{language:"en"}});return new t}),define("module/common/share/model/shareableItem",["underscore","backbone","i18n","helper/settings"],function(e,t,n){var r=t.Model.extend({defaults:{id:"",primaryGroup:{id:"",name:""},sharedGroups:[]},moduleName:"",initialize:function(e,t){t=t||{},this.moduleName=t.moduleName},getPrimaryGroupId:function(){return this.attributes.primaryGroup?this.attributes.primaryGroup.id:null},findItem:function(t){return e.find(this.attributes.sharedGroups,function(e){return e.id==t})},addItem:function(e){var t=this.attributes.sharedGroups||[],n=this.findItem(e.id),r=!n;n={id:parseInt(e.id)||"",name:e.name,fullAccess:e.fullAccess||!1},r&&this.attributes.sharedGroups.unshift(n)},removeItem:function(t){if(!this.attributes.sharedGroups)return;this.attributes.sharedGroups=e.reject(this.attributes.sharedGroups,function(e){return e.id==t})},sort:function(){this.attributes.sharedGroups=this.sortBySharedGroupName(this.attributes.sharedGroups)},sortBySharedGroupName:function(t){return e.sortBy(t,function(e){return e.name.toUpperCase()})},parse:function(e,t){var n=e;return n.sharedGroups=this.sortBySharedGroupName(n.sharedGroups),n},url:function(){return t.SERVICE_BASE_URL+"/"+this.moduleName+"/"+this.get("id")+"/share"}});return r}),define("module/common/share/model/group",["underscore","backbone","i18n","helper/settings"],function(e,t,n){var r=t.Model.extend({defaults:{id:"",name:""},initialize:function(e,t){}});return r}),define("module/common/share/model/groups",["underscore","backbone","module/common/share/model/group","helper/settings"],function(e,t,n){var r=t.Collection.extend({model:n,url:function(){return t.SERVICE_BASE_URL+"/group"},getName:function(e){var t=this.get(e);return t?t.get("name"):""},toComboFeed:function(){var e=this.map(function(e){return{id:e.get("id"),text:e.get("name")}});return e}});return r}),define("module/common/page/t4CollectionView",["require","backbone"],function(e){var t=e("backbone");return t.View.extend({ItemView:null,EmptyView:null,childViewEventPrefix:"childview",constructor:function(e){e=e||{},this.context=e.context||{},this.router=e.router||{},t.View.apply(this,arguments),this.ItemView=this.ItemView||t.View,this.addListeners()},addListeners:function(){this.options.manager&&(this.manager=this.options.manager,this.listenTo(this.manager,"goToView",this.onGoToView)),this.listenTo(this,"beforeRender",this.onBeforeRender),this.listenTo(this.collection,"add",this.addNewItem,this),this.listenTo(this.collection,"remove",this.removeItem,this),this.listenTo(this.collection,"reset",this.resetItems,this),this.listenTo(this.collection,"sort",this.onSortItems,this)},addNewItem:function(e){this._onAdd=!0;var t=this.addItem(e);return this.hasRendered&&t.render(),this.handleEmptyView(),t},removeItem:function(e){this._onRemove=!0;var t=this.getView({model:e});t&&t.remove(),this.handleEmptyView()},onSortItems:function(){!this._onAdd&&!this._onRemove&&this.render(),this._onAdd=this._onRemove=!1},proxyChildEvents:function(e){var t=this.childViewEventPrefix;this.listenTo(e,"all",function(){var n=_.toArray(arguments),r=n[0],i=_.result(this,"childEvents");n[0]=t+":"+r,n.splice(1,0,e),typeof i!="undefined"&&_.isFunction(i[r])&&i[r].apply(this,n.slice(1)),this.trigger.apply(this,n)})},moveTo:function(e,t){var n=this.collection.indexOf(e);n>-1&&n!==t&&(this.collection.remove(e,{silent:!0}),this.collection.add(e,{at:t,silent:!0}),this.render())},handleEmptyView:function(){var e;!this.collection.length&&this.EmptyView?this.addEmptyView():this.EmptyView&&(e=this.getViews().filter(function(e){return e instanceof this.EmptyView},this).first().value(),e&&e.remove())},addEmptyView:function(){var e=[new this.EmptyView];_.isUndefined(this.root)||e.unshift(this.root);var t=this.insertView.apply(this,e);return this.hasRendered&&t.render(),t},reuseOldItem:function(e,t,n){var r=(n||this.getViews()).value()[t];return r.model=e,this.hasRendered&&r.render(),r},getChildView:function(e){return this.ItemView},addItem:function(e){var t=["el","id","attributes","className","tagName","events","template"],n=_.extend({},_.omit(this.options,t),{model:e}),r=[new(this.getChildView(e))(n)],i;return _.isUndefined(this.root)||r.unshift(this.root),i=this.insertView.apply(this,r),this.proxyChildEvents(i),i.once("afterRender",function(){i.name&&setTimeout(function(){this.manager.trigger("goneToView",{viewId:i.name})}.bind(this))},this),i},resetItems:function(e,t){var n=this.getViews().filter(function(e){return e instanceof this.getChildView(e.model)},this),r=n.value().length,i;r.length?this.render():(e.each(function(e,t){r>t?this.reuseOldItem(e,t,n):this.addNewItem(e)},this),r>e.length&&(i=n.value().slice(e.length,r),_.each(i,function(e){e.remove()})),this.handleEmptyView())},onBeforeRender:function(){this.getViews().each(function(e){this.stopListening(e)}),this.collection.map(this.addItem,this),this.handleEmptyView()}})}),define("hbars!module/common/share/template/sharedGroupsTable",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){return"          <th></th>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i;return'<table id="table_share" class="table table-striped table-bordered table-hover">\n  <thead>\n    <tr>\n      <th class="table-span-6">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.share.list.header.group",{name:"t",hash:{},data:r}))+'</th>\n      <th class="table-span-6">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.share.list.header.access",{name:"t",hash:{},data:r}))+"</th>\n"+((i=t.unless.call(e,e!=null?e.secondaryReadOnly:e,{name:"unless",hash:{},fn:this.program(1,r,0),inverse:this.noop,data:r}))!=null?i:"")+'    </tr>\n  </thead>\n  <tbody class="js-controls"></tbody>\n</table>\n'},useData:!0})}),define("module/common/share/model/remainingGroups",["require","backbone","helper/roles"],function(e){var t=e("backbone"),n=e("helper/roles");return t.Collection.extend({initialize:function(e){this.allGroups=e&&e.allGroups||{},this.inlineModel=e&&e.inlineModel||{},this.sharedGroupsCollection=e&&e.sharedGroupsCollection||{},this.assetModel=e&&e.assetModel||{}},getRemainingPlus:function(e){var t=this.removePrimaryAndSecondaryGroups();if(_.isUndefined(e))return t;if(e!==0){var n=_.findWhere(this.allGroups.models,{id:e});n?t.push(n.toJSON()):t.push(this.getInformationFromAsset(e))}return t},checkAccessAndPopulate:function(e,t){if(_.isUndefined(e))throw"an id is required";if(e===0&&n.isAdministrator())return this.getRemainingPlus(e);var r=_.findWhere(this.allGroups.models,{id:e});return r&&t==="primary"?this.inlineModel.set("primaryGroupAccess",!0):_.isUndefined(r)&&t==="primary"&&this.inlineModel.set("primaryGroupAccess",!1),this.getRemainingPlus(e)},getInformationFromAsset:function(e){var t,n=_.findWhere(this.assetModel.get("sharedGroups"),{id:e}),r;return n&&(t=n),r=_.findWhere(this.assetModel.get("primaryGroup"),{id:e}),r&&(t=r),t},removePrimaryAndSecondaryGroups:function(){var e=[];return e=_.map(this.sharedGroupsCollection.models,function(e){return e.id}),this.inlineModel.get("primaryGroupId")!==0&&e.push(this.inlineModel.get("primaryGroupId")),this.filterGroups(e)},filterGroups:function(e){return _.filter(this.allGroups.toJSON(),function(t){return!_.contains(e,t.id)}.bind(this))}})}),define("hbars!module/common/share/template/emptyItemView",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){return"<td></td>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r,i,s){var o;return"<td></td>\n<td></td>\n"+((o=t.unless.call(e,s[1]!=null?s[1].secondaryReadOnly:s[1],{name:"unless",hash:{},fn:this.program(1,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")},useData:!0,useDepths:!0})}),define("hbars!module/common/share/template/sharedGroupItem",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){return" readonly"},3:function(e,t,n,r){return'<td><button type="button" class="btn btn-danger btn-xs shareEraseRowBtn" '+this.escapeExpression((t.disableIfReadonly||e&&e.disableIfReadonly||t.helperMissing).call(e,e,{name:"disableIfReadonly",hash:{},data:r}))+'><i class="fa fa-times"></i>  <span class="hidden-sm">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.eraseRow",{name:"t",hash:{},data:r}))+"</span></button></td>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r,i,s){var o;return'<td>\n    <select name="groupName" id="" class="select2 width-100 '+((o=t["if"].call(e,e!=null?e.secondaryReadOnly:e,{name:"if",hash:{},fn:this.program(1,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+'"></select>\n</td>\n<td>\n  <div class="form-group">\n    <label class="col-sm-3 control-label sr-only" for="">label to be added</label>\n    <div class="col-xs-12 col-sm-12">\n      <select name="readLevel" id="" class="select2 width-100 list_accessrights'+((o=t["if"].call(e,e!=null?e.secondaryReadOnly:e,{name:"if",hash:{},fn:this.program(1,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+'"></select>\n    </div>\n  </div>\n</td>\n'+((o=t.unless.call(e,s[1]!=null?s[1].secondaryReadOnly:s[1],{name:"unless",hash:{},fn:this.program(3,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")},useData:!0,useDepths:!0})}),function(e){typeof define=="function"&&define.amd?define("backbone.stickit",["underscore","backbone","exports"],e):typeof exports=="object"?e(require("underscore"),require("backbone"),exports):e(_,Backbone,{})}(function(e,t,n){t.Stickit=n,n._handlers=[],n.addHandler=function(t){t=e.map(e.flatten([t]),function(t){return e.defaults({},t,{updateModel:!0,updateView:!0,updateMethod:"text"})}),this._handlers=this._handlers.concat(t)},n.ViewMixin={_modelBindings:null,unstickit:function(t,n){if(e.isObject(n)){e.each(n,function(e,n){this.unstickit(t,n)},this);return}var r=[],i=[];this._modelBindings=e.reject(this._modelBindings,function(e){if(t&&e.model!==t)return;if(n&&e.config.selector!=n)return;return e.model.off(e.event,e.fn),i.push(e.config._destroy),r.push(e.model),!0}),e.invoke(e.uniq(r),"trigger","stickit:unstuck",this.cid),e.each(e.uniq(i),function(e){e.call(this)},this),this.$el.off(".stickit"+(t?"."+t.cid:""),n)},stickit:function(t,n){var r=t||this.model,i=n||e.result(this,"bindings")||{};this._modelBindings||(this._modelBindings=[]),this.addBinding(r,i);var s=this.remove;return s.stickitWrapped||(this.remove=function(){var e=this;return this.unstickit(),s&&(e=s.apply(this,arguments)),e}),this.remove.stickitWrapped=!0,this},addBinding:function(t,n,i){var v=t||this.model,m=".stickit."+v.cid;i=i||{};if(e.isObject(n)){var g=n;e.each(g,function(e,t){this.addBinding(v,t,e)},this);return}var y=n===":el"?this.$el:this.$(n);this.unstickit(v,n);if(!y.length)return;e.isString(i)&&(i={observe:i}),e.isFunction(i.observe)&&(i.observe=i.observe.call(this));var b=l(y,i),w=b.observe;b.selector=n,b.view=this;var E=b.bindId=e.uniqueId(),S=e.extend({stickitChange:b},b.setOptions);b._destroy=function(){s.call(this,b.destroy,y,v,b)},c(y,b,v,w),p(y,b,v,w),h(y,b,v,w);if(w){e.each(b.events,function(t){var i=t+m,u=function(e){var t=s.call(this,b.getVal,y,e,b,r.call(arguments,1)),n=o(b.updateModel,t,e,b);n&&a(v,w,t,S,b)},f=n===":el"?"":n;this.$el.on(i,f,e.bind(u,this))},this),e.each(e.flatten([w]),function(e){u(v,"change:"+e,b,function(e,t,n){var r=n&&n.stickitChange&&n.stickitChange.bindId;if(r!==E){var i=f(v,w,b);d(y,b,i,v)}})});var x=f(v,w,b);d(y,b,x,v,!0)}s.call(this,b.initialize,y,v,b)}},e.extend(t.View.prototype,n.ViewMixin);var r=[].slice,i=function(t,n){var r=(n||"").split("."),i=e.reduce(r,function(e,t){return e[t]},t);return i==null?t:i},s=function(t){t=e.isString(t)?i(this,t):t;if(t)return t.apply(this,r.call(arguments,1))},o=function(t,n,r){if(e.isBoolean(t))return t;if(e.isFunction(t)||e.isString(t)){var i=e.last(arguments).view;return s.apply(i,arguments)}return!1},u=function(e,t,n,r){var i=n.view;e.on(t,r,i),i._modelBindings.push({model:e,event:t,fn:r,config:n})},a=function(t,n,r,i,o){var u={},a=o.view;o.onSet&&(r=s.call(a,o.onSet,r,o)),o.set?s.call(a,o.set,n,r,i,o):(u[n]=r,e.isArray(n)&&e.isArray(r)&&(u=e.reduce(n,function(t,n,i){return t[n]=e.has(r,i)?r[i]:null,t},{})),t.set(u,i))},f=function(t,n,r){var i=r.view,o=function(e){return t[r.escape?"escape":"get"](e)},u=function(e){return e==null?"":e},a=e.isArray(n)?e.map(n,o):o(n);return r.onGet&&(a=s.call(i,r.onGet,a,r)),e.isArray(a)?e.map(a,u):u(a)},l=n.getConfiguration=function(t,r){var i=[{updateModel:!1,updateMethod:"text",update:function(e,t,n,r){e[r.updateMethod]&&e[r.updateMethod](t)},getVal:function(e,t,n){return e[n.updateMethod]()}}];i=i.concat(e.filter(n._handlers,function(e){return t.is(e.selector)})),i.push(r);var s=e.extend.apply(e,i);return e.has(s,"updateView")||(s.updateView=!s.visible),s},c=function(t,n,r,i){var s=["autofocus","autoplay","async","checked","controls","defer","disabled","hidden","indeterminate","loop","multiple","open","readonly","required","scoped","selected"],o=n.view;e.each(n.attributes||[],function(a){a=e.clone(a),a.view=o;var l="",c=a.observe||(a.observe=i),h=function(){var n=e.contains(s,a.name)?"prop":"attr",i=f(r,c,a);a.name==="class"?(t.removeClass(l).addClass(i),l=i):t[n](a.name,i)};e.each(e.flatten([c]),function(e){u(r,"change:"+e,n,h)}),h()})},h=function(t,n,r,i){e.each(n.classes||[],function(i,s){e.isString(i)&&(i={observe:i}),i.view=n.view;var o=i.observe,a=function(){var e=f(r,o,i);t.toggleClass(s,!!e)};e.each(e.flatten([o]),function(e){u(r,"change:"+e,n,a)}),a()})},p=function(t,n,r,i){if(n.visible==null)return;var o=n.view,a=function(){var u=n.visible,a=n.visibleFn,l=f(r,i,n),c=!!l;if(e.isFunction(u)||e.isString(u))c=!!s.call(o,u,l,n);a?s.call(o,a,t,c,n):t.toggle(c)};e.each(e.flatten([i]),function(e){u(r,"change:"+e,n,a)}),a()},d=function(e,t,n,r,i){var u=t.view;if(!o(t.updateView,n,t))return;s.call(u,t.update,e,n,r,t),i||s.call(u,t.afterUpdate,e,n,t)};return n.addHandler([{selector:"[contenteditable]",updateMethod:"html",events:["input","change"]},{selector:"input",events:["propertychange","input","change"],update:function(e,t){e.val(t)},getVal:function(e){return e.val()}},{selector:"textarea",events:["propertychange","input","change"],update:function(e,t){e.val(t)},getVal:function(e){return e.val()}},{selector:'input[type="radio"]',events:["change"],update:function(e,t){e.filter('[value="'+t+'"]').prop("checked",!0)},getVal:function(e){return e.filter(":checked").val()}},{selector:'input[type="checkbox"]',events:["change"],update:function(n,r,i,s){if(n.length>1)r||(r=[]),n.each(function(n,i){var s=t.$(i),o=e.contains(r,s.val());s.prop("checked",o)});else{var o=e.isBoolean(r)?r:r===n.val();n.prop("checked",o)}},getVal:function(n){var r;if(n.length>1)r=e.reduce(n,function(e,n){var r=t.$(n);return r.prop("checked")&&e.push(r.val()),e},[]);else{r=n.prop("checked");var i=n.val();i!=="on"&&i!=null&&(r=r?n.val():null)}return r}},{selector:"select",events:["change"],update:function(n,r,o,u){var a,l=u.selectOptions,c=l&&l.collection||undefined,h=n.prop("multiple");if(!l){l={};var p=function(e){return e.map(function(e,n){var r=t.$(n).data("stickit-bind-val");return{value:r!==undefined?r:n.value,label:n.text}}).get()};n.find("optgroup").length?(c={opt_labels:[]},n.find("> option").length&&(c.opt_labels.push(undefined),e.each(n.find("> option"),function(e){c[undefined]=p(t.$(e))})),e.each(n.find("optgroup"),function(e){var n=t.$(e).attr("label");c.opt_labels.push(n),c[n]=p(t.$(e).find("option"))})):c=p(n.find("option"))}l.valuePath=l.valuePath||"value",l.labelPath=l.labelPath||"label",l.disabledPath=l.disabledPath||"disabled";var d=function(n,r,s){e.each(n,function(n){var o=t.$("<option/>"),u=n,a=function(t,n,r){o.text(t),u=n,o.data("stickit-bind-val",u),!e.isArray(u)&&!e.isObject(u)&&o.val(u),r===!0&&o.prop("disabled","disabled")},f,c,p;n==="__default__"?(f=s.label,c=s.value,p=s.disabled):(f=i(n,l.labelPath),c=i(n,l.valuePath),p=i(n,l.disabledPath)),a(f,c,p);var d=function(){return!h&&u!=null&&s!=null&&u===s?!0:e.isObject(s)&&e.isEqual(u,s)?!0:!1};d()?o.prop("selected",!0):h&&e.isArray(s)&&e.each(s,function(t){e.isObject(t)&&(t=i(t,l.valuePath)),(t===u||e.isObject(t)&&e.isEqual(u,t))&&o.prop("selected",!0)}),r.append(o)})};n.find("*").remove();if(e.isString(c)){var v=window;c.indexOf("this.")===0&&(v=this),c=c.replace(/^[a-z]*\.(.+)$/,"$1"),a=i(v,c)}else e.isFunction(c)?a=s.call(this,c,n,u):a=c;if(a instanceof t.Collection){var m=a,g=function(){var e=f(o,u.observe,u);s.call(this,u.update,n,e,o,u)},y=function(){m.off("add remove reset sort",g)},b=function(){y(),m.off("stickit:selectRefresh"),o.off("stickit:selectRefresh")};m.trigger("stickit:selectRefresh"),m.once("stickit:selectRefresh",y,this),m.on("add remove reset sort",g,this),o.trigger("stickit:selectRefresh"),o.once("stickit:selectRefresh",function(){o.off("stickit:unstuck",b)}),o.once("stickit:unstuck",b,this),a=a.toJSON()}if(l.defaultOption){var w=e.isFunction(l.defaultOption)?l.defaultOption.call(this,n,u):l.defaultOption;d(["__default__"],n,w)}if(e.isArray(a))d(a,n,r);else if(a.opt_labels)e.each(a.opt_labels,function(e){var i=t.$("<optgroup/>").attr("label",e);d(a[e],i,r),n.append(i)});else{var E=[],S;for(var x in a)S={},S[l.valuePath]=x,S[l.labelPath]=a[x],E.push(S);E=e.sortBy(E,l.comparator||l.labelPath),d(E,n,r)}},getVal:function(n){var r=n.find("option:selected");return n.prop("multiple")?e.map(r,function(e){return t.$(e).data("stickit-bind-val")}):r.data("stickit-bind-val")}}]),n}),define("helper/stickit/select2Handler",["require","backbone","jquery","underscore","backbone.stickit","select2"],function(e){var t=e("backbone");e("jquery"),e("underscore"),e("backbone.stickit"),e("select2"),t.Stickit.addHandler({selector:"select.select2",initialize:function(e,n,r){var i="change:"+r.observe,s,o,u,a,f,l,c={containerCssClass:"input-large",allowClear:r.selectOptions.allowClear};e.select2(c),o=function(e){var t;return _.isString(e)&&(t=this[e.split("this.").join("")]),t},a=function(e,t,r){t&&(n.set(e,t[r]),n.set(e+"Object",t.toJSON()))},f=function(e,t,n){var i;_.isObject(t)?_.isUndefined(t.atIndex)?i=e.findWhere(t):i=e.at(t.atIndex):r.selectOptions.defaultOption||(i=e.at(0)),a(r.observe,i,n)},u=function(){l.length&&(f(l,r.selectOptions.autoSelection,r.selectOptions.valuePath),this.stopListening(l,"add",u))},l=o.call(this,r.selectOptions.collection),l instanceof t.Collection&&(l.length?f(l,r.selectOptions.autoSelection,r.selectOptions.valuePath):this.listenTo(l,"add",u,this)),s=function(n,i,s){var o={};o[r.selectOptions.valuePath]=i,l instanceof t.Collection&&(a(r.observe,l.findWhere(o),r.selectOptions.valuePath),s.stickitChange||e.trigger("change"))},this.listenTo(n,i,s),this.listenTo(n,"stickit:unstuck",function(){l instanceof t.Collection&&this.stopListening(l,"add",u),this.stopListening(n,i,s)})}})}),define("helper/stickitHandlers",["require","backbone","i18n","backbone.stickit","helper/stickit/select2Handler"],function(e){var t=e("backbone"),n=e("i18n");e("backbone.stickit"),e("helper/stickit/select2Handler"),_.mixin({containsOnlyOne:function(e){return _.filter(e,function(e){return e!==undefined?e.toString():e}).length===1}}),t.Stickit.addHandler({selector:".stick-css-when-equal",update:function(e,t,n,r){var i=r.addClass||"in";r.whenEqualIsBoolean&&(r.whenEqual===t?e.addClass(i):e.removeClass(i));if(!_.containsOnlyOne([r.whenEqual,r.whenNotEqual,r.whenEqualAny,r.whenNotEqualAny]))throw new Error(r.selector+" binding is incorrectly configured");if(r.whenEqual!==undefined){r.whenEqual.toString()&&t.toString()===r.whenEqual.toString()?e.addClass(i):e.removeClass(i);return}if(r.whenNotEqual!==undefined){r.whenNotEqual.toString()&&t.toString()!==r.whenNotEqual.toString()?e.addClass(i):e.removeClass(i);return}if(r.whenEqualAny!==undefined){_.isArray(r.whenEqualAny)&&_.contains(r.whenEqualAny,t)?e.addClass(i):e.removeClass(i);return}if(r.whenNotEqualAny!==undefined){_.isArray(r.whenNotEqualAny)&&!_.contains(r.whenNotEqualAny,t)?e.addClass(i):e.removeClass(i);return}}}),t.Stickit.addHandler({selector:".stick-i18n",update:function(e,t,r,i){e.html(n.t(t,i.data))},getVal:function(e){return e.html()}}),t.Stickit.addHandler({selector:".stick-section-path",update:function(e,t,n,r){var i=r.formatter||[/,/g,' <i class="fa fa-angle-right"></i> '];_.isString(t)&&e.html('<i class="fa fa-folder-open"></i> '+t.replace.apply(t,i))},getVal:function(e){return e.html()}}),t.Stickit.addHandler({selector:".stick-owner-name",update:function(e,t,n,r){var i=r.formatter||[/,/g,' <i class="fa fa-angle-right"></i> '];_.isString(t)&&e.html(t.replace.apply(t,i))},getVal:function(e){return e.html()}}),t.Stickit.addHandler({selector:".stick-disable-input",update:function(e,t,n,r){var i=r.uncheck||!1,s=e.find("input");if(r.whenEqual!==undefined){r.whenEqual.toString()&&t.toString()===r.whenEqual.toString()?(s.prop("disabled",!0).addClass("disabled"),i&&s.prop("checked",!1)):s.prop("disabled",!1).removeClass("disabled");return}if(r.whenNotEqual!==undefined){r.whenNotEqual.toString()&&t.toString()!==r.whenNotEqual.toString()?(s.prop("disabled",!0).addClass("disabled"),i&&s.prop("checked",!1)):s.prop("disabled",!1).removeClass("disabled");return}if(r.whenEqualAny!==undefined){_.isArray(r.whenEqualAny)&&_.contains(r.whenEqualAny,t)?(s.prop("disabled",!0).addClass("disabled"),i&&s.prop("checked",!1)):s.prop("disabled",!1).removeClass("disabled");return}if(r.whenNotEqualAny!==undefined){_.isArray(r.whenNotEqualAny)&&!_.contains(r.whenNotEqualAny,t)?(s.prop("disabled",!0).addClass("disabled"),i&&s.prop("checked",!1)):s.prop("disabled",!1).removeClass("disabled");return}}})}),define("module/common/share/view/sharedGroupItem",["require","backbone","i18n","hbars!../template/sharedGroupItem","Handlebars","backbone.stickit","helper/stickitHandlers"],function(e){var t=e("backbone"),n=e("i18n"),r=e("hbars!../template/sharedGroupItem"),i=e("Handlebars");e("backbone.stickit"),e("helper/stickitHandlers");var s=20,o=10,u=[{value:s,label:n.t("common.share.list.access_type.read_only")},{value:o,label:n.t("common.share.list.access_type.full")}];return t.View.extend({template:r,tagName:"tr",events:{"click .shareEraseRowBtn":"removeModel"},bindings:{'select[name="readLevel"]':{observe:"readLevel",selectOptions:{collection:u}},'select[name="groupName"]':{observe:"id",selectOptions:{collection:function(){return this.availableGroups},valuePath:"id",labelPath:"name"}}},initialize:function(e){var n=e||{};this.remainingGroups=n.remainingGroups||{},this.groupsPopulated=n.groupsPopulated||{},this.inlineModel=n.inlineModel||{},this.availableGroups=new t.Collection,this.addListeners()},triggerRemaining:function(){this.remainingGroups.trigger("groupChange")},addListeners:function(){this.listenTo(this.remainingGroups,"groupChange",this.updateAvailableGroups),this.listenTo(this.model,"change:id",this.triggerRemaining.bind(this))},removeModel:function(){this.inlineModel.set("noAvailableGroups",!1),this.parentView.removeModel(this.model)},updateAvailableGroups:function(){this.availableGroups.set(),this.availableGroups.reset(this.parentView.updateAvailableGroups(this.model.id,"shared")),this.stickit()},afterRender:function(){var e=_.once(this.updateAvailableGroups);this.groupsPopulated.then(e.bind(this))}})}),define("module/common/share/view/list",["require","backbone","i18n","module/common/page/t4CollectionView","hbars!module/common/share/template/sharedGroupsTable","../model/remainingGroups","hbars!../template/emptyItemView","./sharedGroupItem"],function(e){var t=e("backbone"),n=e("i18n"),r=e("module/common/page/t4CollectionView"),i=e("hbars!module/common/share/template/sharedGroupsTable"),s=e("../model/remainingGroups"),o=e("hbars!../template/emptyItemView"),u=e("./sharedGroupItem");return r.extend({template:i,root:".js-controls",comparator:"id",initialize:function(e){this.remainingGroups=e.remainingGroups,this.allGroups=e.allGroups,this.groupsPopulated=e.groupsPopulated,this.inlineModel=e.inlineModel||{},this.addItemView()},EmptyView:t.View.extend({tagName:"tr",template:o}),addItemView:function(){this.ItemView=u.extend({groupsPopulated:this.groupsPopulated,remainingGroups:this.remainingGroups,inlineModel:this.inlineModel,parentView:this})},updateAvailableGroups:function(e,t){return this.remainingGroups.checkAccessAndPopulate(e,t)},removeModel:function(e){this.collection.remove(e),this.remainingGroups.trigger("groupChange")}})}),define("hbars!module/common/share/template/inline",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){var i,s;return(i=(s=(s=t.required||(e!=null?e.required:e))!=null?s:t.helperMissing,typeof s==="function"?s.call(e,{name:"required",hash:{},data:r}):s))!=null?i:""},3:function(e,t,n,r){return'        <div class="row">\n          <div class="col-xs-12 text-right">\n            <a href="#" class="btn btn-success btn-xs add-row stick-css-when-equal" data-target="table_share" id="shareAddRowBtn"><i class="fa fa-plus"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.addRow",{name:"t",hash:{},data:r}))+"</a>\n          </div>\n        </div>\n"},5:function(e,t,n,r){return"row"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i;return'<div class="form-group js-primary-group-access stick-css-when-equal" id="toggleblock_groupaccess">\n  <label class="col-sm-3 control-label" for="form-list_desc">\n    '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.share.inline.primary_group.legend",{name:"t",hash:{},data:r}))+((i=t["if"].call(e,e!=null?e.primaryGroupRequired:e,{name:"if",hash:{},fn:this.program(1,r,0),inverse:this.noop,data:r}))!=null?i:"")+'\n  </label>\n\n  <div class="col-xs-12 col-sm-4 controls">\n    <span data-rel="tooltip" data-placement="top" title="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.share.inline.primary_group.tooltip",{name:"t",hash:{},data:r}))+'">\n      <select class=\'width-100 js-group-select select2\' name="group-select-validation"></select>\n    </span>\n    <span class="lbl"></span>\n  </div>\n\n  <div class="col-xs-12 col-sm-5">\n    <div class="space-4 visible-xs"></div>\n    <a href="javascript:;" class="btn btn-sm btn-info js-toggle-shared-groups stick-css-when-equal">\n      <i class="fa fa-users"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.share.inline.show_shared_groups",{name:"t",hash:{},data:r}))+' <i class="fa fa-angle-down"></i>\n    </a>\n    <div id="shareGlobalSharedWarning" class="hide">\n      <div class="space-10"></div>\n      <div class="alert alert-warning no-margin input-xxlarge">\n        <i class=\'fa fa-exclamation-triangle\'></i>\n        <strong>'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.share.inline.global_primary_group_warning.title",{name:"t",hash:{},data:r}))+"</strong><br>\n        "+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.share.inline.global_primary_group_warning.description",{name:"t",hash:{},data:r}))+'\n      </div>\n    </div>\n  </div>\n\n</div>\n\n<div class="js-sharedView stick-css-when-equal">\n  <div class="form-group">\n    <label class="col-sm-'+this.escapeExpression(this.lambda((i=e!=null?e.gridSize:e)!=null?i.left:i,e))+' control-label" for="form-list_desc">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.share.inline.shared_groups",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-sm-'+this.escapeExpression(this.lambda((i=e!=null?e.gridSize:e)!=null?i.right:i,e))+' controls">\n      <div class="col-sm-'+this.escapeExpression(this.lambda((i=e!=null?e.gridSize:e)!=null?i.right:i,e))+'">\n'+((i=t.unless.call(e,e!=null?e.secondaryReadOnly:e,{name:"unless",hash:{},fn:this.program(3,r,0),inverse:this.noop,data:r}))!=null?i:"")+'        <div class="space-8"></div>\n          <div class="js-sharedTable '+((i=t.unless.call(e,e!=null?e.isModal:e,{name:"unless",hash:{},fn:this.program(5,r,0),inverse:this.noop,data:r}))!=null?i:"")+'"></div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'},useData:!0})}),define("module/common/share/view/inline",["require","i18n","jquery","underscore","backbone","Handlebars","helper/makeup","helper/roles","module/common/share/view/list","module/common/share/model/groups","../model/remainingGroups","helper/roles","hbars!module/common/share/template/inline","backbone.stickit","helper/stickitHandlers"],function(e){var t=e("i18n"),n=e("jquery"),r=e("underscore"),i=e("backbone"),s=e("Handlebars"),o=e("helper/makeup"),u=e("helper/roles"),a=e("module/common/share/view/list"),f=e("module/common/share/model/groups"),l=e("../model/remainingGroups"),c=e("helper/roles"),h=e("hbars!module/common/share/template/inline");return e("backbone.stickit"),e("helper/stickitHandlers"),i.View.extend({template:h,moduleName:null,events:{"click .js-toggle-shared-groups":"onToggleGroupSharing","click #shareAddRowBtn":"onAddSharedGroup"},bindings:{".js-sharedView":{observe:"showSharedGroups",addClass:"hidden",whenEqualIsBoolean:!0,whenEqual:!1},".js-toggle-shared-groups":{observe:"primaryGroupId",addClass:"disabled",whenEqual:0},"#shareAddRowBtn":{observe:"noAvailableGroups",addClass:"disabled",whenEqualIsBoolean:!0,whenEqual:!0},".js-primary-group-access":{observe:"primaryGroupAccess",addClass:"hidden",whenEqualIsBoolean:!0,whenEqual:!1},"select.js-group-select":{observe:"primaryGroupId",selectOptions:{collection:function(){return this.availableGroups},valuePath:"id",labelPath:"name",defaultOption:function(){return this.defaultPrimaryOptions}}}},initialize:function(e){this.groupsPopulated=n.Deferred(),this.options=e||{},this.primaryGroupRequired=this.options.primaryGroupRequired!==undefined?this.options.primaryGroupRequired:u.isNotAdministrator(),this.primaryGroupID=this.options.primaryGroupID,this.model=new i.Model({showSharedGroups:!1,noAvailableGroups:!1,primaryGroupAccess:!0,isPowerUser:c.isPowerUser()});if(r.isUndefined(e.currentMode))throw"expected a string containing current mode (add/edit)";if(r.isUndefined(e.assetModel))throw"expected a current asset model";this.currentMode=e&&e.currentMode||null,this.assetModel=e&&e.assetModel||null,this.primaryGroupPromise=n.Deferred(),this.groupsCollection=new f,this.sharedGroupsCollection=new i.Collection([]),this.availableGroups=new i.Collection,this.remainingGroups=new l({inlineModel:this.model,sharedGroupsCollection:this.sharedGroupsCollection,allGroups:this.groupsCollection,assetModel:this.assetModel}),this.gridSize=this.options.gridSize||3,this.getGroups()},updateDefaultSelectOption:function(){c.isPowerUser()&&this.currentMode==="add"&&(this.model.set("primaryGroupAccess",!0),delete this.bindings["select.js-group-select"].selectOptions.defaultOption,this.availableGroups.length>0&&(this.model.set("primaryGroupId",this.availableGroups.first().id),this.availableGroups.length===1&&this.model.set("noAvailableGroups",!0))),c.isPowerUser()&&this.currentMode==="edit"&&this.model.get("primaryGroupId")!==0?delete this.bindings["select.js-group-select"].selectOptions.defaultOption:c.isPowerUser()&&this.currentMode==="edit"&&this.model.get("primaryGroupId")===0&&(this.bindings["select.js-group-select"].selectOptions.defaultOption=this.defaultPrimaryOptions),this.stickit()},defaultPrimaryOptions:{label:t.t("common.share.inline.primary_group.placeholder"),value:0},getGroups:function(){this.groupsCollection.fetch().done(function(){this.groupsPopulated.resolve()}.bind(this))},setPrimaryGroup:function(e,t){if(r.isNull(e)||r.isUndefined(e))e=0;this.model.set({primaryGroupId:e,showSharedGroups:function(){return e>0}}),this.assetModel=t,this.primaryGroupPromise.resolve()},setSharedGroups:function(e){var t=this.updateReadLevel(e);this.sharedGroupsCollection.set(t),this.createShareListView()},updateReadLevel:function(e){return r.map(e,function(e){return e.readLevel=e.fullAccess?10:20,e})},createShareListView:function(){this.shareListView=new a({collection:this.sharedGroupsCollection,id:"share-list",moduleName:this.options.moduleName,hidePrimaryGroup:!0,fetchGroups:!1,readonly:this.options.readonly,secondaryReadOnly:this.options.secondaryReadOnly!==undefined?this.options.secondaryReadOnly:this.options.readonly,primaryGroupRequired:this.primaryGroupRequired,remainingGroups:this.remainingGroups,groupsPopulated:this.groupsPopulated,inlineModel:this.model,allGroups:this.groupsCollection})},onAddSharedGroup:function(e){e.preventDefault();var t=this.remainingGroups.removePrimaryAndSecondaryGroups();t.length&&t[0]&&t[0].id&&this.sharedGroupsCollection.add(t[0]),t.length-1<=0&&this.model.set("noAvailableGroups",!0),this.triggerRemaining()},onToggleGroupSharing:function(e){this.model.set("showSharedGroups",!this.model.get("showSharedGroups"))},loadSelectTwoToolTips:function(){n("div.select2-container").tooltip({title:function(){return n(this).next().attr("data-original-title")}})},updatePrimaryGroupValidation:function(e){if(e)i.Validation.callbacks.valid(this,"group-select-validation","name");else if(this.options.moduleName=="pageLayout"){var n="pagelayout";i.Validation.callbacks.invalid(this,"group-select-validation",t.t(n+":edit.primaryGroup.validation"),"name")}else i.Validation.callbacks.invalid(this,"group-select-validation",t.t(this.options.moduleName+":edit.primaryGroup.validation"),"name")},updatedModel:function(){var e={};return e.sharedGroups=r.map(this.shareListView.collection.models,function(e){return{id:e.id,name:e.get("name"),ownershipLevel:20,readLevel:e.get("readLevel")||20}}),e.primaryGroup={id:this.model.get("primaryGroupId")},e},serialize:function(){return{gridSize:{left:this.gridSize,right:12-this.gridSize},isModal:this.isModal}},triggerRemaining:function(){this.remainingGroups.trigger("groupChange")},setAvailableGroupListeners:function(){this.listenTo(this.model,"change:primaryGroupId",this.triggerRemaining.bind(this)),this.listenTo(this.model,"change:primaryGroupAccess",this.userHasPrimaryGroupAccess.bind(this)),this.listenTo(this.remainingGroups,"groupChange",this.updateAvailableGroups)},sharedGroupsUserIsAMemberOf:function(){var e=r.intersection(r.map(this.groupsCollection.models,function(e){return e.id}),r.map(this.sharedGroupsCollection.models,function(e){return e.id}));return r.filter(this.sharedGroupsCollection.models,function(t){return r.contains(e,t.id)})},userHasPrimaryGroupAccess:function(){return this.model.get("primaryGroupAccess")?!0:(this.model.set("showSharedGroups",!1),!1)},checkSharedGroupAccess:function(){var e=r.some(this.sharedGroupsUserIsAMemberOf(),function(e){return e.get("readLevel")===10},this);e&&this.shareListView.$el.find("*").attr("disabled",!1)},setNoAvailableGroups:function(){this.remainingGroups.removePrimaryAndSecondaryGroups().length<=0?this.model.set("noAvailableGroups",!0):this.model.set("noAvailableGroups",!1)},removeSharedView:function(){this.model.set("showSharedGroups",!1),this.shareListView.collection.reset()},updateAvailableGroups:function(){var e=this.model.get("primaryGroupId");e===0&&this.removeSharedView(),this.availableGroups.set(),this.availableGroups.reset(this.shareListView.updateAvailableGroups(e,"primary")),this.currentMode==="add"&&this.model.set("primaryGroupAccess",!0),this.stickit()},validate:function(){var e;return c.isPowerUser()?e=this.model.get("primaryGroupId")!==0:e=!0,e},disablePrimaryGroupSelectForPU:function(){c.isPowerUser()&&this.$el.find("select.js-group-select").select2("enable",!1)},beforeRender:function(){this.insertView(".js-sharedTable",this.shareListView),c.isPowerUser()&&this.model.set("showSharedGroups",!0)},afterRender:function(){this.loadToolTips(),this.loadSelectTwoToolTips(),this.stickit(),n.when(this.primaryGroupPromise,this.groupsPopulated).then(function(){this.updateAvailableGroups(),this.setAvailableGroupListeners(),this.updateDefaultSelectOption(),this.userHasPrimaryGroupAccess(),this.currentMode!=="add"&&this.disablePrimaryGroupSelectForPU()}.bind(this))}})}),define("hbars!module/common/share/template/modal",["Handlebars"],function(e){return e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){return'<div id="modal_share" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="deleteLocalLabel" aria-hidden="true">\n  <div class="modal-dialog modal-lg">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã</button>\n        <h3 class="modal-title"> <i class="fa fa-share blue"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.share.title",{name:"t",hash:{},data:r}))+'</h3>\n      </div>\n      <div class="modal-body">\n\n        <div class="row">\n          <div class="col-xs-12">\n            <p>'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.share.description",{name:"t",hash:{},data:r}))+'</p>\n\n            <div id="share-list"></div>\n\n          </div>\n        </div>\n\n      </div>\n      <div class="modal-footer">\n        <a class="btn" id=\'shareCancelBtn\' href="javascript:;"  aria-hidden="true"><i class="fa fa-undo"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.cancel",{name:"t",hash:{},data:r}))+'</a>\n        <a class="btn btn-primary" id=\'shareSaveBtn\' href="javascript:;" aria-hidden="true"><i class="fa fa-save"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.save",{name:"t",hash:{},data:r}))+"</a>\n      </div>\n    </div>\n  </div>\n</div>"},useData:!0})}),define("module/common/share/view/modal",["require","jquery","underscore","backbone","i18n","module/common/share/model/shareableItem","module/common/share/model/groups","module/common/share/view/inline","hbars!module/common/share/template/modal"],function(e){var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("i18n"),s=e("module/common/share/model/shareableItem"),o=e("module/common/share/model/groups"),u=e("module/common/share/view/inline"),a=e("hbars!module/common/share/template/modal");return r.View.extend({template:a,moduleName:null,events:{"click #shareCancelBtn":"cancel","click #shareSaveBtn":"save"},initialize:function(e){n.extend(this,e||{}),this.model=new s({},{moduleName:this.moduleName}),this.listenTo(r,this.eventNameShare(),this.show),this.listenTo(r,this.eventNameShare(),this.setupShareListView),this.listenTo(r,this.eventNameHome(),this.hide),this.listenTo(this.model,"sync",this.notifyEdited),this.listenTo(this.model,"error",this.notifyError),this.isModalClosedWithButtons=!1},setupShareListView:function(e,t){var n;t&&(this.sharedInfoDetails=t,this.shareListView=this.getShareListView(),n=t.get("primaryGroup")?t.get("primaryGroup").id:0,this.updateShareListViewWithGroupInfo(t,n),this.insertView("#share-list",this.shareListView).render())},getShareListView:function(){return new u({id:"share-list",moduleName:this.moduleName,fetchGroups:!0,gridSize:12,isModal:!0,currentMode:"edit",assetModel:this.sharedInfoDetails})},updateShareListViewWithGroupInfo:function(e,t){this.shareListView.setPrimaryGroup(t),this.shareListView.setSharedGroups(e.get("sharedGroups"))},serialize:function(){return{}},save:function(){this.model.set(this.shareListView.updatedModel()),this.model.set("id",this.sharedInfoDetails.id),this.model.save()},cancel:function(){this.isModalClosedWithButtons=!0,this.hide(),r.trigger(this.eventNameShareCancel(),this.model.toJSON())},show:function(){this.$("#modal_share").modal("show")},hide:function(){this.$("#modal_share").modal("hide"),this.shareListView&&this.shareListView.remove()},afterRender:function(){this.forceCancelNotificationOnClose()},forceCancelNotificationOnClose:function(){var e=this;this.$("#modal_share").on("hidden",function(t){e.isModalClosedWithButtons||r.trigger(e.eventNameShareCancel()),e.isModalClosedWithButtons=!1})},notifyEdited:function(){this.isModalClosedWithButtons=!0,this.hide(),r.trigger(this.eventNameEdited(),this.model.toJSON())},notifyError:function(){r.trigger(this.eventNameError(),this.model.toJSON())},eventNameHome:function(){return this.moduleName+":home"},eventNameError:function(){return this.moduleName+":error"},eventNameShare:function(){return this.moduleName+":share"},eventNameEdited:function(){return this.moduleName+":edited"},eventNameShared:function(){return this.moduleName+":shared"},eventNameShareCancel:function(){return this.moduleName+":share:cancel"}})}),define("hbars!module/common/layout/template/opening",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){var i;return'        <a href="'+this.escapeExpression((i=(i=t.secondaryActionUrl||(e!=null?e.secondaryActionUrl:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"secondaryActionUrl",hash:{},data:r}):i))+'" class="btn btn-info secondary-btn">\n          <i class="'+this.escapeExpression((i=(i=t.secondaryIconClasses||(e!=null?e.secondaryIconClasses:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"secondaryIconClasses",hash:{},data:r}):i))+'"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,e!=null?e.secondaryActionKey:e,{name:"t",hash:{},data:r}))+"\n        </a>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i,s;return'<div class="row">\n  <div class="col-xs-5 col-sm-6 col-md-6 col-lg-7">\n    <p>'+((i=(s=(s=t.openingText||(e!=null?e.openingText:e))!=null?s:t.helperMissing,typeof s==="function"?s.call(e,{name:"openingText",hash:{},data:r}):s))!=null?i:"")+'</p>\n  </div>\n\n  <div class="col-xs-7 col-sm-6 col-md-6 col-lg-5 text-right">\n    <p>\n'+((i=t["if"].call(e,e!=null?e.secondaryAction:e,{name:"if",hash:{},fn:this.program(1,r,0),inverse:this.noop,data:r}))!=null?i:"")+'      <a href="'+this.escapeExpression((s=(s=t.mainActionUrl||(e!=null?e.mainActionUrl:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"mainActionUrl",hash:{},data:r}):s))+'" class="btn btn-success primary-btn123">\n        <i class="fa fa-plus"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,e!=null?e.mainActionKey:e,{name:"t",hash:{},data:r}))+'\n      </a>\n    </p>\n  </div>\n</div>\n<div class="space-4"></div>\n'},useData:!0})}),define("module/common/layout/view/crudOpening",["jquery","underscore","backbone","Handlebars","hbars!module/common/layout/template/opening","i18n"],function(e,t,n,r,i,s){var o=n.View.extend({template:i,events:{"click .btn-info":"notifySecondary"},initialize:function(e){e=e||{},this.secondaryAction=e.secondaryAction||{required:!1,localeKey:"",url:"",iconClasses:""},this.module=e.module,this.placeholders=e.placeholders||{},this.registerShow(),this.registerHide()},registerShow:function(){this.listenTo(n,this.createEventName("home"),this.show)},registerHide:function(){this.listenTo(n,this.createEventName("duplicate"),this.hide),this.listenTo(n,this.createEventName("edit"),this.hide),this.listenTo(n,this.createEventName("add"),this.hide),this.listenTo(n,this.createEventName("view"),this.hide)},createEventName:function(e){return this.module+":"+e},hide:function(){this.$el.hide()},show:function(){this.$el.show()},notifySecondary:function(){n.trigger(this.module+":secondary:button")},serialize:function(){var e=this.module.toLowerCase();return{mainActionKey:e+":page.main_action",mainActionUrl:r.helpers.addUrl(),secondaryAction:this.secondaryAction.required,secondaryActionKey:e+":"+this.secondaryAction.localeKey,secondaryActionUrl:"#"+this.secondaryAction.url,secondaryIconClasses:this.secondaryAction.iconClasses,openingText:s.t(e+":page.opening",this.placeholders),iconClasses:"fa fa-plus icon-on-right"}}});return o}),define("module/assets/pageLayout/model/pageLayout",["underscore","backbone","i18n"],function(e,t,n){var r=t.Model.extend({defaults:{name:"",description:"",fileExtension:"",syntaxType:"",headerCode:"",footerCode:"",stylesheetCode:"",sharedGroups:[]},validation:{name:{required:!0,msg:n.t("pagelayout:add.name.validation")}},urlRoot:t.SERVICE_BASE_URL+"/pageLayout",getPrimaryGroupId:function(){return this.attributes.primaryGroup?this.attributes.primaryGroup.id:null},fetchForDuplication:function(){var e=this;this.fetch({success:function(){e.unset("id")}})},getVersion:function(t){var n=this.get("versions")||[];return e.find(n,function(e,n){return t==e.version})},prefix:"pageLayout"});return r}),define("module/assets/pageLayout/model/pageLayouts",["underscore","backbone","module/assets/pageLayout/model/pageLayout"],function(e,t,n){var r=t.Collection.extend({model:n,url:t.SERVICE_BASE_URL+"/pageLayout"});return r}),define("hbars!module/assets/pageLayout/template/list",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){var i,s;return"    "+((i=(s=(s=t.showLoading||(e!=null?e.showLoading:e))!=null?s:t.helperMissing,typeof s==="function"?s.call(e,{name:"showLoading",hash:{},data:r}):s))!=null?i:"")+"\n"},3:function(e,t,n,r){var i;return'  <table id="table_pageLayouts" class="table table-striped table-bordered table-hover">\n    <thead>\n    <tr>\n      <th class="table-span-8">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:list.header.name",{name:"t",hash:{},data:r}))+'</th>\n      <th class="table-span-4">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:list.header.group",{name:"t",hash:{},data:r}))+'</th>\n      <th><span class="sr-only">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common:action.actionsHeader",{name:"t",hash:{},data:r}))+"</span></th>\n    </tr>\n    </thead>\n    <tbody>\n"+((i=t.each.call(e,e!=null?e.model:e,{name:"each",hash:{},fn:this.program(4,r,0),inverse:this.noop,data:r}))!=null?i:"")+"    </tbody>\n  </table>\n"},4:function(e,t,n,r){var i,s;return'      <tr>\n        <td>\n          <span class="badge badge-grey pull-right">id:'+this.escapeExpression((s=(s=t.id||(e!=null?e.id:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"id",hash:{},data:r}):s))+"</span>\n"+((i=t.unless.call(e,e!=null?e.lock:e,{name:"unless",hash:{},fn:this.program(5,r,0),inverse:this.program(7,r,0),data:r}))!=null?i:"")+((i=this.invokePartial(n.contentLockToolTip,e,{name:"contentLockToolTip",data:r,indent:"          ",helpers:t,partials:n}))!=null?i:"")+'          <small class="block">'+this.escapeExpression((t.decode||e&&e.decode||t.helperMissing).call(e,e!=null?e.description:e,{name:"decode",hash:{},data:r}))+'</small>\n        </td>\n        <td class="table-middle ">\n'+((i=t["if"].call(e,e!=null?e.primaryGroup:e,{name:"if",hash:{},fn:this.program(9,r,0),inverse:this.program(11,r,0),data:r}))!=null?i:"")+((i=t["if"].call(e,e!=null?e.sharedGroupCount:e,{name:"if",hash:{},fn:this.program(13,r,0),inverse:this.noop,data:r}))!=null?i:"")+'        </td>\n        <td>\n          <div class="btn-group">\n            <button data-toggle="dropdown" class="btn btn-info btn-xs dropdown-toggle '+((i=t["if"].call(e,e!=null?e.lock:e,{name:"if",hash:{},fn:this.program(16,r,0),inverse:this.noop,data:r}))!=null?i:"")+'"> <i class="fa fa-cog"></i><span class="hidden-xs"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.actions",{name:"t",hash:{},data:r}))+' </span><span class="ace-icon fa fa-caret-down icon-on-right"></span></button>\n            <ul class="dropdown-menu dropdown-menu-right dropdown-caret pull-right">\n\n'+((i=t.unless.call(e,(i=e!=null?e.actions:e)!=null?i.canView:i,{name:"unless",hash:{},fn:this.program(18,r,0),inverse:this.noop,data:r}))!=null?i:"")+"\n"+((i=t["if"].call(e,(i=e!=null?e.actions:e)!=null?i.canView:i,{name:"if",hash:{},fn:this.program(27,r,0),inverse:this.noop,data:r}))!=null?i:"")+"            </ul>\n          </div>\n        </td>\n      </tr>\n"},5:function(e,t,n,r){return'            <a href="'+this.escapeExpression((t.viewOrEditUrl||e&&e.viewOrEditUrl||t.helperMissing).call(e,e!=null?e.id:e,e!=null?e.actions:e,{name:"viewOrEditUrl",hash:{},data:r}))+'" class="edit-name">'+this.escapeExpression((t.decode||e&&e.decode||t.helperMissing).call(e,e!=null?e.name:e,{name:"decode",hash:{},data:r}))+"</a>\n"},7:function(e,t,n,r){return'            <span data-id="'+this.escapeExpression(this.lambda(e!=null?e.id:e,e))+'" role="button" >'+this.escapeExpression((t.decode||e&&e.decode||t.helperMissing).call(e,e!=null?e.name:e,{name:"decode",hash:{},data:r}))+"</span>\n"},9:function(e,t,n,r){var i;return'              <span class="badge badge-grey">'+this.escapeExpression(this.lambda((i=e!=null?e.primaryGroup:e)!=null?i.name:i,e))+"</span>\n"},11:function(e,t,n,r){return"              "+this.escapeExpression((t.badge||e&&e.badge||t.helperMissing).call(e,{name:"badge",hash:{text:"common.global",type:"yellow"},data:r}))+"\n"},13:function(e,t,n,r){var i,s;return'              <span class="badge badge-info pull-right sharedGroupCount" data-toggle="tooltip" data-html="true" data-size="lg" data-id="'+this.escapeExpression((s=(s=t.id||(e!=null?e.id:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"id",hash:{},data:r}):s))+"\" title=\"<div class='text-left'><strong>Also shared with:</strong><hr /><ul class='list-unstyled no-margin'>"+((i=t.each.call(e,e!=null?e.sharedGroups:e,{name:"each",hash:{},fn:this.program(14,r,0),inverse:this.noop,data:r}))!=null?i:"")+'</ul></div>">+'+this.escapeExpression((s=(s=t.sharedGroupCount||(e!=null?e.sharedGroupCount:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"sharedGroupCount",hash:{},data:r}):s))+"</span>\n"},14:function(e,t,n,r){var i;return"<li>"+this.escapeExpression((i=(i=t.name||(e!=null?e.name:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"name",hash:{},data:r}):i))+"</li>"},16:function(e,t,n,r){return" disabled"},18:function(e,t,n,r){var i;return((i=t["if"].call(e,(i=e!=null?e.actions:e)!=null?i.canShare:i,{name:"if",hash:{},fn:this.program(19,r,0),inverse:this.noop,data:r}))!=null?i:"")+((i=t["if"].call(e,(i=e!=null?e.actions:e)!=null?i.canDuplicate:i,{name:"if",hash:{},fn:this.program(21,r,0),inverse:this.noop,data:r}))!=null?i:"")+((i=t["if"].call(e,(i=e!=null?e.actions:e)!=null?i.canEdit:i,{name:"if",hash:{},fn:this.program(23,r,0),inverse:this.noop,data:r}))!=null?i:"")+((i=t["if"].call(e,(i=e!=null?e.actions:e)!=null?i.canErase:i,{name:"if",hash:{},fn:this.program(25,r,0),inverse:this.noop,data:r}))!=null?i:"")},19:function(e,t,n,r){return'                      <li><a href="'+this.escapeExpression((t.shareUrl||e&&e.shareUrl||t.helperMissing).call(e,e!=null?e.id:e,{name:"shareUrl",hash:{},data:r}))+'" role="button" class="share"><i class="fa fa-share bigger-110"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.share",{name:"t",hash:{},data:r}))+"</a></li>\n"},21:function(e,t,n,r){return'                      <li><a href="'+this.escapeExpression((t.duplicateUrl||e&&e.duplicateUrl||t.helperMissing).call(e,e!=null?e.id:e,{name:"duplicateUrl",hash:{},data:r}))+'" class="duplicate"><i class="fa fa-copy bigger-110"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.duplicate",{name:"t",hash:{},data:r}))+"</a></li>\n"},23:function(e,t,n,r){return'                      <li><a href="'+this.escapeExpression((t.editUrl||e&&e.editUrl||t.helperMissing).call(e,e!=null?e.id:e,{name:"editUrl",hash:{},data:r}))+'" class="edit"><i class="fa fa-edit bigger-110"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.edit",{name:"t",hash:{},data:r}))+"</a></li>\n"},25:function(e,t,n,r){var i;return'                      <li class="divider"></li>\n                      <li><a href="javascript:;" class="erase" data-id="'+this.escapeExpression((i=(i=t.id||(e!=null?e.id:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"id",hash:{},data:r}):i))+'"><i class="fa fa-trash-o bigger-110"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.erase",{name:"t",hash:{},data:r}))+"</a></li>\n"},27:function(e,t,n,r){return'                  <li><a href="'+this.escapeExpression((t.viewUrl||e&&e.viewUrl||t.helperMissing).call(e,e!=null?e.id:e,{name:"viewUrl",hash:{},data:r}))+'" class="edit"><i class="fa fa-eye bigger-110"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.show",{name:"t",hash:{},data:r}))+"</a></li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i;return((i=t["if"].call(e,(i=e!=null?e.view:e)!=null?i.isLoading:i,{name:"if",hash:{},fn:this.program(1,r,0),inverse:this.noop,data:r}))!=null?i:"")+"\n"+((i=t.unless.call(e,(i=e!=null?e.view:e)!=null?i.isLoading:i,{name:"unless",hash:{},fn:this.program(3,r,0),inverse:this.noop,data:r}))!=null?i:"")},usePartial:!0,useData:!0})}),define("hbars!module/content/section/template/contentLockToolTip",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){var i;return'<i class="fa fa-lock" data-toggle="tooltip" data-html="true" data-placement="top" title="'+this.escapeExpression((t.buildContentLockTooltip||e&&e.buildContentLockTooltip||t.helperMissing).call(e,(i=e!=null?e.lock:e)!=null?i.ownerName:i,{name:"buildContentLockTooltip",hash:{},data:r}))+'"></i>'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i;return(i=t["if"].call(e,e!=null?e.lock:e,{name:"if",hash:{},fn:this.program(1,r,0),inverse:this.noop,data:r}))!=null?i:""},useData:!0})}),define("module/assets/pageLayout/view/list",["jquery","underscore","backbone","Handlebars","helper/makeup","module/assets/pageLayout/model/pageLayout","module/assets/pageLayout/model/pageLayouts","hbars!module/assets/pageLayout/template/list","hbars!module/content/section/template/contentLockToolTip"],function(e,t,n,r,i,s,o,u,a){var f=n.View.extend({template:u,events:{"click .erase":"notifyErase","click .share":"notifyShare"},initialize:function(){this.model=new o,this.moduleName="pageLayout",this.listenToModel("request",this.setLoading),this.listenToModel("sync",this.refresh),this.listenToModule("add",this.hide),this.listenToModule("edit",this.hide),this.listenToModule("view",this.hide),this.listenToModule("duplicate",this.hide),this.listenToModule("compare:code",this.hide),this.listenToModule("home",this.fetch),this.listenToModule("home:share",this.fetchAndShare),this.listenToModule("compare:show",this.compare),r.registerPartial("contentLockToolTip",a)},listenToModule:function(e,t){this.listenTo(n,this.moduleName+":"+e,t)},listenToModel:function(e,t){this.listenTo(this.model,e,t)},afterRender:function(){this.enhanceTable(),this.loadToolTips()},serialize:function(){var e=this.model.toJSON();return this.setActions(e),{model:e,view:{isLoading:this.isLoading}}},setActions:function(e){t.each(e,function(e){e.actions={canShare:e.editable&&e.fullAccess&&e.primaryGroup,canDuplicate:e.editable&&e.fullAccess,canEdit:e.editable,canErase:e.editable&&e.fullAccess,canView:!e.editable}})},refresh:function(){this.isLoading=!1,this.destroyTable(),this.render(),this.show()},fetch:function(){this.refresh(),this.model.reset(),this.model.fetch()},fetchAndShare:function(e){this.refresh(),this.listenToOnce(this.model,"sync",function(){n.trigger(this.moduleName+":share",e)}),this.model.fetch()},destroyTable:function(){if(!this.dataTable)return;this.dataTable.fnDestroy(),this.dataTable=null},enhanceTable:function(){if(this.isLoading)return;this.dataTable=i.createActionDataTable({el:this.$("#table_pageLayouts")})},notifyErase:function(e){var t=e.target.getAttribute("data-id"),r=this.model.get(t);n.trigger(this.moduleName+":erase",r.toJSON()),n.trigger("unlock",r.id)},notifyShare:function(n){n.preventDefault();var r=e(n.currentTarget).attr("href").replace("#share/",""),i=t.findWhere(this.model.models,{id:Number(r)});this.router.share(r,i)},hide:function(){this.$el.hide()},show:function(){this.$el.show()},compare:function(e){n.trigger(this.moduleName+":compare:code",e)}});return f}),define("helper/rights",[],function(){return{addEditRights:function(e,t){e=e||{},t=!!t;var n=!!e.id,r=t?e.editable&&!e.systemTemplate:e.editable;return e.actions={canShare:n?e.editable&&e.fullAccess:!0,canEdit:n?r:!0,canErase:n?e.editable&&e.fullAccess:!1},e.readonly=n?!e.editable:!1,e},canShare:function(e){var t=!!e.get("id");return t?e.get("editable")&&e.get("fullAccess"):!0},isReadOnly:function(e){var t=!!e.get("id");return t?!e.get("editable"):!1}}}),define("module/common/layout/model/fileExtension",["require","backbone","module/common/validation/validation"],function(e){var t=e("backbone"),n=e("module/common/validation/validation");return t.Model.extend({idAttribute:"name",initialize:function(){this.validationModel=new n({model:"fileextensions"})},url:function(){var e=this.name?"/"+this.name:"";return t.SERVICE_BASE_URL+"/fileExtension"+e}})}),define("module/common/layout/model/fileExtensions",["underscore","backbone","module/common/layout/model/fileExtension"],function(e,t,n){var r=t.Collection.extend({model:n,url:t.SERVICE_BASE_URL+"/fileExtension"});return r}),define("module/common/layout/model/syntaxType",["underscore","backbone"],function(e,t){var n=t.Model.extend({defaults:{name:"",mimeCode:""},urlRoot:t.SERVICE_BASE_URL+"/syntaxType"});return n}),define("module/common/layout/model/syntaxTypes",["underscore","backbone","module/common/layout/model/syntaxType"],function(e,t,n){var r=t.Collection.extend({model:n,url:t.SERVICE_BASE_URL+"/syntaxType"});return r}),define("module/common/layout/model/layoutProcessor",["underscore","backbone"],function(e,t){var n=t.Model.extend({urlRoot:t.SERVICE_BASE_URL+"/publishProcessor"});return n}),define("module/common/layout/model/layoutProcessors",["underscore","backbone","module/common/layout/model/layoutProcessor"],function(e,t,n){var r=t.Collection.extend({model:n,url:t.SERVICE_BASE_URL+"/publishProcessor/",setUrl:function(e){this.url=t.SERVICE_BASE_URL+"/publishProcessor/"+e}});return r}),define("hbars!module/assets/pageLayout/template/edit",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){var i,s;return'  <form class="form-horizontal" id="pageLayoutForm" novalidate>\n    <div class="tabbable">\n      <ul class="nav nav-tabs">\n        <li '+((i=(t.compare||e&&e.compare||t.helperMissing).call(e,e!=null?e.activeTab:e,"===","general",{name:"compare",hash:{},fn:this.program(2,r,0),inverse:this.noop,data:r}))!=null?i:"")+'>\n          <a data-toggle="tab" name="general" href="#layout_generalinfo"><i class="fa fa-sliders"></i><span class="hidden-xs"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:add.generalInformation.tabTitle",{name:"t",hash:{},data:r}))+"</span></a>\n        </li>\n        <li "+((i=(t.compare||e&&e.compare||t.helperMissing).call(e,e!=null?e.activeTab:e,"===","header",{name:"compare",hash:{},fn:this.program(2,r,0),inverse:this.noop,data:r}))!=null?i:"")+'>\n          <a data-toggle="tab" name="header" href="#layout_header"><i class="fa fa-code"></i> <span class="hidden-xs">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:add.headerCode.tabTitle",{name:"t",hash:{},data:r}))+"</span></a>\n        </li>\n        <li "+((i=(t.compare||e&&e.compare||t.helperMissing).call(e,e!=null?e.activeTab:e,"===","footer",{name:"compare",hash:{},fn:this.program(2,r,0),inverse:this.noop,data:r}))!=null?i:"")+'>\n          <a data-toggle="tab" name="footer" href="#layout_footer"><i class="fa fa-code"></i> <span class="hidden-xs">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:add.footerCode.tabTitle",{name:"t",hash:{},data:r}))+"</span></a>\n        </li>\n"+((i=t["if"].call(e,e!=null?e.inEdit:e,{name:"if",hash:{},fn:this.program(4,r,0),inverse:this.noop,data:r}))!=null?i:"")+'      </ul>\n\n      <div class="tab-content">\n        <div id="layout_generalinfo" class="tab-pane '+((i=(t.compare||e&&e.compare||t.helperMissing).call(e,e!=null?e.activeTab:e,"===","general",{name:"compare",hash:{},fn:this.program(6,r,0),inverse:this.noop,data:r}))!=null?i:"")+'">\n          '+this.escapeExpression((t.heading||e&&e.heading||t.helperMissing).call(e,{name:"heading",hash:{text:"pagelayout:add.generalInformation.tabTitle"},data:r}))+"\n          <p>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:add.generalInformation.tabIntroText",{name:"t",hash:{},data:r}))+'</p>\n          <hr class="hidden-xs">\n          <div id="layout_options">\n            <div class="form-group">\n              <label class="col-sm-3 control-label" for="form_name">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:add.name.field",{name:"t",hash:{},data:r}))+" "+((i=(s=(s=t.required||(e!=null?e.required:e))!=null?s:t.helperMissing,typeof s==="function"?s.call(e,{name:"required",hash:{},data:r}):s))!=null?i:"")+'</label>\n              <div class="col-xs-12 col-sm-4">\n                <input type="text" name="name" id="form_name" placeholder="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:add.name.placeholder",{name:"t",hash:{},data:r}))+'" value="'+this.escapeExpression((t.decode||e&&e.decode||t.helperMissing).call(e,(i=e!=null?e.pageLayout:e)!=null?i.name:i,{name:"decode",hash:{},data:r}))+'"\n                       required="" '+this.escapeExpression((t.disableIfReadonly||e&&e.disableIfReadonly||t.helperMissing).call(e,e!=null?e.pageLayout:e,{name:"disableIfReadonly",hash:{},data:r}))+'  class="layout-property width-100 ace-tooltip '+this.escapeExpression((t.classIfReadonly||e&&e.classIfReadonly||t.helperMissing).call(e,e!=null?e.pageLayout:e,{name:"classIfReadonly",hash:{},data:r}))+'"\n                       data-rel="tooltip" data-placement="bottom" title="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:add.name.tooltip",{name:"t",hash:{},data:r}))+'" />\n              </div>\n            </div>\n\n            <div class="form-group">\n              <label class="col-sm-3 control-label" for="form_description">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:add.description.field",{name:"t",hash:{},data:r}))+'</label>\n              <div class="col-xs-12 col-sm-4">\n                <input type="text" name="description" id="form_description" class="layout-property width-100 ace-tooltip '+this.escapeExpression((t.classIfReadonly||e&&e.classIfReadonly||t.helperMissing).call(e,e!=null?e.pageLayout:e,{name:"classIfReadonly",hash:{},data:r}))+'"\n                       placeholder="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:add.description.placeholder",{name:"t",hash:{},data:r}))+'" value="'+this.escapeExpression((t.decode||e&&e.decode||t.helperMissing).call(e,(i=e!=null?e.pageLayout:e)!=null?i.description:i,{name:"decode",hash:{},data:r}))+'" '+this.escapeExpression((t.disableIfReadonly||e&&e.disableIfReadonly||t.helperMissing).call(e,e!=null?e.pageLayout:e,{name:"disableIfReadonly",hash:{},data:r}))+'\n                       data-rel="tooltip" data-placement="bottom" title="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:add.description.tooltip",{name:"t",hash:{},data:r}))+'" />\n              </div>\n            </div>\n\n            <div class="form-group">\n              <label class="col-sm-3 control-label" for="form_fileExtension">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:add.fileExtension.field",{name:"t",hash:{},data:r}))+'</label>\n              <div class="col-xs-12 col-sm-4">\n                <select name="fileExtension" class="layout-property width-100" data-rel="tooltip" data-placement="top" title="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:add.fileExtension.tooltip",{name:"t",hash:{},data:r}))+'" id="form_fileExtension">\n                  <option value="">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:add.generalInformation.default",{name:"t",hash:{},data:r}))+"</option>\n"+((i=t.each.call(e,e!=null?e.fileExtensions:e,{name:"each",hash:{},fn:this.program(8,r,0),inverse:this.noop,data:r}))!=null?i:"")+'                </select>\n              </div>\n            </div>\n\n            <div class="form-group">\n              <label class="col-sm-3 control-label" for="form_syntaxType">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:add.syntaxType.label",{name:"t",hash:{},data:r}))+'</label>\n              <div class="col-xs-12 col-sm-4">\n                <select name="syntaxType" class="layout-property width-100" id="form_syntaxType" data-toggle="tooltip" title="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:add.syntaxType.tooltip",{name:"t",hash:{},data:r}))+'">\n'+((i=t.each.call(e,e!=null?e.syntaxTypes:e,{name:"each",hash:{},fn:this.program(11,r,0),inverse:this.noop,data:r}))!=null?i:"")+((i=t.unless.call(e,e!=null?e.syntaxTypes:e,{name:"unless",hash:{},fn:this.program(13,r,0),inverse:this.noop,data:r}))!=null?i:"")+'                </select>\n              </div>\n            </div>\n\n            <div class="form-group">\n              <label class="col-sm-3 control-label" for="form_layoutProcessor">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:add.layoutProcessor.label",{name:"t",hash:{},data:r}))+'</label>\n              <div class="col-xs-12 col-sm-4">\n                <select name="layoutProcessor" id="form_layoutProcessor" class="layout-property width-100" data-toggle="tooltip" title="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:add.layoutProcessor.tooltip",{name:"t",hash:{},data:r}))+'">\n'+((i=t.each.call(e,e!=null?e.layoutProcessors:e,{name:"each",hash:{},fn:this.program(15,r,0),inverse:this.noop,data:r}))!=null?i:"")+((i=t.unless.call(e,e!=null?e.layoutProcessors:e,{name:"unless",hash:{},fn:this.program(13,r,0),inverse:this.noop,data:r}))!=null?i:"")+'                </select>\n              </div>\n            </div>\n          </div>\n\n          <div class="row hidden" id="beta-warning">\n            <div class="col-xs-12 col-sm-9 col-sm-push-3">\n              '+this.escapeExpression((t.alert||e&&e.alert||t.helperMissing).call(e,{name:"alert",hash:{text:"pagelayout:add.layoutProcessor.betaWarning",type:"warning"},data:r}))+'\n            </div>\n          </div>\n\n          <div id="share"></div>\n\n        </div>\n\n        <div id="layout_header" class="tab-pane '+((i=(t.compare||e&&e.compare||t.helperMissing).call(e,e!=null?e.activeTab:e,"===","header",{name:"compare",hash:{},fn:this.program(6,r,0),inverse:this.noop,data:r}))!=null?i:"")+'">\n          '+this.escapeExpression((t.heading||e&&e.heading||t.helperMissing).call(e,{name:"heading",hash:{text:"pagelayout:add.headerCode.tabTitle"},data:r}))+"\n          <p>"+((i=(t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:add.headerCode.tabIntroText",{name:"t",hash:{},data:r}))!=null?i:"")+'</p>\n          <hr class="hidden-xs">\n\n          <div class="form-horizontal">\n            <div class="form-group">\n              <label for="form_headerCode" class="control-label sr-only">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:add.headerCode.tabTitle",{name:"t",hash:{},data:r}))+'</label>\n              <div class="col-xs-12">\n                <span class="block">\n                  <textarea name="headerCode" id="form_headerCode" class="code-mirror-syntax width-100" rows="6">'+this.escapeExpression(this.lambda((i=e!=null?e.pageLayout:e)!=null?i.headerCode:i,e))+'</textarea>\n                </span>\n              </div>\n            </div>\n          </div>\n\n          <div class="row'+((i=t["if"].call(e,(i=e!=null?e.pageLayout:e)!=null?i.readonly:i,{name:"if",hash:{},fn:this.program(17,r,0),inverse:this.noop,data:r}))!=null?i:"")+'">\n            <div class="col-xs-12">\n              '+this.escapeExpression((t.button||e&&e.button||t.helperMissing).call(e,{name:"button",hash:{"class":"t4-tag",size:"sm",colourClass:"info",text:"common:tagBuilder.title",icon:"code"},data:r}))+'\n            </div>\n          </div>\n\n        </div>\n\n        <div id="layout_footer" class="tab-pane '+((i=(t.compare||e&&e.compare||t.helperMissing).call(e,e!=null?e.activeTab:e,"===","footer",{name:"compare",hash:{},fn:this.program(6,r,0),inverse:this.noop,data:r}))!=null?i:"")+'">\n          '+this.escapeExpression((t.heading||e&&e.heading||t.helperMissing).call(e,{name:"heading",hash:{text:"pagelayout:add.footerCode.tabTitle"},data:r}))+"\n          <p>"+((i=(t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:add.footerCode.tabIntroText",{name:"t",hash:{},data:r}))!=null?i:"")+'</p>\n          <hr class="hidden-xs">\n\n          <div class="form-horizontal">\n            <div class="form-group">\n              <label for="form_footerCode" class="control-label sr-only">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:add.footerCode.tabTitle",{name:"t",hash:{},data:r}))+'</label>\n              <div class="col-xs-12">\n                <span class="block">\n                  <textarea name="footerCode" id="form_footerCode" class="code-mirror-syntax width-100" rows="6">'+this.escapeExpression(this.lambda((i=e!=null?e.pageLayout:e)!=null?i.footerCode:i,e))+'</textarea>\n                </span>\n              </div>\n            </div>\n          </div>\n\n          <div class="row'+((i=t["if"].call(e,(i=e!=null?e.pageLayout:e)!=null?i.readonly:i,{name:"if",hash:{},fn:this.program(17,r,0),inverse:this.noop,data:r}))!=null?i:"")+'">\n            <div class="col-xs-12">\n              '+this.escapeExpression((t.button||e&&e.button||t.helperMissing).call(e,{name:"button",hash:{"class":"t4-tag",size:"sm",colourClass:"info",text:"common:tagBuilder.title",icon:"code"},data:r}))+'\n            </div>\n          </div>\n\n        </div>\n\n        <div id="layout_history" class="tab-pane '+((i=(t.compare||e&&e.compare||t.helperMissing).call(e,e!=null?e.activeTab:e,"===","history",{name:"compare",hash:{},fn:this.program(6,r,0),inverse:this.noop,data:r}))!=null?i:"")+'"></div>\n\n      </div>\n    </div>\n\n'+((i=t["if"].call(e,e!=null?e.duplicate:e,{name:"if",hash:{},fn:this.program(19,r,0),inverse:this.program(21,r,0),data:r}))!=null?i:"")+"\n  </form>\n"},2:function(e,t,n,r){return'class="active"'},4:function(e,t,n,r){var i;return"          <li "+((i=(t.compare||e&&e.compare||t.helperMissing).call(e,e!=null?e.activeTab:e,"===","history",{name:"compare",hash:{},fn:this.program(2,r,0),inverse:this.noop,data:r}))!=null?i:"")+'>\n            <a data-toggle="tab" name="history" href="#layout_history"><i class="fa fa-history"></i> <span class="hidden-xs">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common:version.title.history",{name:"t",hash:{},data:r}))+"</span></a>\n          </li>\n"},6:function(e,t,n,r){return"active"},8:function(e,t,n,r){var i,s;return'                    <option value="'+this.escapeExpression((s=(s=t.name||(e!=null?e.name:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"name",hash:{},data:r}):s))+'" '+((i=(t.compare||e&&e.compare||t.helperMissing).call(e,e!=null?e.name:e,"===",(i=(i=r&&r.root)&&i.pageLayout)&&i.fileExtension,{name:"compare",hash:{},fn:this.program(9,r,0),inverse:this.noop,data:r}))!=null?i:"")+">"+this.escapeExpression((s=(s=t.name||(e!=null?e.name:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"name",hash:{},data:r}):s))+" (."+this.escapeExpression((s=(s=t.extension||(e!=null?e.extension:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"extension",hash:{},data:r}):s))+")</option>\n"},9:function(e,t,n,r){return'selected="selected"'},11:function(e,t,n,r){var i,s;return'                    <option value="'+this.escapeExpression((s=(s=t.id||(e!=null?e.id:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"id",hash:{},data:r}):s))+'" '+((i=(t.compare||e&&e.compare||t.helperMissing).call(e,e!=null?e.id:e,"==",(i=(i=r&&r.root)&&i.pageLayout)&&i.syntaxType,{name:"compare",hash:{},fn:this.program(9,r,0),inverse:this.noop,data:r}))!=null?i:"")+">"+this.escapeExpression((t.decode||e&&e.decode||t.helperMissing).call(e,e!=null?e.name:e,{name:"decode",hash:{},data:r}))+"</option>\n"},13:function(e,t,n,r){return'                    <option value="0">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"pagelayout:add.generalInformation.none",{name:"t",hash:{},data:r}))+"</option>\n"},15:function(e,t,n,r){var i,s;return'                    <option value="'+this.escapeExpression((s=(s=t.id||(e!=null?e.id:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"id",hash:{},data:r}):s))+'" '+((i=(t.compare||e&&e.compare||t.helperMissing).call(e,e!=null?e.id:e,"==",(i=(i=r&&r.root)&&i.pageLayout)&&i.layoutProcessor,{name:"compare",hash:{},fn:this.program(9,r,0),inverse:this.noop,data:r}))!=null?i:"")+">"+this.escapeExpression((s=(s=t.name||(e!=null?e.name:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"name",hash:{},data:r}):s))+"</option>\n"},17:function(e,t,n,r){return" hidden"},19:function(e,t,n,r){return"      "+this.escapeExpression((t.formActions||e&&e.formActions||t.helperMissing).call(e,{name:"formActions",hash:{mainActionIcon:"copy",mainActionText:"common:action.duplicate"},data:r}))+"\n"},21:function(e,t,n,r){var i;return(i=t["if"].call(e,(i=(i=e!=null?e.pageLayout:e)!=null?i.actions:i)!=null?i.canErase:i,{name:"if",hash:{},fn:this.program(22,r,0),inverse:this.program(24,r,0),data:r}))!=null?i:""},22:function(e,t,n,r){return"        "+this.escapeExpression((t.formActions||e&&e.formActions||t.helperMissing).call(e,{name:"formActions",hash:{deleteButton:!0},data:r}))+"\n"},24:function(e,t,n,r){var i;return"        "+this.escapeExpression((i=(i=t.formActions||(e!=null?e.formActions:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"formActions",hash:{},data:r}):i))+"\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i;return(i=t.unless.call(e,e!=null?e.isLoading:e,{name:"unless",hash:{},fn:this.program(1,r,0),inverse:this.noop,data:r}))!=null?i:""},useData:!0})}),define("hbars!module/common/version/template/list",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){var i,s;return"  "+((i=(s=(s=t.showLoading||(e!=null?e.showLoading:e))!=null?s:t.helperMissing,typeof s==="function"?s.call(e,{name:"showLoading",hash:{},data:r}):s))!=null?i:"")+"\n"},3:function(e,t,n,r,i,s){var o;return'  <div class="row">\n    <div class="col-xs-12">\n      '+this.escapeExpression((t.heading||e&&e.heading||t.helperMissing).call(e,{name:"heading",hash:{text:"common:version.title.history"},data:r}))+"\n      "+((o=t["if"].call(e,(o=e!=null?e.actions:e)!=null?o.canCompare:o,{name:"if",hash:{},fn:this.program(4,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"\n      "+((o=t.unless.call(e,(o=e!=null?e.actions:e)!=null?o.canCompare:o,{name:"unless",hash:{},fn:this.program(6,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+'\n    </div>\n  </div>\n\n  <hr class="hidden-xs">\n\n  <div class="row">\n'+((o=t["if"].call(e,(o=e!=null?e.actions:e)!=null?o.canCompare:o,{name:"if",hash:{},fn:this.program(8,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"  </div>\n\n"+((o=t["if"].call(e,(o=e!=null?e.actions:e)!=null?o.canCompare:o,{name:"if",hash:{},fn:this.program(11,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+'\n  <div class="row">\n    <div class="col-xs-12">\n      <table class="table table-striped table-bordered table-hover">\n        <thead>\n          <tr>\n            <th class="table-span-6">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common:version.header.name",{name:"t",hash:{},data:r}))+"</th>\n            <th>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common:version.header.version",{name:"t",hash:{},data:r}))+"</th>\n            <th>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common:version.header.previousVersion",{name:"t",hash:{},data:r}))+"</th>\n            "+((o=t["if"].call(e,e!=null?e.typeContent:e,{name:"if",hash:{},fn:this.program(13,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+'\n            <th class="table-span-6">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common:version.header.lastModified",{name:"t",hash:{},data:r}))+"</th>\n            <th"+((o=t.unless.call(e,(o=e!=null?e.actions:e)!=null?o.canCompare:o,{name:"unless",hash:{},fn:this.program(15,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"></th>\n            <th"+((o=t.unless.call(e,(o=e!=null?e.actions:e)!=null?o.canCompare:o,{name:"unless",hash:{},fn:this.program(15,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"></th>\n          </tr>\n        </thead>\n        <tbody>\n"+((o=t.each.call(e,e!=null?e.versions:e,{name:"each",hash:{},fn:this.program(17,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"        </tbody>\n      </table>\n    </div>\n  </div>\n"},4:function(e,t,n,r){return"<p>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common:version.introTextCanCompare",{name:"t",hash:{},data:r}))+"</p>"},6:function(e,t,n,r){return"<p>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common:version.introText",{name:"t",hash:{},data:r}))+"</p>"},8:function(e,t,n,r,i,s){var o;return'    <div class="col-xs-12 text-right">\n      <a href="#" class="btn btn-info btn-small disabled compare '+((o=t.unless.call(e,(o=s[2]!=null?s[2].actions:s[2])!=null?o.canEdit:o,{name:"unless",hash:{},fn:this.program(9,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+'" title="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common:version.title.compareSelected.placeholder",{name:"t",hash:{},data:r}))+'">\n        <i class="fa fa-columns bigger-110 icon-on-right"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common:version.title.compareSelected.field",{name:"t",hash:{},data:r}))+"\n      </a>\n    </div>\n"},9:function(e,t,n,r){return" disabled"},11:function(e,t,n,r){return'    <div class="space-10"></div>\n'},13:function(e,t,n,r){return"<th>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common:version.header.owner",{name:"t",hash:{},data:r}))+"</th>"},15:function(e,t,n,r){return' class="hidden"'},17:function(e,t,n,r,i,s){var o,u;return"        <tr>\n          <td>"+this.escapeExpression((t.decode||e&&e.decode||t.helperMissing).call(e,e!=null?e.name:e,{name:"decode",hash:{},data:r}))+"</td>\n          <td>\n            "+this.escapeExpression((u=(u=t.version||(e!=null?e.version:e))!=null?u:t.helperMissing,typeof u=="function"?u.call(e,{name:"version",hash:{},data:r}):u))+"\n"+((o=(t.isCurrentVersion||e&&e.isCurrentVersion||t.helperMissing).call(e,e!=null?e.version:e,{name:"isCurrentVersion",hash:{},fn:this.program(18,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"          </td>\n          <td>"+this.escapeExpression((u=(u=t.previousVersion||(e!=null?e.previousVersion:e))!=null?u:t.helperMissing,typeof u=="function"?u.call(e,{name:"previousVersion",hash:{},data:r}):u))+"</td>\n"+((o=t["if"].call(e,s[2]!=null?s[2].typeContent:s[2],{name:"if",hash:{},fn:this.program(20,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+'          <td><i class="fa fa-calendar fa-fw"></i>\n            '+this.escapeExpression((t.parseTime||e&&e.parseTime||t.helperMissing).call(e,e!=null?e.lastModified:e,{name:"parseTime",hash:{},data:r}))+'\n            <br>\n            <i class="fa fa-user fa-fw"></i> '+this.escapeExpression((u=(u=t.lastModifiedBy||(e!=null?e.lastModifiedBy:e))!=null?u:t.helperMissing,typeof u=="function"?u.call(e,{name:"lastModifiedBy",hash:{},data:r}):u))+'\n          </td>\n          <td class="table-middle'+((o=t.unless.call(e,(o=s[2]!=null?s[2].actions:s[2])!=null?o.canCompare:o,{name:"unless",hash:{},fn:this.program(22,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+'">\n            <div class="btn-group">\n              <button data-toggle="dropdown" class="btn btn-info btn-xs dropdown-toggle '+((o=t.unless.call(e,(o=s[2]!=null?s[2].actions:s[2])!=null?o.canEdit:o,{name:"unless",hash:{},fn:this.program(9,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+'">\n                <i class="fa fa-cog"></i><span class="hidden-xs"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.actions",{name:"t",hash:{},data:r}))+'</span>\n                <span class="ace-icon fa fa-caret-down icon-on-right"></span>\n              </button>\n              <ul class="dropdown-menu dropdown-menu-right dropdown-caret pull-right">\n'+((o=t.unless.call(e,(o=s[2]!=null?s[2].actions:s[2])!=null?o.canView:o,{name:"unless",hash:{},fn:this.program(24,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"              </ul>\n            </div>\n          </td>\n          <td"+((o=t.unless.call(e,(o=s[2]!=null?s[2].actions:s[2])!=null?o.canCompare:o,{name:"unless",hash:{},fn:this.program(15,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+'>\n            <label>\n              <input type="checkbox" class="ace" data-version="'+this.escapeExpression((u=(u=t.version||(e!=null?e.version:e))!=null?u:t.helperMissing,typeof u=="function"?u.call(e,{name:"version",hash:{},data:r}):u))+'">\n              <span class="lbl"></span>\n            </label>\n          </td>\n        </tr>\n'},18:function(e,t,n,r){return'              <i class="fa fa-circle green ace-tooltip" title="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common:version.indicator",{name:"t",hash:{},data:r}))+'" data-placement="top"></i>\n'},20:function(e,t,n,r){var i;return"            <td>"+this.escapeExpression((i=(i=t.owner||(e!=null?e.owner:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"owner",hash:{},data:r}):i))+"</td>\n"},22:function(e,t,n,r){return" hidden"},24:function(e,t,n,r,i,s){var o;return(o=t["if"].call(e,(o=s[2]!=null?s[2].actions:s[2])!=null?o.canEdit:o,{name:"if",hash:{},fn:this.program(25,r,0,i,s),inverse:this.noop,data:r}))!=null?o:""},25:function(e,t,n,r){var i,s;return'                <li>\n                  <a href="#" class="preview" data-version="'+this.escapeExpression((s=(s=t.version||(e!=null?e.version:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"version",hash:{},data:r}):s))+'">\n                    <i class="fa fa-eye fa-fw"></i>\n                    '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.preview",{name:"t",hash:{},data:r}))+"\n                  </a>\n                </li>\n"+((i=(t.isCurrentVersion||e&&e.isCurrentVersion||t.helperMissing).call(e,e!=null?e.version:e,{name:"isCurrentVersion",hash:{},fn:this.program(26,r,0),inverse:this.program(28,r,0),data:r}))!=null?i:"")},26:function(e,t,n,r){return""},28:function(e,t,n,r){var i;return'                <li><a href="#" class="confirm" data-version="'+this.escapeExpression((i=(i=t.version||(e!=null?e.version:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"version",hash:{},data:r}):i))+'">\n                  <i class="fa fa-level-up fa-fw"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common:version.actions.makeCurrent",{name:"t",hash:{},data:r}))+"</a>\n                </li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r,i,s){var o;return((o=t["if"].call(e,(o=e!=null?e.view:e)!=null?o.isLoading:o,{name:"if",hash:{},fn:this.program(1,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+((o=t.unless.call(e,(o=e!=null?e.view:e)!=null?o.isLoading:o,{name:"unless",hash:{},fn:this.program(3,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")},useData:!0,useDepths:!0})}),define("module/common/version/model/version",["underscore","backbone"],function(e,t){return t.Model.extend({setAttributes:function(e){this.set({id:e.id,language:e.get("language"),status:e.get("status")})},url:function(){return t.SERVICE_BASE_URL+"/version/"+this.id+"/"+this.get("language")}})}),define("module/common/version/view/list",["jquery","i18n","underscore","backbone","moment","Handlebars","helper/makeup","helper/rights","hbars!module/common/version/template/list","module/common/version/model/version"],function(e,t,n,r,i,s,o,u,a,f){return r.View.extend({template:a,events:{"click .confirm":"showConfirm","click .preview":"preview","click .compare":"showCompareMenu",'change input[type="checkbox"]':"setComparable"},initialize:function(e){this.options=e||{},this.versions=e.model,this.versionModel=new f,this.versionModel.setAttributes(this.versions),this.moduleName=e.moduleName,this.canCompare=e.canCompare!==!1,this.registerListeners(),this.registerHandlebars()},registerListeners:function(){this.listenTo(this.versions,"request",this.setLoading),this.listenTo(this.versions,"sync:read",this.refresh),this.listenTo(this.versionModel,"sync:update",this.versionUpdated),this.listenTo(r,this.moduleName+":confirmed",this.saveVersion),this.listenTo(r,this.moduleName+":compare")},registerHandlebars:function(){var e=this;s.registerHelper("forceNumber",function(e){return Number(e)}),s.registerHelper("parseTime",function(e){return i(e).format("LLL")}),s.registerHelper("isCurrentVersion",function(t,r){if(r===undefined)return;var i=e.versions.get("currentVersion")||{},s;return n.isEqual(i,t)?s=r.fn(this):s=r.inverse(this),s})},serialize:function(){var e=this.sortByVersion();e.id=this.versions.get("id"),e.editable=this.versions.get("editable"),e.fullAccess=this.versions.get("fullAccess");var t=u.addEditRights(e);return{versions:e,actions:n.extend(t.actions,{canCompare:this.canCompare}),view:{isLoading:this.isLoading},typeContent:this.displayOwner()}},refresh:function(){this.isLoading=!1,this.render()},displayOwner:function(){return!!this.versions.get("isShowOwner")},isFetchedModel:function(){return this.model&&this.model.get("versions")},sortByVersion:function(){var e=this.versions.get("versions")||[];return n.sortBy(e,function(e){return Number(e.version)}).reverse()},versionUpdated:function(){r.trigger("version:updated"),this.fetch()},fetch:function(){this.versions.fetch()},saveVersion:function(e){this.versionModel.set("version",e.model.version),this.versionModel.save()},beforeRender:function(){this.destroyTable()},afterRender:function(){this.enhanceTable(),this.$("[data-placement]").tooltip()},enhanceTable:function(){this.dataTable=o.createDataTable({el:this.$("table"),excludeSortColumns:this.canCompare?[4,5]:[],sorting:[[1,"desc"]]})},destroyTable:function(){this.$("table").each(function(){e(this).dataTable().fnDestroy()})},showConfirm:function(t){t.preventDefault();var n=e(t.target).attr("data-version"),i=this.versions.getVersion(n);r.trigger(this.moduleName+":confirm",i)},builtHTML:function(t){var n=e(t.target).attr("data-version"),r=this.versions.getVersion(n).header,i=this.versions.getVersion(n).footer;return r+i},preview:function(e){e.preventDefault();var n=this.builtHTML(e),r=window.open("",t.t("common.preview.title"));r.document.write(n)},selectedVersions:function(){return this.$('input[type="checkbox"]:checked')},showCompareMenu:function(t){t.preventDefault();var n=[];this.selectedVersions().each(function(){n.push(e(this).attr("data-version"))}),this.notifyCompare(n)},notifyCompare:function(e){r.trigger(this.moduleName+":compare",{model:this.versions,versions:{higher:e[0],lower:e[1]}})},setComparable:function(t){if(this.versions.get("editable")===!1)return;var n=e(t.currentTarget),r=n.closest("tr"),i=this.$(".compare"),s=this.selectedVersions(),o=s.length,u=n.prop("checked");o>2&&u&&(n.prop("checked",!1),o-=1),n.prop("checked")?r.addClass("info"):r.removeClass("info"),o===2?(i.removeClass("disabled"),this.$el.find("[type=checkbox]:not(:checked)").addClass("disabled").prop("disabled",!0)):(i.addClass("disabled"),this.$el.find("[type=checkbox]:not(:checked)").removeClass("disabled").prop("disabled",!1))}})}),define("module/assets/pageLayout/view/edit",["i18n","jquery","underscore","backbone","helper/makeup","helper/rights","helper/roles","module/assets/pageLayout/model/pageLayout","module/common/layout/model/fileExtensions","module/common/layout/model/syntaxTypes","module/common/layout/model/layoutProcessors","module/common/share/view/inline","hbars!module/assets/pageLayout/template/edit","module/common/version/view/list"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){return r.View.extend({template:h,loaded:0,totalCalls:4,editors:[],moduleName:"pageLayout",model:new u,fileExtensions:new a,syntaxTypes:new f,layoutProcessors:new l,events:{"click a":"preventDefault","submit form":"preventDefault","click .js-main-action-button":"save","click .js-cancel-button":"notifyCancel","click .js-delete-button":"notifyErase","blur input[required]":"validate","change #form_syntaxType":"updateCodeMirror","change #form_layoutProcessor":"toggleBetaMessage","click .t4-tag":"openTagBuilder","shown.bs.tab .nav-tabs a":"focusCodeMirror","click .nav-tabs li":"navClicked"},initialize:function(){this.currentMode="edit",this.listenTo(this.model,"sync:read",this.fetched,this),this.listenTo(this.model,"sync:create",this.notifyAdded,this),this.listenTo(this.model,"sync:update",this.notifyEdited,this),this.listenTo(this.model,"error",this.notifyError,this),this.listenTo(this.model,"request",this.disableButtons,this),this.listenTo(this.fileExtensions,"sync:read",this.fetched,this),this.listenTo(this.syntaxTypes,"sync:read",this.fetched,this),this.listenTo(this.layoutProcessors,"sync:read",this.fetched,this),this.listenTo(r,"version:updated",this.versionUpdated,this),this.listenTo(r,this.moduleName+":edit",this.showEdit,this),this.listenTo(r,this.moduleName+":view",this.showEdit,this),this.listenTo(r,this.moduleName+":duplicate",this.showDuplicate,this),this.listenTo(r,this.moduleName+":add",this.showAdd,this),this.listenTo(r,this.moduleName+":home",this.hide,this),this.listenTo(r,this.moduleName+":compare:code",this.hide,this),this.listenTo(r,this.moduleName+":compare:hidden",this.show,this),r.Validation.bind(this),this.subscribeWarnings()},subscribeWarnings:function(){r.trigger("notifier:subscribe","pageLayout:share:warning_primary_group")},serialize:function(){var e=this.model.toJSON();return{pageLayout:s.addEditRights(e),fileExtensions:this.fileExtensions.toJSON(),syntaxTypes:this.syntaxTypes.toJSON(),layoutProcessors:this.layoutProcessors.toJSON(),duplicate:this.duplicate,isLoading:this.isLoading,inEdit:this.isEditView(),activeTab:this.activeTab}},insertShareView:function(){this.shareView=new c({id:"shareLayout",gridSize:3,moduleName:"pageLayout",readonly:!s.canShare(this.model),authLevel:this.primaryGroupRequired,primaryGroupID:this.primaryGroupID,currentMode:this.currentMode,assetModel:this.model}),this.shareView.setPrimaryGroup(this.model.getPrimaryGroupId()),this.shareView.setSharedGroups(this.model.get("sharedGroups")),this.insertView("#share",this.shareView)},beforeRender:function(){this.$("select").each(function(){t(this).select2("destroy")}),this.loaded===this.totalCalls&&(this.primaryGroupRequired=o.isNotAdministrator(),this.primaryGroupID=this.model.getPrimaryGroupId(),this.insertShareView(),this.isEditView()&&(this.versionView=new p({id:"version",moduleName:"pageLayout",model:this.model,readonly:!s.canShare(this.model)}),this.versionView.fetch(),this.insertView("#layout_history",this.versionView)))},afterRender:function(){if(this.isLoading)return;i.createSelect({el:this.$("select"),readonly:this.isEditView()?!this.model.get("editable"):!1}),this.applyCodeMirror(),this.loadToolTips(),this.betaWarning=this.$("#beta-warning")},applyCodeMirror:function(){var e=this,t=this.$("#form_syntaxType"),n=this.$(".code-mirror-syntax"),r=t.val(),s=this.syntaxTypes.get(r),o,u;if(!s)return;u={mode:s.get("mime_code"),matchBrackets:!0,lineNumbers:!0,readonly:this.isEditView()?!this.model.get("editable"):!1},n.each(function(){o=i.createCodeEditor(this.id,u),e.editors.push(o)})},updateCodeMirror:function(){this.removeCodeMirror(),this.applyCodeMirror()},removeCodeMirror:function(){if(!this.editors.length)return;n.each(this.editors,function(e){e.toTextArea()}),this.editors=[]},focusCodeMirror:function(e){var t=this.$(e.currentTarget),r=t.attr("href"),i=/header|footer/i.test(r),s=this.$(r);if(!i)return;s.find("textarea").focus(),s.find(".CodeMirror").click();var o=n.chain(this.editors).filter(function(t){if(t.getTextArea().name.split("Code").join("")===e.currentTarget.name&&!t.hasBeenVisible)return t.hasBeenVisible=!0,t},this).first().value();setTimeout(function(){o&&o.refresh()})},showAdd:function(){this.currentMode="add",this.model.clear(),this.activeTab="general";if(this.stayOnPage)return;this.fetchAll(),this.render(),this.show()},versionUpdated:function(){var e=this.model.get("id");this.stayOnPage=!1,this.showEdit(e,"history")},showEdit:function(e,t,n){this.currentMode="edit",this.activeTab=t;if(this.stayOnPage)return;this.activeTab===undefined&&(this.activeTab="general"),this.fetchAll(e),this.render(),this.show()},showDuplicate:function(e){this.fetchAll(e,!0),this.render(),this.show()},fetchAll:function(t,n){this.reset(),this.duplicate=n,this.model.clear();if(t){this.model.set({id:t});if(n)this.model.fetchForDuplication();else{var i=this.model;this.model.fetch().success(function(){r.trigger("bookmark:overrideDescription",e.t("pagelayout:bookmark.prefix")+i.attributes.name)})}}else this.loaded=1;this.fileExtensions.fetch(),this.syntaxTypes.fetch(),this.layoutProcessors.setUrl(10),this.layoutProcessors.fetch()},fetched:function(){this.loaded++,this.loaded===this.totalCalls&&this.refresh()},refresh:function(){this.isLoading=!1,this.render()},reset:function(){i.restoreAllCodeEditors(),this.isLoading=!0,this.loaded=0,this.model.clear()},validate:function(e){var t={};t[e.target.name]=e.target.value,this.model.set(t,{validate:!0})},show:function(){this.$el.show()},hide:function(){this.$el.hide()},updateModel:function(){var e=this.shareView?this.shareView.updatedModel():{},t=this.$("#layout_options .layout-property").not(".select2-container"),r=this.$(".code-mirror-syntax"),i;i=function(e){return n.object(n.map(e,function(e){return[e.name,e.value]}))},this.model.set(i(t.serializeArray())),this.model.set(i(r.serializeArray())),this.model.set(e)},save:function(){if(this.verifyGroupIntegrity()){this.notifyWarningPrimaryGroupInShared();return}if(!this.shareView.validate()){this.model.validate();return}i.restoreAllCodeEditors(),this.updateModel(),this.model.save()},isEditView:function(){return!!this.model.id},notifyEdited:function(){this.stayOnPage=!1,r.trigger("pageLayout:edited",this.model.id),this.hide()},notifyAdded:function(){this.stayOnPage=!1,r.trigger("pageLayout:added",this.model.toJSON()),this.hide()},notifyCancel:function(){this.duplicate=!1,this.stayOnPage=!1;var e=this.isEditView()?"edit":"add";r.trigger("pageLayout:"+e+":cancel",this.model.id),this.hide()},notifyErase:function(e){e.preventDefault(),this.stayOnPage=!1,r.trigger("pageLayout:erase",this.model.toJSON())},verifyGroupIntegrity:function(){var e=t("#toggleblock_groupaccess .group-select").select2("val"),n=this.model.get("sharedGroups");if(!n)return!1;var r=0,i=n.length;for(r=0;r<i;r+=1)if(parseInt(e)===n[r].id)return!0;return!1},notifyWarningPrimaryGroupInShared:function(){r.trigger("pageLayout:share:warning_primary_group")},toggleBetaMessage:function(){var e=this.$("#form_layoutProcessor").val();Number(e)!==1?this.betaWarning.removeClass("hidden"):this.betaWarning.addClass("hidden")},openTagBuilder:function(e){e.preventDefault(),r.trigger("builder:open")},disableButtons:function(){this.$(".btn").attr("disabled",!0)},navClicked:function(e){e.preventDefault(),this.stayOnPage=!0;var t=e.target.name;t===undefined&&(t=e.target.parentElement.name);var n=this.model.get("id");this.isEditView()?location.hash="edit/"+n+"/"+t:location.hash="add/"+t}})}),define("hbars!module/common/erase/template/erase",["Handlebars"],function(e){return e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i;return'<div id="'+this.escapeExpression((i=(i=t.modalID||(e!=null?e.modalID:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"modalID",hash:{},data:r}):i))+'" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="deleteLocalLabel" aria-hidden="true">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã</button>\n        <h4 class="modal-title"> <i class="fa fa-trash-o"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.erase.title",{name:"t",hash:{},data:r}))+'</h4>\n      </div>\n      <div class="modal-body">\n        <div class="row">\n          <div class="col-xs-12">\n            <p class="question"></p>\n            <ul class="items"></ul>\n            <div class="alert alert-warning">\n              <p>\n                <i class="fa fa-exclamation-circle"></i> '+this.escapeExpression((i=(i=t.description||(e!=null?e.description:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"description",hash:{},data:r}):i))+'\n              </p>\n            </div>\n          </div>\n        </div>\n\n      </div>\n      <div class="modal-footer">\n        <a href="#" class="btn btn-default"><i class="fa fa-undo"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.cancel",{name:"t",hash:{},data:r}))+'</a>\n        <a href="#" class="btn btn-danger"><i class="fa fa-trash-o"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.erase",{name:"t",hash:{},data:r}))+" "+this.escapeExpression((i=(i=t.type||(e!=null?e.type:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"type",hash:{},data:r}):i))+"</a>\n      </div>\n    </div>\n  </div>\n</div>"},useData:!0})}),define("module/common/erase/view/erase",["jquery","underscore","backbone","i18n","hbars!module/common/erase/template/erase"],function(e,t,n,r,i){return n.View.extend({template:i,modalWindow:null,moduleName:null,events:{"click .btn-default":"hide","click .btn-danger":"erase"},initialize:function(e){t.extend(this,e||{}),this.modalID=this.modalID||"modal_erase",this.listenTo(this.model,"error",this.notifyError),this.listenTo(this.model,"sync",this.notifyUpdated),this.listenTo(n,this.eventNameUpdate(),this.show)},serialize:function(){return{model:this.model.toJSON(),modalID:this.modalID||"modal_erase",description:this.getDescription(),type:this.model.modelName||""}},getDescription:function(){var e;return this.model.modelName?e=r.t("common.erase.description_type",{type:this.model.prefix}):e=r.t("common.erase.description"),e},afterRender:function(){this.modalWindow=e("#"+this.modalID)},show:function(e,t){this.mergeModel(e,t),this.updateMarkup(),this.modalWindow||(this.modalWindow=this.$el.find("#"+this.modalID)),this.modalWindow.modal("show")},updateMarkup:function(){var e=r.t(this.i18nQuestionKey(),{placeholder:this.getPersonalizedDataForQuestion()});this.$el.find(".question").html(e)},getPersonalizedDataForQuestion:function(){return""},getAltModuleName:function(e){return""},hide:function(e){e&&e.preventDefault(),this.modalWindow.modal("hide"),n.trigger(this.moduleName+this.getAltModuleName(":")+":erase:closed")},erase:function(e){e&&e.preventDefault(),this.model.destroy(),this.hide()},mergeModel:function(e,n){this.model.set(e),t.extend(this.model,n||{})},notifyError:function(e,t){n.trigger(this.eventNameUpdatedError(),this.model.toJSON(),t)},notifyUpdated:function(){n.trigger(this.eventNameUpdated(),this.model.toJSON())},eventNameUpdate:function(){return this.moduleName+this.getAltModuleName(":")+":erase"},eventNameUpdated:function(){return this.moduleName+this.getAltModuleName(":")+":erased"},eventNameUpdatedError:function(){return this.moduleName+this.getAltModuleName(":")+":erased:error"},i18nQuestionKey:function(){return this.moduleName.toLowerCase()+":"+this.getAltModuleName(".")+"erase.question"}})}),define("module/assets/pageLayout/view/erase",["module/common/erase/view/erase","module/assets/pageLayout/model/pageLayout"],function(e,t){var n=e.extend({moduleName:"pageLayout",model:new t({},{ignoreLanguage:!0}),getPersonalizedDataForQuestion:function(){return this.model.get("name")}});return n}),define("hbars!module/common/confirm/template/confirm",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){var i;return'          <div class="alert alert-warning">\n            <p><i class="fa fa-exclamation-circle"></i> '+this.escapeExpression((i=(i=t.warning||(e!=null?e.warning:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"warning",hash:{},data:r}):i))+"</p>\n          </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i,s;return'<div id="modal_confirm" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="confirmVersion" aria-hidden="false">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Cancel</span></button>\n        <h4 class="modal-title"><i class="'+this.escapeExpression((s=(s=t.titleIcon||(e!=null?e.titleIcon:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"titleIcon",hash:{},data:r}):s))+'"></i> '+this.escapeExpression((s=(s=t.title||(e!=null?e.title:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"title",hash:{},data:r}):s))+'</h4>\n      </div>\n      <div class="modal-body">\n        <p>'+this.escapeExpression((s=(s=t.question||(e!=null?e.question:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"question",hash:{},data:r}):s))+"</p>\n"+((i=t["if"].call(e,e!=null?e.warning:e,{name:"if",hash:{},fn:this.program(1,r,0),inverse:this.noop,data:r}))!=null?i:"")+'      </div>\n      <div class="modal-footer">\n        <a class="btn btn-default" href="#" data-dismiss="modal" aria-hidden="true">\n          <i class="fa fa-undo"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.cancel",{name:"t",hash:{},data:r}))+'\n        </a>\n        <a class="confirm '+this.escapeExpression((s=(s=t.confirmClass||(e!=null?e.confirmClass:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"confirmClass",hash:{},data:r}):s))+'" href="#">\n          <i class="'+this.escapeExpression((s=(s=t.confirmIcon||(e!=null?e.confirmIcon:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"confirmIcon",hash:{},data:r}):s))+'"></i> '+this.escapeExpression((s=(s=t.confirmText||(e!=null?e.confirmText:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"confirmText",hash:{},data:r}):s))+"\n        </a>\n      </div>\n    </div>\n  </div>\n</div>"},useData:!0})}),define("module/common/confirm/view/confirm",["backbone","i18n","hbars!module/common/confirm/template/confirm"],function(e,t,n){return e.View.extend({template:n,moduleName:null,events:{"click a[href=#]":"preventDefault","click .confirm":"confirm"},initialize:function(n){this.options=n||{},this.moduleName=this.options.moduleName||"",this.altModuleName=this.options.altModuleName||"",this.model=this.model||{},this.titleIcon=n.titleIcon||"fa fa-level-up",this.confirmText=n.confirmText||t.t("action.confirm"),this.confirmIcon=n.confirmIcon||"fa fa-check",this.warning=n.warning,this.confirmClass=n.confirmClass||"btn btn-primary",e.on(this.moduleName+":confirm",this.showModal,this)},serialize:function(){return{title:this.translate("title"),question:this.translate("question"),titleIcon:this.titleIcon,confirmText:this.confirmText,confirmIcon:this.confirmIcon,warning:this.warning,confirmClass:this.confirmClass}},afterRender:function(){var t=this;this.modalWindow=this.$("#modal_confirm"),this.modalWindow.on("hidden.bs.modal",function(){e.trigger(t.moduleName+":confirm:closed")})},showModal:function(e){this.model=e,this.render(),this.modalWindow.modal("show")},getAltModuleName:function(){if(this.altModuleName)return this.altModuleName+"."},translate:function(e){return this.getAltModuleName()?t.t(this.moduleName.toLowerCase()+":"+"confirm."+this.getAltModuleName()+e,this.model):t.t(this.moduleName.toLowerCase()+":"+"confirm."+e,this.model)},confirm:function(){e.trigger(this.moduleName+":confirmed",{model:this.model}),this.modalWindow&&this.modalWindow.modal("hide")}})}),define("module/common/page/baseRouter",["underscore","backbone"],function(e,t){var n=t.Router.extend({constructor:function(e){e=e||{},this.manager=e.manager,this.context=e.context,t.Router.apply(this,arguments)},home:function(){t.trigger(this.moduleName+":home")},add:function(){t.trigger(this.moduleName+":add")},load:function(){t.trigger(this.moduleName+":load")},edit:function(e){t.trigger(this.moduleName+":edit",e)},view:function(e){t.trigger(this.moduleName+":view",e)},duplicate:function(e){t.trigger(this.moduleName+":duplicate",e)},share:function(e,n){var r=n||{};this.page.isListFetched()?t.trigger(this.moduleName+":share",e,r):t.trigger(this.moduleName+":home:share",e,r)},setPage:function(e){this.page=e},navigateHome:function(){this.navigate("/")},goHome:function(){this.navigate("/"),this.home()},goToNotFound:function(){window.location.replace(t.CONTEXT_URL+"page/notFound?moduleName="+this.moduleName)},back:function(){history.back()},route:function(n,r,i){var s=n;e.isRegExp(n)||(n=this._routeToRegExp(n)),e.isFunction(r)&&(i=r,r=""),i||(i=this[r]);var o=this;return t.history.route(n,function(e){var u=o._extractParameters(n,e),a=function(){i&&i.apply(o,u),o.trigger.apply(o,["route:"+r].concat(u)),o.trigger("route",r,u),t.history.trigger("route",o,r,u),o.after&&o.after.apply(o,u)};o.currentRoute=s,o.before?o.before.apply(o,[{args:u,route:s,fragment:e},a]):a.call(o)}),this}});return n}),define("helper/redirectHelper",["require","backbone","jquery"],function(e){var t=e("backbone"),n=e("jquery"),r=function(e){return n(window).on("hashchange",function(){window.location.reload()}),window.location.href=e,e};return{redirectTo:function(e,n){var i=window.location.href;return n=n||{},t.Cookie.set("t4ContentRedirectTo",n.url||i),r(e)},back:function(){var e=t.Cookie.get("t4ContentRedirectTo");t.Cookie.remove("t4ContentRedirectTo");if(!e)return;return r(e)}}}),define("module/assets/pageLayout/router",["underscore","backbone","module/common/page/baseRouter","helper/contentlock/lockHelper","helper/redirectHelper","helper/modalHelper"],function(e,t,n,r,i,s){var o=n.extend({routes:{"":"home",add:"add","edit/:id":"edit","edit/:id/:activeTab":"edit","view/:id":"view","duplicate/:id":"duplicate","share/:id":"share","*path":"defaultRoute"},moduleName:"pageLayout",initialize:function(){this.lockHelper=new r,this.listenTo(t,this.moduleName+":erase:cancel",this.back),this.listenTo(t,this.moduleName+":erased",this.goHome),this.listenTo(t,this.moduleName+":added",this.goHome),this.listenTo(t,this.moduleName+":edited",this.goHome),this.listenTo(t,this.moduleName+":edit:cancel",this.goHome),this.listenTo(t,this.moduleName+":add:cancel",this.goHome),this.listenTo(t,this.moduleName+":share:cancel",this.navigateHome)},edit:function(e,n){t.trigger(this.moduleName+":edit",e,n)},defaultRoute:function(){t.trigger(this.moduleName+":add")},before:function(n,r){e.contains(["edit/:id"],n.route)&&this.idIsNumber(n.args[0])?(this.lockHelper.addExpiryCallback(function(){this.lockHelper.unlock(n.args[0]).then(function(){i.redirectTo(t.CONTEXT_URL+"page/pageLayout#")}.bind(this))}.bind(this)),this.lockHelper.checkIsAvailable(n.args[0]).then(r,function(e){e!==403&&s.create("lock-message").show().close.then(function(){i.redirectTo(t.CONTEXT_URL+"page/pageLayout#")})})):r()},updateLockHelper:function(e){this.lockHelper.setupContentTimeout(e)},idIsNumber:function(t){return!e.isNaN(parseInt(t,10))}});return o}),define("hbars!module/common/compare/template/compare",["Handlebars"],function(e){return e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){return'<div id="modal_content" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="deleteLocalLabel"\n     aria-hidden="true">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã</button>\n        <h3 class="modal-title" id="modal-select-compare"><i\n          class="fa fa-question-circle blue"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common:compare.title",{name:"t",hash:{},data:r}))+'</h3>\n      </div>\n      <div class="modal-body">\n\n        <table id="table-compare-selection" class="table table-striped table-bordered table-hover">\n          <thead>\n          <tr>\n            <th class="table-span-3">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common:compare.compareType",{name:"t",hash:{},data:r}))+'</th>\n            <th class="table-span-9">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common:compare.description",{name:"t",hash:{},data:r}))+'</th>\n            <th class="sorting_disabled"></th>\n          </tr>\n          </thead>\n          <tbody>\n          <tr>\n            <td>'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common:compare.code.title",{name:"t",hash:{},data:r}))+"</td>\n            <td>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common:compare.code.placeholder",{name:"t",hash:{},data:r}))+'</td>\n            <td><label><input id="code" name="compare-type" class="ace" type="radio" value="code" checked=""><span\n              class="lbl"></span></label></td>\n          </tr>\n          <tr>\n            <td>'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common:compare.visual.title",{name:"t",hash:{},data:r}))+" </td>\n            <td>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common:compare.visual.placeholder",{name:"t",hash:{},data:r}))+'</td>\n            <td><label><input id="visual" name="compare-type" class="ace" type="radio" value="visual"><span\n              class="lbl"></span></label></td>\n          </tr>\n          </tbody>\n        </table>\n\n      </div>\n      <div class="modal-footer">\n        <a class="btn" href="javascript:;" data-dismiss="modal" aria-hidden="true"><i\n          class="fa fa-undo"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.cancel",{name:"t",hash:{},data:r}))+'</a>\n        <a class="btn btn-primary main-action" href="javascript:;" id="compare-launch"><i\n          class="fa fa-columns"></i>  '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.compare",{name:"t",hash:{},data:r}))+"</a>\n      </div>\n    </div>\n  </div>\n</div>"},useData:!0})}),define("module/common/compare/view/compare",["jquery","underscore","backbone","i18n","hbars!module/common/compare/template/compare"],function(e,t,n,r,i){var s=n.View.extend({template:i,modalWindow:null,moduleName:null,events:{"click #compare-launch":"loadCompareView","click #eraseDeleteBtn":"erase"},initialize:function(e){t.extend(this,e||{}),this.model=this.model||{},this.listenTo(n,this.moduleName+":compare",this.showModal),this.listenTo(n,this.moduleName+":home",this.hide),this.listenTo(n,this.moduleName+":edit",this.hide),this.listenTo(n,this.moduleName+":code:compare",this.hide)},afterRender:function(){this.addHideEvent()},addHideEvent:function(){var t=this;e("#modal_content").on("hidden",function(){n.trigger(t.moduleName+":confirm:closed")})},showModal:function(t){this.options=t||{},this.model=t.model,this.versions=t.versions,e("#modal_content").modal("show")},setCompareType:function(){return e('input[name="compare-type"]:checked').val()},loadCompareView:function(){var e=this.validateHigherLowerVersions().higher,t=this.validateHigherLowerVersions().lower,r=this.options.model.get("id"),i="pageLayout",s=this.setCompareType();this.hide(),n.trigger(this.moduleName+":compare:show",{id:r,previousVersion:t,latestVersion:e,viewType:s})},validateHigherLowerVersions:function(){var e=this.options.versions.higher,t=this.options.versions.lower;return Number(e)<Number(t)&&(e=this.options.versions.lower,t=this.options.versions.higher),{higher:e,lower:t}},hide:function(){e("#modal_content").modal("hide")}});return s}),define("hbars!module/content/compare/template/code",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){return"            "+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.compare.code.version.current",{name:"t",hash:{},data:r}))+"\n"},3:function(e,t,n,r){var i;return"            "+this.escapeExpression((t.parseTime||e&&e.parseTime||t.helperMissing).call(e,(i=(i=e!=null?e.versions:e)!=null?i.higher:i)!=null?i.lastModified:i,{name:"parseTime",hash:{},data:r}))+"\n"},5:function(e,t,n,r){return'        <iframe id="higher" frameborder="0"></iframe>\n'},7:function(e,t,n,r){var i,s;return'          <option value="'+this.escapeExpression((s=(s=t.version||(e!=null?e.version:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"version",hash:{},data:r}):s))+'" '+((i=(t.compare||e&&e.compare||t.helperMissing).call(e,e!=null?e.version:e,"==",(i=(i=(i=r&&r.root)&&i.versions)&&i.lower)&&i.version,{name:"compare",hash:{},fn:this.program(8,r,0),inverse:this.noop,data:r}))!=null?i:"")+">"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.compare.code.version.name",{name:"t",hash:{},data:r}))+" "+this.escapeExpression((s=(s=t.version||(e!=null?e.version:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"version",hash:{},data:r}):s))+"</option>\n"},8:function(e,t,n,r){return'selected="selected"'},10:function(e,t,n,r){return'        <iframe id="lower" frameborder="0"></iframe>\n'},12:function(e,t,n,r){return'        <button class="btn btn-primary" type="submit" id="pageLayoutSaveBtn">\n          <i class="fa fa-save bigger-110"></i>\n          '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.save",{name:"t",hash:{},data:r}))+"\n        </button>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i,s,o,u='<div class="page-content">\n  <div class="row">\n    <div class="col-xs-12">\n      <h3 class="lighter green">'+this.escapeExpression(this.lambda((i=e!=null?e.pageLayout:e)!=null?i.name:i,e))+'</h3>\n    </div>\n  </div>\n\n  <div class="row">\n    <div class="col-xs-6">\n      <h4 class="lighter green">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.compare.code.version.name",{name:"t",hash:{},data:r}))+" "+this.escapeExpression(this.lambda((i=(i=e!=null?e.versions:e)!=null?i.higher:i)!=null?i.version:i,e))+"\n        <small>\n";return i=(s=(s=t.isCurrentVersion||(e!=null?e.isCurrentVersion:e))!=null?s:t.helperMissing,o={name:"isCurrentVersion",hash:{},fn:this.program(1,r,0),inverse:this.program(3,r,0),data:r},typeof s=="function"?s.call(e,o):s),t.isCurrentVersion||(i=t.blockHelperMissing.call(e,i,o)),i!=null&&(u+=i),u+"        </small>\n      </h4>\n"+((i=t["if"].call(e,e!=null?e.isViewTypeVisual:e,{name:"if",hash:{},fn:this.program(5,r,0),inverse:this.noop,data:r}))!=null?i:"")+'\n    </div>\n    <div class="col-xs-6">\n      <h4 class="lighter green pull-left">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.compare.code.version.name",{name:"t",hash:{},data:r}))+" "+this.escapeExpression(this.lambda((i=(i=e!=null?e.versions:e)!=null?i.lower:i)!=null?i.version:i,e))+"\n        <small>"+this.escapeExpression((t.parseTime||e&&e.parseTime||t.helperMissing).call(e,(i=(i=e!=null?e.versions:e)!=null?i.lower:i)!=null?i.lastModified:i,{name:"parseTime",hash:{},data:r}))+'</small>\n      </h4>\n      <select id="version-selection" class="pull-right">\n        <option disabled="disabled">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.compare.code.version.default",{name:"t",hash:{},data:r}))+"</option>\n"+((i=t.each.call(e,e!=null?e.listVersions:e,{name:"each",hash:{},fn:this.program(7,r,0),inverse:this.noop,data:r}))!=null?i:"")+"      </select>\n"+((i=t["if"].call(e,e!=null?e.isViewTypeVisual:e,{name:"if",hash:{},fn:this.program(10,r,0),inverse:this.noop,data:r}))!=null?i:"")+'    </div>\n  </div>\n\n\n  <div class="row"> Â´\n    <div class="col-xs-12" id="code-view"></div>\n  </div>\n\n\n  <div class="row">\n    <div class="form-actions text-right">\n'+((i=t["if"].call(e,e!=null?e.isCurrentVersion:e,{name:"if",hash:{},fn:this.program(12,r,0),inverse:this.noop,data:r}))!=null?i:"")+'      <a class="btn btn-default cancel-compare">\n        <i class="fa fa-undo bigger-110"></i>\n        '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.cancel",{name:"t",hash:{},data:r}))+"\n      </a>\n\n    </div>\n\n  </div>\n\n</div>"},useData:!0})}),define("module/content/compare/view/code",["require","underscore","backbone","Handlebars","moment","helper/makeup","hbars!module/content/compare/template/code","module/assets/pageLayout/model/pageLayout"],function(e){var t=e("underscore"),n=e("backbone"),r=e("Handlebars"),i=e("moment"),s=e("helper/makeup"),o=e("hbars!module/content/compare/template/code"),u=e("module/assets/pageLayout/model/pageLayout"),a,f="<!-- ### END HEADER / START FOOTER ### -->",l="\n"+f+"\n";return n.View.extend({template:o,events:{"change #version-selection":"update","click #pageLayoutSaveBtn":"save","click .cancel-compare":"hide"},initialize:function(){this.moduleName="compare",this.model=new u,this.model.on("sync:update",this.notifyEdited,this),this.model.on("sync:read",this.render,this),n.on("pageLayout:home",this.hide,this),n.on("pageLayout:edit",this.hide,this),n.on("pageLayout:add",this.hide,this),n.on("pageLayout:compare:code",this.configure,this),n.Validation.bind(this),this.registerHelpers()},serialize:function(){return this.versions={higher:this.model.getVersion(this.higher),lower:this.model.getVersion(this.lower)},{pageLayout:this.model.toJSON(),versions:this.versions,listVersions:this.getVersionsSorted(),isViewTypeVisual:this.viewType==="visual",isCurrentVersion:this.isCurrentVersion()&&this.viewType==="code"}},afterRender:function(){this.selectVersion=this.$("#version-selection"),this.codeView=this.$("#code-view"),this.viewType==="code"&&this.renderCode(),this.viewType==="visual"&&this.renderVisual(),s.createSelect({el:this.$("select")})},getVersionsSorted:function(){var e=this.model.get("versions"),n=this,r;return r=t.filter(e,function(e){return Number(e.version)<Number(n.higher)}),t.sortBy(r,function(e){return Number(e.version)})},isFetchedModel:function(){return this.model&&this.model.get("versions")},update:function(){var e=this.selectVersion.val(),t=["#compare",this.id,e,this.higher,this.viewType];location.hash=t.join("/")},save:function(){this.getContent(),this.model.set({headerCode:this.newHeader}),this.model.set({footerCode:this.newFooter}),this.model.save()},mergeViewHeight:function(e){function t(e){return e?e.getScrollInfo().height:0}return Math.max(t(e.leftOriginal()),t(e.editor()),t(e.rightOriginal()))},resize:function(e){var t=this.mergeViewHeight(e),n,r,i;r=e.leftOriginal(),r&&r.setSize(null,t),e.editor().setSize(null,t),i=e.rightOriginal(),i&&i.setSize(null,t),n=this.mergeViewHeight(e),n<t&&(t=n),e.wrap.style.height=t+"px"},renderVisual:function(){if(!this.isFetchedModel())return;this.frames={higher:this.$("#higher")[0],lower:this.$("#lower")[0]},this.frames.higher.contentWindow.document.write(this.builtHTML(this.versions.higher)),this.frames.lower.contentWindow.document.write(this.builtHTML(this.versions.lower))},renderCode:function(){var e=this.isCurrentVersion();e||this.codeView.addClass("readonly"),this.codeView.html(""),a=s.codeMirror.MergeView(this.codeView[0],{value:this.builtHTML(this.versions.higher),orig:this.builtHTML(this.versions.lower),lineNumbers:!0,tabSize:2,mode:"text/html",highlightDifferences:!0,readOnly:!e,viewportMargin:Infinity}),this.mergeViewHeight(a),this.resize(a),this.dv=a,this.dv.edit.on("beforeChange",this.stopSplitterEdit.bind(this))},stopSplitterEdit:function(e,t){if(!t||!t.origin)return!1;var n=t.from.line,r=this.dv.edit.getLine(n),i=t.to.line,s=this.dv.edit.getLine(i),o=this.dv.edit.getSelection();if(o.indexOf(f)>-1||r.indexOf(f)>-1||s.indexOf(f)>-1)return t.cancel()},getContent:function(){if(!this.isFetchedModel())return;var e=this.dv.edit.doc.getValue().split(l);this.newHeader=e[0],this.newFooter=e[1]},builtHTML:function(e){e=e||{};var t=e.header||"",n=e.footer||"";return t+l+n},notifyEdited:function(){n.trigger("pageLayout:edited",this.model.toJSON())},isCurrentVersion:function(){if(this.isFetchedModel()){var e=this.model.get("currentVersion"),n=this.versions.higher.version;return t.isEqual(e,n)}},registerHelpers:function(){var e=this;r.registerHelper("parseTime",function(e){return i(e).format("LL")})},configure:function(e){this.id=e.id,this.compareType="code",this.viewType=e.viewType,this.higher=e.latestVersion,this.lower=e.previousVersion,this.model.set({id:this.id}),this.model.fetch(),this.show()},show:function(){this.$el.show()},hide:function(){this.$el.hide(),n.trigger("pageLayout:compare:hidden")}})}),define("hbars!module/common/tagBuilder/template/modal",["Handlebars"],function(e){return e.template({1:function(e,t,n,r,i,s){var o;return"            <li "+((o=(t.compare||e&&e.compare||t.helperMissing).call(e,s[1]!=null?s[1].mode:s[1],"===","content",{name:"compare",hash:{},fn:this.program(2,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+' data-name="content">\n              <a data-toggle="tab" href="#tag-content">\n                <i class="ace-icon fa fa-file-text-o"></i>\n                <span class="hidden-xs">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.tabs.content",{name:"t",hash:{},data:r}))+"</span>\n              </a>\n            </li>\n"},2:function(e,t,n,r){return'class="active"'},4:function(e,t,n,r,i,s){var o;return"            <li "+((o=(t.compare||e&&e.compare||t.helperMissing).call(e,s[1]!=null?s[1].mode:s[1],"===","pageLayout",{name:"compare",hash:{},fn:this.program(2,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+' data-name="navigation">\n              <a data-toggle="tab" href="#tag-navigation">\n                <i class="ace-icon fa fa-compass"></i>\n                <span class="hidden-xs">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.tabs.navigation",{name:"t",hash:{},data:r}))+"</span>\n              </a>\n            </li>\n"},6:function(e,t,n,r){return'            <li data-name="media">\n              <a data-toggle="tab" href="#tag-media">\n                <i class="ace-icon fa fa-picture-o"></i>\n                <span class="hidden-xs">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.tabs.media",{name:"t",hash:{},data:r}))+"</span>\n              </a>\n            </li>\n"},8:function(e,t,n,r){return'            <li data-name="metaTags">\n              <a data-toggle="tab" href="#tag-meta-tags">\n                <i class="ace-icon fa fa-tags"></i>\n                <span class="hidden-xs">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.tabs.metaTags",{name:"t",hash:{},data:r}))+"</span>\n              </a>\n            </li>\n"},10:function(e,t,n,r){return'            <li data-name="channel">\n              <a data-toggle="tab" href="#tag-channel">\n                <i class="ace-icon fa fa-home"></i>\n                <span class="hidden-xs">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.tabs.channel",{name:"t",hash:{},data:r}))+"</span>\n              </a>\n            </li>\n"},12:function(e,t,n,r){var i;return'<div class="tab-pane '+((i=(t.compare||e&&e.compare||t.helperMissing).call(e,e!=null?e.mode:e,"===","content",{name:"compare",hash:{},fn:this.program(13,r,0),inverse:this.noop,data:r}))!=null?i:"")+'" id="tag-content"></div>'},13:function(e,t,n,r){return"in active"},15:function(e,t,n,r){var i;return'<div class="tab-pane '+((i=(t.compare||e&&e.compare||t.helperMissing).call(e,e!=null?e.mode:e,"===","pageLayout",{name:"compare",hash:{},fn:this.program(13,r,0),inverse:this.noop,data:r}))!=null?i:"")+'" id="tag-navigation"></div>'},17:function(e,t,n,r){return'<div class="tab-pane" id="tag-media"></div>'},19:function(e,t,n,r){return'<div class="tab-pane" id="tag-meta-tags"></div>'},21:function(e,t,n,r){return'<div class="tab-pane" id="tag-channel"></div>'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r,i,s){var o;return'<div class="modal fade">\n  <div class="modal-dialog modal-lg">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close cancel">\n          <span aria-hidden="true">Ã</span>\n          <span class="sr-only">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.close",{name:"t",hash:{},data:r}))+'</span>\n        </button>\n        <h4 class="modal-title">\n          <i class="fa fa-code"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.title",{name:"t",hash:{},data:r}))+'\n        </h4>\n      </div>\n\n      <div class="modal-body">\n        <div class="alert alert-info" style="display: none;">\n          <i class="fa fa-info-circle"></i>\n          To copy the t4 tag output straight to the clipboard enable or install Adobe Flash Player 11.0 or higher\n        </div>\n        <div class="space-10"></div>\n        <div class="tabbable">\n          <ul class="nav nav-tabs">\n'+((o=t["if"].call(e,(o=e!=null?e.tabs:e)!=null?o.content:o,{name:"if",hash:{},fn:this.program(1,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"\n"+((o=t["if"].call(e,(o=e!=null?e.tabs:e)!=null?o.navigation:o,{name:"if",hash:{},fn:this.program(4,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"\n"+((o=t["if"].call(e,(o=e!=null?e.tabs:e)!=null?o.media:o,{name:"if",hash:{},fn:this.program(6,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"\n"+((o=t["if"].call(e,(o=e!=null?e.tabs:e)!=null?o.metaTags:o,{name:"if",hash:{},fn:this.program(8,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"\n"+((o=t["if"].call(e,(o=e!=null?e.tabs:e)!=null?o.channel:o,{name:"if",hash:{},fn:this.program(10,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+'\n\n                <li data-name="misc">\n                  <a data-toggle="tab" href="#tag-misc">\n                    <i class="ace-icon fa fa-code"></i>\n                    <span class="hidden-xs">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.tabs.misc",{name:"t",hash:{},data:r}))+'</span>\n                  </a>\n                </li>\n\n          </ul>\n\n          <div class="tab-content">\n            '+((o=t["if"].call(e,(o=e!=null?e.tabs:e)!=null?o.content:o,{name:"if",hash:{},fn:this.program(12,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"\n            "+((o=t["if"].call(e,(o=e!=null?e.tabs:e)!=null?o.navigation:o,{name:"if",hash:{},fn:this.program(15,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"\n            "+((o=t["if"].call(e,(o=e!=null?e.tabs:e)!=null?o.media:o,{name:"if",hash:{},fn:this.program(17,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"\n            "+((o=t["if"].call(e,(o=e!=null?e.tabs:e)!=null?o.metaTags:o,{name:"if",hash:{},fn:this.program(19,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"\n            "+((o=t["if"].call(e,(o=e!=null?e.tabs:e)!=null?o.channel:o,{name:"if",hash:{},fn:this.program(21,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+'\n            <div class="tab-pane" id="tag-misc"></div>\n\n          </div>\n        </div>\n      </div>\n\n      <div class="modal-footer">\n        <button type="button" class="btn btn-default cancel">\n          <i class="fa fa-undo"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.cancel",{name:"t",hash:{},data:r}))+'\n        </button>\n        <button id="copy-button" type="button" class="btn btn-primary" data-clipboard-target=".tab-pane.active .preview">\n          <i class="fa fa-copy"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.action.copy",{name:"t",hash:{},data:r}))+"\n        </button>\n      </div>\n    </div>\n  </div>\n</div>\n"},useData:!0,useDepths:!0})}),define("hbars!module/common/tagBuilder/template/modal/content",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){return"    "+this.escapeExpression((t.radioOption||e&&e.radioOption||t.helperMissing).call(e,{name:"radioOption",hash:{checked:!0,tooltip:"styleguide:forms.radio.options.1.tooltip",label:"tagBuilder.content.element",value:"content",name:"tag-output"},data:r}))+"\n    "+this.escapeExpression((t.radioOption||e&&e.radioOption||t.helperMissing).call(e,{name:"radioOption",hash:{tooltip:"styleguide:forms.radio.options.2.tooltip",label:"tagBuilder.content.metadata",value:"meta",name:"tag-output"},data:r}))+"\n"},3:function(e,t,n,r){var i;return'        <option value="'+this.escapeExpression((t.typeMapper||e&&e.typeMapper||t.helperMissing).call(e,e!=null?e.type:e,{name:"typeMapper",hash:{},data:r}))+'">'+this.escapeExpression((i=(i=t.alias||(e!=null?e.alias:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"alias",hash:{},data:r}):i))+"</option>\n"},5:function(e,t,n,r){var i;return'        <option value="'+this.escapeExpression((i=(i=t.mediaLayout||(e!=null?e.mediaLayout:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"mediaLayout",hash:{},data:r}):i))+'">'+this.escapeExpression((i=(i=t.mediaLayout||(e!=null?e.mediaLayout:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"mediaLayout",hash:{},data:r}):i))+"</option>\n"},7:function(e,t,n,r){var i;return'        <option value="'+this.escapeExpression((i=(i=t.alias||(e!=null?e.alias:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"alias",hash:{},data:r}):i))+'">'+this.escapeExpression((i=(i=t.alias||(e!=null?e.alias:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"alias",hash:{},data:r}):i))+"</option>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i;return'<h4 class="green lighter">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.title",{name:"t",hash:{},data:r}))+"</h4>\n<p>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.subTitle",{name:"t",hash:{},data:r}))+'</p>\n<hr />\n\n<form class="form-horizontal">\n\n'+((i=(t.radioGroup||e&&e.radioGroup||t.helperMissing).call(e,{name:"radioGroup",hash:{optionWidth:"col-sm-8",labelWidth:"col-sm-4",label:"tagBuilder.content.tagOutput"},fn:this.program(1,r,0),inverse:this.noop,data:r}))!=null?i:"")+'\n<div class="content-element-collection">\n\n  <div class="form-group" id="content-element">\n    <label class="col-sm-4 control-label" for="content-element-select">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.contentElement",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-sm-7">\n      <select name="content-element-select" class="width-100" id="content-element-select" title="" data-placement="top">\n'+((i=t.each.call(e,e!=null?e.elements:e,{name:"each",hash:{},fn:this.program(3,r,0),inverse:this.noop,data:r}))!=null?i:"")+'      </select>\n    </div>\n  </div>\n\n  <div class="form-group" id="date-format-select-group">\n    <label class="col-sm-4 control-label" for="date-format-select">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.dateFormat",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-xs-12 col-sm-7">\n      <select name="date-format-select" class="width-100" id="date-format-select" title="" data-placement="top">\n'+((i=this.invokePartial(n.dateFormats,e,{name:"dateFormats",data:r,indent:"        ",helpers:t,partials:n}))!=null?i:"")+"      </select>\n    </div>\n  </div>\n\n  "+this.escapeExpression((t.textField||e&&e.textField||t.helperMissing).call(e,{name:"textField",hash:{name:"custom-date-format",id:"custom-date-format",label:"tagBuilder.content.customDateFormat",inputWidth:"col-xs-12 col-sm-7",labelWidth:"col-sm-4",containerClass:"custom-date-format-group"},data:r}))+'\n\n  <div class="form-group" id="media-formatter-group">\n    <label class="col-sm-4 control-label" for="media-formatter-select">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.mediaFormatter",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-xs-12 col-sm-7">\n      <select name="media-formatter-select" class="width-100" id="media-formatter-select" title="" data-placement="top">\n        <option></option>\n        <option value="custom">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.customFormat",{name:"t",hash:{},data:r}))+"</option>\n"+((i=t.each.call(e,e!=null?e.formats:e,{name:"each",hash:{},fn:this.program(5,r,0),inverse:this.noop,data:r}))!=null?i:"")+"      </select>\n    </div>\n  </div>\n\n  "+this.escapeExpression((t.textField||e&&e.textField||t.helperMissing).call(e,{name:"textField",hash:{name:"custom-media-formatter",id:"custom-media-formatter",label:"tagBuilder.content.customMediaFormatter",inputWidth:"col-xs-12 col-sm-7",labelWidth:"col-sm-4",containerClass:"custom-media-formatter-group"},data:r}))+'\n\n\n  <div class="form-group" id="output-method">\n    <label class="col-sm-4 control-label" for="output-method-select">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.outputMethod.label",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-xs-12 col-sm-7">\n      <select name="output-method-select" class="width-100" id="output-method-select" title="" data-placement="top">\n        <option value="normal" id="output-normal-output">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.outputMethod.normalOutput",{name:"t",hash:{},data:r}))+'</option>\n        <option value="selective-output" id="output-selective">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.outputMethod.selectiveOutput",{name:"t",hash:{},data:r}))+'</option>\n        <option value="fulltext" id="output-fulltext">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.outputMethod.fulltext",{name:"t",hash:{},data:r}))+'</option>\n        <option value="value" id="output-list-value">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.outputMethod.listValue",{name:"t",hash:{},data:r}))+'</option>\n        <option value="name" id="output-list-name">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.outputMethod.listName",{name:"t",hash:{},data:r}))+'</option>\n        <option value="normal" id="output-standard-link">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.outputMethod.standardLink",{name:"t",hash:{},data:r}))+'</option>\n        <option value="linktext" id="output-link-text">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.outputMethod.linkText",{name:"t",hash:{},data:r}))+'</option>\n        <option value="linkurl" id="output-link-url">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.outputMethod.linkURL",{name:"t",hash:{},data:r}))+'</option>\n        <option value="file" id="output-file">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.outputMethod.outputToFile",{name:"t",hash:{},data:r}))+'</option>\n        <option value="image" id="output-image">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.outputMethod.outputToImage",{name:"t",hash:{},data:r}))+'</option>\n        <option value="imageurl" id="output-image-url">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.outputMethod.outputToImageUrl",{name:"t",hash:{},data:r}))+'</option>\n        <option value="userinfo" id="output-user-info">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.outputMethod.userInfo",{name:"t",hash:{},data:r}))+'</option>\n      </select>\n    </div>\n  </div>\n\n  <div class="form-group" id="process-selective-output">\n    <label class="control-label col-sm-4">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.process",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-sm-8">\n      <div class="checkbox">\n        <label>\n          <input id="process-selective-output-checkbox" name="process-selective-output-checkbox" type="checkbox" class="ace" />\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.parseT4",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n    </div>\n  </div>\n\n  <div class="form-group" id="userinfo-output-group">\n    <label class="control-label col-sm-4">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.userInfoOutput",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-sm-8">\n\n      <div class="radio">\n        <label>\n          <input name="userinfo-output" value="username" type="radio" class="ace" checked />\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.username",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n\n      <div class="radio">\n        <label>\n          <input name="userinfo-output" value="first_last" type="radio" class="ace" />\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.firstName",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n\n      <div class="radio">\n        <label>\n          <input name="userinfo-output" value="last_first" type="radio" class="ace" />\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.lastName",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n    </div>\n  </div>\n\n  <div class="form-group" id="content-selective-output-markup">\n    <label for="selective-output-markup" class="col-sm-4 control-label">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.selectiveOutputMarkup",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-xs-12 col-sm-7">\n      <span class="block">\n        <textarea name="selective-output-markup" id="selective-output-markup" class="width-100" rows="10"></textarea>\n      </span>\n    </div>\n  </div>\n\n  <div class="form-group" id="friendly-url-group">\n    <label class="control-label col-sm-4">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.fullTextURL",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-sm-7">\n      <div class="checkbox">\n        <label>\n          <input name="fulltext-use-element" type="checkbox" class="ace">\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.friendlyURL",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n    </div>\n  </div>\n\n  <div class="form-group" id="friendly-url-element-group">\n    <label class="col-sm-4 control-label" for="friendly-url-element">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.contentElementURL",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-sm-7">\n      <select name="friendly-url-element" class="width-100" id="friendly-url-element" title="" data-placement="top">\n      <option></option>\n'+((i=t.each.call(e,e!=null?e.elements:e,{name:"each",hash:{},fn:this.program(7,r,0),inverse:this.noop,data:r}))!=null?i:"")+'      </select>\n    </div>\n  </div>\n\n  <div class="form-group modifiers" id="content-modifiers">\n    <label class="control-label col-sm-4">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.modifiers.label",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-sm-8">\n\n      <div class="checkbox">\n        <label>\n          <input name="parse-media" type="checkbox" class="ace" data-value="medialibrary">\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.modifiers.parseForMedia",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n\n      <div class="checkbox">\n        <label>\n          <input name="parse-navigation" type="checkbox" class="ace" data-value="nav_sections">\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.modifiers.parseForNavigation",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n\n      <div class="checkbox">\n        <label>\n          <input name="strip-html" type="checkbox" class="ace" data-value="striptags">\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.modifiers.stripOutHTML",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n\n      <div class="checkbox">\n        <label>\n          <input name="html-encode" type="checkbox" class="ace" data-value="htmlentities">\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.modifiers.encodeCharacters",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n\n      <div class="checkbox">\n        <label>\n          <input name="new-lines" type="checkbox" class="ace" data-value="nl2br">\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.modifiers.newLineToBR",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n\n      <div class="checkbox">\n        <label>\n          <input name="invalid-rss" type="checkbox" class="ace" data-value="rssentities">\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.modifiers.rss",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n\n      <div class="checkbox">\n        <label>\n          <input name="encode-for-js" type="checkbox" class="ace" data-value="js_var">\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.modifiers.js",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n\n      <div class="checkbox">\n        <label>\n          <input name="encode-email" type="checkbox" class="ace" data-value="encode_emails">\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.modifiers.ascii",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n\n    </div>\n  </div>\n\n  <div class="form-group" id="format-modifiers">\n    <label class="control-label col-sm-4">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.formatModifiers.label",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-sm-8">\n      <div class="checkbox">\n        <label>\n          <input id="enable-format-modifiers" name="enable-format-modifiers" type="checkbox" class="ace">\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.formatModifiers.enableFormatModifiers",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n    </div>\n    <div class="space-20"></div>\n    <div id="format-modifier-values">\n      <label for="format-modifier-values" class="col-sm-4 control-label">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.formatModifiers.formatModifierValues",{name:"t",hash:{},data:r}))+'</label>\n        <div class="col-xs-12 col-sm-7">\n          <input type="text" name="format-modifiers-text" id="format-modifiers-text" class="width-100"></input>\n        </div>\n    </div>\n  </div>\n\n  <div class="form-group" id="content-direct-edit">\n    <label class="control-label col-sm-4">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.directEdit",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-sm-8">\n      <div class="checkbox">\n        <label>\n          <input id="disable-direct-edit" name="disable-direct-edit" type="checkbox" class="ace">\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.disableDirectEdit",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n    </div>\n  </div>\n\n</div> \n\n\n<div class="content-metadata-collection">\n  <div class="form-group" id="content-metadata-type">\n    <label class="control-label col-sm-4">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.metaData.label",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-sm-8">\n\n      <div class="radio">\n        <label>\n          <input value="html-anchor" name="metadata-type" type="radio" class="ace" data-value="html_anchor" data-hide-name="true" checked>\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.metaData.htmlAnchor",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n\n      <div class="radio">\n        <label>\n          <input value="content-id" name="metadata-type" type="radio" class="ace" data-value="content_id" data-hide-name="true">\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.metaData.contentID",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n\n      <div class="radio">\n        <label>\n          <input value="last-modified" data-date="true" name="metadata-type" type="radio" class="ace" data-value="last_modified">\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.metaData.lastModified",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n\n      <div class="radio">\n        <label>\n          <input value="last-modified-by-username" name="metadata-type" type="radio" class="ace" data-value="last_modified_by_username">\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.metaData.lastModifiedUsername",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n\n      <div class="radio">\n        <label>\n          <input value="last-modified-by-full-value" name="metadata-type" type="radio" class="ace" data-value="last_modified_by_fullname">\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.metaData.lastModifiedValue",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n\n      <div class="radio">\n        <label>\n          <input value="last-modified-x-days" name="metadata-type" type="radio" class="ace" data-value="recently_modified">\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.metaData.days",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n\n      <div class="radio">\n        <label>\n          <input value="publish-date" data-date="true" name="metadata-type" type="radio" class="ace" data-value="publish_date">\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.metaData.publishDate",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n\n      <div class="radio">\n        <label>\n          <input value="expiry-date" data-date="true" name="metadata-type" type="radio" class="ace" data-value="expiry_date">\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.metaData.expiryDate",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n\n      <div class="radio">\n        <label>\n          <input value="content-version" name="metadata-type" type="radio" class="ace" data-value="version">\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.metaData.contentVersion",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n\n      <div class="radio">\n        <label>\n          <input value="element-size" data-element="true" name="metadata-type" type="radio" class="ace" data-value="filesize">\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.metaData.elementSize",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n\n    </div>\n  </div>\n\n  <div class="form-group" id="meta-date-format-select-group">\n    <label class="col-sm-4 control-label" for="meta-date-format-select">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.dateFormat",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-xs-12 col-sm-7">\n      <select name="meta-date-format-select" class="width-100" id="meta-date-format-select" title="" data-placement="top">\n'+((i=this.invokePartial(n.dateFormats,e,{name:"dateFormats",data:r,indent:"        ",helpers:t,partials:n}))!=null?i:"")+'      </select>\n    </div>\n  </div>\n\n  <div class="form-group" id="custom-meta-date-format-group">\n    <label for="custom-meta-date-format" class="col-sm-4 control-label">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.customDateFormat",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-xs-12 col-sm-7">\n      <span class="block">\n        <input type="text" id="custom-meta-date-format" name="custom-meta-date-format" class="width-100" />\n      </span>\n    </div>\n  </div>\n\n  <div class="form-group" id="content-metadata-element-size">\n    <label class="col-sm-4 control-label" for="meta-size-content-element">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.contentForSize",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-sm-7">\n      <select name="meta-size-content-element" class="width-100" id="meta-size-content-element" data-placeholder="Select an element" title="" data-placement="top">\n'+((i=t.each.call(e,e!=null?e.elements:e,{name:"each",hash:{},fn:this.program(3,r,0),inverse:this.noop,data:r}))!=null?i:"")+'      </select>\n    </div>\n  </div>\n\n\n</div>\n\n\n  <div class="form-group" id="custom-image-client-resize-group">\n    <label for="custom-image-client-resize" class="control-label col-sm-4">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.clientResize",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-sm-8">\n      <div class="checkbox">\n        <label>\n          <input id="custom-image-client-resize" name="custom-image-client-resize" type="checkbox" class="ace" />\n          <span class="lbl">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.disableClientResize",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n    </div>\n  </div>\n\n  <div class="form-group" id="custom-image-max-width-group">\n    <label for="custom-image-max-width" class="col-sm-4 control-label">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.maxWidth",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-xs-12 col-sm-7">\n      <span class="block">\n        <input type="text" id="custom-image-max-width" name="custom-image-max-width" class="width-100" />\n      </span>\n    </div>\n  </div>\n\n  <div class="form-group" id="custom-image-max-height-group">\n    <label for="custom-image-max-height" class="col-sm-4 control-label">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.maxHeight",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-xs-12 col-sm-7">\n      <span class="block">\n        <input type="text" id="custom-image-max-height" name="custom-image-max-height" class="width-100" />\n      </span>\n    </div>\n  </div>\n\n  <div class="form-group" id="custom-image-alt-group">\n    <label for="custom-image-alt" class="col-sm-4 control-label">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.alt",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-xs-12 col-sm-7">\n      <span class="block">\n        <input type="text" id="custom-image-alt" name="custom-image-alt" class="width-100" />\n      </span>\n    </div>\n  </div>\n\n  <div class="form-group" id="custom-image-alt-element-group">\n    <label for="custom-image-element-alt" class="col-sm-4 control-label">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.altElement",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-xs-12 col-sm-7">\n      <span class="block">\n        <input type="text" id="custom-image-alt-element" name="custom-image-alt-element" class="width-100" />\n      </span>\n    </div>\n  </div>\n\n  <div class="form-group" id="custom-image-style-group">\n    <label for="custom-image-style" class="col-sm-4 control-label">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.style",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-xs-12 col-sm-7">\n      <span class="block">\n        <textarea name="custom-image-style" id="custom-image-style" class="width-100" rows="3"></textarea>\n      </span>\n    </div>\n  </div>\n\n\n</form>\n\n<div class="preview-container"></div>\n'},usePartial:!0,useData:!0})}),function(e){var t=function(t,n){this.selector=t,this.$dependencyObj=e(t),this.qualifiers=n};t.prototype.enabled=function(t){if(e(this.selector+"[disabled]").length>0){if(t)return!1}else if(!t)return!1;return!0},t.prototype.checked=function(e){if(this.$dependencyObj.attr("type")==="checkbox")if(!this.$dependencyObj.is(":checked")&&e||this.$dependencyObj.is(":checked")&&!e)return!1;return!0},t.prototype.values=function(t){var n=this.$dependencyObj.val(),r=t.length,i=0,s=!1;this.$dependencyObj.attr("type")==="radio"&&(n=this.$dependencyObj.filter(":checked").val());for(i;i<r;i+=1)if(typeof n=="array"||typeof n=="object"){if(e(this.$dependencyObj.val()).not(e(t[i])).length===0&&e(t[i]).not(e(this.$dependencyObj.val())).length===0){s=!0;break}}else if(t[i]===n){s=!0;break}return s},t.prototype.not=function(e){var t=this.$dependencyObj.val(),n=e.length,r=0;for(r;r<n;r+=1)if(e[r]===t)return!1;return!0},t.prototype.match=function(e){var t=this.$dependencyObj.val(),n=e;return n.test(t)},t.prototype.contains=function(t){var n=this.$dependencyObj.val(),r=0;if(typeof n!="array"&&typeof n!="object")return this.values(t);for(r in t)if(e.inArray(t[r],n)!==-1)return!0;return!1},t.prototype.email=function(e){var t=/^[_a-zA-Z0-9\-]+(\.[_a-zA-Z0-9\-]+)*@[a-zA-Z0-9\-]+(\.[a-zA-Z0-9\-]+)*\.(([0-9]{1,3})|([a-zA-Z]{2,3})|(aero|coop|info|museum|name))$/;return this.match(t)===e},t.prototype.url=function(e){var t=/(((http|ftp|https):\/\/)|www\.)[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?\^=%&:\/~\+#!]*[\w\-\@?\^=%&\/~\+#])?/g;return this.match(t)===e},t.prototype.doesQualify=function(){var e=0;for(e in this.qualifiers)if(t.prototype.hasOwnProperty(e)&&typeof t.prototype[e]=="function"){if(!this[e](this.qualifiers[e]))return!1}else if(typeof (this.qualifiers[e]==="function"))return this.qualifiers[e](this.$dependencyObj.val());return!0};var n=function(e){var n=0;this.dependencies=[];for(n in e)this.dependencies.push(new t(n,e[n]))};n.prototype.doesQualify=function(){var e=this.dependencies.length,t=0,n=!0;for(t;t<e;t+=1)if(!this.dependencies[t].doesQualify()){n=!1;break}return n};var r=function(t,n,r){this.dependencySets=[],this.$subject=t,this.settings=e.extend({disable:!0,hide:!0,duration:200,onEnable:function(){},onDisable:function(){}},r),this.enableCallback=function(){},this.disableCallback=function(){},this.init(n)};r.prototype.init=function(e){this.addSet(e),this.check(!0)},r.prototype.addSet=function(e){var t=this,r=0,i=0,s=0,o;this.dependencySets.push(new n(e)),r=this.dependencySets.length-1,i=this.dependencySets[r].dependencies.length;for(s;s<i;s+=1)o=this.dependencySets[r].dependencies[s],o.$dependencyObj.on("change",function(e){t.triggeredEvent=e,t.triggeredDependency=this,t.check()}),o.$dependencyObj.attr("type")==="text"&&o.$dependencyObj.on("keypress",function(e){e.which&&o.$dependencyObj.is(":focus")&&t.check()&&(t.triggeredEvent=e,t.triggeredDependency=this,t.check())})},r.prototype.or=function(e){return this.addSet(e),this.check(!1),this},r.prototype.enable=function(t){var n=this.$subject,r=this.$subject.attr("id"),i;this.settings.hasOwnProperty("valueTarget")&&this.settings.valueTarget!==undefined?n=e(this.settings.valueTarget):this.$subject[0].nodeName.toLowerCase()!=="input"&&this.$subject[0].nodeName.toLowerCase()!=="textarea"&&this.$subject[0].nodeName.toLowerCase()!=="select"&&(n=this.$subject.find("input, textarea, select")),this.settings.disable&&this.$subject.removeAttr("disabled"),this.settings.hide&&(this.$subject.parent()[0].nodeName.toLowerCase()==="label"?i=this.$subject.parent():i=this.$subject.add('label[for="'+r+'"]'),i.css("display")==="none"&&(t?i.show():i.fadeIn(this.settings.duration))),this.settings.hasOwnProperty("valueOnEnable")&&this.settings.valueOnEnable!==undefined&&n.val(this.settings.valueOnEnable),this.settings.hasOwnProperty("checkOnEnable")&&(this.settings.checkOnEnable?n.attr("checked","checked"):n.removeAttr("checked")),this.settings.hasOwnProperty("toggleClass")&&this.settings.toggleClass!==undefined&&this.$subject.addClass(this.settings.toggleClass),this.settings.onEnable.call(this.triggeredDependency,this.triggeredEvent)},r.prototype.disable=function(t){var n=this.$subject,r=this.$subject.attr("id"),i;this.settings.hasOwnProperty("valueTarget")&&this.settings.valueTarget!==undefined?n=e(this.settings.valueTarget):this.$subject[0].nodeName.toLowerCase()!=="input"&&this.$subject[0].nodeName.toLowerCase()!=="textarea"&&this.$subject[0].nodeName.toLowerCase()!=="select"&&(n=this.$subject.find("input, textarea, select")),this.settings.disable&&this.$subject.attr("disabled","disabled"),this.settings.hide&&(this.$subject.parent()[0].nodeName.toLowerCase()==="label"?i=this.$subject.parent():i=this.$subject.add('label[for="'+r+'"]'),t?i.css({display:"none"}):i.fadeOut(this.settings.duration)),this.settings.hasOwnProperty("valueOnDisable")&&this.settings.valueOnDisable!==undefined&&n.val(this.settings.valueOnDisable),this.settings.hasOwnProperty("checkOnDisable")&&(this.settings.checkOnDisable?n.attr("checked","checked"):n.removeAttr("checked")),this.settings.hasOwnProperty("toggleClass")&&this.settings.toggleClass!==undefined&&this.$subject.removeClass(this.settings.toggleClass),this.settings.onDisable.call(this.triggeredDependency,this.triggeredEvent)},r.prototype.check=function(e){var t=this.dependencySets.length,n=0,r=!1;for(n;n<t;n+=1)if(this.dependencySets[n].doesQualify()){r=!0;break}return r?(this.enable(e),!0):(this.disable(e),!1)},e.fn.dependsOn=function(e,t){var n=new r(this,e,t);return n}}(jQuery),define("dependsOn",function(){}),define("module/common/tagBuilder/helper/dependencies",["jquery","dependsOn"],function(e,t){var n=function(t,n,r){return function(){var i=e("#content-element-select").val(),s=Array.isArray(t)?t:[t],o='[name="'+n+'"]';r.$(o).prop("checked",e.inArray(i,s)>=0)}};return function(){var t=this;this.$(".content-element-collection").dependsOn({'[name="tag-output"]':{values:["content"]}},{duration:0}),this.$(".content-metadata-collection").dependsOn({'[name="tag-output"]':{values:["meta"]}},{duration:0}),this.$("#content-metadata-element-size").dependsOn({'[name="metadata-type"]':{values:["element-size"]}},{duration:0}),this.$("#output-standard-link, #output-link-text, #output-link-url").dependsOn({"#content-element-select":{values:["section-content-link"]}},{duration:0}),this.$("#output-normal-output").dependsOn({"#content-element-select":{values:["","plaintext","date","decimal-number","group-select","HTML","media","whole-number"]}},{duration:0,onEnable:function(){t.$("#output-normal-output").prop("selected",!0)}}),this.$("#output-list-value").dependsOn({"#content-element-select":{values:["checkbox","cascading-list","multi-select-list","multiple-select","radio","select-box"]}},{valueTarget:"#output-method-select",valueOnEnable:"value",duration:0}),this.$("#output-list-name").dependsOn({"#content-element-select":{values:["checkbox","cascading-list","multi-select-list","multiple-select","radio","select-box"]}},{valueTarget:"#output-method-select",valueOnEnable:"value",duration:0}),this.$("#output-standard-link").dependsOn({"#content-element-select":{values:["section-content-link"]}},{onEnable:function(){t.$("#output-standard-link").prop("selected",!0)},duration:0}),this.$("#output-link-text").dependsOn({"#content-element-select":{values:["section-content-link"]}},{onEnable:function(){t.$("#output-standard-link").prop("selected",!0)},duration:0}),this.$("#output-link-url").dependsOn({"#content-element-select":{values:["section-content-link"]}},{onEnable:function(){t.$("#output-standard-link").prop("selected",!0)},duration:0}),this.$("#output-file").dependsOn({"#content-element-select":{values:["file"]}},{onEnable:function(){var n=e("#content-element-select").val();t.$("#output-file").prop("selected",n==="file")},duration:0}),this.$("#output-image").dependsOn({"#content-element-select":{values:["image"]}},{onEnable:function(){var n=e("#content-element-select").val();t.$("#output-image").prop("selected",n==="image")},duration:0}),this.$("#output-image-url").dependsOn({"#content-element-select":{values:["image"]}},{onEnable:function(){var n=e("#content-element-select").val();t.$("#output-image-url").prop("selected",n==="imageurl")},duration:0}),this.$("#output-user-info").dependsOn({"#content-element-select":{values:["content-owner"]}},{valueTarget:"#output-method-select",valueOnEnable:"userinfo",onEnable:function(){t.$("#output-method-select").trigger("change")},onDisable:function(){t.$("#output-method-select").trigger("change")},duration:0}),this.$("#userinfo-output-group").dependsOn({"#output-method-select":{values:["userinfo"]}},{duration:0}),this.$("#process-selective-output").dependsOn({"#output-method-select":{values:["selective-output"]}},{valueTarget:"#process-selective-output-checkbox",checkOnEnable:!0,checkOnDisable:!1,duration:0}),this.$("#content-selective-output-markup").dependsOn({"#output-method-select":{values:["selective-output"]}},{duration:0}),this.$("#friendly-url-group").dependsOn({"#output-method-select":{values:["fulltext"]}},{valueTarget:'[name="fulltext-use-element"]',checkOnEnable:!0,checkOnDisable:!1,duration:0}),this.$("#friendly-url-element-group").dependsOn({"#output-method-select":{values:["fulltext"]},'[name="fulltext-use-element"]':{checked:!0}},{duration:0}),this.$("#date-format-select-group").dependsOn({"#content-element-select":{values:["date"]}},{duration:0}),this.$(".custom-date-format-group").dependsOn({"#date-format-select":{values:["custom"]},"#content-element-select":{values:["date"]}},{duration:0}),this.$("#meta-date-format-select-group").dependsOn({"#content-metadata-type input":{values:["last-modified","publish-date","expiry-date"]}},{duration:0}),this.$("#custom-meta-date-format-group").dependsOn({"#meta-date-format-select":{values:["custom"]}},{duration:0}),this.$("#media-formatter-group").dependsOn({"#content-element-select":{values:["media"]}},{duration:0}),this.$(".custom-media-formatter-group").dependsOn({"#media-formatter-select":{values:["custom"]},"#content-element-select":{values:["media"]}},{duration:0}),this.$('[name="parse-media"]').dependsOn({"#content-element-select":{not:["content-owner","date","decimal-number","file","group-select","image","keyword-selector","media","section-content-link","whole-number"]}},{hide:!1,checkOnDisable:!1,onEnable:n("HTML","parse-media",this),duration:0}),this.$('[name="parse-navigation"]').dependsOn({"#content-element-select":{not:["content-owner","date","decimal-number","file","group-select","image","keyword-selector","media","section-content-link","whole-number"]}},{hide:!1,checkOnDisable:!1,onEnable:n("HTML","parse-navigation",this),onDisable:n("section-content-link","parse-navigation",this),duration:0}),this.$('[name="strip-html"]').dependsOn({"#content-element-select":{not:["content-owner","date","decimal-number","file","group-select","image","keyword-selector","media","section-content-link","whole-number"]}},{hide:!1,checkOnDisable:!1,onEnable:n("plaintext","strip-html",this),duration:0}),this.$('[name="html-encode"]').dependsOn({"#content-element-select":{not:["content-owner","date","decimal-number","file","group-select","image","keyword-selector","media","section-content-link","whole-number"]}},{hide:!1,checkOnDisable:!1,onEnable:n("plaintext","html-encode",this),duration:0}),this.$('[name="new-lines"]').dependsOn({"#content-element-select":{values:["plaintext"]}},{hide:!1,checkOnDisable:!1,duration:0}),this.$('[name="invalid-rss"]').dependsOn({"#content-element-select":{not:["content-owner","date","decimal-number","file","group-select","image","keyword-selector","media","section-content-link","whole-number"]}},{hide:!1,checkOnDisable:!1,duration:0}),this.$('[name="encode-for-js"]').dependsOn({"#content-element-select":{not:["content-owner","date","decimal-number","file","group-select","image","keyword-selector","media","section-content-link","whole-number"]}},{hide:!1,checkOnDisable:!1,duration:0}),this.$('[name="encode-email"]').dependsOn({"#content-element-select":{not:["content-owner","date","decimal-number","file","group-select","image","keyword-selector","media","section-content-link","whole-number"]}},{hide:!1,checkOnDisable:!1,duration:0}),this.$('[id="format-modifier-values"]').dependsOn({"#enable-format-modifiers":{checked:!0}}),this.$('[id="content-modifiers"]').dependsOn({"#output-method-select":{not:["fulltext"]}}),this.$('[id="format-modifiers"]').dependsOn({"#output-method-select":{values:["selective-output"]}}),this.$("#custom-image-client-resize-group").dependsOn({"#output-method-select":{values:["image"]}}),this.$("#custom-image-max-width-group").dependsOn({"#output-method-select":{values:["image","imageurl"]}}),this.$("#custom-image-max-height-group").dependsOn({"#output-method-select":{values:["image","imageurl"]}}),this.$("#custom-image-alt-group").dependsOn({"#output-method-select":{values:["image"]}}),this.$("#custom-image-alt-element-group").dependsOn({"#output-method-select":{values:["image"]}}),this.$("#custom-image-style-group").dependsOn({"#output-method-select":{values:["image"]}})}}),define("hbars!module/common/tagBuilder/template/dateFormats",["Handlebars"],function(e){return e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){return'<option></option>\n<option value="custom">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.customFormat",{name:"t",hash:{},data:r}))+'</option>\n<optgroup label="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.dateFormats.dateExamples.title",{name:"t",hash:{},data:r}))+'">\n  <option value="MM/dd/yyyy">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.dateFormats.dateExamples.MM/dd/yyyy",{name:"t",hash:{},data:r}))+'</option>\n  <option value="M/d/yy">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.dateFormats.dateExamples.M/d/yy",{name:"t",hash:{},data:r}))+'</option>\n  <option value="dd/MM/yyyy">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.dateFormats.dateExamples.dd/MM/yyyy",{name:"t",hash:{},data:r}))+'</option>\n  <option value="d/M/yy">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.dateFormats.dateExamples.d/M/yy",{name:"t",hash:{},data:r}))+"</option>\n  <option value=\"EEE, MMM d, ''yy\">"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.dateFormats.dateExamples.EEE, MMM d, ''yy",{name:"t",hash:{},data:r}))+'</option>\n  <option value="EEEE, MMMM d, yyyy">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.dateFormats.dateExamples.EEEE, MMMM d, yyyy",{name:"t",hash:{},data:r}))+'</option>\n</optgroup>\n<optgroup label="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.dateFormats.timeExamples.title",{name:"t",hash:{},data:r}))+'">\n  <option value="hh:mm a">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.dateFormats.timeExamples.hhmm a",{name:"t",hash:{},data:r}))+'</option>\n  <option value="h:mm a">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.dateFormats.timeExamples.hmm a",{name:"t",hash:{},data:r}))+'</option>\n  <option value="HH:mm">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.dateFormats.timeExamples.HHmm",{name:"t",hash:{},data:r}))+'</option>\n  <option value="HH:mm:ss z">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.dateFormats.timeExamples.HHmmss z",{name:"t",hash:{},data:r}))+'</option>\n  <option value="HH:mm:ss Z">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.dateFormats.timeExamples.HHmmss Z",{name:"t",hash:{},data:r}))+"</option>\n  <option value=\"h 'o''clock' a, zzzz\">"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.dateFormats.timeExamples.h 'o''clock' a, zzzz",{name:"t",hash:{},data:r}))+'</option>\n</optgroup>\n<optgroup label="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.dateFormats.dateAndTimeExamples.title",{name:"t",hash:{},data:r}))+'">\n  <option value="MM/dd/yyyy \'at\' HH:mm:ss z">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.dateFormats.dateAndTimeExamples.MM/dd/yyyy 'at' HHmmss z",{name:"t",hash:{},data:r}))+"</option>\n  <option value=\"h:mm a 'on' EEE, d MMMM\">"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.dateFormats.dateAndTimeExamples.hmm a 'on' EEE, d MMMM",{name:"t",hash:{},data:r}))+"</option>\n  <option value=\"yyyyMMdd'T'HHmmss'Z'\">"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.dateFormats.dateAndTimeExamples.yyyyMMdd'T'HHmmss'Z'",{name:"t",hash:{},data:r}))+"</option>\n  <option value=\"yyyy-MM-dd'T'HH:MM:ss'Z'\">"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.content.dateFormats.dateAndTimeExamples.yyyy-MM-dd'T'HHMMss'Z'",{name:"t",hash:{},data:r}))+"</option>\n</optgroup>"},useData:!0})}),define("module/common/tagBuilder/view/modal/content",["backbone","underscore","jquery","hbars!module/common/tagBuilder/template/modal/content","module/common/tagBuilder/helper/dependencies","hbars!module/common/tagBuilder/template/dateFormats","Handlebars"],function(e,t,n,r,i,s,o){var u={"Plain Text":"plaintext",Image:"image",Html:"html",File:"file",Date:"date","Check Box":"checkbox","Select Box":"select-box","Multiple Select":"multiple-select","Radio Button":"radio","Cascading List":"cascading-list",Media:"media","Decimal Number":"decimal-number","Whole Number":"whole-number","Section/Content Link":"section-content-link","Multi-select List":"multi-select-list","Content Owner":"content-owner","Keyword Selector":"keyword-selector","Group Select":"group-select"};return e.View.extend({template:r,events:{'change [name="tag-output"]':"build",'change [name="metadata-type"]':"build",'change [name="content-element-select"]':"build",'change [name="output-method-select"]':"build",'change [name="fulltext-use-element"]':"build",'change [name="friendly-url-element"]':"build",'change [name="meta-date-format-select"]':"build",'change [name="meta-size-content-element"]':"build",'change [name="disable-direct-edit"]':"build",'change [name="userinfo-output"]':"build",'change [name="process-selective-output-checkbox"]':"build",'change [name="date-format-select"]':"build",'change [name="media-formatter-select"]':"build","change .modifiers input":"build",'change [name="enable-format-modifiers"]':"build",'keyup [name="custom-meta-date-format"]':"build",'keyup [name="selective-output-markup"]':"build",'keyup [name="custom-date-format"]':"build",'keyup [name="custom-media-formatter"]':"build",'keyup [name="format-modifiers-text"]':"build",'change [name="custom-image-client-resize"]':"build",'keyup [name="custom-image-max-width"]':"build",'keyup [name="custom-image-max-height"]':"build",'keyup [name="custom-image-alt"]':"build",'keyup [name="custom-image-alt-element"]':"build",'keyup [name="custom-image-style"]':"build"},initialize:function(e){this.options=e||{},this.previewView=new e.previewConstructor,this.tagAttributes={},o.registerPartial("dateFormats",s),o.registerHelper("typeMapper",function(e){var n=t.find(this.elementTypes,function(t){return e===t.id});if(n)return u[n.name]||n.name}.bind(this))},serialize:function(){return{elements:this.elements||[],formats:this.mediaFormats||[]}},beforeRender:function(){this.insertView(".preview-container",this.previewView)},afterRender:function(){i.apply(this),this.build()},setContentElements:function(e){this.elements=e,this.render()},setElementTypes:function(e){this.elementTypes=e,this.render()},setMediaFormats:function(e){this.mediaFormats=e,this.render()},build:function(){var e=this.$('[name="tag-output"]:checked').val(),t=this.$("#output-method-select").val();this.tagType=e,(!t||this.outputTypeIsDisabled(t))&&this.selectFirstEnabledOutputType(),t!="userinfo"&&n("#userinfo-output-group").hide(),this.tagAttributes=this["build"+e.capitalize()](),this.setTag()},outputTypeIsDisabled:function(e){var t=this.$("#output-method-select option[value="+e+"]:not([style])").first();return!t||t.attr("disabled")==="disabled"},selectFirstEnabledOutputType:function(){var e=this.$("#output-method-select option"),n=t.reject(e,function(e){return e.disabled});n.length>0&&this.$("#output-method-select").val(n[0].value)},buildMeta:function(){var e=[];return{meta:this.getMetaType(),format:this.getMetaFormat(e),name:this.getMetaName(),exceptions:e}},getMetaType:function(){return this.$('[name="metadata-type"]:checked').data("value")},getMetaFormat:function(e){var t=this.$('[name="metadata-type"]:checked'),n=!!t.data("date"),r;if(n)return this.$('[name="meta-size-content-element"]').val(""),r=this.$('[name="meta-date-format-select"]').val(),e.push("format"),(r==="custom"?null:r)||this.$('[name="custom-meta-date-format"]').val()},getMetaName:function(){return this.$('[name="metadata-type"]:checked').data("hide-name")!==!0?this.$('[name="meta-size-content-element"] option:selected').text():""},buildContent:function(){var e=[],t=this.getStyles();return{name:this.getContentName(),output:this.getContentOutput(),"use-element":this.getUseElement(e),"filename-element":this.getFilenameElement(),modifiers:this.getModifiers(),info:this.getUserInfo(),"enable-dedit":this.getDisableDirectEdit(),"process-format":this.getProcessFormat(),format:this.getFormat(e),"format-modifiers":this.getFormatModifiers(),includeformatmodifiers:this.areFormatModifiersRequired(),date_format:this.getDateFormat(e),formatter:this.getMediaFormatter(e),exceptions:e,style:t.style,"max-width":t.maxWidth,"max-height":t.maxHeight,"client-resize":t.clientResize,alt:t.altText,"alt-element":t.altElement}},getContentName:function(){return this.$('[name="content-element-select"] option:selected').text()},getContentOutput:function(){return this.$('[name="output-method-select"]').val()},getUseElement:function(e){var t=this.$('[name="fulltext-use-element"]').prop("checked");return t?e.push("filename-element"):this.$('[name="friendly-url-element"]').val(""),t},getFilenameElement:function(){return this.$('[name="friendly-url-element"] option:selected').text()},getModifiers:function(){var e=[];return this.$(".modifiers input:checked").each(function(){e.push(n(this).data("value"))}),e.join(",")},getUserInfo:function(){var e=this.$('[name="output-method-select"] option:selected').val()==="userinfo";if(e)return this.$('[name="userinfo-output"]:checked').val()},getDisableDirectEdit:function(){return this.$('[name="disable-direct-edit"]').prop("checked")?"false":""},getProcessFormat:function(){return this.$('[name="process-selective-output-checkbox"]').prop("checked")?"true":""},htmlEscape:function(t){return String(t).replace(/"/g,"&quot;").replace(/'/g,"&#39;")},getFormat:function(e){var t=this.$('[name="output-method-select"] option:selected').val()==="selective-output";return t?e.push("format"):this.$('[name="process-selective-output-checkbox"]').prop("checked",!1),this.htmlEscape(n('[name="selective-output-markup"]').val())},getFormatModifiers:function(){return this.$('[name="format-modifiers-text"]').val()===""?"":this.$('[name="format-modifiers-text"]').val()},areFormatModifiersRequired:function(){return this.$('[name="enable-format-modifiers"]').is(":checked")},getDateFormat:function(e){var t=this.$('[name="content-element-select"] option:selected'),n=this.$('[name="date-format-select"]'),r=this.$('[name="custom-date-format"]'),i=t&&t.val()==="date",s;if(!i){n.val("");return}return e.push("date_format"),s=n.val(),s==="custom"?r.val():s},getMediaFormatter:function(e){var t=this.$('[name="content-element-select"] option:selected').val()==="media",n;if(t)return e.push("formatter"),n=this.$('[name="media-formatter-select"]').val(),(n==="custom"?null:n)||this.$('[name="custom-media-formatter"]').val();this.$('[name="media-formatter-select"]').val("")},getStyles:function(){var e=n("#custom-image-max-width").val()||"",t=n("#custom-image-max-height").val()||"";return{style:this.htmlEscape(n("#custom-image-style").val()),clientResize:!this.$("#custom-image-client-resize").is(":checked"),maxWidth:e.replace(/\D/g,""),maxHeight:t.replace(/\D/g,""),altText:this.htmlEscape(n("#custom-image-alt").val()),altElement:this.htmlEscape(n("#custom-image-alt-element").val())}},setTag:function(){this.previewView.setTag(this.tagType,this.tagAttributes)},hasPreview:function(){return this.previewView.hasSelection()}})}),define("hbars!module/common/tagBuilder/template/modal/navigation",["Handlebars"],function(e){return e.template({1:function(e,t,n,r,i,s){return'        <option value="'+this.escapeExpression(this.lambda(e,e))+'" '+this.escapeExpression((t.selected||e&&e.selected||t.helperMissing).call(e,e,s[1]!=null?s[1].filter:s[1],{name:"selected",hash:{},data:r}))+">"+this.escapeExpression((t.translateType||e&&e.translateType||t.helperMissing).call(e,e,{name:"translateType",hash:{},data:r}))+"</option>\n"},3:function(e,t,n,r){var i,s;return'        <optgroup label="'+this.escapeExpression((s=(s=t.key||r&&r.key)!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"key",hash:{},data:r}):s))+'">\n'+((i=t.each.call(e,e,{name:"each",hash:{},fn:this.program(4,r,0),inverse:this.noop,data:r}))!=null?i:"")+"        </optgroup>\n"},4:function(e,t,n,r){var i,s;return'          <option value="'+this.escapeExpression((s=(s=t.id||(e!=null?e.id:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"id",hash:{},data:r}):s))+'" data-id="'+this.escapeExpression((s=(s=t.id||(e!=null?e.id:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"id",hash:{},data:r}):s))+'" data-type="'+this.escapeExpression((s=(s=t.navigationType||(e!=null?e.navigationType:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"navigationType",hash:{},data:r}):s))+'" data-title="'+this.escapeExpression((t.translateType||e&&e.translateType||t.helperMissing).call(e,e!=null?e.navigationType:e,{name:"translateType",hash:{},data:r}))+'">'+((i=(s=(s=t.name||(e!=null?e.name:e))!=null?s:t.helperMissing,typeof s==="function"?s.call(e,{name:"name",hash:{},data:r}):s))!=null?i:"")+"</option>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r,i,s){var o;return'<h4 class="green lighter">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.navigation.title",{name:"t",hash:{},data:r}))+"</h4>\n<p>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.navigation.subTitle",{name:"t",hash:{},data:r}))+'</p>\n<hr />\n\n<form class="form-horizontal">\n  <div class="form-group">\n    <label class="col-sm-4 control-label">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.navigation.restrict",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-xs-12 col-sm-7">\n      <select name="navigation-filter" class="width-100">\n        <option></option>\n'+((o=t.each.call(e,e!=null?e.types:e,{name:"each",hash:{},fn:this.program(1,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+'      </select>\n    </div>\n  </div>\n  <div class="form-group">\n    <label class="col-sm-4 control-label">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.navigation.available",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-xs-12 col-sm-7">\n      <select name="navigation-object" class="width-100">\n        <option></option>\n'+((o=t.each.call(e,e!=null?e.collection:e,{name:"each",hash:{},fn:this.program(3,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+'      </select>\n    </div>\n  </div>\n</form>\n\n<div class="preview-container"></div>'},useData:!0,useDepths:!0})}),define("module/assets/navigation/model/navigation",["underscore","backbone","i18n"],function(e,t,n){var r=t.Model.extend({defaults:{isEnabled:!0,isPreviewModeEnabled:!0,isCachingEnabled:!1},validation:{name:{required:!0,msg:n.t("navigation:edit.name.validation")}},prefix:"navigation",urlRoot:t.SERVICE_BASE_URL+"/navigation",clearToDefaultValues:function(){this.clear(),this.attributes.isEnabled=!0,this.attributes.isPreviewModeEnabled=!0,this.attributes.isCachingEnabled=!1},getPrimaryGroupId:function(){return this.attributes.primaryGroup?this.attributes.primaryGroup.id:null},fetchForDuplication:function(){var e=this;this.fetch({success:function(){e.unset("id")}})},getProperty:function(e){if(!this.attributes.properties)return;var t=this.attributes.properties[e];return t?t.value:undefined},setProperty:function(e,t){this.attributes.properties||(this.attributes.properties=[]),this.attributes.properties[e]={navigationPropertyID:this.get("id"),attribute:e,value:t}}});return r}),define("module/assets/navigation/model/navigations",["require","underscore","backbone","module/assets/navigation/model/navigation","i18n"],function(e){var t=e("underscore"),n=e("backbone"),r=e("module/assets/navigation/model/navigation"),i=e("i18n");return n.Collection.extend({model:r,prefix:"navigation",url:n.SERVICE_BASE_URL+"/navigation",byGroup:function(e){var n=this.toJSON();return e&&(n=t.filter(n,function(t){return t.navigationType===e})),t.groupBy(n,function(e){return e.primaryGroup?e.primaryGroup.name:i.t("tagBuilder.navigation.global")})}})}),define("module/common/tagBuilder/view/modal/navigation",["require","backbone","jquery","hbars!module/common/tagBuilder/template/modal/navigation","module/assets/navigation/model/navigations","helper/makeup","Handlebars","i18n"],function(e){var t=e("backbone"),n=e("jquery"),r=e("hbars!module/common/tagBuilder/template/modal/navigation"),i=e("module/assets/navigation/model/navigations"),s=e("helper/makeup"),o=e("Handlebars"),u=e("i18n"),a=["a2z","breadcrumbs","cssselector","generatefile","keyword","languageswitcher","linkmenu","pagination","previousnextfulltext","publishonefile","relatedcontent","relatedsection","returntoindex","sectiondetails","sectioniterator","meta","sitemap","topcontent","topstories"];return t.View.extend({template:r,events:{'change [name="navigation-filter"]':"changeFilter",'change [name="navigation-object"]':"changeNavigationObject"},initialize:function(e){this.options=e||{},this.previewView=new e.previewConstructor,this.collection=new i,this.listenTo(this.collection,"sync:read",this.render),this.registerHandlebars(),this.fetch()},registerHandlebars:function(){o.registerHelper("translateType",function(e){return u.t("navigationTypes."+e)})},serialize:function(){return{collection:this.collection.byGroup(this.filter),filter:this.filter,types:a}},beforeRender:function(){this.insertView(".preview-container",this.previewView),this.$("select").each(function(){n(this).select2("destroy")})},afterRender:function(){this.$('select[name="navigation-filter"]').select2({allowClear:!0}),this.$('select[name="navigation-object"]').select2({formatResult:this.formatNavListing,formatSelection:this.formatNavListing,escapeMarkup:function(e){return e}})},formatNavListing:function(e){if(!e.id)return e.text;var t=e.element;return e.text+'<span class="badge badge-grey pull-right hidden-xs hidden-sm">'+n(t).data("title")+"</span>"},fetch:function(){this.collection.fetch()},changeFilter:function(e){var t=n(e.currentTarget);this.filter=t.val(),this.render(),this.previewView.reset(),this.previewView.render()},changeNavigationObject:function(e){var t=n(e.currentTarget),r=parseInt(t.val(),10),i;r&&(i=this.collection.get(r),i&&this.setTag(i))},setTag:function(e){this.previewView.setTag("navigation",{name:e.get("name"),id:e.id})},hasPreview:function(){return this.previewView.hasSelection()}})}),define("hbars!module/common/tagBuilder/template/modal/media",["Handlebars"],function(e){return e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){return'<h4 class="green lighter">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.media.title",{name:"t",hash:{},data:r}))+"</h4>\n<p>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.media.subTitle",{name:"t",hash:{},data:r}))+'</p>\n<hr />\n\n<form class="form-horizontal">\n  <div class="media-selector"></div>\n</form>\n\n<div class="preview-container"></div>'},useData:!0})}),define("module/common/media/model/media",["underscore","backbone"],function(e,t){return t.Model.extend({initialize:function(){this.listenTo(t,"error:413",this.requestEntityTooLarge)},url:function(){return t.SERVICE_BASE_URL+"/media/"+this.get("id")+"/"+this.get("language")},deleteUrl:function(){return t.SERVICE_BASE_URL+"/media/category/"+this.categoryID+"/id/"+this.get("id")+"/"+this.get("language")},createUrl:function(){return t.SERVICE_BASE_URL+"/media"},updateUrl:function(){var e=this.get("categories")||[];return t.SERVICE_BASE_URL+"/media/category/"+e[0]+"/"+this.get("language")+"/"+this.get("id")},create:function(e){var t=this.generateFormData(e);this.save(null,{type:"post",data:t,contentType:!1,processData:!1,url:this.createUrl()})},update:function(e){var t=this.generateFormData(e);this.save(null,{type:"post",data:t,contentType:!1,processData:!1,url:this.updateUrl()})},generateFormData:function(t){this.body=t;var n=new FormData;return e.each(t,function(e,t){n.append(t,e)}),n},getElements:function(t,n){var r=this.get("elements"),i=[],s,o,u,a,f;return e.each(r,function(e,t){s=t,o=t.replace(/#(\d*):(\d*)$/i,function(e,t,n){return u=Number(t),a=Number(n),""}),i.push({alias:o,name:o,id:u,type:a,value:e,originalKey:s})}),e.isUndefined(r)?f=this.merge(i,t,n):f=this.merge(i),f=e.filter(f,function(t){return!e.contains(["Name","Description","MediaType","Media","Thumbnail","ServerId","RemotePath","variant","variantname","syntax"],t.name)}),e.sortBy(f,function(e){return e.sequence})},merge:function(t,n,r){var i=this.get("contentType")||{},s=this.get("types")||[],o=i.contentTypeElements,u;if(!t||t.length===0)t.push(e.findWhere(n.get("contentTypeElements"),{name:"keywords"})),o=n.get("contentTypeElements"),s=r.toJSON(),i=n;return e.each(t,function(t){u=e.find(o,function(e){return t.id===e.id}),e.extend(t,u),t.identifier="content-"+i.id+"-"+t.id,t.type=e.find(s,function(e){return e.id===t.type})||{}}),t},parse:function(e){if(Number(e))return{id:e,binaryLanguage:this.body.binaryLanguage,language:this.body.language};if(e&&e.mediaPath){var t=/(<([^>]+)>)/ig,n=e.mediaPath.replace(t,""),r=n.split("&raquo;");e.mediaPath=r.map(Function.prototype.call,String.prototype.trim)}return e},requestEntityTooLarge:function(e){var n=e.response,r=n.responseJSON;t.trigger("media:save:validationError",{status:n.status,text:r.errorText,field:"file"})}})}),define("module/common/media/model/mediaFormats",["underscore","jquery","backbone"],function(e,t,n){return n.Collection.extend({url:function(){return n.SERVICE_BASE_URL+"/mediaformat"},singleUrl:function(e,t){return n.SERVICE_BASE_URL+"/mediaformat/"+e+"/"+t},getByMedia:function(e,t){return this.fetch({url:this.singleUrl(e,t)})}})}),define("hbars!module/common/media/template/selector",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){var i,s;return'<div class="form-group">\n  <label class="control-label col-sm-'+this.escapeExpression((s=(s=t.leftGrid||(e!=null?e.leftGrid:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"leftGrid",hash:{},data:r}):s))+'">'+this.escapeExpression((s=(s=t.labelName||(e!=null?e.labelName:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"labelName",hash:{},data:r}):s))+" "+((i=t["if"].call(e,e!=null?e.requiredSelection:e,{name:"if",hash:{},fn:this.program(2,r,0),inverse:this.noop,data:r}))!=null?i:"")+'</label>\n  <div class="col-xs-12 col-sm-'+this.escapeExpression((s=(s=t.rightGrid||(e!=null?e.rightGrid:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"rightGrid",hash:{},data:r}):s))+'" id="media-selector-controls">\n'},2:function(e,t,n,r){var i,s;return(i=(s=(s=t.required||(e!=null?e.required:e))!=null?s:t.helperMissing,typeof s==="function"?s.call(e,{name:"required",hash:{},data:r}):s))!=null?i:""},4:function(e,t,n,r){var i;return'    <div class="breadcrumbs media-select-item clearfix">\n      <div class="col-xs-3'+((i=(t.compare||e&&e.compare||t.helperMissing).call(e,(i=(i=r&&r.root)&&i.model)&&i.mediaURL,"&&",(i=(i=r&&r.root)&&i.model)&&i.thumbnailURL,{name:"compare",hash:{},fn:this.program(5,r,0),inverse:this.program(7,r,0),data:r}))!=null?i:"")+'">\n'+((i=(t.compare||e&&e.compare||t.helperMissing).call(e,(i=(i=r&&r.root)&&i.model)&&i.mediaURL,"&&",(i=(i=r&&r.root)&&i.model)&&i.thumbnailURL,{name:"compare",hash:{},fn:this.program(9,r,0),inverse:this.program(11,r,0),data:r}))!=null?i:"")+'      </div>\n      <div class="col-sm-9">\n        <h5>\n'+((i=t["if"].call(e,e!=null?e.parentMedia:e,{name:"if",hash:{},fn:this.program(13,r,0),inverse:this.program(15,r,0),data:r}))!=null?i:"")+"        </h5>\n        <p>"+this.escapeExpression(this.lambda((i=(i=r&&r.root)&&i.model)&&i.fileName,e))+" ("+this.escapeExpression((t.fileSize||e&&e.fileSize||t.helperMissing).call(e,(i=(i=r&&r.root)&&i.model)&&i.mediaSize,!0,{name:"fileSize",hash:{},data:r}))+')</p>\n        <ul class="breadcrumb">\n          <li><i class="fa fa-folder-open"></i></li>\n'+((i=t.each.call(e,(i=(i=r&&r.root)&&i.model)&&i.mediaPath,{name:"each",hash:{},fn:this.program(17,r,0),inverse:this.noop,data:r}))!=null?i:"")+"        </ul>\n      </div>\n    </div>\n"},5:function(e,t,n,r){return""},7:function(e,t,n,r){return" text-center"},9:function(e,t,n,r){var i;return'        <img alt="'+this.escapeExpression(this.lambda((i=(i=r&&r.root)&&i.model)&&i.description,e))+'" src="'+this.escapeExpression(this.lambda((i=(i=r&&r.root)&&i.model)&&i.thumbnailURL,e))+'" class="img-responsive">\n'},11:function(e,t,n,r){var i;return'        <i class="fa '+this.escapeExpression((t.mediaIcon||e&&e.mediaIcon||t.helperMissing).call(e,(i=e!=null?e.model:e)!=null?i.fileName:i,{name:"mediaIcon",hash:{},data:r}))+' fa-5x" style="margin-top: 5px;"></i>\n'},13:function(e,t,n,r){var i;return"              "+this.escapeExpression(this.lambda((i=(i=r&&r.root)&&i.parentMedia)&&i.name,e))+" - "+this.escapeExpression((t.decode||e&&e.decode||t.helperMissing).call(e,(i=(i=r&&r.root)&&i.model)&&i.name,{name:"decode",hash:{},data:r}))+"\n"},15:function(e,t,n,r){var i;return"              "+this.escapeExpression((t.decode||e&&e.decode||t.helperMissing).call(e,(i=(i=r&&r.root)&&i.model)&&i.name,{name:"decode",hash:{},data:r}))+"\n"},17:function(e,t,n,r){return"          <li>"+this.escapeExpression(this.lambda(e,e))+"</li>\n"},19:function(e,t,n,r){var i;return'    <div class="space-6"></div>\n    <select class="width-100 formatters">\n      <option value="" '+this.escapeExpression((t.selected||e&&e.selected||t.helperMissing).call(e,"",(i=r&&r.root)&&i.selectedFormatter,{name:"selected",hash:{},data:r}))+">&nbsp;"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:selector.defaultLayout",{name:"t",hash:{},data:r}))+"</option>\n"+((i=t.each.call(e,e!=null?e.mediaFormatters:e,{name:"each",hash:{},fn:this.program(20,r,0),inverse:this.noop,data:r}))!=null?i:"")+"    </select>\n"},20:function(e,t,n,r){var i,s;return'      <option value="'+this.escapeExpression((s=(s=t.mediaLayout||(e!=null?e.mediaLayout:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"mediaLayout",hash:{},data:r}):s))+'" '+this.escapeExpression((t.selected||e&&e.selected||t.helperMissing).call(e,e!=null?e.mediaLayout:e,(i=r&&r.root)&&i.selectedFormatter,{name:"selected",hash:{},data:r}))+">"+this.escapeExpression((s=(s=t.mediaLayout||(e!=null?e.mediaLayout:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"mediaLayout",hash:{},data:r}):s))+"</option>\n"},22:function(e,t,n,r){var i;return"      <div "+((i=t["if"].call(e,e!=null?e.hasSelection:e,{name:"if",hash:{},fn:this.program(23,r,0),inverse:this.noop,data:r}))!=null?i:"")+">\n      "+this.escapeExpression((t.button||e&&e.button||t.helperMissing).call(e,{name:"button",hash:{"class":"select-media",colourClass:"primary",icon:"image",text:"media:action.select"},data:r}))+"\n"+((i=t["if"].call(e,e!=null?e.hasSelection:e,{name:"if",hash:{},fn:this.program(25,r,0),inverse:this.noop,data:r}))!=null?i:"")+"    </div>\n"},23:function(e,t,n,r){return'style="margin-top: 20px;"'},25:function(e,t,n,r){var i;return"        "+this.escapeExpression((t.button||e&&e.button||t.helperMissing).call(e,{name:"button",hash:{"class":"clear-media",colourClass:"grey",icon:"times",text:"media:action.clear"},data:r}))+"\n"+((i=t["if"].call(e,e!=null?e.showDownloadButton:e,{name:"if",hash:{},fn:this.program(26,r,0),inverse:this.noop,data:r}))!=null?i:"")},26:function(e,t,n,r){return"          "+this.escapeExpression((t.button||e&&e.button||t.helperMissing).call(e,{name:"button",hash:{"class":"download-media",colourClass:"primary",icon:"download",text:"common:action.download"},data:r}))+"\n"},28:function(e,t,n,r){return"  </div>\n</div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i;return((i=t["if"].call(e,e!=null?e.formGroup:e,{name:"if",hash:{},fn:this.program(1,r,0),inverse:this.noop,data:r}))!=null?i:"")+((i=t["if"].call(e,e!=null?e.hasSelection:e,{name:"if",hash:{},fn:this.program(4,r,0),inverse:this.noop,data:r}))!=null?i:"")+((i=(t.compare||e&&e.compare||t.helperMissing).call(e,(i=e!=null?e.mediaFormatters:e)!=null?i.length:i,">",1,{name:"compare",hash:{},fn:this.program(19,r,0),inverse:this.noop,data:r}))!=null?i:"")+((i=t["if"].call(e,e!=null?e.showButtons:e,{name:"if",hash:{},fn:this.program(22,r,0),inverse:this.noop,data:r}))!=null?i:"")+((i=t["if"].call(e,e!=null?e.formGroup:e,{name:"if",hash:{},fn:this.program(28,r,0),inverse:this.noop,data:r}))!=null?i:"")},useData:!0})}),define("module/common/media/view/selector",["underscore","jquery","backbone","helper/language","module/common/media/model/media","module/common/media/model/mediaFormats","hbars!module/common/media/template/selector"],function(e,t,n,r,i,s,o){return n.View.extend({template:o,events:{"click .select-media":"openLibrary","click .clear-media":"clearMedia","change .formatters":"selectFormatterType","click .download-media":"notifyDownload"},initialize:function(t){this.options=t||{},this.tooltip=this.options.tooltip||"",this.showButtons=!!this.options.showButtons,this.model=new i,this.mediaFormats=new s,this.selectedFormatter="",this.options=e.extend({required:!1,formGroup:!1,labelName:"",errorMessage:"",leftGrid:"3",rightGrid:"4",tooltip:"",showButtons:!1,formatters:!1,formattersLabel:"",showDownloadButton:!1},t||{}),n.on("media:selected",this.selected.bind(this))},serialize:function(){var e=this.parentMedia?this.parentMedia.toJSON():!1;return{tooltip:this.options.tooltip,model:this.model.toJSON(),selectedFormatter:this.selectedFormatter,mediaFormatters:this.mediaFormats.toJSON(),hasSelection:this.hasSelection,parentMedia:e,showButtons:this.options.showButtons,labelName:this.options.labelName,requiredSelection:this.options.required,formGroup:this.options.formGroup,leftGrid:this.options.leftGrid,rightGrid:this.options.rightGrid,formatters:this.options.formatters,formattersLabel:this.options.formattersLabel,showDownloadButton:this.options.showDownloadButton}},afterRender:function(){this.loadToolTips()},openLibrary:function(e){e.preventDefault(),n.trigger("media:home",this)},selected:function(e,n,i,s){if(s&&this.cid===s.cid){var o=r.getCurrentLanguage(),u=this,a=[];this.model.clear(),this.model.set({id:e,language:o}),this.selectedFormatter=i,a.push(this.model.fetch()),a.push(this.mediaFormats.getByMedia(e,o)),t.when.apply(t,a).then(function(){u.fetched()})}},clearMedia:function(e){e.preventDefault(),this.clear()},clear:function(){this.reset(),this.fadeOutSelection()},fetched:function(){var e=this.model.get("variant");this.selectDefaultFormatter(),e?this.fetchParent(e):(this.hasSelection=!0,this.render()),n.trigger("media:selected:loaded")},selectDefaultFormatter:function(){if(!this.selectedFormatter){var t=e.find(this.mediaFormats.toJSON(),function(e){return e.isDefault});this.selectedFormatter=t?t.mediaLayout:""}},fetchParent:function(e){this.parentMedia=new i,this.parentMedia.set({id:e,language:r.getCurrentLanguage()}),this.parentMedia.once("sync:read",this.fetchedParent.bind(this)),this.parentMedia.fetch()},fetchedParent:function(){this.hasSelection=!0,this.render()},fadeOutSelection:function(){var e=this;e.hasSelection=!1,this.$(".breadcrumbs").slideUp(200,function(){e.$(".formatters").hide(),e.$(".clear-media").hide(),setTimeout(function(){e.render(),n.trigger("media:clear")},100)})},reset:function(){this.model.clear(),this.model.language=null,this.parentMedia=null,this.hasSelection=!1,this.mediaFormats=new s,this.selectedFormatter=null},validate:function(){var e={attribute:"id",id:"media-selector-controls"},t=this.isValid();return t?n.Validation.callbacks.valid(this,e.id,e.attribute):n.Validation.callbacks.invalid(this,e.id,this.options.errorMessage,e.attribute),t},isValid:function(){var e=!0;return this.options.required&&(e=this.hasSelection||!1),e},hasSelectedMedia:function(){return this.model&&this.model.id>0},selectMedia:function(e){if(!e||parseInt(e.id)<=0)return!1;this.selected(e.id,r.getCurrentLanguage(),"",this)},getSelectedMedia:function(){return e.extend({},this.model.toJSON(),{format:this.mediaFormats.toJSON()})},getMedia:function(){return this.getSelectedMedia()},selectFormatterType:function(e){this.selectedFormatter=e.currentTarget.value},notifyDownload:function(e){e.preventDefault(),window.open(this.model.get("mediaURL"),"download")}})}),define("module/common/tagBuilder/view/modal/media",["backbone","underscore","hbars!module/common/tagBuilder/template/modal/media","module/common/media/view/selector","i18n"],function(e,t,n,r,i){return e.View.extend({template:n,events:{"change select":"changeFormatter"},initialize:function(t){this.options=t||{},this.previewView=new t.previewConstructor,this.modal=t.parent,this.mediaSelector=new r({showButtons:!0,formGroup:!0,labelName:i.t("tagBuilder.media.selectedMedia"),formatters:!0,formattersLabel:i.t("tagBuilder.media.mediaFormat"),leftGrid:4,rightGrid:7}),e.on("media:home",this.onMediaOpen.bind(this)),e.on("media:clear",this.onMediaLoaded.bind(this))},serialize:function(){return{selectedImage:this.hasSelection}},beforeRender:function(){this.insertView(".preview-container",this.previewView),this.insertView(".media-selector",this.mediaSelector)},onMediaOpen:function(){this.modal.hide(),this.listenToOnce(e,"media:selected:loaded",this.onMediaLoaded)},onMediaLoaded:function(){var e=this.mediaSelector.getSelectedMedia(),n=this.mediaSelector.selectedFormatter;this.hasSelection=!t.isEmpty(e),this.modal.mode==="content"?this.modal.show(this.modal.contentType.id):this.modal.show(),this.render(),this.hasSelection?this.setTag(e,n):this.resetTag()},changeFormatter:function(e){var n=this.mediaSelector.getSelectedMedia(),r=this.mediaSelector.selectedFormatter;t.isEmpty(n)?this.resetTag():this.setTag(n,r)},resetTag:function(){this.previewView.reset(),this.previewView.render()},setTag:function(e,t){this.previewView.setTag("media",{formatter:t,id:e.id})},hasPreview:function(){return this.previewView.hasSelection()}})}),define("hbars!module/common/tagBuilder/template/modal/metaTags",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){var i;return'          <option value="'+this.escapeExpression((i=(i=t.id||(e!=null?e.id:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"id",hash:{},data:r}):i))+'">'+this.escapeExpression((i=(i=t.name||(e!=null?e.name:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"name",hash:{},data:r}):i))+"</option>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i;return'<h4 class="green lighter">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.metaTags.title",{name:"t",hash:{},data:r}))+"</h4>\n<p>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.metaTags.subTitle",{name:"t",hash:{},data:r}))+'</p>\n<hr />\n\n<form class="form-horizontal">\n  <div class="form-group">\n    <label class="col-sm-4 control-label">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.metaTags.availableTags",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-xs-12 col-sm-7">\n      <select class="width-100">\n        <option></option>\n        <optgroup label="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.metaTags.user",{name:"t",hash:{},data:r}))+'">\n'+((i=t.each.call(e,(i=e!=null?e.collection:e)!=null?i.user:i,{name:"each",hash:{},fn:this.program(1,r,0),inverse:this.noop,data:r}))!=null?i:"")+'        </optgroup>\n        <optgroup label="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.metaTags.system",{name:"t",hash:{},data:r}))+'">\n'+((i=t.each.call(e,(i=e!=null?e.collection:e)!=null?i.system:i,{name:"each",hash:{},fn:this.program(1,r,0),inverse:this.noop,data:r}))!=null?i:"")+'        </optgroup>\n      </select>\n    </div>\n  </div>\n</form>\n\n<div class="preview-container"></div>'},useData:!0})}),define("module/tools/meta/model/metaTags/metaTag",["require","backbone","i18n"],function(e){var t=e("backbone"),n=e("i18n");return t.Model.extend({urlRoot:t.SERVICE_BASE_URL+"/meta",validation:{name:{required:!0,msg:n.t("meta:metaConfig.validation.name")},format:{required:function(){return this.get("specialMapping")!==0},msg:n.t("meta:metaConfig.validation.format")},language:{required:function(){return this.get("setting")!==1},msg:n.t("meta:metaConfig.validation.language")}}})}),define("module/tools/meta/model/metaTags/metaTags",["require","backbone","./metaTag"],function(e){var t=e("backbone"),n=e("./metaTag"),r=["DC.abstract","DC.author","DC.contributor","DC.copyright","DC.date","DC.description","DC.format","DC.keywords","DC.language","DC.modified","DC.title"];return t.Collection.extend({model:n,url:t.SERVICE_BASE_URL+"/meta",setUrl:function(e){this.url=t.SERVICE_BASE_URL+"/meta/"+e},bySpecialMapping:function(){var e=this.filter(function(e){return e.get("specialMapping")!==0});return e},toComboFeed:function(){return this.map(function(e){return{id:e.get("id"),text:e.get("name")}})},updateAll:function(){var e=this,n={success:function(t,n,r){e.reset(t)}};return t.sync("update",this,n)},grouped:function(){return _.groupBy(this.toJSON(),function(e){var t="";return _.contains(r,e.name)?t="system":t="user",t})}})}),define("module/common/tagBuilder/view/modal/metaTags",["backbone","jquery","hbars!module/common/tagBuilder/template/modal/metaTags","module/tools/meta/model/metaTags/metaTags"],function(e,t,n,r){return e.View.extend({template:n,events:{"change select":"selectMetaTag"},initialize:function(e){this.options=e||{},this.previewView=new e.previewConstructor,this.collection=new r,this.listenTo(this.collection,"sync:read",this.render),this.fetch()},serialize:function(){return{collection:this.collection.grouped()}},beforeRender:function(){this.insertView(".preview-container",this.previewView),this.$("select").each(function(){t(this).select2("destroy")})},afterRender:function(){this.$("select").select2()},fetch:function(){this.collection.setUrl("level"),this.collection.fetch()},selectMetaTag:function(e){var n=t(e.currentTarget),r=n.val(),i;r&&(i=this.collection.get(r),i&&this.setTag(i))},setTag:function(e){this.previewView.setTag("meta",{id:e.id})},hasPreview:function(){return this.previewView.hasSelection()}})}),define("hbars!module/common/tagBuilder/template/modal/channel",["Handlebars"],function(e){return e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){return'<h4 class="green lighter">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.channel.title",{name:"t",hash:{},data:r}))+"</h4>\n<p>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.channel.subTitle",{name:"t",hash:{},data:r}))+'</p>\n<hr />\n\n<form class="form-horizontal">\n  <div class="form-group">\n    <label class="col-sm-4 control-label">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.channel.availableChannelInfo",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-xs-12 col-sm-7">\n      <select class="width-100">\n        <option></option>\n        <option value="site-root">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.channel.channelInfo.siteRoot",{name:"t",hash:{},data:r}))+'</option>\n        <option value="description">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.channel.channelInfo.description",{name:"t",hash:{},data:r}))+'</option>\n        <option value="fav-icon">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.channel.channelInfo.favIcon",{name:"t",hash:{},data:r}))+'</option>\n        <option value="id">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.channel.channelInfo.id",{name:"t",hash:{},data:r}))+'</option>\n        <option value="name">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.channel.channelInfo.name",{name:"t",hash:{},data:r}))+'</option>\n      </select>\n    </div>\n  </div>\n</form>\n\n<div class="preview-container"></div>'},useData:!0})}),define("module/common/tagBuilder/view/modal/channel",["backbone","jquery","hbars!module/common/tagBuilder/template/modal/channel"],function(e,t,n){return e.View.extend({template:n,events:{"change select":"selectChannelInfo"},initialize:function(e){this.options=e||{},this.previewView=new e.previewConstructor},serialize:function(){return{}},beforeRender:function(){this.insertView(".preview-container",this.previewView),this.$("select").each(function(){t(this).select2("destroy")})},afterRender:function(){this.$("select").select2()},selectChannelInfo:function(e){var n=t(e.currentTarget),r=n.val();r&&this.setTag(r)},setTag:function(e){this.previewView.setTag("channel",{output:e})},hasPreview:function(){return this.previewView.hasSelection()}})}),define("hbars!module/common/tagBuilder/template/modal/misc",["Handlebars"],function(e){return e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){return'<h4 class="green lighter">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.miscTags.title",{name:"t",hash:{},data:r}))+"</h4>\n<p>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.miscTags.subTitle",{name:"t",hash:{},data:r}))+"</p>\n<ul>\n  <li>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.miscTags.options.t4Title",{name:"t",hash:{},data:r}))+"</li>\n  <li>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.miscTags.options.t4TitleIndex",{name:"t",hash:{},data:r}))+"</li>\n  <li>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.miscTags.options.t4Edit",{name:"t",hash:{},data:r}))+'</li>\n\n</ul>\n<hr />\n\n<form class="form-horizontal">\n  <div class="form-group">\n    <label class="col-sm-4 control-label">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.miscTags.availableTags",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-xs-12 col-sm-7">\n      <select class="width-100">\n        <option></option>\n        <option value="title" id="title">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.miscTags.pageInfo.title",{name:"t",hash:{},data:r}))+'</option>\n        <option value="title-on-index" id="title-on-index">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.miscTags.pageInfo.titleIndex",{name:"t",hash:{},data:r}))+'</option>\n        <option value="edit-page" id="edit-page">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.miscTags.pageInfo.editPage",{name:"t",hash:{},data:r}))+'</option>\n      </select>\n   </div>\n   <div class="space-20"></div>\n   <div id="direct-edit-text">\n     <label for="direct-edit-text" class="col-sm-4 control-label">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.miscTags.pageInfo.directEditText",{name:"t",hash:{},data:r}))+'</label>\n     <div class="col-xs-12 col-sm-7">\n        <input type="text" name="direct-edit-text" id="direct-edit-text" class="width-100"></input>\n     </div>\n    </div>\n  </div>\n\n</form>\n<div class="preview-container"></div>'},useData:!0})}),define("module/common/tagBuilder/view/modal/misc",["backbone","jquery","hbars!module/common/tagBuilder/template/modal/misc"],function(e,t,n){return e.View.extend({template:n,events:{"change select":"selectPageInfo",'keyup [name="direct-edit-text"]':"setDirectEditText"},initialize:function(e){this.options=e||{},this.directEditText,this.previewView=new e.previewConstructor},serialize:function(){return{}},beforeRender:function(){this.insertView(".preview-container",this.previewView),this.$("select").each(function(){t(this).select2("destroy")})},afterRender:function(){this.$("select").select2(),this.$("#direct-edit-text").hide()},selectPageInfo:function(e){var n=t(e.currentTarget),r=n.val();r&&this.setTag(r)},setTag:function(e){e==="edit-page"?(this.$("#direct-edit-text").show(),this.previewView.setTag(e,{action:"direct-edit",text:this.getDirectEditText()})):(this.$("#direct-edit-text").hide(),this.previewView.setTag(e,{}))},setDirectEditText:function(){this.directEditText=this.$("#direct-edit-text input").val(),this.setTag("edit-page")},getDirectEditText:function(){return this.directEditText},hasPreview:function(){return this.previewView.hasSelection()}})}),define("hbars!module/common/tagBuilder/template/preview",["Handlebars"],function(e){return e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i;return'<hr />\n<h4 class="green lighter">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"tagBuilder.action.preview",{name:"t",hash:{},data:r}))+'</h4>\n<pre class="text-center">\n  <code class="preview">'+this.escapeExpression((i=(i=t.preview||(e!=null?e.preview:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"preview",hash:{},data:r}):i))+"</code>\n</pre>"},useData:!0})}),define("module/common/tagBuilder/view/preview",["backbone","underscore","hbars!module/common/tagBuilder/template/preview"],function(e,t,n){return e.View.extend({template:n,initialize:function(){this.preview=""},serialize:function(){return{preview:this.preview}},setTag:function(t,n){var r=this.stringify(n);this.preview='<t4 type="'+t+'" '+r+"/>",this.render(),e.trigger("preview:setTag")},stringify:function(e){var n="",r=e.exceptions||[];return t.each(e,function(e,i,s){i==="format-modifiers"&&e===""?s.includeformatmodifiers===!0&&(n+=i+'="'+e+'" '):i==="output"?n+=this.appendDisplayField(e):i==="client-resize"?e||(n+=i+'="'+e+'" '):(e||t.contains(r,i))&&i!=="exceptions"&&i!=="includeformatmodifiers"&&i!=="output"&&(n+=i+'="'+e+'" ')},this),n},appendDisplayField:function(e){return e==="name"?'output="normal" display_field="name" ':e==="value"?'output="normal" display_field="value" ':'output="'+e+'" '},selectText:function(){var e=this.$(".preview").get(0),t,n;document.body.createTextRange?(t=document.body.createTextRange(),t.moveToElementText(e),t.select()):window.getSelection&&(n=window.getSelection(),t=document.createRange(),t.selectNodeContents(e),n.removeAllRanges(),n.addRange(t))},reset:function(){this.preview="",e.trigger("preview:setTag")},hasSelection:function(){return!!this.preview}})}),define("module/assets/contenttype/model/contenttype",["backbone","i18n","module/common/validation/validation"],function(e,t,n){return e.Model.extend({initialize:function(){this.validationModel=new n({model:"contenttype"})},isReadonly:function(){return!this.get("editable")},fetchForDuplication:function(){var e=this;return this.fetch({success:function(){e.set({name:e.get("alias")}),e.set({duplicate:!0}),e.set({duplicatedFromId:e.get("id")}),e.unset("alias"),e.unset("id")}})},getPrimaryGroupId:function(){var e=this.get("primaryGroup");return e?e.id:null},resetToDefaults:function(){this.clear(),this.addElement({name:"Name",description:"The Name element",maxSize:80,compulsory:!0,type:1,id:1,disabledElement:!0,alias:"Name"})},addElement:function(e){var t=this.get("contentTypeElements")||[];t.push({id:e.id||"",name:e.name||"",description:e.description||"",maxSize:e.maxSize||"",compulsory:e.compulsory||!1,type:e.type||"",listId:e.listId||"",alias:e.alias||""}),this.set("contentTypeElements",t)},getElements:function(){return(this.attributes||{}).contentTypeElements||[]},urlRoot:e.SERVICE_BASE_URL+"/contenttype"})}),define("module/assets/contenttype/model/type",["underscore","backbone"],function(e,t){var n=t.Model.extend({defaults:{id:"",name:""},urlRoot:t.SERVICE_BASE_URL+"/type"});return n}),function(e){if(typeof exports=="object"&&typeof module!="undefined")module.exports=e();else if(typeof define=="function"&&define.amd)define("clipboard",[],e);else{var t;typeof window!="undefined"?t=window:typeof global!="undefined"?t=global:typeof self!="undefined"?t=self:t=this,t.Clipboard=e()}}(function(){var e,t,n;return function r(e,t,n){function i(o,u){if(!t[o]){if(!e[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=t[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return i(n?n:t)},l,l.exports,r,e,t,n)}return t[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){var r=e("matches-selector");t.exports=function(e,t,n){var i=n?e:e.parentNode;while(i&&i!==document){if(r(i,t))return i;i=i.parentNode}}},{"matches-selector":2}],2:[function(e,t,n){function s(e,t){if(i)return i.call(e,t);var n=e.parentNode.querySelectorAll(t);for(var r=0;r<n.length;++r)if(n[r]==e)return!0;return!1}var r=Element.prototype,i=r.matchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector||r.msMatchesSelector||r.oMatchesSelector;t.exports=s},{}],3:[function(e,t,n){function i(e,t,n,r){var i=s.apply(this,arguments);return e.addEventListener(n,i),{destroy:function(){e.removeEventListener(n,i)}}}function s(e,t,n,i){return function(n){n.delegateTarget=r(n.target,t,!0),n.delegateTarget&&i.call(e,n)}}var r=e("closest");t.exports=i},{closest:1}],4:[function(e,t,n){n.node=function(e){return e!==undefined&&e instanceof HTMLElement&&e.nodeType===1},n.nodeList=function(e){var t=Object.prototype.toString.call(e);return e!==undefined&&(t==="[object NodeList]"||t==="[object HTMLCollection]")&&"length"in e&&(e.length===0||n.node(e[0]))},n.string=function(e){return typeof e=="string"||e instanceof String},n.function=function(e){var t=Object.prototype.toString.call(e);return t==="[object Function]"}},{}],5:[function(e,t,n){function s(e,t,n){if(!e&&!t&&!n)throw new Error("Missing required arguments");if(!r.string(t))throw new TypeError("Second argument must be a String");if(!r.function(n))throw new TypeError("Third argument must be a Function");if(r.node(e))return o(e,t,n);if(r.nodeList(e))return u(e,t,n);if(r.string(e))return a(e,t,n);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function o(e,t,n){return e.addEventListener(t,n),{destroy:function(){e.removeEventListener(t,n)}}}function u(e,t,n){return Array.prototype.forEach.call(e,function(e){e.addEventListener(t,n)}),{destroy:function(){Array.prototype.forEach.call(e,function(e){e.removeEventListener(t,n)})}}}function a(e,t,n){return i(document.body,e,t,n)}var r=e("./is"),i=e("delegate");t.exports=s},{"./is":4,delegate:3}],6:[function(e,t,n){function r(e){var t;if(e.nodeName==="INPUT"||e.nodeName==="TEXTAREA")e.focus(),e.setSelectionRange(0,e.value.length),t=e.value;else{e.hasAttribute("contenteditable")&&e.focus();var n=window.getSelection(),r=document.createRange();r.selectNodeContents(e),n.removeAllRanges(),n.addRange(r),t=n.toString()}return t}t.exports=r},{}],7:[function(e,t,n){function r(){}r.prototype={on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){function i(){r.off(e,i),t.apply(n,arguments)}var r=this;return i._=t,this.on(e,i,n)},emit:function(e){var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,i=n.length;for(r;r<i;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],i=[];if(r&&t)for(var s=0,o=r.length;s<o;s++)r[s].fn!==t&&r[s].fn._!==t&&i.push(r[s]);return i.length?n[e]=i:delete n[e],this}},t.exports=r},{}],8:[function(e,t,n){function i(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.__esModule=!0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("select"),u=i(o),a=function(){function e(t){s(this,e),this.resolveOptions(t),this.initSelection()}return e.prototype.resolveOptions=function(){var t=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];this.action=t.action,this.emitter=t.emitter,this.target=t.target,this.text=t.text,this.trigger=t.trigger,this.selectedText=""},e.prototype.initSelection=function(){if(this.text&&this.target)throw new Error('Multiple attributes declared, use either "target" or "text"');if(this.text)this.selectFake();else{if(!this.target)throw new Error('Missing required attributes, use either "target" or "text"');this.selectTarget()}},e.prototype.selectFake=function(){var t=this;this.removeFake(),this.fakeHandler=document.body.addEventListener("click",function(){return t.removeFake()}),this.fakeElem=document.createElement("textarea"),this.fakeElem.style.position="absolute",this.fakeElem.style.left="-9999px",this.fakeElem.style.top=(window.pageYOffset||document.documentElement.scrollTop)+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,document.body.appendChild(this.fakeElem),this.selectedText=u["default"](this.fakeElem),this.copyText()},e.prototype.removeFake=function(){this.fakeHandler&&(document.body.removeEventListener("click"),this.fakeHandler=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)},e.prototype.selectTarget=function(){this.selectedText=u["default"](this.target),this.copyText()},e.prototype.copyText=function(){var t=undefined;try{t=document.execCommand(this.action)}catch(n){t=!1}this.handleResult(t)},e.prototype.handleResult=function(t){t?this.emitter.emit("success",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)}):this.emitter.emit("error",{action:this.action,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})},e.prototype.clearSelection=function(){this.target&&this.target.blur(),window.getSelection().removeAllRanges()},e.prototype.destroy=function(){this.removeFake()},r(e,[{key:"action",set:function(){var t=arguments.length<=0||arguments[0]===undefined?"copy":arguments[0];this._action=t;if(this._action!=="copy"&&this._action!=="cut")throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(t){if(t!==undefined){if(!t||typeof t!="object"||t.nodeType!==1)throw new Error('Invalid "target" value, use a valid Element');this._target=t}},get:function(){return this._target}}]),e}();n["default"]=a,t.exports=n["default"]},{select:6}],9:[function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function p(e,t){var n="data-clipboard-"+e;if(!t.hasAttribute(n))return;return t.getAttribute(n)}n.__esModule=!0;var o=e("./clipboard-action"),u=r(o),a=e("tiny-emitter"),f=r(a),l=e("good-listener"),c=r(l),h=function(e){function t(n,r){i(this,t),e.call(this),this.resolveOptions(r),this.listenClick(n)}return s(t,e),t.prototype.resolveOptions=function(){var t=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];this.action=typeof t.action=="function"?t.action:this.defaultAction,this.target=typeof t.target=="function"?t.target:this.defaultTarget,this.text=typeof t.text=="function"?t.text:this.defaultText},t.prototype.listenClick=function(t){var n=this;this.listener=c["default"](t,"click",function(e){return n.onClick(e)})},t.prototype.onClick=function(t){var n=t.delegateTarget||t.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new u["default"]({action:this.action(n),target:this.target(n),text:this.text(n),trigger:n,emitter:this})},t.prototype.defaultAction=function(t){return p("action",t)},t.prototype.defaultTarget=function(t){var n=p("target",t);if(n)return document.querySelector(n)},t.prototype.defaultText=function(t){return p("text",t)},t.prototype.destroy=function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)},t}(f["default"]);n["default"]=h,t.exports=n["default"]},{"./clipboard-action":8,"good-listener":5,"tiny-emitter":7}]},{},[9])(9)}),define("module/common/tagBuilder/view/modal",["require","backbone","jquery","hbars!module/common/tagBuilder/template/modal","module/common/tagBuilder/view/modal/content","module/common/tagBuilder/view/modal/navigation","module/common/tagBuilder/view/modal/media","module/common/tagBuilder/view/modal/metaTags","module/common/tagBuilder/view/modal/channel","module/common/tagBuilder/view/modal/misc","module/common/tagBuilder/view/preview","module/assets/contenttype/model/contenttype","module/assets/contenttype/model/type","module/common/media/model/mediaFormats","clipboard","i18n"],function(e){var t=e("backbone"),n=e("jquery"),r=e("hbars!module/common/tagBuilder/template/modal"),i=e("module/common/tagBuilder/view/modal/content"),s=e("module/common/tagBuilder/view/modal/navigation"),o=e("module/common/tagBuilder/view/modal/media"),u=e("module/common/tagBuilder/view/modal/metaTags"),a=e("module/common/tagBuilder/view/modal/channel"),f=e("module/common/tagBuilder/view/modal/misc"),l=e("module/common/tagBuilder/view/preview"),c=e("module/assets/contenttype/model/contenttype"),h=e("module/assets/contenttype/model/type"),p=e("module/common/media/model/mediaFormats"),d=e("clipboard"),v=e("i18n");return t.View.extend({template:r,events:{"click .cancel":"cancel",'shown.bs.tab a[data-toggle="tab"]':"checkCopyButton","click #select-button":"selectText"},initialize:function(e){this.options=e||{},this.mode=this.options.mode||"content",this.contentType=new c,this.elementTypes=new h,this.mediaFormats=new p,t.on("builder:open",this.show.bind(this)),t.on("builder:close",this.hide.bind(this)),t.on("builder:copied",this.hide.bind(this)),t.on("preview:setTag",this.checkCopyButton.bind(this)),this.contentType.on("sync:read",this.notifyContentTypes.bind(this)),this.elementTypes.on("sync:read",this.notifyElementTypes.bind(this)),this.mediaFormats.on("sync:read",this.notifyMediaFormats.bind(this)),this.elementTypes.fetch(),this.mediaFormats.fetch(),this.initializeViews()},initializeViews:function(){var e={previewConstructor:l,parent:this};this.contentView=new i(e),this.navigationView=new s(e),this.mediaView=new o(e),this.metaTagsView=new u(e),this.channelView=new a(e),this.miscView=new f(e)},serialize:function(){return{tabs:this.getTabStates(),mode:this.mode}},notifyContentTypes:function(){this.contentView.setContentElements(this.contentType.getElements())},notifyElementTypes:function(){this.contentView.setElementTypes(this.elementTypes.toJSON())},notifyMediaFormats:function(){this.contentView.setMediaFormats(this.mediaFormats.toJSON())},activeView:function(){var e=this.$(".tabbable > .nav.nav-tabs > li.active"),t=e.data("name")+"View";return this[t]},enhanceCopyButton:function(){var e=this,r=new d("#copy-button");r.on("success",function(e){n(e.trigger).tooltip("show"),e.clearSelection(),t.trigger("builder:copied",{common:!0})}),r.on("error",function(e){e.trigger.setAttribute("title",v.t("common:tagBuilder.action.notCopied")),n(e.trigger).tooltip("show"),n(e.trigger).on("hidden.bs.tooltip",function(e){n(this).tooltip("destroy")})})},getTabStates:function(){return{content:{content:!0,navigation:!0,media:!0,metaTags:!1,channel:!1},pageLayout:{content:!1,navigation:!0,media:!0,metaTags:!0,channel:!0}}[this.mode||"content"]},cancel:function(){this.hide()},checkCopyButton:function(){var e=this.activeView(),t;e&&(t=e.hasPreview(),this.$("#copy-button").prop("disabled",!t))},selectText:function(){var e=this.activeView(),t;e&&(t=e.hasPreview(),t&&e.previewView.selectText())},show:function(e){var t=e?"content":"pageLayout";t&&t!==this.mode&&(this.mode=t,this.render()),e&&(this.contentType.id=e,this.contentType.fetch()),this.$modal.modal("show")},hide:function(){this.$modal.modal("hide")},beforeRender:function(){this.insertView("#tag-content",this.contentView),this.insertView("#tag-navigation",this.navigationView),this.insertView("#tag-media",this.mediaView),this.insertView("#tag-meta-tags",this.metaTagsView),this.insertView("#tag-channel",this.channelView),this.insertView("#tag-misc",this.miscView)},afterRender:function(){this.$modal=this.$(".modal"),n("[title]").tooltip(),this.enhanceCopyButton()}})}),define("hbars!module/common/media/template/modal",["Handlebars"],function(e){return e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){return'<div class="modal">\n  <div class="modal-dialog modal-xl">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal">\n          <span aria-hidden="true">Ã</span>\n          <span class="sr-only">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:action.close",{name:"t",hash:{},data:r}))+'</span>\n        </button>\n        <h4 class="modal-title">\n          <i class="fa fa-external-link-square"></i>\n          <span>'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:action.select",{name:"t",hash:{},data:r}))+'</span>\n        </h4>\n      </div>\n      <div class="modal-body">\n        <div class="media-list"></div>\n        <div class="media-edit"></div>\n        <div class="variants-list"></div>\n        <div class="search-list"></div>\n      </div>\n      <div class="modal-footer">\n      </div>\n    </div>\n  </div>\n</div>'},useData:!0})}),define("hbars!module/common/media/template/modal/homeFooter",["Handlebars"],function(e){return e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){return'<button type="button" class="btn btn-default cancel-close"><i class="fa fa-undo"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.cancel",{name:"t",hash:{},data:r}))+"</button>"},useData:!0})}),define("hbars!module/common/media/template/modal/editFooter",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){return"cancel"},3:function(e,t,n,r){return"cancel-close"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i;return'<button type="button" class="btn btn-default '+((i=t.unless.call(e,e!=null?e.onlyEdit:e,{name:"unless",hash:{},fn:this.program(1,r,0),inverse:this.program(3,r,0),data:r}))!=null?i:"")+'"><i class="fa fa-undo"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.cancel",{name:"t",hash:{},data:r}))+'</button>\n<div class="btn-group dropup">\n  <button class="btn btn-primary save" style="border-width: 5px;">\n    <i class="fa fa-save"></i>\n    '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.save",{name:"t",hash:{},data:r}))+"\n  </button>\n</div>\n"},useData:!0})}),define("hbars!module/common/media/template/modal/variantsFooter",["Handlebars"],function(e){return e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){return'<button type="button" class="btn btn-default cancel"><i class="fa fa-undo"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.cancel",{name:"t",hash:{},data:r}))+"</button>"},useData:!0})}),define("hbars!module/common/media/template/modal/variantsEditFooter",["Handlebars"],function(e){return e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){return'<button type="button" class="btn btn-default cancel-variant"><i class="fa fa-undo"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.cancel",{name:"t",hash:{},data:r}))+'</button>\n<div class="btn-group dropup">\n  <button class="btn btn-primary save-variant" style="border-width: 5px;">\n    <i class="fa fa-save"></i>\n    '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.save",{name:"t",hash:{},data:r}))+"\n  </button>\n</div>"},useData:!0})}),define("hbars!module/common/media/template/modal/searchFooter",["Handlebars"],function(e){return e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){return'<div class="text-left">\n  <button type="button" class="btn btn-default cancel-search"><i class="fa fa-arrow-left"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.back",{name:"t",hash:{},data:r}))+"</button>\n</div>"},useData:!0})}),define("helper/media",["backbone","module/content/section/model/section","module/tools/config/model/configurationOption","module/common/config/model/config"],function(e,t,n,r){var i={mediaPathlanguage:"en",mediaRootID:2,mediaCategorisedID:3,mediaCategorisedName:"Categorised",mediaMinAccessToAutoPublish:1};return{getAsyncRootCategory:function(){return this.categorisedSection?$.Deferred().resolve(this.categorisedSection):(this.fetchDebouncedRootCategory=this.fetchDebouncedRootCategory||_.debounce(this.fetchRootCategory,300,!0),this.fetchDebouncedRootCategory())},fetchAsyncMediaPathLanguage:function(){if(this.mediaPathLanguage)return $.Deferred().resolve(this.mediaPathLanguage);var e=new n,t=$.Deferred();return e.set({name:"mediaLibrary.pathLanguage"}),e.fetch().done(function(){this.mediaPathLanguage=e.get("value"),t.resolve(this.mediaPathLanguage)}.bind(this)),t},fetchRootCategory:function(){var r,s,o=i.mediaCategorisedName,u=new n,a=new t,f=$.Deferred();return u.set({name:"mediaLibrary.section"}),$.when(this.fetchAsyncMediaPathLanguage(),u.fetch()).then(function(){r=this.mediaPathLanguage,s=u.get("value"),a.fetch({url:e.SERVICE_BASE_URL+"/hierarchy/child/"+s+"/"+o+"/"+r}).then(function(){this.categorisedSection=a.id,f.resolve(a.id)}.bind(this))}.bind(this)),f},getMinUserLevelsForMedia:function(){var t=$.Deferred(),n=new r;return n.key="role.media.",n.fetch().done(function(){this.minUserLevels=new e.Collection(_.toArray(n.toJSON().options)),t.resolve(this.minUserLevels)}.bind(this)),t}}}),define("module/common/media/model/categories",["underscore","backbone","i18n","helper/media"],function(e,t,n,r){return t.Model.extend({url:t.SERVICE_BASE_URL+"/mediacategory",initialize:function(e){this.options=e||{},this.startNode=this.options.startNode,this.startNode||this.getRootCategoryId()},getRootCategoryId:function(){return r.getAsyncRootCategory().done(function(e){this.startNode=e}.bind(this))},promiseAccessLevel:function(){var e=$.Deferred();return this.get("0")&&this.get("0").accessLevel?e.resolve(this.get("0").accessLevel):this.once("sync:create",function(){e.resolve(this.get("0").accessLevel)},this),e},getUrl:function(){return this.url+"/"+this.id+"/"+this.language},editUrl:function(){return this.url+"/"+this.id+"/"+this.language},createUrl:function(){return this.url+"/"+this.language},deleteUrl:function(){return this.url+"/"+this.id},moveUrl:function(e,t){return this.url+"/"+e+"/"+t+"/"+this.language},flatten:function(){function s(n,r){var i=n.children||[];e.each(i,function(n){t.push(e.extend(n,{level:r})),s(n,r+1)})}var t=[],n=1,r=this.get(0)||{},i=r.children;return t.push(r),e.each(i,function(r){t.push(e.extend(r,{level:n})),s(r,n+1)}),t},toTreeData:function(){var t=[];return e.each(this.get("children"),function(e){var n=e.hasChildren?"folder":"item";t.push({name:e.name,type:n,additionalParameters:{id:e.id},dataAttributes:{"data-id":e.id,"data-icon":"fa fa-folder section-icon",sectionType:"Category"}})}),t},getNameByID:function(t){var n=e.find(this.flatten()||[],function(e){return e.id===t})||{};return n.name},getByID:function(t){return e.find(this.flatten()||[],function(e){return e.id===parseInt(t,10)})},getParentByID:function(t){var n=this.get(0),r=-1,i=function(n){e.each(n.children||[],function(e){if(e.id===t){r=n.id;return}i(e)})};return i(n),r},fetchTree:function(t){this.startNode?(this.lazyFetchTree=this.lazyFetchTree||e.debounce(this._fetchTree,300),this.lazyFetchTree(t)):this.getRootCategoryId().then(function(){this._fetchTree(t)}.bind(this))},_fetchTree:function(e){return this.save({category:{id:this.startNode,language:e},recursionDepth:0,explode:!1,activeNode:-1,showInactive:!1,showMyMedia:!1},{type:"post"})},fetchAll:function(e){this.startNode?this._fetchAll(e):this.getRootCategoryId().then(function(){this._fetchAll(e)}.bind(this))},_fetchAll:function(e){this.save({category:{id:this.startNode,language:e},recursionDepth:-1,activeNode:-1,explode:!1,showInactive:!1,showMyMedia:!1},{type:"post"})},fetchNodes:function(e,t){this.activeNode=e,this.save({category:{id:this.startNode,language:t},recursionDepth:0,explode:!1,activeNode:this.activeNode,showInactive:!1,showMyMedia:!1},{type:"post"})},getCategory:function(e,t){this.id=e,this.language=t,this.fetch({url:this.getUrl()})},editCategory:function(e,t,n){return this.id=e,this.language=t,this.save(n,{url:this.editUrl(),type:"put"})},createCategory:function(t){var n={description:"",archive:!1,status:"0",show:!1,eForm:!1,"output-uri":""};this.save(e.extend(n,t),{type:"post",url:this.createUrl()})},deleteCategory:function(){this.save({},{type:"delete",url:this.deleteUrl()})},moveCategory:function(e,t){this.save({},{type:"move",url:this.moveUrl(e,t)})},parse:function(t){return e.isArray(t)&&t[0]&&t[0].icon&&(this.changeIcons(t[0]),this.removeInactiveCategories(t[0])),t},changeIcons:function(t){t.icon="fa-folder";if(t.children&&t.children.length){var n=this;e.each(t.children,function(e){n.changeIcons(e)})}},removeInactiveCategories:function(t){t.icon="fa-folder";if(t.children&&t.children.length){var n=this,r=[];e.each(t.children,function(e){e.status===0&&(r.push(e),n.removeInactiveCategories(e))}),t.children=r,t.hasChildren=!!r.length}}})}),define("hbars!module/common/category/tree/template/actions",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){var i;return(i=t["if"].call(e,e!=null?e.hasAccess:e,{name:"if",hash:{},fn:this.program(2,r,0),inverse:this.noop,data:r}))!=null?i:""},2:function(e,t,n,r){return'    <div class="btn-group text-left actions">\n      <button data-toggle="dropdown" class="btn btn-info btn-xs dropdown-toggle" data-position="auto"><i class="fa fa-cog"></i> <span class="ace-icon fa fa-caret-down icon-on-right"></span></button>\n      <ul class="dropdown-menu dropdown-menu-right dropdown-caret pull-right text-left">\n        <li><a href="#" class="edit-category"><i class="fa fa-edit"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:action.editCategory",{name:"t",hash:{},data:r}))+'</a></li>\n        <li><a href="#" class="add-sub"><i class="fa fa-level-down"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:action.addCategory",{name:"t",hash:{},data:r}))+'</a></li>\n        <li class="divider"></li>\n        <li><a href="#" class="delete-section"><i class="fa fa-trash-o"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:action.eraseCategory",{name:"t",hash:{},data:r}))+"</a></li>\n      </ul>\n    </div>\n"},4:function(e,t,n,r){var i;return(i=t["if"].call(e,e!=null?e.hasAccess:e,{name:"if",hash:{},fn:this.program(5,r,0),inverse:this.noop,data:r}))!=null?i:""},5:function(e,t,n,r){return'    <label>\n      <input type="checkbox" class="ace">\n      <span class="lbl"></span>\n    </label>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i;return'<div class="pull-right">\n  <div class="tree-folder-actions text-right">\n'+((i=t["if"].call(e,(i=(i=r&&r.root)&&i.params)&&i.showActions,{name:"if",hash:{},fn:this.program(1,r,0),inverse:this.noop,data:r}))!=null?i:"")+((i=t["if"].call(e,(i=(i=r&&r.root)&&i.params)&&i.showCheckboxes,{name:"if",hash:{},fn:this.program(4,r,0),inverse:this.noop,data:r}))!=null?i:"")+"  </div>\n</div>\n"},useData:!0})}),define("hbars!module/common/category/tree/template/category",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){var i,s;return'    <a href="#" class="tree-expand-collapse">\n      <i class="fa fa-'+((i=t["if"].call(e,e!=null?e.isOpen:e,{name:"if",hash:{},fn:this.program(2,r,0),inverse:this.program(4,r,0),data:r}))!=null?i:"")+'-square-o" data-id="'+this.escapeExpression((s=(s=t.id||(e!=null?e.id:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"id",hash:{},data:r}):s))+'" data-level="'+this.escapeExpression((s=(s=t.level||(e!=null?e.level:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"level",hash:{},data:r}):s))+'">\n        <span class="sr-only">'+((i=t["if"].call(e,e!=null?e.isOpen:e,{name:"if",hash:{},fn:this.program(6,r,0),inverse:this.program(8,r,0),data:r}))!=null?i:"")+"</span>\n      </i>\n    </a>\n"},2:function(e,t,n,r){return"minus"},4:function(e,t,n,r){return"plus"},6:function(e,t,n,r){return"Close"},8:function(e,t,n,r){return"Open"},10:function(e,t,n,r){return"tree-branch-name tree-folder-name"},12:function(e,t,n,r){return"tree-item-name"},14:function(e,t,n,r){return"selection-link"},16:function(e,t,n,r){return"tree-link"},18:function(e,t,n,r){var i,s;return'href="'+this.escapeExpression(this.lambda((i=(i=r&&r.root)&&i.params)&&i.baseHrefOnClick,e))+this.escapeExpression((s=(s=t.id||(e!=null?e.id:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"id",hash:{},data:r}):s))+'"'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i,s;return'<div class="pull-left">\n'+((i=t["if"].call(e,e!=null?e.hasChildren:e,{name:"if",hash:{},fn:this.program(1,r,0),inverse:this.noop,data:r}))!=null?i:"")+'  <div class="'+((i=t["if"].call(e,e!=null?e.hasChildren:e,{name:"if",hash:{},fn:this.program(10,r,0),inverse:this.program(12,r,0),data:r}))!=null?i:"")+'">\n    <a class="'+((i=t["if"].call(e,(i=(i=r&&r.root)&&i.params)&&i.allowSelection,{name:"if",hash:{},fn:this.program(14,r,0),inverse:this.program(16,r,0),data:r}))!=null?i:"")+'" '+((i=t["if"].call(e,e!=null?e.showOptionsMenu:e,{name:"if",hash:{},fn:this.program(18,r,0),inverse:this.noop,data:r}))!=null?i:"")+' data-name="'+this.escapeExpression(this.lambda(e!=null?e.name:e,e))+'" data-id="'+this.escapeExpression((s=(s=t.id||(e!=null?e.id:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"id",hash:{},data:r}):s))+'" data-mirror="'+this.escapeExpression((s=(s=t["mirror-type"]||(e!=null?e["mirror-type"]:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"mirror-type",hash:{},data:r}):s))+'" data-access="'+this.escapeExpression((s=(s=t.accessLevel||(e!=null?e.accessLevel:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"accessLevel",hash:{},data:r}):s))+'">\n      <span class="icon-item fa '+this.escapeExpression((t.getSectionIcon||e&&e.getSectionIcon||t.helperMissing).call(e,e,{name:"getSectionIcon",hash:{},data:r}))+' section-icon"></span>\n      <span class="tree-label" title="'+this.escapeExpression((t.getToolTip||e&&e.getToolTip||t.helperMissing).call(e,e,{name:"getToolTip",hash:{},data:r}))+'" id="folder1-label">'+this.escapeExpression((t.decode||e&&e.decode||t.helperMissing).call(e,e!=null?e.name:e,{name:"decode",hash:{},data:r}))+"</span>\n    </a>\n  </div>\n</div>\n"},useData:!0})}),define("hbars!module/common/category/tree/template/subCategory",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){var i;return(i=t.each.call(e,e!=null?e.children:e,{name:"each",hash:{},fn:this.program(2,r,0),inverse:this.noop,data:r}))!=null?i:""},2:function(e,t,n,r){var i,s;return'  <div class="'+this.escapeExpression((t.getNodeCls||e&&e.getNodeCls||t.helperMissing).call(e,e,{name:"getNodeCls",hash:{},data:r}))+' line-item" role="treeitem" aria-expanded="'+this.escapeExpression((s=(s=t.isOpen||(e!=null?e.isOpen:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"isOpen",hash:{},data:r}):s))+'">\n    <div class="'+this.escapeExpression((t.getNodeHeaderCls||e&&e.getNodeHeaderCls||t.helperMissing).call(e,e,{name:"getNodeHeaderCls",hash:{},data:r}))+' line-item-header clearfix section-draggable section-droppable" data-id="'+this.escapeExpression((s=(s=t.id||(e!=null?e.id:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"id",hash:{},data:r}):s))+'" data-name="'+this.escapeExpression(this.lambda(e!=null?e.name:e,e))+'" data-mirror-type="'+this.escapeExpression(this.lambda(e!=null?e["mirror-type"]:e,e))+'">\n'+((i=this.invokePartial(n.category,e,{name:"category",data:r,indent:"      ",helpers:t,partials:n}))!=null?i:"")+((i=this.invokePartial(n["category-actions"],e,{name:"category-actions",data:r,indent:"      ",helpers:t,partials:n}))!=null?i:"")+"    </div>\n"+((i=t["if"].call(e,e!=null?e.children:e,{name:"if",hash:{},fn:this.program(3,r,0),inverse:this.noop,data:r}))!=null?i:"")+"  </div>\n"},3:function(e,t,n,r){var i;return(i=this.invokePartial(n["category-subCategory"],e,{name:"category-subCategory",data:r,indent:"      ",helpers:t,partials:n}))!=null?i:""},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i;return'<div class="tree-branch-children tree-folder-content" role="group">\n'+((i=t["if"].call(e,e!=null?e.isOpen:e,{name:"if",hash:{},fn:this.program(1,r,0),inverse:this.noop,data:r}))!=null?i:"")+"</div>\n"},usePartial:!0,useData:!0})}),define("hbars!module/common/category/tree/template/tree",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){var i,s;return"    "+((i=(s=(s=t.categoryLoading||(e!=null?e.categoryLoading:e))!=null?s:t.helperMissing,typeof s==="function"?s.call(e,{name:"categoryLoading",hash:{},data:r}):s))!=null?i:"")+"\n"},3:function(e,t,n,r){var i;return((i=t["if"].call(e,(i=(i=r&&r.root)&&i.params)&&i.showWidget,{name:"if",hash:{},fn:this.program(4,r,0),inverse:this.noop,data:r}))!=null?i:"")+'        <div class="fuelux">\n          <div class="tree tree-folder-select" role="tree">\n'+((i=t["with"].call(e,e!=null?e.hierarchy:e,{name:"with",hash:{},fn:this.program(6,r,0),inverse:this.noop,data:r}))!=null?i:"")+"          </div>\n        </div>\n"+((i=t["if"].call(e,(i=(i=r&&r.root)&&i.params)&&i.showWidget,{name:"if",hash:{},fn:this.program(18,r,0),inverse:this.noop,data:r}))!=null?i:"")},4:function(e,t,n,r){var i;return'  <div class="widget-box">\n'+((i=this.invokePartial(n.header,e,{name:"header",data:r,indent:"    ",helpers:t,partials:n}))!=null?i:"")+'    <div class="widget-body">\n      <div class="widget-main">\n'},6:function(e,t,n,r){var i,s;return'            <div class="'+this.escapeExpression((t.getNodeCls||e&&e.getNodeCls||t.helperMissing).call(e,e,{name:"getNodeCls",hash:{},data:r}))+' line-item" role="treeitem" aria-expanded="'+this.escapeExpression((s=(s=t.isOpen||(e!=null?e.isOpen:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"isOpen",hash:{},data:r}):s))+'">\n              <div class="'+this.escapeExpression((t.getNodeHeaderCls||e&&e.getNodeHeaderCls||t.helperMissing).call(e,e,{name:"getNodeHeaderCls",hash:{},data:r}))+' clearfix section-droppable" data-id="'+this.escapeExpression((s=(s=t.id||(e!=null?e.id:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"id",hash:{},data:r}):s))+'" data-access="'+this.escapeExpression((s=(s=t.accessLevel||(e!=null?e.accessLevel:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"accessLevel",hash:{},data:r}):s))+'" data-name="'+this.escapeExpression(this.lambda(e!=null?e.name:e,e))+'" \n              data-mirror-type="'+this.escapeExpression(this.lambda(e!=null?e["mirror-type"]:e,e))+'">\n'+((i=this.invokePartial(n.category,e,{name:"category",data:r,indent:"                ",helpers:t,partials:n}))!=null?i:"")+'                <div class="pull-right">\n                  <div class="tree-folder-actions text-right">\n'+((i=t["if"].call(e,(i=(i=r&&r.root)&&i.params)&&i.showActions,{name:"if",hash:{},fn:this.program(7,r,0),inverse:this.noop,data:r}))!=null?i:"")+((i=t["if"].call(e,(i=(i=r&&r.root)&&i.params)&&i.showCheckboxes,{name:"if",hash:{},fn:this.program(10,r,0),inverse:this.noop,data:r}))!=null?i:"")+"                  </div>\n                </div>\n              </div>\n"+((i=t["if"].call(e,e!=null?e.isOpen:e,{name:"if",hash:{},fn:this.program(13,r,0),inverse:this.noop,data:r}))!=null?i:"")+"            </div>\n"},7:function(e,t,n,r){var i;return(i=t["if"].call(e,e!=null?e.hasAccess:e,{name:"if",hash:{},fn:this.program(8,r,0),inverse:this.noop,data:r}))!=null?i:""},8:function(e,t,n,r){return'                    <div class="btn-group text-left">\n                      <button data-toggle="dropdown" class="btn btn-info btn-xs dropdown-toggle" data-position="auto"><i class="fa fa-cog"></i>\n                        <span class="ace-icon fa fa-caret-down icon-on-right"></span>\n                      </button>\n                      <ul class="dropdown-menu dropdown-menu-right dropdown-caret pull-right text-left">\n                        <li><a href="#" class="add-sub"><i class="fa fa-level-down"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:action.addCategory",{name:"t",hash:{},data:r}))+"</a></li>\n                      </ul>\n                    </div>\n"},10:function(e,t,n,r){var i;return(i=t["if"].call(e,e!=null?e.hasAccess:e,{name:"if",hash:{},fn:this.program(11,r,0),inverse:this.noop,data:r}))!=null?i:""},11:function(e,t,n,r){return'                      <label>\n                        <input type="checkbox" class="ace">\n                        <span class="lbl"></span>\n                      </label>\n'},13:function(e,t,n,r){var i;return(i=t["if"].call(e,e!=null?e.children:e,{name:"if",hash:{},fn:this.program(14,r,0),inverse:this.noop,data:r}))!=null?i:""},14:function(e,t,n,r){var i;return'              <div class="tree-branch-children tree-folder-content" role="group">\n'+((i=t.each.call(e,e!=null?e.children:e,{name:"each",hash:{},fn:this.program(15,r,0),inverse:this.noop,data:r}))!=null?i:"")+"              </div>\n"},15:function(e,t,n,r){var i,s;return'                <div class="'+this.escapeExpression((t.getNodeCls||e&&e.getNodeCls||t.helperMissing).call(e,e,{name:"getNodeCls",hash:{},data:r}))+' line-item" role="treeitem" aria-expanded="'+this.escapeExpression((s=(s=t.isOpen||(e!=null?e.isOpen:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"isOpen",hash:{},data:r}):s))+'">\n                  <div class="'+this.escapeExpression((t.getNodeHeaderCls||e&&e.getNodeHeaderCls||t.helperMissing).call(e,e,{name:"getNodeHeaderCls",hash:{},data:r}))+' clearfix section-draggable section-droppable" data-id="'+this.escapeExpression((s=(s=t.id||(e!=null?e.id:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"id",hash:{},data:r}):s))+'" data-access="'+this.escapeExpression((s=(s=t.accessLevel||(e!=null?e.accessLevel:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"accessLevel",hash:{},data:r}):s))+'" data-name="'+this.escapeExpression(this.lambda(e!=null?e.name:e,e))+'" data-mirror-type="'+this.escapeExpression(this.lambda(e!=null?e["mirror-type"]:e,e))+'">\n'+((i=this.invokePartial(n.category,e,{name:"category",data:r,indent:"                    ",helpers:t,partials:n}))!=null?i:"")+((i=this.invokePartial(n["category-actions"],e,{name:"category-actions",data:r,indent:"                    ",helpers:t,partials:n}))!=null?i:"")+"                  </div>\n"+((i=t["if"].call(e,e!=null?e.children:e,{name:"if",hash:{},fn:this.program(16,r,0),inverse:this.noop,data:r}))!=null?i:"")+"                </div>\n"},16:function(e,t,n,r){var i;return(i=this.invokePartial(n["category-subCategory"],e,{name:"category-subCategory",data:r,indent:"                  ",helpers:t,partials:n}))!=null?i:""},18:function(e,t,n,r){return"      </div>\n    </div>\n  </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i;return(i=t["if"].call(e,e!=null?e.isLoading:e,{name:"if",hash:{},fn:this.program(1,r,0),inverse:this.program(3,r,0),data:r}))!=null?i:""},usePartial:!0,useData:!0})}),define("module/common/category/tree/view/tree",["underscore","jquery","backbone","i18n","Handlebars","helper/language","module/common/media/model/categories","module/common/section/tree/view/tree","hbars!module/common/category/tree/template/actions","hbars!module/common/category/tree/template/category","hbars!module/common/category/tree/template/subCategory","hbars!module/common/category/tree/template/tree"],function(e,t,n,r,i,s,o,u,a,f,l,c){return u.extend({template:c,model:new o,events:{'click a[href="#"]':"preventDefault","click .delete-section":"erase","click .pull-left i":"updateTree","click .tree-link":"selectCategory","click .add-sub":"add","click .edit-category":"edit",'change [type="checkbox"]':"changeCategory","show.bs.dropdown .actions":"onShowActions","hide.bs.dropdown .actions":"onHideActions"},initialize:function(e){this.options=e||{},this.options.params={activeNode:null,showActions:!!e.showActions,showCheckboxes:!!e.showCheckboxes,autoFetch:!!e.autoFetch,folderSelect:!!e.folderSelect,isSortable:!!e.isSortable,highlightCategory:!!e.highlightCategory},this.constructor.__super__.initialize.call(this,e),this.moveModel=new o,this.model.on("sync:create",this.refresh.bind(this)),this.moveModel.on("sync",this.notifyMoved,this),this.listenTo(n,"media:category:erased",this.notifyErased),this.listenTo(n,"media:category:added",this.notifyAdded),this.listenTo(n,"media:category:edited",this.notifyEdited),this.listenTo(n,"media:category:selected",this.setActive),this.params.isSortable&&this.listenTo(n,"section:tree:dropped",this.notifyMove),i.registerPartial("category",f),i.registerPartial("category-actions",a),i.registerPartial("category-subCategory",l),i.registerHelper("getSectionIcon",this.getCategoryIcon.bind(this)),i.registerHelper("categoryLoading",function(){return'<div class="loading text-center"><div class="space-32"></div><i class="fa fa-spinner fa-3x fa-spin"></i><br>'+r.t("common.loading")+'<div class="space-32"></div></div>'}),n.trigger("notifier:subscribe","media:category:added"),n.trigger("notifier:subscribe","media:category:edited"),n.trigger("notifier:subscribe","media:category:erased"),n.trigger("notifier:subscribe","media:category:moved"),n.trigger("notifier:subscribe","media:warning:noAccess")},afterRender:function(){if(this.isLoading)return;var t=this;e.each(this.selectedCategories,function(e){t.$('[data-id="'+e+'"]').find('input[type="checkbox"]').prop("checked",!0)}),this.params.isSortable&&this.setSortable(),this.$(".tree").length&&this.trigger("tree:loaded")},serialize:function(){return{isLoading:this.isLoading,params:this.params,hierarchy:this.model.get(0),myMedia:this.model.get(1)||{}}},fetch:function(e){var t=e||{},n=t.activeNode;this.model.clear();var r=s.getCurrentLanguage();if(n)return this.model.fetchNodes(n,r);this.model.activeNode=this.params.activeNode,this.model.fetchTree(r)},selectCategory:function(e){e.preventDefault();if(this.options.params.highlightCategory){var r=this.$(".tree-selected"),i=t(e.currentTarget),s=i.closest(".line-item").length>0?i.closest(".line-item"):i.closest(".line-item-header");r.get(0)===s.get(0)?s.removeClass("tree-selected"):(r.removeClass("tree-selected"),s.addClass("tree-selected"))}if(this.options.params.folderSelect){var o=this.getData(e)||{};n.trigger("media:category:selected",o.id,o.access)}},add:function(e){e.preventDefault();var n=t(e.currentTarget),r=n.closest("[data-id]"),i=r.data("id");location.hash="category/"+i+"/add"},edit:function(e){e.preventDefault();var n=t(e.currentTarget),r=n.closest("[data-id]"),i=r.data("id"),s=this.getCategoryParent(i);location.hash="category/"+i+"/parent/"+s},notifyMove:function(e){this.moveModel.language=s.getCurrentLanguage(),this.moveModel.moveCategory(e.from.id,e.to.id)},erase:function(e){e.preventDefault();var r=t(e.currentTarget),i=r.closest("[data-id]"),s=i.data("id"),o=this.model.getNameByID(s);n.trigger("media:category:erase",{name:o},{id:s})},setCategories:function(e){this.selectedCategories=e},getSelected:function(){var e=[];return this.options.params.showCheckboxes&&(e=this.selectedCategories),this.options.params.highlightCategory&&this.$(".tree-selected").each(function(){var r=t(this).closest("[data-id]").length>0?t(this).closest("[data-id]"):t(this).find("[data-id]");r.data("access")===parseInt(10)?n.trigger("media:warning:noAccess"):e.push(r.data("id"))}),e},setActive:function(e){this.$el.find(".tree-link > span.tree-label").removeClass("active"),this.$el.find('.tree-link[data-id="'+e+'"] > span.tree-label').addClass("active")},changeCategory:function(n){n.preventDefault();var r=t(n.currentTarget),i=r.prop("checked"),s=r.closest("[data-id]").data("id");s&&(i&&!e.contains(this.selectedCategories,s)?this.selectedCategories.push(s):this.selectedCategories=e.filter(this.selectedCategories,function(e){return parseInt(e,10)!==parseInt(s,10)}))},getName:function(e){return!e||!e.name?r.t("common:info.notTranslated"):e.name},getToolTip:function(e){return!e||!e.name?r.t("common:info.notTranslated"):this.composeToolTip(e)},getToolTipEntry:function(e,t){return"("+e+") "+t},composeToolTip:function(e){var t=e.name?e.name:r.t("common:info.notTranslated");return this.getToolTipEntry(this.getStatus(e),t)},getCategoryParent:function(e){return this.model.getParentByID(e)},getCategoryIcon:function(e){return e.isOpen?"fa-folder-open":"fa-folder"},notifyAdded:function(){this.fetch()},notifyEdited:function(){this.fetch()},notifyErased:function(){this.fetch()},notifyMoved:function(){this.fetch()}})}),define("module/common/media/model/mediaCollection",["underscore","backbone","module/common/media/model/media"],function(e,t,n){return t.Collection.extend({model:n,url:function(){return t.SERVICE_BASE_URL+"/media/category/"+this.category+"/"+this.language+"?showPending="+this.showPending}})}),define("module/content/mediatype/model/mediatype",["underscore","backbone","i18n"],function(e,t,n){var r=t.Model.extend({prefix:"mediatype",urlRoot:t.SERVICE_BASE_URL+"/mediaType"});return r}),define("module/content/mediatype/model/mediatypes",["underscore","backbone","module/content/mediatype/model/mediatype"],function(e,t,n){var r=t.Collection.extend({model:n,prefix:"mediatype",url:t.SERVICE_BASE_URL+"/mediaType"});return r}),define("hbars!module/common/media/template/media/list",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){var i,s;return((i=(s=(s=t.showLoading||(e!=null?e.showLoading:e))!=null?s:t.helperMissing,typeof s==="function"?s.call(e,{name:"showLoading",hash:{},data:r}):s))!=null?i:"")+"\n"},3:function(e,t,n,r,i,s){var o;return'<table class="table table-striped table-bordered table-hover dt-responsive" id="table-media-list">\n  <thead>\n  <tr>\n    <th class="table-span-2">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:list.headers.preview",{name:"t",hash:{},data:r}))+'</th>\n    <th class="table-span-4">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:list.headers.name",{name:"t",hash:{},data:r}))+'</th>\n    <th class="table-span-3">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:list.headers.version",{name:"t",hash:{},data:r}))+'</th>\n    <th class="table-span-3">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:list.headers.status",{name:"t",hash:{},data:r}))+'</th>\n    <th class="table-span-3">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:list.headers.filename",{name:"t",hash:{},data:r}))+'</th>\n    <th class="table-span-2">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:list.headers.type",{name:"t",hash:{},data:r}))+'</th>\n    <th class="table-span-1">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:list.headers.size",{name:"t",hash:{},data:r}))+"</th>\n    <th></th>\n"+((o=t["if"].call(e,e!=null?e.checkbox:e,{name:"if",hash:{},fn:this.program(4,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"  </tr>\n  </thead>\n  <tbody>\n"+((o=t.each.call(e,e!=null?e.collection:e,{name:"each",hash:{},fn:this.program(6,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"  </tbody>\n</table>\n"},4:function(e,t,n,r){return'    <th>\n      <label>\n        <input type="checkbox" class="ace select-all">\n        <span class="lbl"></span>\n      </label>\n    </th>\n'},6:function(e,t,n,r,i,s){var o;return'    <tr class="odd" data-id="'+this.escapeExpression(this.lambda(e!=null?e.id:e,e))+'">\n      <td class="text-center">\n'+((o=(t.unlessCond||e&&e.unlessCond||t.helperMissing).call(e,e!=null?e.lock:e,"!A",s[2]!=null?s[2].canPerformDefaultAction:s[2],{name:"unlessCond",hash:{},fn:this.program(7,r,0,i,s),inverse:this.program(12,r,0,i,s),data:r}))!=null?o:"")+'      </td>\n      <td>\n        <span class="badge pull-right">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.id",{name:"t",hash:{},data:r}))+":"+this.escapeExpression(this.lambda(e!=null?e.id:e,e))+"</span>\n"+((o=t.unless.call(e,e!=null?e.lock:e,{name:"unless",hash:{},fn:this.program(18,r,0,i,s),inverse:this.program(21,r,0,i,s),data:r}))!=null?o:"")+((o=this.invokePartial(n.contentLockToolTip,e,{name:"contentLockToolTip",data:r,indent:"        ",helpers:t,partials:n}))!=null?o:"")+'        <br>\n        <small class="grey">\n            '+this.escapeExpression((t.decode||e&&e.decode||t.helperMissing).call(e,e!=null?e.description:e,{name:"decode",hash:{},data:r}))+"\n        </small>\n      </td>\n      <td>"+this.escapeExpression(this.lambda(e!=null?e.version:e,e))+'</td>\n      <td><span class="label label-'+this.escapeExpression((t.getContentStatusLabel||e&&e.getContentStatusLabel||t.helperMissing).call(e,e!=null?e.status:e,{name:"getContentStatusLabel",hash:{},data:r}))+' arrowed">'+this.escapeExpression((t.getStatus||e&&e.getStatus||t.helperMissing).call(e,e!=null?e.status:e,{name:"getStatus",hash:{},data:r}))+'</span></td>\n      <td><span class="media-filename" title="'+this.escapeExpression(this.lambda(e!=null?e.fileName:e,e))+'">'+this.escapeExpression(this.lambda(e!=null?e.fileName:e,e))+"</span></td>\n      <td>"+this.escapeExpression(this.lambda(e!=null?e.typeName:e,e))+"</td>\n      <td>"+this.escapeExpression((t.fileSize||e&&e.fileSize||t.helperMissing).call(e,e!=null?e.mediaSize:e,!0,{name:"fileSize",hash:{},data:r}))+'</td>\n      <td>\n        <div class="btn-group">\n'+((o=t["with"].call(e,e,{name:"with",hash:{},fn:this.program(23,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"        </div>\n      </td>\n"+((o=t["if"].call(e,s[1]!=null?s[1].checkbox:s[1],{name:"if",hash:{},fn:this.program(30,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"    </tr>\n"},7:function(e,t,n,r){var i;return'        <a href="#" class="edit" data-id="'+this.escapeExpression(this.lambda(e!=null?e.id:e,e))+'" data-language="'+this.escapeExpression(this.lambda(e!=null?e.language:e,e))+'">\n'+((i=t["if"].call(e,e!=null?e.thumbnail:e,{name:"if",hash:{},fn:this.program(8,r,0),inverse:this.program(10,r,0),data:r}))!=null?i:"")+"        </a>\n"},8:function(e,t,n,r){var i;return'          <img src="'+this.escapeExpression((i=(i=t.thumbnail||(e!=null?e.thumbnail:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"thumbnail",hash:{},data:r}):i))+'" alt="'+this.escapeExpression(this.lambda(e!=null?e.name:e,e))+'" class="img-responsive" style="margin: 0 auto;">\n'},10:function(e,t,n,r){return'          <i class="fa '+this.escapeExpression((t.mediaIcon||e&&e.mediaIcon||t.helperMissing).call(e,e!=null?e.fileName:e,{name:"mediaIcon",hash:{},data:r}))+'"></i>\n'},12:function(e,t,n,r){var i;return'        <span data-id="'+this.escapeExpression(this.lambda(e!=null?e.id:e,e))+'" data-language="'+this.escapeExpression(this.lambda(e!=null?e.language:e,e))+'">\n'+((i=(t.compare||e&&e.compare||t.helperMissing).call(e,e!=null?e.thumbnail:e,"&&",e!=null?e.fileName:e,{name:"compare",hash:{},fn:this.program(8,r,0),inverse:this.program(13,r,0),data:r}))!=null?i:"")},13:function(e,t,n,r){var i;return((i=t.unless.call(e,e!=null?e.fileName:e,{name:"unless",hash:{},fn:this.program(14,r,0),inverse:this.program(16,r,0),data:r}))!=null?i:"")+"        </span>\n"},14:function(e,t,n,r){return'            <i class="red fa '+this.escapeExpression((t.mediaIcon||e&&e.mediaIcon||t.helperMissing).call(e,e!=null?e.fileName:e,{name:"mediaIcon",hash:{},data:r}))+'" data-rel="tooltip" data-placement="bottom" title="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:error.errorWithMediaFile.tooltip",{name:"t",hash:{},data:r}))+'"></i><br/>\n            '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:error.errorWithMediaFile.title",{name:"t",hash:{},data:r}))+"\n"},16:function(e,t,n,r){return'            <i class="fa '+this.escapeExpression((t.mediaIcon||e&&e.mediaIcon||t.helperMissing).call(e,e!=null?e.fileName:e,{name:"mediaIcon",hash:{},data:r}))+'"></i>\n'},18:function(e,t,n,r,i,s){var o;return(o=t["if"].call(e,s[2]!=null?s[2].canPerformDefaultAction:s[2],{name:"if",hash:{},fn:this.program(19,r,0,i,s),inverse:this.program(21,r,0,i,s),data:r}))!=null?o:""},19:function(e,t,n,r){return'          <a href="#" class="edit" data-id="'+this.escapeExpression(this.lambda(e!=null?e.id:e,e))+'" data-language="'+this.escapeExpression(this.lambda(e!=null?e.language:e,e))+'">'+this.escapeExpression((t.decode||e&&e.decode||t.helperMissing).call(e,e!=null?e.name:e,{name:"decode",hash:{},data:r}))+"</a>\n"},21:function(e,t,n,r){return'         <span data-id="'+this.escapeExpression(this.lambda(e!=null?e.id:e,e))+'" data-language="'+this.escapeExpression(this.lambda(e!=null?e.language:e,e))+'">\n          '+this.escapeExpression((t.decode||e&&e.decode||t.helperMissing).call(e,e!=null?e.name:e,{name:"decode",hash:{},data:r}))+"\n         </span>\n"},23:function(e,t,n,r){var i,s,o,u="";return i=(s=(s=t.actionButton||(e!=null?e.actionButton:e))!=null?s:t.helperMissing,o={name:"actionButton",hash:{},fn:this.program(24,r,0),inverse:this.noop,data:r},typeof s=="function"?s.call(e,o):s),t.actionButton||(i=t.blockHelperMissing.call(e,i,o)),i!=null&&(u+=i),u},24:function(e,t,n,r){var i;return(i=t["if"].call(e,(i=r&&r.root)&&i.canMakeChanges,{name:"if",hash:{},fn:this.program(25,r,0),inverse:this.program(28,r,0),data:r}))!=null?i:""},25:function(e,t,n,r){var i;return"               "+this.escapeExpression((t.actionLink||e&&e.actionLink||t.helperMissing).call(e,{name:"actionLink",hash:{language:e!=null?e.language:e,id:e!=null?e.id:e,"class":"edit",text:"common:action.edit",icon:"edit",link:"#"},data:r}))+"\n               "+this.escapeExpression((t.actionLink||e&&e.actionLink||t.helperMissing).call(e,{name:"actionLink",hash:{language:e!=null?e.language:e,id:e!=null?e.id:e,"class":"move",text:"common:action.move",icon:"external-link-square",link:"#"},data:r}))+"\n               "+this.escapeExpression((t.actionLink||e&&e.actionLink||t.helperMissing).call(e,{name:"actionLink",hash:{language:e!=null?e.language:e,id:e!=null?e.id:e,"class":"variants",text:"media:action.variants",icon:"crop",link:"#"},data:r}))+"\n               "+this.escapeExpression((t.actionLink||e&&e.actionLink||t.helperMissing).call(e,{name:"actionLink",hash:{language:e!=null?e.language:e,id:e!=null?e.id:e,"class":"download",text:"common:action.download",icon:"cloud-download",link:"#"},data:r}))+"\n               "+this.escapeExpression((t.actionLink||e&&e.actionLink||t.helperMissing).call(e,{name:"actionLink",hash:{divider:!0},data:r}))+"\n               "+this.escapeExpression((t.actionLink||e&&e.actionLink||t.helperMissing).call(e,{name:"actionLink",hash:{"class":"erase",text:"common:action.erase",icon:"trash-o",link:"#"},data:r}))+"\n"+((i=t["if"].call(e,(i=r&&r.root)&&i.showLayoutsButton,{name:"if",hash:{},fn:this.program(26,r,0),inverse:this.noop,data:r}))!=null?i:"")},26:function(e,t,n,r){return"                 "+this.escapeExpression((t.actionLink||e&&e.actionLink||t.helperMissing).call(e,{name:"actionLink",hash:{divider:!0},data:r}))+"\n                 "+this.escapeExpression((t.actionLink||e&&e.actionLink||t.helperMissing).call(e,{name:"actionLink",hash:{language:e!=null?e.language:e,id:e!=null?e.id:e,"class":"contentLayouts",text:"media:action.selectLayout",icon:"cubes",link:"#"},data:r}))+"\n"},28:function(e,t,n,r){var i;return"             "+this.escapeExpression((t.actionLink||e&&e.actionLink||t.helperMissing).call(e,{name:"actionLink",hash:{language:e!=null?e.language:e,category:(i=r&&r.root)&&i.categoryID,id:e!=null?e.id:e,"class":"view",text:"common:action.view",icon:"eye",link:"#"},data:r}))+"\n             "+this.escapeExpression((t.actionLink||e&&e.actionLink||t.helperMissing).call(e,{name:"actionLink",hash:{language:e!=null?e.language:e,id:e!=null?e.id:e,"class":"download",text:"common:action.download",icon:"cloud-download",link:"#"},data:r}))+"\n"},30:function(e,t,n,r){return'      <td>\n        <label>\n          <input name="selected" type="checkbox" class="ace">\n          <span class="lbl"></span>\n        </label>\n      </td>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r,i,s){var o;return((o=t["if"].call(e,e!=null?e.isLoading:e,{name:"if",hash:{},fn:this.program(1,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"\n"+((o=t.unless.call(e,e!=null?e.isLoading:e,{name:"unless",hash:{},fn:this.program(3,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")},usePartial:!0,useData:!0,useDepths:!0})}),define("module/common/media/view/media/list",["require","jquery","backbone","Handlebars","helper/makeup","helper/language","module/common/media/model/mediaCollection","module/content/mediatype/model/mediatypes","hbars!module/common/media/template/media/list","hbars!module/content/section/template/contentLockToolTip","helper/redirectHelper"],function(e){var t=e("jquery"),n=e("backbone"),r=e("Handlebars"),i=e("helper/makeup"),s=e("helper/language"),o=e("module/common/media/model/mediaCollection"),u=e("module/content/mediatype/model/mediatypes"),a=e("hbars!module/common/media/template/media/list"),f=e("hbars!module/content/section/template/contentLockToolTip"),l=e("helper/redirectHelper");return n.View.extend({template:a,events:{"change .select-all":"selectAll","click .erase":"notifyErase","click .edit":"notifyEdit","click .move":"notifyMove","click .variants":"notifyVariants","click .download":"notifyDownload","click .contentLayouts":"notifyLayouts","click .view":"notifyView"},initialize:function(e){this.options=e||{},this.moduleName=this.options.moduleName,this.usageContext=this.options.usageContext,this.navigator=this.options.navigator,this.checkbox=!!this.options.checkbox,this.selectMode=!!this.options.selectMode,this.showPending=!!this.options.showPending,this.collection=new o,this.mediaTypes=new u,this.lastCategory=null,r.registerPartial("contentLockToolTip",f),this.registerListeners()},registerListeners:function(){n.on(this.moduleName+":category:selected",this.fetch,this),n.on(this.moduleName+":tree:node:selected",this.fetch,this),n.on(this.moduleName+":list:changeView",this.changeViewType,this),n.on(this.moduleName+":edited",this.fetch,this),n.on(this.moduleName+":added",this.onMediaAdded,this),n.on(this.moduleName+":erased",this.fetch,this),n.on(this.moduleName+":bulk:erased",this.fetch,this),n.on(this.moduleName+":bulk:moved",this.fetch,this),n.on(this.moduleName+":home:open",function(){this.mediaTypes.fetch()},this),n.on(this.moduleName+":layoutSelected",this.onLayoutSelected,this),this.listenTo(this.collection,"error",this.notifyError,this),this.listenTo(this.collection,"request",this.setLoading),this.listenTo(this.collection,"sync:read",this.refresh),this.listenTo(n,this.moduleName+":category:selected",this.setAccessLevel)},onLayoutSelected:function(e,t,r,i){n.trigger("media:selected",e.id,e.get("language"),t,r,i),n.trigger("media:close")},enhanceTable:function(e){this.table&&this.table.fnDestroy(),e=this.currentViewType,e=e||"list",e==="list"?this.table=i.createActionDataTable({el:this.$("table")}):e==="thumbnail"&&(this.table=i.createThumbnailDataTable({el:this.$("table"),checkbox:this.checkbox}))},serialize:function(){var e=this.accessLevel!==0,t=e&&(this.selectMode||this.accessLevel===20),n=this.accessLevel===20;return{showLayoutsButton:_.contains(["content","directedit"],this.usageContext),selectMode:this.selectMode,hasReadAccess:e,canPerformDefaultAction:t,canMakeChanges:n,collection:this.collection.toJSON(),checkbox:this.checkbox,isLoading:this.isLoading,categoryID:this.collection.category}},refresh:function(){this.isLoading=!1,this.render()},selectAll:function(e){var n=t(e.target),r=n.prop("checked");this.$('table input[name="selected"][type="checkbox"]').each(function(){t(this).prop("checked",r)})},getSelected:function(){var e=this.$('input[type="checkbox"]:checked'),n=[],r=this;return e.each(function(){var e=t(this).closest("[data-id]"),i=e.attr("data-id"),s=r.collection.get(i);s&&n.push(s.toJSON())}),n},notifyErase:function(e){e.preventDefault();var r=t(e.target).closest("[data-id]"),i=r.attr("data-id"),s=this.collection.get(i);n.trigger(this.moduleName+":erase",s.toJSON())},notifyError:function(){},notifyEdit:function(e){e.preventDefault();var n=t(e.currentTarget),r=n.data("id"),i=n.data("language");this.options.selectMode&&!n.closest(".dropdown-menu").length?this.navigator.variants(this.collection.get(r)):this.navigator.edit(r,i)},notifyView:function(e){e.preventDefault();var n=t(e.currentTarget),r=n.data("id"),i=n.data("language"),s=n.data("category");l.redirectTo("media#category/"+s+"/edit/"+r+"/"+i)},notifyMove:function(e){e.preventDefault();var n=t(e.currentTarget),r=n.data("id"),i=n.data("language");this.navigator.edit(r,i,"categorisation")},notifyVariants:function(e){e.preventDefault();var n=t(e.currentTarget),r=n.data("id"),i=n.data("language");this.navigator.edit(r,i,"variants")},notifyDownload:function(e){e.preventDefault();var n=t(e.currentTarget),r=n.data("id"),i=this.collection.get(r);i.fetch({success:function(e){window.open(e.get("mediaURL"),"download")}})},notifyLayouts:function(e){e.preventDefault();var r=t(e.currentTarget),i=r.data("id"),s=this.collection.get(i);n.trigger("media:showLayouts",s)},changeViewType:function(e){this.currentViewType=e,this.enhanceTable(e),this.loadToolTips()},hasAccess:function(){return this.accessLevel===20?!0:!1},fetch:function(e,t){if(e==this.lastCategory)return!1;(e||this.lastCategory)&&this.fetchMediaCategory(e,t)},onMediaAdded:function(e){this.fetchMediaCategory(e)},setAccessLevel:function(e,t){this.accessLevel=t},fetchMediaCategory:function(e,t){return this.collection.reset(),this.collection.category=e||this.lastCategory,this.collection.language=s.getCurrentLanguage(),this.collection.showPending=this.showPending,this.isLoading=!0,this.accessLevel=t||this.accessLevel,this.lastCategory=this.collection.category,this.collection.fetch()},shortenString:function(e,t){return e.length>t?e.substr(0,t/2)+"..."+e.slice(-7):e},fixFileNames:function(){t(".media-filename").each(function(e,t){var n=t.textContent,r=n.length;r>16&&(n=this.shortenString(n,16)),t.textContent=n}.bind(this))},afterRender:function(){this.enhanceTable(),t(document).on("settings.ace",function(){i.reloadMasonry()}),this.loadToolTips(),this.fixFileNames()}})}),define("hbars!module/common/media/template/breadcrumb",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){var i,s;return'    <li>\n      <a href="#" data-id="'+this.escapeExpression((s=(s=t.id||(e!=null?e.id:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"id",hash:{},data:r}):s))+'">\n'+((i=t["if"].call(e,r&&r.first,{name:"if",hash:{},fn:this.program(2,r,0),inverse:this.noop,data:r}))!=null?i:"")+"        "+this.escapeExpression((t.decode||e&&e.decode||t.helperMissing).call(e,e!=null?e.name:e,{name:"decode",hash:{},data:r}))+"\n      </a>\n    </li>\n"},2:function(e,t,n,r){return'        <i class="fa fa-home"></i>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i;return'<div class="breadcrumbs">\n  <ul class="breadcrumb">\n'+((i=t.each.call(e,e!=null?e.path:e,{name:"each",hash:{},fn:this.program(1,r,0),inverse:this.noop,data:r}))!=null?i:"")+"  </ul>\n</div>\n"},useData:!0})}),define("module/common/media/view/breadcrumb",["underscore","jquery","backbone","helper/media","module/content/section/model/section","module/common/media/model/categories","hbars!module/common/media/template/breadcrumb"],function(e,t,n,r,i,s,o){return n.View.extend({template:o,id:"media_view_breadcrumb",events:{"click a":"selectCategory"},initialize:function(e){this.options=e||{},this.navigator=this.options.navigator,this.section=new i,this.categories=new s,this.path=[],n.on("media:category:selected",this.selected,this),n.on("media:home:open",this.selected,this),n.on("media:home",function(){r.getAsyncRootCategory().done(function(e){this.selected(e)}.bind(this))},this),this.categories.on("request",this.setLoading,this),this.categories.on("sync",this.fetched,this),r.fetchAsyncMediaPathLanguage().done(function(e){this.categories.fetchTree(e)}.bind(this))},serialize:function(){return{path:this.path||[]}},setLoading:function(){this.isLoading=!0},fetched:function(){this.isLoading=!1,this.selectedID&&this.selected(this.selectedID)},selected:function(e){this.selectedID=e;if(this.isLoading)return;this.path=this.builtPath(e),this.render()},builtPath:function(e){var t=this.categories.getByID(e),n=[],r;if(t){r=this.categories.getParentByID(t.id),n.push({id:t.id,name:t.name});while(r>0)t=this.categories.getByID(r),r=this.categories.getParentByID(t.id),n.push({id:t.id,name:t.name});return n.reverse(),n}},selectCategory:function(e){e.preventDefault();var r=t(e.currentTarget),i=r.data("id");this.navigator.home(i),n.trigger("media:category:selected",i)}})}),define("hbars!module/common/media/template/list",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){return'\n    <div class="btn-group text-left">\n      <button data-toggle="dropdown" class="btn btn-info dropdown-toggle">\n        <i class="fa fa-cog"></i>\n        '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:action.bulkActions",{name:"t",hash:{},data:r}))+'\n        <span class="ace-icon fa fa-caret-down icon-on-right"></span>\n      </button>\n      <ul class="dropdown-menu dropdown-menu-right dropdown-caret pull-right">\n        <li>\n          <a href="#" class="move-selected">\n            <i class="fa fa-external-link-square"></i>\n            '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.move",{name:"t",hash:{},data:r}))+'\n          </a>\n        </li>\n        <li class="divider"></li>\n        <li>\n          <a href="#" class="erase-selected">\n            <i class="fa fa-trash-o"></i>\n            '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.erase",{name:"t",hash:{},data:r}))+"\n          </a>\n        </li>\n      </ul>\n    </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i;return'<div class="row">\n  <div class="col-sm-8">\n    <p>'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:list.title",{name:"t",hash:{},data:r}))+'</p>\n  </div>\n\n  <div class="col-sm-4 text-right">\n    <p></p>\n'+((i=t["if"].call(e,e!=null?e.bulkActions:e,{name:"if",hash:{},fn:this.program(1,r,0),inverse:this.noop,data:r}))!=null?i:"")+'    <a href="#" class="btn btn-success add" id="main_action"> <i class="fa fa-plus"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:page.main_action",{name:"t",hash:{},data:r}))+'</a>\n    <p></p>\n  </div>\n\n</div>\n<div class="row">\n  <div class="col-xs-2 col-sm-3 col-lg-4">\n    <a href="#" class="btn btn-info btn-sm toggle-categories">\n      <i class="fa fa-sitemap"></i>\n      <span class="hidden-xs"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:action.hideCategories",{name:"t",hash:{},data:r}))+'</span>\n    </a>\n  </div>\n  <div class="col-xs-10 col-sm-4 xs-spacer">\n    <form class="search">\n      <div class="input-group">\n        <input type="text" class="form-control">\n        <span class="input-group-btn">\n          <button class="btn btn-sm btn-primary">\n            <i class="fa fa-search"></i>\n            '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.search",{name:"t",hash:{},data:r}))+'\n          </button>\n        </span>\n      </div>\n    </form>\n  </div>\n  <div class="col-xs-8 col-sm-3 col-lg-2 xs-spacer">\n    <form class="jump">\n      <div class="input-group">\n        <input type="number" class="form-control" min="1">\n        <span class="input-group-btn">\n          <button class="btn btn-sm btn-primary"># '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:action.jump",{name:"t",hash:{},data:r}))+'</button>\n        </span>\n      </div>\n    </form>\n  </div>\n  <div class="col-xs-4 col-sm-2 col-lg-2 text-right">\n    <div data-toggle="buttons" class="btn-group btn-overlap">\n      <label class="btn btn-white ace-tooltip active" title="" data-original-title="List view">\n        <input type="radio" name="viewType" value="list">\n        <i class="icon-only ace-icon fa fa-list"></i>\n      </label>\n\n      <label class="btn btn-white ace-tooltip" title="" data-original-title="Thumbnail view">\n        <input type="radio" name="viewType" value="thumbnail">\n        <i class="icon-only ace-icon fa fa-th"></i>\n      </label>\n    </div>\n  </div>\n</div>\n\n<div class="space-4"></div>\n\n<div class="row">\n  <div class="col-xs-12">\n    <div class="category-breadcrumbs"></div>\n  </div>\n</div>\n\n<div class="space-4"></div>\n\n<div class="row">\n  <div class="col-md-4">\n    <div class="widget-container-col">\n      <div class="widget-box">\n        <div class="widget-header success">\n          <h5 class="widget-title">\n            <i class="ace-icon fa fa-sitemap"></i>\n            '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:list.mediaCategories",{name:"t",hash:{},data:r}))+'\n          </h5>\n          <div class="widget-toolbar">\n            <a href="#" data-action="fullscreen">\n              <i class="ace-icon fa fa-expand"></i>\n            </a>\n          </div>\n        </div>\n        <div class="widget-body">\n          <div class="widget-main" id="media-categories"></div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="col-md-8" id="media-list"></div>\n</div>\n'},useData:!0})}),define("module/common/media/view/list",["require","jquery","backbone","Handlebars","helper/makeup","helper/language","module/common/category/tree/view/tree","module/common/media/view/media/list","module/common/media/model/media","module/common/media/view/breadcrumb","hbars!module/common/media/template/list","helper/makeup"],function(e){var t=e("jquery"),n=e("backbone"),r=e("Handlebars"),i=e("helper/makeup"),s=e("helper/language"),o=e("module/common/category/tree/view/tree"),u=e("module/common/media/view/media/list"),a=e("module/common/media/model/media"),f=e("module/common/media/view/breadcrumb"),l=e("hbars!module/common/media/template/list"),i=e("helper/makeup");return n.View.extend({template:l,events:{"click .toggle-categories":"toggleCategories","submit .jump":"jump","submit .search":"search","click .erase-selected":"notifyEraseSelected","click .download-selected":"notifyDownloadSelected","click .move-selected":"notifyMoveSelected","click .add":"notifyAdd",'change input[type="radio"][name="viewType"]':"notifyChangeViewType"},initialize:function(e){this.options=e||{},this.moduleName=this.options.moduleName,this.router=this.options.router,this.navigator=this.options.navigator,this.bulkActions=this.options.bulkActions,this.selectMode=!!this.options.selectMode,this.showPending=!!this.options.showPending,this.categoriesView=new o({moduleName:this.moduleName,showActions:this.options.actions,showCheckboxes:!1,autoFetch:!0,folderSelect:!0,isSortable:!0}),this.listView=new u({moduleName:this.moduleName,usageContext:this.options.usageContext,navigator:this.navigator,checkbox:this.bulkActions,selectMode:this.selectMode,showPending:this.showPending}),this.breadcrumbView=new f({navigator:this.navigator}),this.selectedNodeId=0,this.activeNodeId=0,this.media=new a,this.registerListeners(),this.registerSubscriptions()},registerListeners:function(){n.on(this.moduleName+":home",this.fetch,this),n.on(this.moduleName+":edit",this.hide,this),n.on(this.moduleName+":readOnly",this.hide,this),n.on(this.moduleName+":edit:readOnly",this.hide,this),n.on(this.moduleName+":add",this.hide,this),n.on(this.moduleName+":category:add",this.hide,this),n.on(this.moduleName+":category:edit",this.hide,this),n.on(this.moduleName+":variant:edit",this.hide,this),n.on(this.moduleName+":variants",this.hide,this),n.on(this.moduleName+":search",this.hide,this),n.on(this.moduleName+":home:open",this.onOpenCategory,this),n.on(this.moduleName+":category:selected",function(e){this.navigator.home(e)},this),this.listenTo(this.categoriesView,"tree:loaded",this.selectNode)},onOpenCategory:function(e){this.selectedNodeId=e,this.categoriesView.model.promiseAccessLevel().done(function(t){n.trigger(this.moduleName+":tree:node:selected",e,t)})},selectNode:function(){this.selectedNodeId=this.selectedNodeId||this.$(".tree-link").first().data("id");if(this.activeNodeId==this.selectedNodeId)return!1;this.activeNodeId=this.selectedNodeId;var e=["",":id","edit/:id","edit/:sectionId/:contentId/:activeTab","edit/:channelId/:language/:sectionId","edit/:sectionId/:contentId","add/:sectionId/:mirrorSection","add/:id/:open"];this.router&&_.contains(e,this.router.currentRoute)&&this.$('.tree-link[data-id="'+this.selectedNodeId+'"]').trigger("click")},registerSubscriptions:function(){n.trigger("notifier:subscribe",this.moduleName+":warning:noSelection"),n.trigger("notifier:subscribe",this.moduleName+":bulk:erased"),n.trigger("notifier:subscribe",this.moduleName+":warning:noAccess")},serialize:function(){return{bulkActions:this.bulkActions}},beforeRender:function(){this.insertView("#media-categories",this.categoriesView),this.insertView("#media-list",this.listView),this.insertView(".category-breadcrumbs",this.breadcrumbView)},jump:function(e){e.preventDefault();var n=t(e.target),r=n.find("input"),i=r.val(),o=s.getCurrentLanguage(),u=/^[0-9]+$/.test(i);u&&(this.media.set({id:i,language:o}),this.media.fetch({success:function(){this.navigator.edit(i,o),r.val("")}.bind(this)}))},search:function(e){e.preventDefault();var n=t(e.target),r=n.find("input");this.navigator.search(r.val())},fetch:function(){this.listView.fetch(this.selectedNodeId),this.show()},toggleCategories:function(e){e.preventDefault();var n=t(e.currentTarget),r=n.find("span"),s=this.$("#media-list"),o=this.$("#media-categories").closest(".widget-container-col");s.toggleClass("col-md-12").toggleClass("col-md-8"),s.hasClass("col-md-12")?o.hide():o.show(),s.hasClass("col-md-12")?r.text(" "+i18n.t("media:action.showCategories")):r.text(" "+i18n.t("media:action.hideCategories")),i.reloadMasonry()},notifyEraseSelected:function(e){e.preventDefault();var t=this.listView.getSelected(),r=this.listView.hasAccess();if(!r){n.trigger(this.moduleName+":warning:noAccess");return}t.length>0?n.trigger(this.moduleName+":bulk:erase",t,this.listView.lastCategory):n.trigger(this.moduleName+":warning:noSelection")},notifyDownloadSelected:function(e){e.preventDefault();var t=this.listView.getSelected();t.length>0?n.trigger(this.moduleName+":bulk:download",t):n.trigger(this.moduleName+":warning:noSelection")},notifyMoveSelected:function(e){e.preventDefault();var t=this.listView.getSelected(),r=this.listView.lastCategory,i=this.listView.hasAccess();if(!i){n.trigger(this.moduleName+":warning:noAccess");return}t.length>0?n.trigger(this.moduleName+":bulk:move",t,r):n.trigger(this.moduleName+":warning:noSelection")},notifyAdd:function(e){e.preventDefault();var t=this.listView.lastCategory||3,r=this.listView.hasAccess();if(!r){n.trigger(this.moduleName+":warning:noAccess");return}this.navigator.add(t)},notifyChangeViewType:function(e){var t=this.$('[name="viewType"]:checked').val();n.trigger(this.moduleName+":list:changeView",t)},show:function(){this.$el.fadeIn(400)},hide:function(){this.$el.hide()}})}),define("module/assets/contenttype/model/types",["backbone","module/assets/contenttype/model/type"],function(e,t){return e.Collection.extend({model:t,url:e.SERVICE_BASE_URL+"/type",toComboFeed:function(){return this.map(function(e){return{id:e.get("id"),text:e.get("name")}})}})}),define("helper/mediaFormatter",["underscore","jquery","helper/language"],function(e,t,n){var r=function(){};return e.extend(r.prototype,{updateMediaElements:function(n,r){if(n.indexOf("DE Media Layout")===-1)return n||"";var i=t("<div/>").html(e.unescape(n)),s=this.sanitiseAndWrap(i,r),o=this.getMediaComments(s,"startComments"),u=this.getMediaComments(s,"endComments");return o.each(function(e,t){var n=this.getIdFromComment(t.nodeValue);this.updateMediaElement(e,t,u,r,n)}.bind(this)),i.html().replace(/<!--\s*DE Media Layout:\s*[^]*?\s*-->/g,"")},getMediaComments:function(e,t){return e.map(function(e,n){var r=t==="startComments"?"DE Media Layout: START":"DE Media Layout: END";if(n.nodeType==8&&n.nodeValue.indexOf(r)>-1)return n;if(n.childNodes.length)return this.seachForComments(n,r)}.bind(this))},seachForComments:function(t,n){if(t.nodeType===8&&t.nodeValue.indexOf(n)>-1)return t;if(t.childNodes.length>0){var r=e.map(t.childNodes,function(e){if(e.nodeType===8&&e.nodeValue.indexOf(n)>-1)return e;if(e.childNodes.length===0)return;return this.seachForComments(e,n)},this);return e.chain(r).flatten().compact().value()}return!1},sanitiseAndWrap:function(e){return e.contents()},updateMediaElement:function(r,i,s,o,u){var a,f,l,c,h=this.getAllMediaElementsFromContent(i),p=e.findWhere(h,{mediaId:u});p&&p.element&&(f=p.element);if(f)a=s.filter(function(e,t){return this.getIdFromComment(t.nodeValue)===u}.bind(this)),this.addT4InstanceId(t(f).nextUntil(a).andSelf(),o||e.uniqueId()),this.addT4DataAttributes(t(f).nextUntil(a).andSelf(),u,n.getCurrentLanguage(),this.getAttributesFromComment(i.nodeValue),this.getLayoutFromComment(i.nodeValue));else{l=t(i.parentNode).contents().filter(function(){return this.nodeType!==8});if(l&&l.length===0)return;c=t("<span>").html(l),i.parentNode.appendChild(c[0]),this.addT4InstanceId(c,o||e.uniqueId()),this.addT4DataAttributes(c,u,n.getCurrentLanguage(),this.getAttributesFromComment(i.nodeValue),this.getLayoutFromComment(i.nodeValue))}},getAllMediaElementsFromContent:function(n){var r,i=t(n.parentNode).contents(),s;return s=e.map(i,function(e,t){var n=this.contents,r;if(e.nodeType===1&&t&&n[t-1].nodeType===8){if(n[t-1].nodeValue.indexOf("DE Media Layout: START")>-1)return r=this.mediaFormatter.getIdFromComment(n[t-1].nodeValue),{element:e,mediaId:r}}else if(e.childNodes.length){var i;for(var s in e.childNodes)if(e.childNodes.hasOwnProperty(s)){var o=e.childNodes[s];o.nodeType===8&&o.nodeValue.indexOf("DE Media Layout: START")>-1&&(i=o)}return i&&i.length&&(r=this.mediaFormatter.getIdFromComment(i.nodeValue)),{element:e,mediaId:r}}},{contents:i,mediaFormatter:this}),e.compact(s)},getIdFromComment:function(t){var n=t.split(/START = |END = /),r=n.length===2?n[1]:"",i=r.split(",").shift().split("-->").join("").trim();if(e.isNaN(parseInt(i,10)))throw new Error("invalid id "+i+" in comment "+t);return i},getAttributesFromComment:function(e){var t=e.split("attributes = "),n=t.length===2?t[1]:"";return n.split("-->").join("").trim()},getLayoutFromComment:function(e){var t=e.split("formatter = "),n=t.length===2?t[1]:"";return n.split(",").shift()},addT4IdAttribute:function(e,t){e.attr("data-t4-media-id",t)},filterMediaElements:function(n){return t(e.reject(n,function(e){return e.nodeName==="BR"||e.dataset&&e.dataset.t4Type==="sslink"}))},addT4DataAttributes:function(t,n,r,i,s){var o=i.replace(/&amp;/g,"&");return t=this.filterMediaElements(t),t.attr("data-t4-media-id",n),t.find("*").andSelf().addClass("t4-tag-content-item mceNonEditable").attr("data-t4-markup-for",n).attr("data-t4-media-attributes",e.escape(o)).attr("data-t4-media-formatter",s||"").attr("data-t4-media-language",r).attr("data-t4-type","media")},addT4InstanceId:function(e,t){return e=this.filterMediaElements(e),e.find("*").andSelf().attr("data-t4-instance-id",t)},getT4InstanceId:function(e){return e.attr("data-t4-instance-id")},removeMediaLayoutComments:function(e){return(e||"").replace(/<!--\s*DE Media Layout:\s*START\s*=\s*\d+\s*[^]*?\s*-->/g,"").replace(/<!-- DE Media Layout: END = \d+ -->/g,"")},removeRemnantsFor:function(e,n,r){t(n).find('*[data-t4-instance-id="'+e+'"]').not(r).remove()},removeAllRemnants:function(e){t(e).find("*[data-t4-markup-for]").remove()}}),r}),define("helper/directEdit",["require","tinymce","jquery","underscore","helper/mediaFormatter","helper/contentlock/commonLock"],function(e){var t=e("tinymce"),n=e("jquery"),r=e("underscore"),i=e("helper/mediaFormatter"),s=e("helper/contentlock/commonLock"),o=window.top.Backbone;return{bindTinyMce:function(e,i,s){if(!s)return!1;var o=this,u=s.toJSON(),a;i=i?s.get("menubar"):i,a=r.extend({},u,{fixed_toolbar_container:"#de-tinymce-toolbar",selector:e,inline:!0,forced_root_block:"",menubar:i,plugins:u.plugins,relative_urls:!1,convert_urls:!1,setup:function(e){e.on("change undo redo",o.onTinyMceChange.bind(o)),e.on("change",o.callLock.bind(o))},init_instance_callback:function(e){e.on("focus",function(e){n("#de-tinymce-toolbar").addClass("active")}),e.on("blur",function(e){n("#de-tinymce-toolbar").removeClass("active")})}}),i||(a.toolbar=!1,a.plugins=(a.plugins||"").replace("contextmenu","")),t.init(a)},deLocked:[],callLock:function(e){var t=n("#"+e.target.id).parents(".t4-de-content-block").data("content-id");this.deLock(t)},deLock:function(e){r.contains(this.deLocked,e)||(this.deLocked.push(e),s.setupLockFromId(e))},onTinyMceChange:function(e){var t=e.target,r=n("#"+t.id),i=r.parents(".t4-de-content-block");i.toggleClass("de-save-needed",t.isDirty())},getJson:function(){var e=n(this).find(".t4-de-content-media-json").val();if(!e)throw o.trigger("directedit:contentlayouterror"),new Error("Content cannot be saved there is a problem with the content layout.");return JSON.parse(e)},getMedia:function(e){var t=e.find(".de-editable-image"),n=this,r=!1,i={},s;return t.each(function(){s=n.getJson.call(this);if(s.compulsory&&(!s.mediaId||s.mediaId===""))return r=!0,!1;i[n.getKey(s)]=""+s.mediaId}),r?!1:i},getTinyMceContent:function(e){var r=e.find(".t4-de-editable-block"),i=this,s=!1,o,u,a,f,l,c,h={};return r.each(function(){c=i.getJson.call(this),o=n(this).find(".de-editable-tiny-mce"),u=o.hasClass("de-editable-media"),a=o.hasClass("de-editable-plaintext");if(u)return!0;f=t.get(o[0].id),l=f.getContent({format:"html"}),a&&l.indexOf("t4-form-de-placeholder")===-1&&(l=f.getContent({format:"text"}));if(c.compulsory&&(!l||l.trim()===""))return s=!0,!1;l=i.getParsedTinyMce(l),h[i.getKey(c)]=l}),s?!1:h},setId:function(e){return!e.t4MediaId&&!e.t4SsLinkId?"":e.t4MediaId?' id="'+e.t4MediaId+'" ':' sslink_id="'+e.t4SsLinkId+'" '},updateEscapedAmpersands:function(e){return e.replace(/&amp;/g,"&")},setMediaAttributes:function(e){var t;return!e.t4MediaAttributes||r.isEmpty(e.t4MediaAttributes)?"":(r.isString(e.t4MediaAttributes)&&(e.t4MediaAttributes=this.updateEscapedAmpersands(e.t4MediaAttributes),t=new RegExp("&quot","ig"),t.test(e.t4MediaAttributes)&&(e.t4MediaAttributes=r.unescape(e.t4MediaAttributes)),e.t4MediaAttributes=JSON.parse(e.t4MediaAttributes)),'mediaattributes="'+r.escape(JSON.stringify(e.t4MediaAttributes))+'"')},setMediaFormatter:function(e){return!e.t4MediaFormatter||r.isEmpty(e.t4MediaFormatter)?"":'formatter="'+e.t4MediaFormatter+'"'},getParsedTinyMce:function(e){var t=n("<t4temp />"),r;return t.html(this.replaceLayoutWithT4Tags(t,e)),this.removeTemporaryTags(t),r=t.html(),r=this.toSelfClosingT4Tags(r),r},toSelfClosingT4Tags:function(e){return e.replace(/><\/t4>/gi,"/>")},replaceLayoutWithT4Tags:function(e,t,n,i,s){var o,u;return n&&i&&s&&r.extend(this,{setId:n,setMediaAttributes:i,setMediaFormatter:s}),u=this.createInitialHtml(e,t),e=u.temp,o=u.html,o=this.updateWithSSLinks(e,o),o=this.updateWithMediaLinks(e,o),o=this.updateWithFormTags(e,o),this.removeMediaMarkupRemnants(o)},createInitialHtml:function(e,t){var n;return e.html(t),n=e.html(),{html:n,temp:e}},updateWithSSLinks:function(e,t){return e.find("*[data-t4-ss-link-id]").each(function(e,n){t=t.replace(n.outerHTML,this.getSSLinkInfo(n))}.bind(this)),t},getSSLinkInfo:function(e){var t=n(e),i,s,o;if(!e)throw"expected a tag";return s=t.data(),i=r.escape(t.text()),t.find('[data-t4-type="media"]').length&&(i=this.getNestedImageTag(t)),o=this.createT4Tag(s,i,t),o},getNestedImageTag:function(e){var t,n,i;t=e.find("img").data();if(r.isObject(t.t4MediaAttributes))n=t.t4MediaAttributes;else{if(!r.isString(t.t4MediaAttributes))throw"Unexpected attribute format";n=JSON.parse(r.unescape(t.t4MediaAttributes))}return e.find("img").attr("style")&&(i=this.createStylesObject(e.find("img").attr("style"))),r.isObject(i)&&!r.isEmpty(i)&&r.extend(n.attributes,i),t.t4MediaAttributes=r.escape(JSON.stringify(n)),r.escape(this.createT4Tag(t))},updateWithMediaLinks:function(e,t){if(r.isUndefined(e)||r.isUndefined(t))throw"expected arguments not supplied";return e.find("*[data-t4-media-id]").each(function(e,i){var s=n(i).attr("style"),o=n(i).data();r.isObject(o.t4MediaAttributes)?o.t4MediaAttributes.attributes=this.extendStyles(s,o):o.t4MediaAttributes&&o.t4MediaAttributes.indexOf("attributes")>-1&&(o.t4MediaAttributes=this.updateEscapedAmpersands(o.t4MediaAttributes),o.t4MediaAttributes=JSON.parse(r.unescape(o.t4MediaAttributes)),o.t4MediaAttributes.attributes=this.extendStyles(s,o)),t=t.replace(i.outerHTML,this.createT4Tag(o))}.bind(this)),t},getFormTag:function(e,t){return'<t4 type="form" name="'+t+'" id="'+e+'" />'},updateWithFormTags:function(e,t){if(t.indexOf("t4-form-de-placeholder")>-1){var n=e.find(".t4-form-de-placeholder"),r=n.data("id"),i=n.data("form-name");e.find(".t4-form-de-placeholder").each(function(e,n){t=t.replace(n.outerHTML,this.getFormTag(r,i))}.bind(this))}return t},createT4Tag:function(e,t,n){var i="",s;if(r.isUndefined(e)||!r.isObject(e))throw"expected an object argument";return n&&(i=this.getAttributesString(n[0])),t=t||"",s=e.t4Type==="sslink"?' sslinkText="'+t+'"':"","<t4 "+this.setId(e)+this.setMediaAttributes(e)+' type="'+e.t4Type+'" '+this.setMediaFormatter(e)+s+i+" />"},getAttributesFromNode:function(e){return r.reduce(e.attributes,function(e,t){return e[t.name]=t.value,e},{})},getAttributesString:function(e){var t,i,s,o;if(!e)throw"expected link element";return t=this.getAttributesFromNode(e),i=r.keys(t),s=r.map(i,function(e){var r=e,i=t[e];if(r==="href"||r==="data-t4-type"||r==="data-t4-ss-link-id")return;r==="class"&&(i=i.replace("t4-tag-content-item",""));if(n.trim(i))return'"'+r+'" : "'+i+'"'}),s=r.compact(s),o='{"attributes": {'+s.join(", ")+"}}",' ssLinkAttributes="'+r.escape(o)+'" '},extendStyles:function(e,t){var n=this.createStylesObject(e);return r.isEmpty(n)?t.t4MediaAttributes.attributes:r.extend(t.t4MediaAttributes.attributes||{},n)},createStylesObject:function(e){var t={},i;return e&&(i=e.split(";")),r.each(i,function(e){var r;e=n.trim(e);if(e!==""){r=e.split(":");if(r[0]==="width"||r[0]==="height")r[1]=r[1].replace("px","");t[n.trim(r[0])]=n.trim(r[1])}}),t},removeMediaMarkupRemnants:function(e){var t=n("<div/>").html(e);return(new i).removeAllRemnants(t),t.html()},removeTemporaryTags:function(e){(new i).removeAllRemnants(e)},getKey:function(e){return e.name+"#"+e.id+":"+e.type.id}}}),define("module/content/types/model/sectionContentLink",["backbone","helper/language","helper/utils"],function(e,t,n){var r=e.SERVICE_BASE_URL+"/ssl",i=" &raquo; ";return e.Model.extend({url:function(){return[r,this.id,this.language,this.sectionId,this.contentId].join("/")},clear:function(){return this.language=null,this.sectionId=null,this.contentId=null,this.constructor.__super__.clear.apply(this,arguments)},getT4Link:function(){var e=this.get("id");return e?'<t4 sslink_id="'+e+'" type="sslink" />':""},isT4Image:function(e){return e=n.removeSpecialCharacters(e),e.indexOf("img")>=0?$(e).data("t4-type")==="media"?!0:!1:!1},toT4MediaElement:function(e){if(!this.isT4Image(e))return"";var t=$(e).data("t4-media-attributes")||{attributes:{}};return'<t4 id="'+$(e).data("t4-media-id")+'" mediaattributes="'+_.escape(JSON.stringify(t))+'" type="media" />'},getHtml:function(e){var t,n,r,i,s,o="";return t=this.get("attributes"),n=this.getAttributes(t),r=this.getStringAttrs(n),i=n&&n.title?"":' title="'+this.get("path")+'" ',n.class&&(o=n.class),s=e||this.get("linkText"),'<a class="t4-tag-content-item '+o+'" data-t4-type="sslink" href="#" data-t4-ss-link-id="'+this.id+'" '+i+r+">"+s+"</a>"},getStringAttrs:function(e){if(_.isEmpty(e))return"";var t="";return _.each(_.keys(e),function(n){if(n==="class")return;t+=" "+n+'="'+e[n]+'"'}),t},getAttributes:function(e){var t,n;if(e&&_.isString(e))return t=/"attributes":/ig,n=/&quot;attributes&quot;/ig,n.test(e)&&(e=_.unescape(e)),t.test(e)||(e=e.replace("attributes",'"attributes"')),e=JSON.parse(e),e.attributes;if(_.isObject(e)&&!_.isArray(e))return e.attributes?e.attributes:e;if(e)throw"unexpected formatting"},fetchLink:function(e,t){if(this.id<0)return;return t=t||{},this.sectionId=e,this.contentId=t.id,this.language=t.language,this.fetch()},getDefaultLinkText:function(){return(this.get("path")||"").split(i).pop()},saveNew:function(e,t,n,i){return this.setValues(e,t,n,i,!0),this.save(this.toJSON(),{method:"PUT",url:r})},setValues:function(e,n,r,s,o){var u=e?e.path:[];s&&u.push(s),this.set({fromSection:n,toSection:e.section.id,fromContent:r.id,toContent:e.content||e.content.id>0?e.content.id:null,linkText:s?s:"",language:t.getCurrentLanguage(),toLanguage:e.section.lang||e.content.lang,attributes:null,useDefaultLinkText:s?!1:!0,path:u.join(i),active:o})},update:function(){var e=r+"/"+this.id;return this.save(this.toJSON(),{method:"PUT",url:e})},defaults:{useDefaultLinkText:!0}})}),define("helper/htmleditor",["module/content/types/model/sectionContentLink"],function(e){return{removeHtml:function(e){e=e||"";var t=new RegExp(/[A-Za-z0-9-_]+=("|')(.*?)("|')/gi),n=new RegExp(/\s+(\/?)>/g),r=new RegExp(/<(\/?)a>/gi);return e.replace(t,"").replace(n,"$1>").replace(r,"")},createLink:function(t,n,r,i){var s=this,o=t.selection.getContent(),u,a;a=new e,a.isT4Image(o)?u=a.toT4MediaElement(o):o!==""&&(u=this.removeHtml(o)),a.once("sync:create",function(e){s.buildLink(t,e)}),a.saveNew(n.toJSON(),r,i,u,!0)},buildLink:function(e,t){var n=t.get("path")||"",r=e.selection.getContent(),i=r===""?t.get("linkText"):r;window.setTimeout(function(){e.selection.setContent(t.getHtml(i))},0)},isTinyMceEnabled:function(){var e=localStorage.getItem("userHtmlEditorId");return e==="2"?!1:!0}}}),define("hbars!module/common/content/template/tabs/elements",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){var i,s;return"  "+((i=(s=(s=t.showLoading||(e!=null?e.showLoading:e))!=null?s:t.helperMissing,typeof s==="function"?s.call(e,{name:"showLoading",hash:{},data:r}):s))!=null?i:"")+"\n"},3:function(e,t,n,r){var i;return((i=t.unless.call(e,e!=null?e.hideTitle:e,{name:"unless",hash:{},fn:this.program(4,r,0),inverse:this.noop,data:r}))!=null?i:"")+'  <div id="edit-content-fields"></div>\n'},4:function(e,t,n,r){return'    <div class="row">\n      <div class="col-sm-10">\n        <h3 class="lighter block green">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"content:edit.content.title",{name:"t",hash:{},data:r}))+this.escapeExpression((t.whichName||e&&e.whichName||t.helperMissing).call(e,e!=null?e.contentType:e,{name:"whichName",hash:{},data:r}))+"</h3>\n      </div>\n    </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i;return(i=t["if"].call(e,e!=null?e.isLoading:e,{name:"if",hash:{},fn:this.program(1,r,0),inverse:this.program(3,r,0),data:r}))!=null?i:""},useData:!0})}),define("module/common/content/view/tabs/elements",["backbone","underscore","jquery","helper/directEdit","helper/htmleditor","helper/configurationHelper","hbars!module/common/content/template/tabs/elements","tinymce"],function(e,t,n,r,i,s,o,u){var a=[{name:"content.enableSpellCheck"}];return e.View.extend({id:"content_view_tabs_elements",template:o,initialize:function(e){this.instances=[],this.dependencies=[],this.options=e||{},this.isEdit=this.options.isEdit,this.sectionId=this.options.sectionId,this.contentId=this.options.contentId,this.hideTitle=!!this.options.hideTitle,this.readOnly=this.options.readOnly,this.inherited=this.options.inherited,this.allowedGroups=this.options.allowedGroups,this.shouldNotValidate=this.options.shouldNotValidate||!1,this.excludeName=!!this.options.excludeName,this.elements=this.model.getElements(this.contentType,this.types)||[],s.fetch(a).done(function(){this.applyConfiguration()}.bind(this))},beforeRender:function(){this.setElementViews()},serialize:function(){return{isLoading:this.isLoading,hideTitle:this.hideTitle,contentType:this.model.get("contentType")||{}}},afterRender:function(){this.loadToolTips(),this.readOnly&&this.setReadOnly()},reset:function(){this.isLoading=!0,this.instances=[],this.dependencies=[],this.render()},refresh:function(){this.instances=t.clone(arguments),this.isLoading=!1,this.render()},fetchViews:function(){var e;t.each(this.elements,function(t){e=this.toCamelCase(t.type.name),this.dependencies.push("module/content/types/view/"+e)},this),require(this.dependencies,this.refresh.bind(this))},setElementViews:function(){var e=this,n=this.model.toJSON(),r,i;t.each(this.instances,function(t,s){r=e.elements[s];if(r.name==="Name"&&!!e.options.excludeName)return;i=new t({id:"t4view_"+r.identifier,moduleName:e.moduleName,model:r,content:n,sectionId:e.sectionId,readOnly:e.readOnly,inherited:e.inherited,allowedGroups:e.allowedGroups,spellCheck:e.spellCheck,context:e.context,shouldNotValidate:e.shouldNotValidate}),e.insertView("#edit-content-fields",i)})},getDates:function(){var e=this.$el.find(".date-picker"),t,r,i,s={};return e.each(function(){t=n(this).data("DateTimePicker"),t&&(r=t.date(),r&&(i=r.toDate().getTime()),s[this.name]=n(this).val()!==""?i:null)}),s},getParsedTinyMce:function(){var e=this.$("textarea.tinymce"),s=n("<t4temp />"),o=this,a,f,l,c,h,p,d,v={},m,g;return l=function(e){return!e.t4MediaId&&!e.t4SsLinkId?"":e.t4MediaId?' id="'+e.t4MediaId+'" ':' sslink_id="'+e.t4SsLinkId+'" '},a=function(e){var n;return!e.t4MediaAttributes||t.isEmpty(e.t4MediaAttributes)?"":(n=t.escape(t.isString(e.t4MediaAttributes)?e.t4MediaAttributes:JSON.stringify(e.t4MediaAttributes)),n=n.replace(/(&amp;quot;)/g,"&quot;"),'mediaattributes="'+n+'"')},f=function(e){return!e.t4MediaFormatter||t.isEmpty(e.t4MediaFormatter)?"":'formatter="'+e.t4MediaFormatter+'"'},e.each(function(){d=n(this),i.isTinyMceEnabled()?(m=u.get(d[0].id),g=m.getContent({format:"html"})):g=d.val(),s.html(g),s.html(r.replaceLayoutWithT4Tags(s,g,l,a,f)),r.removeTemporaryTags(s),c=s.html(),c=c.replace(/><\/t4>/gi,"/>"),v[this.name]=c}),v},getFormData:function(){var e=this.$el,r=e.find("textarea, select, input[type=number], input[type=text]").not(".date-picker, .tinymce"),i=this.getParsedTinyMce(),s=this.getDates(),o=e.find(".file-upload-element"),u=e.find(":checkbox:checked").serializeArray(),a={},f,l;return f=function(e){return/content-[0-9]*-[0-9]*/.test(e)},l=function(e){return!f(e.name)},r.each(function(e,t){f(t.name)&&(a[t.name]=n(t).val())}),t.each(o,function(e){var t=n(e).attr("name");f(t)&&(a[t]={existingFile:n(e).attr("data-existingFile")==="true",code:n(e).attr("data-code"),preferredFilename:n(e).attr("data-preferredFilename")})},this),u=t.reject(u,l),t.extend(a,t.groupBy(u,"name")),t.extend(a,s),t.extend(a,i),a},toCamelCase:function(e){return e.toLowerCase().replace(/(\s|-|\/|\\|_)(.)/g,function(e,t,n){return n.toUpperCase()})},setReadOnly:function(){this.$("button, input, textarea, select").prop("disabled",!0)},applyConfiguration:function(){this.spellCheck=s.getParamValue(a,"content.enableSpellCheck")==="true",this.fetchViews()}})}),define("hbars!module/common/media/template/edit/general",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){return'  <div class="form-group">\n    <label for="media-file" class="col-sm-3 control-label">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.general.label.preview",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-xs-12 col-sm-8">\n      <div class="media-preview"></div>\n    </div>\n  </div>\n'},3:function(e,t,n,r){var i,s;return(i=(s=(s=t.required||(e!=null?e.required:e))!=null?s:t.helperMissing,typeof s==="function"?s.call(e,{name:"required",hash:{},data:r}):s))!=null?i:""},5:function(e,t,n,r){return' disabled="disabled" '},7:function(e,t,n,r){var i;return'      <option value="'+this.escapeExpression(this.lambda(e!=null?e.id:e,e))+'" '+this.escapeExpression((t.selected||e&&e.selected||t.helperMissing).call(e,e!=null?e.id:e,(i=(i=r&&r.root)&&i.model)&&i.type,{name:"selected",hash:{},data:r}))+">"+this.escapeExpression(this.lambda(e!=null?e.name:e,e))+"</option>\n"},9:function(e,t,n,r){var i;return'      <option value="'+this.escapeExpression(this.lambda(e!=null?e.id:e,e))+'" '+this.escapeExpression((t.selected||e&&e.selected||t.helperMissing).call(e,e!=null?e.id:e,(i=(i=r&&r.root)&&i.model)&&i.syntax,{name:"selected",hash:{},data:r}))+">"+((i=this.lambda(e!=null?e.name:e,e))!=null?i:"")+"</option>\n"},11:function(e,t,n,r){var i;return'<div class="form-group">\n  <label class="control-label col-sm-3">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.general.label.media_language_dependence",{name:"t",hash:{},data:r}))+'</label>\n  <div class="col-sm-9">\n    <div class="radio">\n      <label>\n        <input name="dependency" type="radio" class="ace" checked="" value="smxx||smxx">\n        <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.general.label.fully_independent",{name:"t",hash:{},data:r}))+'</span>\n      </label>\n    </div>\n    <div class="radio">\n      <label>\n        <input name="dependency" type="radio" class="ace" value="smxx||'+this.escapeExpression((i=(i=t.contentLanguage||(e!=null?e.contentLanguage:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"contentLanguage",hash:{},data:r}):i))+'">\n        <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.general.label.independent_media_file",{name:"t",hash:{},data:r}))+'</span>\n      </label>\n    </div>\n    <div class="radio">\n      <label>\n        <input name="dependency" type="radio" class="ace" value="'+this.escapeExpression((i=(i=t.contentLanguage||(e!=null?e.contentLanguage:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"contentLanguage",hash:{},data:r}):i))+"||"+this.escapeExpression((i=(i=t.contentLanguage||(e!=null?e.contentLanguage:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"contentLanguage",hash:{},data:r}):i))+'">\n        <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.general.label.fully_dependent",{name:"t",hash:{},data:r}))+"</span>\n      </label>\n    </div>\n  </div>\n</div>\n"},13:function(e,t,n,r){var i;return'  <div class="form-group">\n    <label class="control-label col-sm-3">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.general.label.media_language_dependence",{name:"t",hash:{},data:r}))+'</label>\n    <div class="col-sm-4">\n    '+this.escapeExpression((i=(i=t.dependency||(e!=null?e.dependency:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"dependency",hash:{},data:r}):i))+"\n    </div>\n  </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i,s,o,u='<h3 class="green lighter">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.general.media_details",{name:"t",hash:{},data:r}))+'</h3>\n<form class="form-horizontal">\n\n';return i=(s=(s=t.inEdit||(e!=null?e.inEdit:e))!=null?s:t.helperMissing,o={name:"inEdit",hash:{},fn:this.program(1,r,0),inverse:this.noop,data:r},typeof s=="function"?s.call(e,o):s),t.inEdit||(i=t.blockHelperMissing.call(e,i,o)),i!=null&&(u+=i),u+='\n<div class="form-group">\n  <label for="media-file" class="col-sm-3 control-label">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.general.label.media_file",{name:"t",hash:{},data:r}))+" ("+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.general.maxSize.max",{name:"t",hash:{},data:r}))+": "+this.escapeExpression((s=(s=t.maxUpload||(e!=null?e.maxUpload:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"maxUpload",hash:{},data:r}):s))+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.general.maxSize.kilobytes",{name:"t",hash:{},data:r}))+") ",i=(s=(s=t.inAdd||(e!=null?e.inAdd:e))!=null?s:t.helperMissing,o={name:"inAdd",hash:{},fn:this.program(3,r,0),inverse:this.noop,data:r},typeof s=="function"?s.call(e,o):s),t.inAdd||(i=t.blockHelperMissing.call(e,i,o)),i!=null&&(u+=i),u+='</label>\n  <div class="col-xs-12 col-sm-4">\n    <div id="media-file" class="dropzone"></div>\n  </div>\n</div>\n\n<div class="form-group">\n  <label class="col-sm-3 control-label" for="media-type">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.general.label.media_type",{name:"t",hash:{},data:r}))+'</label>\n  <div class="col-xs-12 col-sm-4">\n    <select name="media-type" class="width-100"  ',i=(s=(s=t.readOnlyView||(e!=null?e.readOnlyView:e))!=null?s:t.helperMissing,o={name:"readOnlyView",hash:{},fn:this.program(5,r,0),inverse:this.noop,data:r},typeof s=="function"?s.call(e,o):s),t.readOnlyView||(i=t.blockHelperMissing.call(e,i,o)),i!=null&&(u+=i),u+=' id="media-type" title="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.general.tooltip.media_type",{name:"t",hash:{},data:r}))+'" data-placement="top">\n'+((i=t.each.call(e,e!=null?e.mediaTypes:e,{name:"each",hash:{},fn:this.program(7,r,0),inverse:this.noop,data:r}))!=null?i:"")+'    </select>\n  </div>\n</div>\n\n<div class="form-group">\n  <label for="media-name" class="col-sm-3 control-label">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.general.label.media_name",{name:"t",hash:{},data:r}))+" "+((i=(s=(s=t.required||(e!=null?e.required:e))!=null?s:t.helperMissing,typeof s==="function"?s.call(e,{name:"required",hash:{},data:r}):s))!=null?i:"")+'</label>\n  <div class="col-xs-12 col-sm-4">\n      <span class="block">\n        <input type="text" id="media-name" maxlength ="'+this.escapeExpression(this.lambda((i=e!=null?e.maxSizeDetails:e)!=null?i.name:i,e))+'"  name="media-name" class="width-100 has-character-limit" ',i=(s=(s=t.readOnlyView||(e!=null?e.readOnlyView:e))!=null?s:t.helperMissing,o={name:"readOnlyView",hash:{},fn:this.program(5,r,0),inverse:this.noop,data:r},typeof s=="function"?s.call(e,o):s),t.readOnlyView||(i=t.blockHelperMissing.call(e,i,o)),i!=null&&(u+=i),u+=' value="'+this.escapeExpression((t.decode||e&&e.decode||t.helperMissing).call(e,(i=e!=null?e.model:e)!=null?i.name:i,{name:"decode",hash:{},data:r}))+'">\n      </span>\n  </div>\n</div>\n\n<div class="form-group">\n  <label for="media-description" class="col-sm-3 control-label">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.general.label.media_description",{name:"t",hash:{},data:r}))+'</label>\n  <div class="col-xs-12 col-sm-4">\n      <span class="block">\n        <input type="text" id="media-description" name="media-description" ',i=(s=(s=t.readOnlyView||(e!=null?e.readOnlyView:e))!=null?s:t.helperMissing,o={name:"readOnlyView",hash:{},fn:this.program(5,r,0),inverse:this.noop,data:r},typeof s=="function"?s.call(e,o):s),t.readOnlyView||(i=t.blockHelperMissing.call(e,i,o)),i!=null&&(u+=i),u+=' placeholder="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.general.tooltip.media_description",{name:"t",hash:{},data:r}))+'" class="width-100" value="'+this.escapeExpression((t.decode||e&&e.decode||t.helperMissing).call(e,(i=e!=null?e.model:e)!=null?i.description:i,{name:"decode",hash:{},data:r}))+'" maxlength ="'+this.escapeExpression(this.lambda((i=e!=null?e.maxSizeDetails:e)!=null?i.description:i,e))+'">\n      </span>\n  </div>\n</div>\n\n<div class="form-group">\n  <label class="col-sm-3 control-label" for="syntax-highting-language">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.general.label.syntax_highlighting_language",{name:"t",hash:{},data:r}))+'</label>\n  <div class="col-xs-12 col-sm-4">\n    <select name="syntax-highting-language" class="width-100" id="syntax-highting-language" ',i=(s=(s=t.readOnlyView||(e!=null?e.readOnlyView:e))!=null?s:t.helperMissing,o={name:"readOnlyView",hash:{},fn:this.program(5,r,0),inverse:this.noop,data:r},typeof s=="function"?s.call(e,o):s),t.readOnlyView||(i=t.blockHelperMissing.call(e,i,o)),i!=null&&(u+=i),u+=' title="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.general.tooltip.syntax_highlighting_language",{name:"t",hash:{},data:r}))+'" data-placement="top">\n'+((i=t.each.call(e,e!=null?e.syntaxTypes:e,{name:"each",hash:{},fn:this.program(9,r,0),inverse:this.noop,data:r}))!=null?i:"")+"    </select>\n  </div>\n</div>\n\n",i=(s=(s=t.inAdd||(e!=null?e.inAdd:e))!=null?s:t.helperMissing,o={name:"inAdd",hash:{},fn:this.program(11,r,0),inverse:this.noop,data:r},typeof s=="function"?s.call(e,o):s),t.inAdd||(i=t.blockHelperMissing.call(e,i,o)),i!=null&&(u+=i),i=(s=(s=t.inEdit||(e!=null?e.inEdit:e))!=null?s:t.helperMissing,o={name:"inEdit",hash:{},fn:this.program(13,r,0),inverse:this.noop,data:r},typeof s=="function"?s.call(e,o):s),t.inEdit||(i=t.blockHelperMissing.call(e,i,o)),i!=null&&(u+=i),u+'\n<hr>\n\n<h3 class="green lighter meta-data-title">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.general.label.media_language_dependence",{name:"t",hash:{},data:r}))+'</h3>\n  <div class="element-view"></div>\n</form>'},useData:!0})}),function(e){typeof define=="function"&&define.amd?define("jquery.iframe-transport",["jquery"],e):typeof exports=="object"?e(require("jquery")):e(window.jQuery)}(function(e){var t=0;e.ajaxTransport("iframe",function(n){if(n.async){var r=n.initialIframeSrc||"javascript:false;",i,s,o;return{send:function(u,a){i=e('<form style="display:none;"></form>'),i.attr("accept-charset",n.formAcceptCharset),o=/\?/.test(n.url)?"&":"?",n.type==="DELETE"?(n.url=n.url+o+"_method=DELETE",n.type="POST"):n.type==="PUT"?(n.url=n.url+o+"_method=PUT",n.type="POST"):n.type==="PATCH"&&(n.url=n.url+o+"_method=PATCH",n.type="POST"),t+=1,s=e('<iframe src="'+r+'" name="iframe-transport-'+t+'"></iframe>').bind("load",function(){var t,o=e.isArray(n.paramName)?n.paramName:[n.paramName];s.unbind("load").bind("load",function(){var t;try{t=s.contents();if(!t.length||!t[0].firstChild)throw new Error}catch(n){t=undefined}a(200,"success",{iframe:t}),e('<iframe src="'+r+'"></iframe>').appendTo(i),window.setTimeout(function(){i.remove()},0)}),i.prop("target",s.prop("name")).prop("action",n.url).prop("method",n.type),n.formData&&e.each(n.formData,function(t,n){e('<input type="hidden"/>').prop("name",n.name).val(n.value).appendTo(i)}),n.fileInput&&n.fileInput.length&&n.type==="POST"&&(t=n.fileInput.clone(),n.fileInput.after(function(e){return t[e]}),n.paramName&&n.fileInput.each(function(t){e(this).prop("name",o[t]||n.paramName)}),i.append(n.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),n.fileInput.removeAttr("form")),i.submit(),t&&t.length&&n.fileInput.each(function(n,r){var i=e(t[n]);e(r).prop("name",i.prop("name")).attr("form",i.attr("form")),i.replaceWith(r)})}),i.append(s).appendTo(document.body)},abort:function(){s&&s.unbind("load").prop("src",r),i&&i.remove()}}}}),e.ajaxSetup({converters:{"iframe text":function(t){return t&&e(t[0].body).text()},"iframe json":function(t){return t&&e.parseJSON(e(t[0].body).text())},"iframe html":function(t){return t&&e(t[0].body).html()},"iframe xml":function(t){var n=t&&t[0];return n&&e.isXMLDoc(n)?n:e.parseXML(n.XMLDocument&&n.XMLDocument.xml||e(n.body).html())},"iframe script":function(t){return t&&e.globalEval(e(t[0].body).text())}}})}),function(e){typeof define=="function"&&define.amd?define("jquery.ui.widget",["jquery"],e):typeof exports=="object"?e(require("jquery")):e(jQuery)}(function(e){var t=0,n=Array.prototype.slice;e.cleanData=function(t){return function(n){var r,i,s;for(s=0;(i=n[s])!=null;s++)try{r=e._data(i,"events"),r&&r.remove&&e(i).triggerHandler("remove")}catch(o){}t(n)}}(e.cleanData),e.widget=function(t,n,r){var i,s,o,u,a={},f=t.split(".")[0];return t=t.split(".")[1],i=f+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)},e[f]=e[f]||{},s=e[f][t],o=e[f][t]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),u=new n,u.options=e.widget.extend({},u.options),e.each(r,function(t,r){if(!e.isFunction(r)){a[t]=r;return}a[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},i=function(e){return n.prototype[t].apply(this,e)};return function(){var t=this._super,n=this._superApply,s;return this._super=e,this._superApply=i,s=r.apply(this,arguments),this._super=t,this._superApply=n,s}}()}),o.prototype=e.widget.extend(u,{widgetEventPrefix:s?u.widgetEventPrefix||t:t},a,{constructor:o,namespace:f,widgetName:t,widgetFullName:i}),s?(e.each(s._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,o,n._proto)}),delete s._childConstructors):n._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){var r=n.call(arguments,1),i=0,s=r.length,o,u;for(;i<s;i++)for(o in r[i])u=r[i][o],r[i].hasOwnProperty(o)&&u!==undefined&&(e.isPlainObject(u)?t[o]=e.isPlainObject(t[o])?e.widget.extend({},t[o],u):e.widget.extend({},u):t[o]=u);return t},e.widget.bridge=function(t,r){var i=r.prototype.widgetFullName||t;e.fn[t]=function(s){var o=typeof s=="string",u=n.call(arguments,1),a=this;return s=!o&&u.length?e.widget.extend.apply(null,[s].concat(u)):s,o?this.each(function(){var n,r=e.data(this,i);if(s==="instance")return a=r,!1;if(!r)return e.error("cannot call methods on "+t+" prior to initialization; "+"attempted to call method '"+s+"'");if(!e.isFunction(r[s])||s.charAt(0)==="_")return e.error("no such method '"+s+"' for "+t+" widget instance");n=r[s].apply(r,u);if(n!==r&&n!==undefined)return a=n&&n.jquery?a.pushStack(n.get()):n,!1}):this.each(function(){var t=e.data(this,i);t?(t.option(s||{}),t._init&&t._init()):e.data(this,i,new r(s,this))}),a}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(n,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=t++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),n),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,n){var r=t,i,s,o;if(arguments.length===0)return e.widget.extend({},this.options);if(typeof t=="string"){r={},i=t.split("."),t=i.shift();if(i.length){s=r[t]=e.widget.extend({},this.options[t]);for(o=0;o<i.length-1;o++)s[i[o]]=s[i[o]]||{},s=s[i[o]];t=i.pop();if(arguments.length===1)return s[t]===undefined?null:s[t];s[t]=n}else{if(arguments.length===1)return this.options[t]===undefined?null:this.options[t];r[t]=n}}return this._setOptions(r),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,n,r){var i,s=this;typeof t!="boolean"&&(r=n,n=t,t=!1),r?(n=i=e(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,i=this.widget()),e.each(r,function(r,o){function u(){if(!t&&(s.options.disabled===!0||e(this).hasClass("ui-state-disabled")))return;return(typeof o=="string"?s[o]:o).apply(s,arguments)}typeof o!="string"&&(u.guid=o.guid=o.guid||u.guid||e.guid++);var a=r.match(/^([\w:-]*)\s*(.*)$/),f=a[1]+s.eventNamespace,l=a[2];l?i.delegate(l,f,u):n.bind(f,u)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return(typeof e=="string"?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){typeof i=="string"&&(i={effect:i});var o,u=i?i===!0||typeof i=="number"?n:i.effect||n:t;i=i||{},typeof i=="number"&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&e.effects.effect[u]?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}});var r=e.widget}),function(e){typeof define=="function"&&define.amd?define("jquery.fileupload",["jquery","jquery.ui.widget"],e):typeof exports=="object"?e(require("jquery"),require("./vendor/jquery.ui.widget")):e(window.jQuery)}(function(e){function t(t){var n=t==="dragover";return function(r){r.dataTransfer=r.originalEvent&&r.originalEvent.dataTransfer;var i=r.dataTransfer;i&&e.inArray("Files",i.types)!==-1&&this._trigger(t,e.Event(t,{delegatedEvent:r}))!==!1&&(r.preventDefault(),n&&(i.dropEffect="copy"))}}e.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))")).test(window.navigator.userAgent)&&!e('<input type="file">').prop("disabled"),e.support.xhrFileUpload=!!window.ProgressEvent&&!!window.FileReader,e.support.xhrFormDataFileUpload=!!window.FormData,e.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:undefined,fileInput:undefined,replaceFileInput:!0,paramName:undefined,singleFileUploads:!0,limitMultiFileUploads:undefined,limitMultiFileUploadSize:undefined,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:undefined,forceIframeTransport:!1,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:!0,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,n){return t=this.messages[t]||t.toString(),n&&e.each(n,function(e,n){t=t.replace("{"+e+"}",n)}),t},formData:function(e){return e.serializeArray()},add:function(t,n){if(t.isDefaultPrevented())return!1;(n.autoUpload||n.autoUpload!==!1&&e(this).fileupload("option","autoUpload"))&&n.process().done(function(){n.submit()})},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:e.support.blobSlice&&function(){var e=this.slice||this.webkitSlice||this.mozSlice;return e.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,n){var r=e-this.timestamp;if(!this.bitrate||!n||r>n)this.bitrate=(t-this.loaded)*(1e3/r)*8,this.loaded=t,this.timestamp=e;return this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var n;return e.type(t.formData)==="function"?t.formData(t.form):e.isArray(t.formData)?t.formData:e.type(t.formData)==="object"?(n=[],e.each(t.formData,function(e,t){n.push({name:e,value:t})}),n):[]},_getTotal:function(t){var n=0;return e.each(t,function(e,t){n+=t.size||1}),n},_initProgressObject:function(t){var n={loaded:0,total:0,bitrate:0};t._progress?e.extend(t._progress,n):t._progress=n},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)e._response.hasOwnProperty(t)&&delete e._response[t];else e._response={}},_onProgress:function(t,n){if(t.lengthComputable){var r=Date.now?Date.now():(new Date).getTime(),i;if(n._time&&n.progressInterval&&r-n._time<n.progressInterval&&t.loaded!==t.total)return;n._time=r,i=Math.floor(t.loaded/t.total*(n.chunkSize||n._progress.total))+(n.uploadedBytes||0),this._progress.loaded+=i-n._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(r,this._progress.loaded,n.bitrateInterval),n._progress.loaded=n.loaded=i,n._progress.bitrate=n.bitrate=n._bitrateTimer.getBitrate(r,i,n.bitrateInterval),this._trigger("progress",e.Event("progress",{delegatedEvent:t}),n),this._trigger("progressall",e.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var n=this,r=t.xhr?t.xhr():e.ajaxSettings.xhr();r.upload&&(e(r.upload).bind("progress",function(e){var r=e.originalEvent;e.lengthComputable=r.lengthComputable,e.loaded=r.loaded,e.total=r.total,n._onProgress(e,t)}),t.xhr=function(){return r})},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_initXHRData:function(t){var n=this,r,i=t.files[0],s=t.multipart||!e.support.xhrFileUpload,o=e.type(t.paramName)==="array"?t.paramName[0]:t.paramName;t.headers=e.extend({},t.headers),t.contentRange&&(t.headers["Content-Range"]=t.contentRange);if(!s||t.blob||!this._isInstanceOf("File",i))t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(i.name)+'"';s?e.support.xhrFormDataFileUpload&&(t.postMessage?(r=this._getFormData(t),t.blob?r.push({name:o,value:t.blob}):e.each(t.files,function(n,i){r.push({name:e.type(t.paramName)==="array"&&t.paramName[n]||o,value:i})})):(n._isInstanceOf("FormData",t.formData)?r=t.formData:(r=new FormData,e.each(this._getFormData(t),function(e,t){r.append(t.name,t.value)})),t.blob?r.append(o,t.blob,i.name):e.each(t.files,function(i,s){(n._isInstanceOf("File",s)||n._isInstanceOf("Blob",s))&&r.append(e.type(t.paramName)==="array"&&t.paramName[i]||o,s,s.uploadName||s.name)})),t.data=r):(t.contentType=i.type||"application/octet-stream",t.data=t.blob||i),t.blob=null},_initIframeSettings:function(t){var n=e("<a></a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&n&&n!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(t){var n=e(t.fileInput),r=t.paramName;return r?e.isArray(r)||(r=[r]):(r=[],n.each(function(){var t=e(this),n=t.prop("name")||"files[]",i=(t.prop("files")||[1]).length;while(i)r.push(n),i-=1}),r.length||(r=[n.prop("name")||"files[]"])),r},_initFormSettings:function(t){if(!t.form||!t.form.length)t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")));t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||e.type(t.form.prop("method"))==="string"&&t.form.prop("method")||"").toUpperCase(),t.type!=="POST"&&t.type!=="PUT"&&t.type!=="PATCH"&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var n=e.extend({},this.options,t);return this._initFormSettings(n),this._initDataSettings(n),n},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,n,r){var i=e.Deferred(),s=i.promise();return n=n||this.options.context||s,t===!0?i.resolveWith(n,r):t===!1&&i.rejectWith(n,r),s.abort=i.promise,this._enhancePromise(s)},_addConvenienceMethods:function(t,n){var r=this,i=function(t){return e.Deferred().resolveWith(r,t).promise()};n.process=function(t,s){if(t||s)n._processQueue=this._processQueue=(this._processQueue||i([this])).pipe(function(){return n.errorThrown?e.Deferred().rejectWith(r,[n]).promise():i(arguments)}).pipe(t,s);return this._processQueue||i([this])},n.submit=function(){return this.state()!=="pending"&&(n.jqXHR=this.jqXHR=r._trigger("submit",e.Event("submit",{delegatedEvent:t}),this)!==!1&&r._onSend(t,this)),this.jqXHR||r._getXHRPromise()},n.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",r._trigger("fail",null,this),r._getXHRPromise(!1))},n.state=function(){if(this.jqXHR)return r._getDeferredState(this.jqXHR);if(this._processQueue)return r._getDeferredState(this._processQueue)},n.processing=function(){return!this.jqXHR&&this._processQueue&&r._getDeferredState(this._processQueue)==="pending"},n.progress=function(){return this._progress},n.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),n=t&&t.split("-"),r=n&&n.length>1&&parseInt(n[1],10);return r&&r+1},_chunkedUpload:function(t,n){t.uploadedBytes=t.uploadedBytes||0;var r=this,i=t.files[0],s=i.size,o=t.uploadedBytes,u=t.maxChunkSize||s,a=this._blobSlice,f=e.Deferred(),l=f.promise(),c,h;return!(this._isXHRUpload(t)&&a&&(o||u<s))||t.data?!1:n?!0:o>=s?(i.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",i.error])):(h=function(){var n=e.extend({},t),l=n._progress.loaded;n.blob=a.call(i,o,o+u,i.type),n.chunkSize=n.blob.size,n.contentRange="bytes "+o+"-"+(o+n.chunkSize-1)+"/"+s,r._initXHRData(n),r._initProgressListener(n),c=(r._trigger("chunksend",null,n)!==!1&&e.ajax(n)||r._getXHRPromise(!1,n.context)).done(function(i,u,a){o=r._getUploadedBytes(a)||o+n.chunkSize,l+n.chunkSize-n._progress.loaded&&r._onProgress(e.Event("progress",{lengthComputable:!0,loaded:o-n.uploadedBytes,total:o-n.uploadedBytes}),n),t.uploadedBytes=n.uploadedBytes=o,n.result=i,n.textStatus=u,n.jqXHR=a,r._trigger("chunkdone",null,n),r._trigger("chunkalways",null,n),o<s?h():f.resolveWith(n.context,[i,u,a])}).fail(function(e,t,i){n.jqXHR=e,n.textStatus=t,n.errorThrown=i,r._trigger("chunkfail",null,n),r._trigger("chunkalways",null,n),f.rejectWith(n.context,[e,t,i])})},this._enhancePromise(l),l.abort=function(){return c.abort()},h(),l)},_beforeSend:function(e,t){this._active===0&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(t,n,r,i){var s=i._progress.total,o=i._response;i._progress.loaded<s&&this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:s,total:s}),i),o.result=i.result=t,o.textStatus=i.textStatus=n,o.jqXHR=i.jqXHR=r,this._trigger("done",null,i)},_onFail:function(e,t,n,r){var i=r._response;r.recalculateProgress&&(this._progress.loaded-=r._progress.loaded,this._progress.total-=r._progress.total),i.jqXHR=r.jqXHR=e,i.textStatus=r.textStatus=t,i.errorThrown=r.errorThrown=n,this._trigger("fail",null,r)},_onAlways:function(e,t,n,r){this._trigger("always",null,r)},_onSend:function(t,n){n.submit||this._addConvenienceMethods(t,n);var r=this,i,s,o,u,a=r._getAJAXSettings(n),f=function(){return r._sending+=1,a._bitrateTimer=new r._BitrateTimer,i=i||((s||r._trigger("send",e.Event("send",{delegatedEvent:t}),a)===!1)&&r._getXHRPromise(!1,a.context,s)||r._chunkedUpload(a)||e.ajax(a)).done(function(e,t,n){r._onDone(e,t,n,a)}).fail(function(e,t,n){r._onFail(e,t,n,a)}).always(function(e,t,n){r._onAlways(e,t,n,a),r._sending-=1,r._active-=1;if(a.limitConcurrentUploads&&a.limitConcurrentUploads>r._sending){var i=r._slots.shift();while(i){if(r._getDeferredState(i)==="pending"){i.resolve();break}i=r._slots.shift()}}r._active===0&&r._trigger("stop")}),i};return this._beforeSend(t,a),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(o=e.Deferred(),this._slots.push(o),u=o.pipe(f)):(this._sequence=this._sequence.pipe(f,f),u=this._sequence),u.abort=function(){return s=[undefined,"abort","abort"],i?i.abort():(o&&o.rejectWith(a.context,s),f())},this._enhancePromise(u)):f()},_onAdd:function(t,n){var r=this,i=!0,s=e.extend({},this.options,n),o=n.files,u=o.length,a=s.limitMultiFileUploads,f=s.limitMultiFileUploadSize,l=s.limitMultiFileUploadSizeOverhead,c=0,h=this._getParamName(s),p,d,v,m,g=0;f&&(!u||o[0].size===undefined)&&(f=undefined);if(!(s.singleFileUploads||a||f)||!this._isXHRUpload(s))v=[o],p=[h];else if(!s.singleFileUploads&&!f&&a){v=[],p=[];for(m=0;m<u;m+=a)v.push(o.slice(m,m+a)),d=h.slice(m,m+a),d.length||(d=h),p.push(d)}else if(!s.singleFileUploads&&f){v=[],p=[];for(m=0;m<u;m+=1){c+=o[m].size+l;if(m+1===u||c+o[m+1].size+l>f||a&&m+1-g>=a)v.push(o.slice(g,m+1)),d=h.slice(g,m+1),d.length||(d=h),p.push(d),g=m+1,c=0}}else p=h;return n.originalFiles=o,e.each(v||o,function(s,o){var u=e.extend({},n);return u.files=v?o:[o],u.paramName=p[s],r._initResponseObject(u),r._initProgressObject(u),r._addConvenienceMethods(t,u),i=r._trigger("add",e.Event("add",{delegatedEvent:t}),u),i}),i},_replaceFileInput:function(t){var n=t.fileInput,r=n.clone(!0);t.fileInputClone=r,e("<form></form>").append(r)[0].reset(),n.after(r).detach(),e.cleanData(n.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,t){return t===n[0]?r[0]:t}),n[0]===this.element[0]&&(this.element=r)},_handleFileTreeEntry:function(t,n){var r=this,i=e.Deferred(),s=function(e){e&&!e.entry&&(e.entry=t),i.resolve([e])},o=function(e){r._handleFileTreeEntries(e,n+t.name+"/").done(function(e){i.resolve(e)}).fail(s)},u=function(){a.readEntries(function(e){e.length?(f=f.concat(e),u()):o(f)},s)},a,f=[];return n=n||"",t.isFile?t._file?(t._file.relativePath=n,i.resolve(t._file)):t.file(function(e){e.relativePath=n,i.resolve(e)},s):t.isDirectory?(a=t.createReader(),u()):i.resolve([]),i.promise()},_handleFileTreeEntries:function(t,n){var r=this;return e.when.apply(e,e.map(t,function(e){return r._handleFileTreeEntry(e,n)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var n=t.items;return n&&n.length&&(n[0].webkitGetAsEntry||n[0].getAsEntry)?this._handleFileTreeEntries(e.map(n,function(e){var t;return e.webkitGetAsEntry?(t=e.webkitGetAsEntry(),t&&(t._file=e.getAsFile()),t):e.getAsEntry()})):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var n=t.prop("webkitEntries")||t.prop("entries"),r,i;if(n&&n.length)return this._handleFileTreeEntries(n);r=e.makeArray(t.prop("files"));if(!r.length){i=t.prop("value");if(!i)return e.Deferred().resolve([]).promise();r=[{name:i.replace(/^.*\\/,"")}]}else r[0].name===undefined&&r[0].fileName&&e.each(r,function(e,t){t.name=t.fileName,t.size=t.fileSize});return e.Deferred().resolve(r).promise()},_getFileInputFiles:function(t){return t instanceof e&&t.length!==1?e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(t)},_onChange:function(t){var n=this,r={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(r.fileInput).always(function(i){r.files=i,n.options.replaceFileInput&&n._replaceFileInput(r),n._trigger("change",e.Event("change",{delegatedEvent:t}),r)!==!1&&n._onAdd(t,r)})},_onPaste:function(t){var n=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,r={files:[]};n&&n.length&&(e.each(n,function(e,t){var n=t.getAsFile&&t.getAsFile();n&&r.files.push(n)}),this._trigger("paste",e.Event("paste",{delegatedEvent:t}),r)!==!1&&this._onAdd(t,r))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var n=this,r=t.dataTransfer,i={};r&&r.files&&r.files.length&&(t.preventDefault(),this._getDroppedFiles(r).always(function(r){i.files=r,n._trigger("drop",e.Event("drop",{delegatedEvent:t}),i)!==!1&&n._onAdd(t,i)}))},_onDragOver:t("dragover"),_onDragEnter:t("dragenter"),_onDragLeave:t("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),e.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(t,n){var r=e.inArray(t,this._specialOptions)!==-1;r&&this._destroyEventHandlers(),this._super(t,n),r&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;t.fileInput===undefined?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_getRegExp:function(e){var t=e.split("/"),n=t.pop();return t.shift(),new RegExp(t.join("/"),n)},_isRegExpOption:function(t,n){return t!=="url"&&e.type(n)==="string"&&/^\/.*\/[igm]{0,3}$/.test(n)},_initDataAttributes:function(){var t=this,n=this.options,r=this.element.data();e.each(this.element[0].attributes,function(e,i){var s=i.name.toLowerCase(),o;/^data-/.test(s)&&(s=s.slice(5).replace(/-[a-z]/g,function(e){return e.charAt(1).toUpperCase()}),o=r[s],t._isRegExpOption(s,o)&&(o=t._getRegExp(o)),n[s]=o)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var n=this;if(!t||this.options.disabled)return;t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,n._onAdd(null,t)}):(t.files=e.makeArray(t.files),this._onAdd(null,t))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var n=this,r=e.Deferred(),i=r.promise(),s,o;return i.abort=function(){return o=!0,s?s.abort():(r.reject(null,"abort","abort"),i)},this._getFileInputFiles(t.fileInput).always(function(e){if(o)return;if(!e.length){r.reject();return}t.files=e,s=n._onSend(null,t),s.then(function(e,t,n){r.resolve(e,t,n)},function(e,t,n){r.reject(e,t,n)})}),this._enhancePromise(i)}t.files=e.makeArray(t.files);if(t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})}),function(e){e.fn.inputlimiter=function(t){var n=e.extend({},e.fn.inputlimiter.defaults,t),r=e(this);n.boxAttach&&!e("#"+n.boxId).length&&(e("<div/>").appendTo("body").attr({id:n.boxId,"class":n.boxClass}).css({position:"absolute"}).hide(),e.fn.bgiframe&&e("#"+n.boxId).bgiframe());var i=function(t){var r=e(this),i=u(r.val());!n.allowExceed&&i>n.limit&&r.val(a(r.val())),n.boxAttach&&e("#"+n.boxId).css({width:r.outerWidth()-(e("#"+n.boxId).outerWidth()-e("#"+n.boxId).width())+"px",left:r.offset().left+"px",top:r.offset().top+r.outerHeight()-1+"px","z-index":2e3});var s=n.limit-i>0?n.limit-i:0,o=n.remTextFilter(n,s),f=n.limitTextFilter(n);if(n.limitTextShow){e("#"+n.boxId).html(o+" "+f);var l=e("<span/>").appendTo("body").attr({id:"19cc9195583bfae1fad88e19d443be7a","class":n.boxClass}).html(o+" "+f).innerWidth();e("#19cc9195583bfae1fad88e19d443be7a").remove(),l>e("#"+n.boxId).innerWidth()&&e("#"+n.boxId).html(o+"<br />"+f),e("#"+n.boxId).show()}else e("#"+n.boxId).html(o).show()},s=function(t){var r=u(e(this).val());if(!n.allowExceed&&r>n.limit){var i=t.ctrlKey||t.altKey||t.metaKey;if(!i&&t.which>=32&&t.which<=122&&this.selectionStart===this.selectionEnd)return!1}},o=function(){var t=e(this);count=u(t.val()),!n.allowExceed&&count>n.limit&&t.val(a(t.val()));if(n.boxAttach)e("#"+n.boxId).fadeOut("fast");else if(n.remTextHideOnBlur){var r=n.limitText;r=r.replace(/\%n/g,n.limit),r=r.replace(/\%s/g,n.limit===1?"":"s"),e("#"+n.boxId).html(r)}},u=function(t){if(n.limitBy.toLowerCase()==="words")return t.length>0?e.trim(t).replace(/\ +(?= )/g,"").split(" ").length:0;var r=t.length,i=t.match(/\n/g);return i&&n.lineReturnCount>1&&(r+=i.length*(n.lineReturnCount-1)),r},a=function(t){return n.limitBy.toLowerCase()==="words"?e.trim(t).replace(/\ +(?= )/g,"").split(" ").splice(0,n.limit).join(" ")+" ":t.substring(0,n.limit)};e(this).each(function(r){var u=e(this);(!t||!t.limit)&&n.useMaxlength&&parseInt(u.attr("maxlength"))>0&&parseInt(u.attr("maxlength"))!=n.limit?u.inputlimiter(e.extend({},n,{limit:parseInt(u.attr("maxlength"))})):(!n.allowExceed&&n.useMaxlength&&n.limitBy.toLowerCase()==="characters"&&u.attr("maxlength",n.limit),u.unbind(".inputlimiter"),u.bind("keyup.inputlimiter",i),u.bind("keypress.inputlimiter",s),u.bind("blur.inputlimiter",o))})},e.fn.inputlimiter.remtextfilter=function(e,t){var n=e.remText;return t===0&&e.remFullText!==null&&(n=e.remFullText),n=n.replace(/\%n/g,t),n=n.replace(/\%s/g,e.zeroPlural?t===1?"":"s":t<=1?"":"s"),n},e.fn.inputlimiter.limittextfilter=function(e){var t=e.limitText;return t=t.replace(/\%n/g,e.limit),t=t.replace(/\%s/g,e.limit<=1?"":"s"),t},e.fn.inputlimiter.defaults={limit:255,boxAttach:!0,boxId:"limiterBox",boxClass:"limiterBox",remText:"%n character%s remaining.",remTextFilter:e.fn.inputlimiter.remtextfilter,remTextHideOnBlur:!0,remFullText:null,limitTextShow:!0,limitText:"Field limited to %n character%s.",limitTextFilter:e.fn.inputlimiter.limittextfilter,zeroPlural:!0,allowExceed:!1,useMaxlength:!0,limitBy:"characters",lineReturnCount:1}}(jQuery),define("jquery.inputlimiter.1.3.1",function(){}),define("module/common/media/view/edit/general",["require","underscore","jquery","backbone","i18n","helper/language","helper/makeup","module/assets/contenttype/model/contenttype","module/assets/contenttype/model/types","module/common/media/view/selector","module/common/layout/model/syntaxTypes","module/common/content/view/tabs/elements","module/content/mediatype/model/mediatypes","hbars!module/common/media/template/edit/general","jquery.iframe-transport","jquery.fileupload","module/tools/config/model/configurationOption","jquery.inputlimiter.1.3.1"],function(e){var t=e("underscore"),n=e("jquery"),r=e("backbone"),i=e("i18n"),s=e("helper/language"),o=e("helper/makeup"),u=e("module/assets/contenttype/model/contenttype"),a=e("module/assets/contenttype/model/types"),f=e("module/common/media/view/selector"),l=e("module/common/layout/model/syntaxTypes"),c=e("module/common/content/view/tabs/elements"),h=e("module/content/mediatype/model/mediatypes"),p=e("hbars!module/common/media/template/edit/general"),d=e("jquery.iframe-transport"),v=e("jquery.fileupload"),m=e("module/tools/config/model/configurationOption"),g=e("jquery.inputlimiter.1.3.1");return r.View.extend({template:p,events:{'blur [name="media-name"]':"validate"},initialize:function(e){this.options=e||{},this.moduleName=this.options.moduleName,this.model=this.options.model,this.parent=this.options.parent,this.mediaSelector=new f({showButtons:!1}),this.mediaTypes=new h,this.syntaxTypes=new l,this.types=new a,this.contentType=new u,this.contentType.id=1,this.configOption=new m,r.once("media:edit media:add",function(){this.fetchElements(),this.mediaTypes.fetch(),this.syntaxTypes.fetch()},this),r.Validation.bind(this),this.fetch(),t.isUndefined(this.maxUpload)&&this.getMaxUploadSize()},getMaxUploadSize:function(){this.configOption.set("name","advanced.fileManagement.maximumUploadSize"),this.maxUpload=this.configOption.fetch().done(function(e){this.maxUpload=e.value}.bind(this))},getMaxSizeDetails:function(e){var n,r={};if(t.isUndefined(this.model.get("contentType"))&&t.isUndefined(e))return;return n=e?e.contentTypeElements:this.model.get("contentType")&&this.model.get("contentType").contentTypeElements,t.each(n,function(e){r[e.name.toLowerCase()]=e.maxSize}),r},serialize:function(){return{model:this.model.toJSON(),mediaTypes:this.mediaTypes.toJSON(),syntaxTypes:this.syntaxTypes.toJSON(),contentLanguage:s.getCurrentLanguage(),dependency:this.getLanguageDependency(),maxSizeDetails:this.getMaxSizeDetails(),maxUpload:this.maxUpload}},insertCharacterCounter:function(){this.$el.find(".has-character-limit").inputlimiter({limit:this.$el.attr("maxlength"),remText:"%n character%s remaining...",limitText:"max allowed : %n."})},submit:function(e){o.submitEditNotSupportedBrowsers({url:r.SERVICE_BASE_URL+"/media/xhrnotsupported/modify",data:e,updatedEventName:"media:updated:form"})},setMediaType:function(e){var r,i=this.mediaTypes.filter(function(t){return t.get("permittedExtensions").toLowerCase().indexOf(e)>-1}),s;i.length&&(s=t.first(i).id),s&&n("#media-type").val(s).trigger("change")},getLanguageDependency:function(){var e=this.model.toJSON(),t=e.language,n=e.binaryLanguage;if(t&&n)return t==="smxx"&&n==="smxx"?i.t("media:edit.general.label.fully_independent"):n==="smxx"&&t!=="smxx"?i.t("media:edit.general.label.independent_media_file"):i.t("media:edit.general.label.fully_dependent")},getFormData:function(){var e={},n=this.getLanguages(),r=this.getFile();return e.name=this.getName(),e.description=this.$('[name="media-description"]').val(),e.type=this.$('[name="media-type"]').val(),e.syntaxType=this.$('[name="syntax-highting-language"]').val(),e.myMedia="0",e.elements=this.getElementFormData(),this.parent.mode==="edit"&&(e.mediaID=this.model.get("id")),!e.name||!r?!1:t.extend({},e,r,n)},getFile:function(){var e={},t=this.file||o.file;return t?(e.file=t,e.fileName=t.name,r.Validation.callbacks.valid(this,"media-file","id"),e):this.parent.mode==="add"&&!this.file?(r.Validation.callbacks.invalid(this,"media-file",i.t("media:edit.general.validation.file"),"id"),!1):this.parent.mode==="edit"&&!t?e:!1},getLanguages:function(){var e={},t=this.$('[name="dependency"]:checked').val()||"",n=t.split("||");return t?(e.language=n[1],e.binaryLanguage=n[0]):(e.language=this.model.get("language"),e.binaryLanguage=this.model.get("binaryLanguage")),e},getName:function(){var e=this.$('[name="media-name"]').val();return e?(r.Validation.callbacks.valid(this,"media-name","name"),e):(r.Validation.callbacks.invalid(this,"media-name",i.t("media:edit.general.validation.name"),"name"),!1)},getElementFormData:function(){var e=this.model.getElements(this.contentType,this.types),n=this.elementView.getFormData(),r={};return t.each(e,function(e){var t=e.originalKey?e.originalKey:e.name+"#"+e.id+":"+e.type.id;r[t]=n[e.identifier]}),JSON.stringify(r)},fetchElements:function(){n.when(this.types.fetch()).then(function(){return this.contentType.fetch()}.bind(this)).then(function(e){var t=this.getMaxSizeDetails(e);this.elementView=new c({baseView:this.baseView,model:this.model,contentType:this.contentType,types:this.types,hideTitle:!0,maxSizeDetails:t}),this.render()}.bind(this))},fetched:function(){this.mediaSelector.model=this.model,this.mediaSelector.hasSelection=!0,this.mediaSelector.render(),this.render(),this.fetchElements()},fetch:function(e){var t=[];return t.push(this.mediaTypes.fetch()),t.push(this.syntaxTypes.fetch()),t.push(this.types.fetch()),t.push(this.contentType.fetch()),n.when.apply(n,t)},validate:function(e){var t=n(e.currentTarget);t.val()?r.Validation.callbacks.valid(this,"media-name","name"):r.Validation.callbacks.invalid(this,"media-name",i.t("media:edit.general.validation.name"),"name")},notifyError:function(e){if(!e)return;e.text==="FILE_OVER_LIMIT"&&r.Validation.callbacks.invalid(this,"media-file",i.t("error:notification.413.FILE_OVER_LIMIT.title"),"id")},beforeRender:function(){this.insertView(".media-preview",this.mediaSelector),this.elementView&&this.insertView(".element-view",this.elementView),o.destroyUploads(),this.$("select").each(function(){n(this).select2("destroy")})},afterRender:function(){var e=this;this.$dropzone=o.createUpload({el:this.$(".dropzone"),notSupported:{urlCreate:r.SERVICE_BASE_URL+"/media/xhrnotsupported/create",urlUpdate:r.SERVICE_BASE_URL+"/media/xhrnotsupported/update",id:this.model.get("id"),createdEventName:"media:created:form",updatedEventName:"media:updated:form"}}),this.$dropzone.supported&&(this.$dropzone.on("addedfile",function(t){e.$dropzone.files[1]!=null&&e.$dropzone.removeFile(this.files[0]),r.Validation.callbacks.valid(e,"media-file","id"),e.file=t,e.$(".dz-message").hide(),this.setMediaType(t.name.split(".").pop().toLowerCase())}.bind(this)),this.$dropzone.on("removedfile",function(){e.file=null,e.$(".dz-message").show()}),this.$dropzone.on("drop",function(t){e.$dropzone.removeAllFiles()})),o.createSelect({el:this.$("select")}),this.elementView&&!t.isEmpty(this.elementView.elements)?this.$(".meta-data-title").show():this.$(".meta-data-title").hide(),this.insertCharacterCounter()}})}),define("hbars!module/common/media/template/edit/editor",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){return' disabled="disabled" '},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i,s,o,u='<h3 class="green lighter">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.editor.title",{name:"t",hash:{},data:r}))+"</h3>\n<p>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.editor.description",{name:"t",hash:{},data:r}))+'</p>\n\n<textarea id="media-editor-textarea" name="media-editor-textarea" class="width-100" ';return i=(s=(s=t.readOnlyView||(e!=null?e.readOnlyView:e))!=null?s:t.helperMissing,o={name:"readOnlyView",hash:{},fn:this.program(1,r,0),inverse:this.noop,data:r},typeof s=="function"?s.call(e,o):s),t.readOnlyView||(i=t.blockHelperMissing.call(e,i,o)),i!=null&&(u+=i),u+">\n"+this.escapeExpression((s=(s=t.text||(e!=null?e.text:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"text",hash:{},data:r}):s))+"\n</textarea>"},useData:!0})}),define("module/common/media/view/edit/editor",["require","underscore","backbone","helper/makeup","codeMirror/lib/codemirror","hbars!module/common/media/template/edit/editor"],function(e){var t=e("underscore"),n=e("backbone"),r=e("helper/makeup"),i=e("codeMirror/lib/codemirror"),s=e("hbars!module/common/media/template/edit/editor");return n.View.extend({template:s,initialize:function(e){this.options=e||{},this.moduleName=this.options.moduleName,this.model=this.options.model,this.parent=this.options.parent},serialize:function(){return{text:this.text||""}},afterRender:function(){this.setupEditor()},setupEditor:function(){var e=this,n=this.parent.generalView.syntaxTypes.toJSON(),r=t.find(n,function(t){return t.id===e.model.get("syntax")});this.editor=i.fromTextArea(this.$("textarea").get(0),{mode:(r||{}).mime_code||"text/html",lineNumbers:!0})},fetched:function(e){var t=this.model.get("mediaURL"),n=this;this.isCompatibleMediaType(this.model.get("type"),e)&&(n.text=this.model.get("text"),n.render())},isCompatibleMediaType:function(e,n){var r=t.find(n,function(t){return t.id===e});return r&&!r.binary},getFormData:function(){var e={};return e.text=this.editor.getValue(),t.extend({},e)}})}),function(e){function s(){return e("<div/>")}var t=Math.abs,n=Math.max,r=Math.min,i=Math.round;e.imgAreaSelect=function(o,u){function G(e){return e+y.left-S.left}function Y(e){return e+y.top-S.top}function Z(e){return e-y.left+S.left}function et(e){return e-y.top+S.top}function tt(e){return e.pageX-S.left}function nt(e){return e.pageY-S.top}function rt(e){var t=e||k,n=e||L;return{x1:i(q.x1*t),y1:i(q.y1*n),x2:i(q.x2*t),y2:i(q.y2*n),width:i(q.x2*t)-i(q.x1*t),height:i(q.y2*n)-i(q.y1*n)}}function it(e,t,n,r,s){var o=s||k,u=s||L;q={x1:i(e/o||0),y1:i(t/u||0),x2:i(n/o||0),y2:i(r/u||0)},q.width=q.x2-q.x1,q.height=q.y2-q.y1}function st(){if(!f||!a.width())return;y={left:i(a.offset().left),top:i(a.offset().top)},b=a.innerWidth(),w=a.innerHeight(),y.top+=a.outerHeight()-w>>1,y.left+=a.outerWidth()-b>>1,O=i(u.minWidth/k)||0,M=i(u.minHeight/L)||0,_=i(r(u.maxWidth/k||1<<24,b)),D=i(r(u.maxHeight/L||1<<24,w)),e().jquery=="1.3.2"&&T=="fixed"&&!R.getBoundingClientRect&&(y.top+=n(document.body.scrollTop,R.scrollTop),y.left+=n(document.body.scrollLeft,R.scrollLeft)),S=/absolute|relative/.test(E.css("position"))?{left:i(E.offset().left)-E.scrollLeft(),top:i(E.offset().top)-E.scrollTop()}:T=="fixed"?{left:e(document).scrollLeft(),top:e(document).scrollTop()}:{left:0,top:0},m=G(0),g=Y(0),(q.x2>b||q.y2>w)&&pt()}function ot(t){if(!H)return;l.css({left:G(q.x1),top:Y(q.y1)}).add(c).width(J=q.width).height(K=q.height),c.add(h).add(d).css({left:0,top:0}),h.width(n(J-h.outerWidth()+h.innerWidth(),0)).height(n(K-h.outerHeight()+h.innerHeight(),0)),e(p[0]).css({left:m,top:g,width:q.x1,height:w}),e(p[1]).css({left:m+q.x1,top:g,width:J,height:q.y1}),e(p[2]).css({left:m+q.x2,top:g,width:b-q.x2,height:w}),e(p[3]).css({left:m+q.x1,top:g+q.y2,width:J,height:w-q.y2}),J-=d.outerWidth(),K-=d.outerHeight();switch(d.length){case 8:e(d[4]).css({left:J>>1}),e(d[5]).css({left:J,top:K>>1}),e(d[6]).css({left:J>>1,top:K}),e(d[7]).css({top:K>>1});case 4:d.slice(1,3).css({left:J}),d.slice(2,4).css({top:K})}t!==!1&&(e.imgAreaSelect.onKeyPress!=St&&e(document).unbind(e.imgAreaSelect.keyPress,e.imgAreaSelect.onKeyPress),u.keys&&e(document)[e.imgAreaSelect.keyPress](e.imgAreaSelect.onKeyPress=St)),Nt&&h.outerWidth()-h.innerWidth()==2&&(h.css("margin",0),setTimeout(function(){h.css("margin","auto")},0))}function ut(e){st(),ot(e),B=G(q.x1),j=Y(q.y1),F=G(q.x2),I=Y(q.y2)}function at(e,t){u.fadeSpeed?e.fadeOut(u.fadeSpeed,t):e.hide()}function ft(e){var t=Z(tt(e))-q.x1,n=et(nt(e))-q.y1;Q||(st(),Q=!0,l.one("mouseout",function(){Q=!1})),A="",u.resizable&&(n<=u.resizeMargin?A="n":n>=q.height-u.resizeMargin&&(A="s"),t<=u.resizeMargin?A+="w":t>=q.width-u.resizeMargin&&(A+="e")),l.css("cursor",A?A+"-resize":u.movable?"move":""),v&&v.toggle()}function lt(t){e("body").css("cursor",""),(u.autoHide||q.width*q.height==0)&&at(l.add(p),function(){e(this).hide()}),e(document).unbind("mousemove",dt),l.mousemove(ft),u.onSelectEnd(o,rt())}function ct(t){return t.which!=1?!1:(st(),A?(e("body").css("cursor",A+"-resize"),B=G(q[/w/.test(A)?"x2":"x1"]),j=Y(q[/n/.test(A)?"y2":"y1"]),e(document).mousemove(dt).one("mouseup",lt),l.unbind("mousemove",ft)):u.movable?(N=m+q.x1-tt(t),C=g+q.y1-nt(t),l.unbind("mousemove",ft),e(document).mousemove(mt).one("mouseup",function(){u.onSelectEnd(o,rt()),e(document).unbind("mousemove",mt),l.mousemove(ft)})):a.mousedown(t),!1)}function ht(e){P&&(e?(F=n(m,r(m+b,B+t(I-j)*P*(F>B||-1))),I=i(n(g,r(g+w,j+t(F-B)/P*(I>j||-1)))),F=i(F)):(I=n(g,r(g+w,j+t(F-B)/P*(I>j||-1))),F=i(n(m,r(m+b,B+t(I-j)*P*(F>B||-1)))),I=i(I)))}function pt(){B=r(B,m+b),j=r(j,g+w),t(F-B)<O&&(F=B-O*(F<B||-1),F<m?B=m+O:F>m+b&&(B=m+b-O)),t(I-j)<M&&(I=j-M*(I<j||-1),I<g?j=g+M:I>g+w&&(j=g+w-M)),F=n(m,r(F,m+b)),I=n(g,r(I,g+w)),ht(t(F-B)<t(I-j)*P),t(F-B)>_&&(F=B-_*(F<B||-1),ht()),t(I-j)>D&&(I=j-D*(I<j||-1),ht(!0)),q={x1:Z(r(B,F)),x2:Z(n(B,F)),y1:et(r(j,I)),y2:et(n(j,I)),width:t(F-B),height:t(I-j)},ot(),u.onSelectChange(o,rt())}function dt(e){return F=/w|e|^$/.test(A)||P?tt(e):G(q.x2),I=/n|s|^$/.test(A)||P?nt(e):Y(q.y2),pt(),!1}function vt(t,n){F=(B=t)+q.width,I=(j=n)+q.height,e.extend(q,{x1:Z(B),y1:et(j),x2:Z(F),y2:et(I)}),ot(),u.onSelectChange(o,rt())}function mt(e){return B=n(m,r(N+tt(e),m+b-q.width)),j=n(g,r(C+nt(e),g+w-q.height)),vt(B,j),e.preventDefault(),!1}function gt(){e(document).unbind("mousemove",gt),st(),F=B,I=j,pt(),A="",p.is(":visible")||l.add(p).hide().fadeIn(u.fadeSpeed||0),H=!0,e(document).unbind("mouseup",yt).mousemove(dt).one("mouseup",lt),l.unbind("mousemove",ft),u.onSelectStart(o,rt())}function yt(){e(document).unbind("mousemove",gt).unbind("mouseup",yt),at(l.add(p)),it(Z(B),et(j),Z(B),et(j)),this instanceof e.imgAreaSelect||(u.onSelectChange(o,rt()),u.onSelectEnd(o,rt()))}function bt(t){return t.which!=1||p.is(":animated")?!1:(st(),N=B=tt(t),C=j=nt(t),e(document).mousemove(gt).mouseup(yt),!1)}function wt(){ut(!1)}function Et(){f=!0,Tt(u=e.extend({classPrefix:"imgareaselect",movable:!0,parent:"body",resizable:!0,resizeMargin:10,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}},u)),l.add(p).css({visibility:""}),u.show&&(H=!0,st(),ot(),l.add(p).hide().fadeIn(u.fadeSpeed||0)),setTimeout(function(){u.onInit(o,rt())},0)}function xt(e,t){for(var n in t)u[n]!==undefined&&e.css(t[n],u[n])}function Tt(t){t.parent&&(E=e(t.parent)).append(l).append(p),e.extend(u,t),st();if(t.handles!=null){d.remove(),d=e([]),X=t.handles?t.handles=="corners"?4:8:0;while(X--)d=d.add(s());d.addClass(u.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:x+1||1}),!parseInt(d.css("width"))>=0&&d.width(5).height(5),(V=u.borderWidth)&&d.css({borderWidth:V,borderStyle:"solid"}),xt(d,{borderColor1:"border-color",borderColor2:"background-color",borderOpacity:"opacity"})}k=u.imageWidth/b||1,L=u.imageHeight/w||1,t.x1!=null&&(it(t.x1,t.y1,t.x2,t.y2),t.show=!t.hide),t.keys&&(u.keys=e.extend({shift:1,ctrl:"resize"},t.keys)),p.addClass(u.classPrefix+"-outer"),c.addClass(u.classPrefix+"-selection");for(X=0;X++<4;)e(h[X-1]).addClass(u.classPrefix+"-border"+X);xt(c,{selectionColor:"background-color",selectionOpacity:"opacity"}),xt(h,{borderOpacity:"opacity",borderWidth:"border-width"}),xt(p,{outerColor:"background-color",outerOpacity:"opacity"}),(V=u.borderColor1)&&e(h[0]).css({borderStyle:"solid",borderColor:V}),(V=u.borderColor2)&&e(h[1]).css({borderStyle:"dashed",borderColor:V}),l.append(c.add(h).add(v)).append(d),Nt&&((V=(p.css("filter")||"").match(/opacity=(\d+)/))&&p.css("opacity",V[1]/100),(V=(h.css("filter")||"").match(/opacity=(\d+)/))&&h.css("opacity",V[1]/100)),t.hide?at(l.add(p)):t.show&&f&&(H=!0,l.add(p).fadeIn(u.fadeSpeed||0),ut()),P=(W=(u.aspectRatio||"").split(/:/))[0]/W[1],a.add(p).unbind("mousedown",bt);if(u.disable||u.enable===!1)l.unbind("mousemove",ft).unbind("mousedown",ct),e(window).unbind("resize",wt);else{if(u.enable||u.disable===!1)(u.resizable||u.movable)&&l.mousemove(ft).mousedown(ct),e(window).resize(wt);u.persistent||a.add(p).mousedown(bt)}u.enable=u.disable=undefined}var a=e(o),f,l=s(),c=s(),h=s().add(s()).add(s()).add(s()),p=s().add(s()).add(s()).add(s()),d=e([]),v,m,g,y={left:0,top:0},b,w,E,S={left:0,top:0},x=0,T="absolute",N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q={x1:0,y1:0,x2:0,y2:0,width:0,height:0},R=document.documentElement,U=navigator.userAgent,z,W,X,V,J,K,Q,St=function(e){var t=u.keys,i,s,o=e.keyCode;i=!isNaN(t.alt)&&(e.altKey||e.originalEvent.altKey)?t.alt:!isNaN(t.ctrl)&&e.ctrlKey?t.ctrl:!isNaN(t.shift)&&e.shiftKey?t.shift:isNaN(t.arrows)?10:t.arrows;if(t.arrows=="resize"||t.shift=="resize"&&e.shiftKey||t.ctrl=="resize"&&e.ctrlKey||t.alt=="resize"&&(e.altKey||e.originalEvent.altKey)){switch(o){case 37:i=-i;case 39:s=n(B,F),B=r(B,F),F=n(s+i,B),ht();break;case 38:i=-i;case 40:s=n(j,I),j=r(j,I),I=n(s+i,j),ht(!0);break;default:return}pt()}else{B=r(B,F),j=r(j,I);switch(o){case 37:vt(n(B-i,m),j);break;case 38:vt(B,n(j-i,g));break;case 39:vt(B+r(i,b-Z(F)),j);break;case 40:vt(B,j+r(i,w-et(I)));break;default:return}}return!1};this.remove=function(){Tt({disable:!0}),l.add(p).remove()},this.getOptions=function(){return u},this.setOptions=Tt,this.getSelection=rt,this.setSelection=it,this.cancelSelection=yt,this.update=ut;var Nt=(/msie ([\w.]+)/i.exec(U)||[])[1],Ct=/opera/i.test(U),kt=/webkit/i.test(U)&&!/chrome/i.test(U);z=a;while(z.length)x=n(x,isNaN(z.css("z-index"))?x:z.css("z-index")),!u.parent&&z.css("position")=="fixed"&&(T="fixed"),z=z.parent(":not(body)");x=u.zIndex||x,e.imgAreaSelect.keyPress=Nt||kt?"keydown":"keypress",l.add(p).hide().css({position:T,overflow:"hidden",zIndex:x||"0"}),l.css({zIndex:x+2||2}),c.add(h).css({position:"absolute",fontSize:0}),o.complete||o.readyState=="complete"||!a.is("img")?Et():a.one("load",Et),!f&&Nt&&Nt>=7&&(o.src=o.src)},e.fn.imgAreaSelect=function(t){return t=t||{},this.each(function(){e(this).data("imgAreaSelect")?t.remove?(e(this).data("imgAreaSelect").remove(),e(this).removeData("imgAreaSelect")):e(this).data("imgAreaSelect").setOptions(t):t.remove||(t.enable===undefined&&t.disable===undefined&&(t.enable=!0),e(this).data("imgAreaSelect",new e.imgAreaSelect(this,t)))}),t.instance?e(this).data("imgAreaSelect"):this}}(jQuery),define("jquery.imgareaselect.pack",function(){}),define("module/system/mediaconfig/model/mediaVariant",["underscore","backbone","i18n","module/common/validation/validation"],function(e,t,n,r){return t.Model.extend({initialize:function(){this.validationModel=new r({model:"mediaconfig"})},url:function(){var e=this.name?"/"+this.name:"";return t.SERVICE_BASE_URL+"/mediavariant"+e}})}),define("module/system/mediaconfig/model/mediaVariants",["backbone","module/system/mediaconfig/model/mediaVariant"],function(e,t){return e.Collection.extend({model:t,url:function(){return e.SERVICE_BASE_URL+"/mediavariant/"}})}),define("hbars!module/common/media/template/cropTool",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){return" hidden"},3:function(e,t,n,r){return'              <option value="'+this.escapeExpression(this.lambda(e!=null?e.name:e,e))+'" data-width="'+this.escapeExpression(this.lambda(e!=null?e.width:e,e))+'" data-height ="'+this.escapeExpression(this.lambda(e!=null?e.height:e,e))+'">'+this.escapeExpression(this.lambda(e!=null?e.name:e,e))+"</option>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i,s,o,u='<div class="row">\n  <div class="col-sm-6">\n    <div data-toggle="buttons" class="btn-group btn-overlap';return i=(s=(s=t.showInVariants||(e!=null?e.showInVariants:e))!=null?s:t.helperMissing,o={name:"showInVariants",hash:{},fn:this.program(1,r,0),inverse:this.noop,data:r},typeof s=="function"?s.call(e,o):s),t.showInVariants||(i=t.blockHelperMissing.call(e,i,o)),i!=null&&(u+=i),u+'" id="tool-selector">\n      <label class="btn btn-white btn-info active ace-tooltip" title="" data-original-title="Crop">\n        <span class="sr-only">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:cropTool.crop.title",{name:"t",hash:{},data:r}))+'</span>\n        <input name="crop-type" type="radio" value="crop" checked>\n        <i class="icon-only ace-icon fa fa-crop"></i>\n      </label>\n      <label class="btn btn-white btn-info ace-tooltip" title="" data-original-title="Resize">\n        <span class="sr-only">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:cropTool.resize.title",{name:"t",hash:{},data:r}))+'</span>\n        <input name="crop-type" type="radio" value="resize">\n        <i class="icon-only ace-icon fa fa-expand"></i>\n      </label>\n    </div>\n  </div>\n  <div class="col-sm-6 crop">\n    <form class="form-horizontal">\n      <div class="form-group">\n        <label class="col-sm-4 control-label">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:cropTool.cropSize.title",{name:"t",hash:{},data:r}))+'</label>\n        <div class="col-sm-8">\n          <select class="width-100 crop-options">\n            <option value="unconstrained" selected="">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:cropTool.cropSize.unconstrained",{name:"t",hash:{},data:r}))+'</option>\n            <option value="custom">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:cropTool.cropSize.custom",{name:"t",hash:{},data:r}))+'</option>\n            <optgroup label="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:cropTool.cropSize.predefinedVariants",{name:"t",hash:{},data:r}))+'">\n'+((i=t.each.call(e,e!=null?e.mediaVariants:e,{name:"each",hash:{},fn:this.program(3,r,0),inverse:this.noop,data:r}))!=null?i:"")+'            </optgroup>\n          </select>\n        </div>\n      </div>\n    </form>\n  </div>\n  <div class="col-sm-6 resize" style="display: none;">\n    <form class="form-horizontal">\n      <div class="form-group">\n        <label class="col-sm-4 control-label" for="resize-variant-sizes">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:cropTool.cropSize.predefinedVariants",{name:"t",hash:{},data:r}))+'</label>\n        <div class="col-sm-8">\n          <select class="width-100 resize-options">\n            <option value="custom">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:cropTool.cropSize.custom",{name:"t",hash:{},data:r}))+'</option>\n            <optgroup label="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:cropTool.cropSize.predefinedVariants",{name:"t",hash:{},data:r}))+'">\n'+((i=t.each.call(e,e!=null?e.mediaVariants:e,{name:"each",hash:{},fn:this.program(3,r,0),inverse:this.noop,data:r}))!=null?i:"")+'            </optgroup>\n          </select>\n        </div>\n      </div>\n    </form>\n  </div>\n</div>\n\n<div class="row crop">\n  <form>\n    <div class="col-xs-6 col-sm-3">\n      <label class="sr-only" for="crop-x">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:cropTool.crop.x.label",{name:"t",hash:{},data:r}))+'</label>\n      <div class="input-group">\n        <div class="input-group-addon">X</div>\n        <input class="width-100 ace-tooltip crop-value" type="number" placeholder="" name="crop-x" id="crop-x" title="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:cropTool.crop.x.tooltip",{name:"t",hash:{},data:r}))+'">\n      </div>\n    </div>\n    <div class="col-xs-6 col-sm-3">\n      <label class="sr-only" for="crop-y">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:cropTool.crop.y.label",{name:"t",hash:{},data:r}))+'</label>\n      <div class="input-group">\n        <div class="input-group-addon">Y</div>\n        <input class="width-100 ace-tooltip crop-value" type="number" placeholder="" name="crop-y" id="crop-y" title="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:cropTool.crop.y.tooltip",{name:"t",hash:{},data:r}))+'">\n      </div>\n    </div>\n\n    <input class="crop-value" type="hidden" name="crop-x2" id="crop-x2"/>\n    <input class="crop-value" type="hidden" name="crop-y2" id="crop-y2"/>\n\n    <div class="col-xs-6 col-sm-3">\n      <label class="sr-only" for="crop-w">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:cropTool.crop.w.label",{name:"t",hash:{},data:r}))+'</label>\n      <div class="input-group">\n        <div class="input-group-addon">W</div>\n        <input class="width-100 crop-value ace-tooltip" type="number" name="crop-w" id="crop-w" readonly="" title="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:cropTool.crop.w.tooltip",{name:"t",hash:{},data:r}))+'">\n      </div>\n    </div>\n    <div class="col-xs-6 col-sm-3">\n      <label class="sr-only" for="crop-h">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:cropTool.crop.h.label",{name:"t",hash:{},data:r}))+'</label>\n      <div class="input-group">\n        <div class="input-group-addon">H</div>\n        <input class="width-100 crop-value ace-tooltip" type="number" placeholder="" name="crop-h" id="crop-h" readonly="" title="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:cropTool.crop.h.tooltip",{name:"t",hash:{},data:r}))+'">\n      </div>\n    </div>\n  </form>\n</div>\n\n<div class="row resize" style="display: none;">\n  <form>\n    <div class="col-sm-6">\n      <div>\n        <label>\n          <input name="maintain-aspect" id="maintain-aspect" type="checkbox" class="ace maintain-aspect" checked="">\n          <span class="lbl"> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:cropTool.resize.maintainRatio",{name:"t",hash:{},data:r}))+'</span>\n        </label>\n      </div>\n    </div>\n    <div class="col-xs-6 col-sm-3">\n      <div class="input-group">\n        <div class="input-group-addon">W</div>\n        <input class="width-100 resize-value ace-tooltip" type="number" placeholder="" data-property="width" name="resize-w" id="resize-w" title="" data-original-title="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:cropTool.resize.width",{name:"t",hash:{},data:r}))+'">\n      </div>\n    </div>\n    <div class="col-xs-6 col-sm-3">\n      <div class="input-group">\n        <div class="input-group-addon">H</div>\n        <input class="width-100 resize-value ace-tooltip" type="number" placeholder="" data-property="height" name="resize-h" id="resize-h" title="" data-original-title="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:cropTool.resize.height",{name:"t",hash:{},data:r}))+'">\n      </div>\n    </div>\n  </form>\n</div>\n\n<div class="space-8"></div>\n\n<div class="row scale-warning" style="display: none;">\n  <div class="col-xs-12">\n    <div class="alert alert-info" style="margin-bottom: 20px;">\n      <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">Ã</span><span class="sr-only">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:action.close",{name:"t",hash:{},data:r}))+'</span></button>\n      <p><i class="fa fa-info-circle"></i> '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:cropTool.warning",{name:"t",hash:{},data:r}))+'</p>\n    </div>\n  </div>\n</div>\n\n<div class="row">\n  <div class="col-xs-12">\n    <div id="crop-image-container" style="position: relative;">\n      <img src="'+this.escapeExpression((s=(s=t.imageURL||(e!=null?e.imageURL:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"imageURL",hash:{},data:r}):s))+'" class="img-responsive crop-target" style="margin: 0 auto;">\n    </div>\n  </div>\n</div>'},useData:!0})}),define("module/common/media/view/cropTool",["jquery","underscore","backbone","helper/makeup","jquery.imgareaselect.pack","module/system/mediaconfig/model/mediaVariants","hbars!module/common/media/template/cropTool"],function(e,t,n,r,i,s,o){return n.View.extend({template:o,events:{"submit form":"preventDefault",'change input[name="crop-type"]':"changeCropType","change .crop-options":"changeCropOptions","change .resize-options":"changeResizeOptions","change .crop-value":"changeCropValue","keyup .resize-value":"changeResizeValue","change .maintain-aspect":"checkedMaintainAspect"},initialize:function(e){this.options=e||{},this.originalSize={},this.mode="crop",this.mediaVariants=new s},serialize:function(){return{imageURL:this.imageURL,mediaVariants:this.mediaVariants.toJSON()}},beforeRender:function(){this.cropTool&&this.cropTool.remove(),this.mediaVariants.fetch()},afterRender:function(){this.$("[title]").tooltip(),this.$image=this.$("img"),this.$cropX=this.$("#crop-x"),this.$cropX2=this.$("#crop-x2"),this.$cropY=this.$("#crop-y"),this.$cropY2=this.$("#crop-y2"),this.$cropW=this.$("#crop-w"),this.$cropH=this.$("#crop-h"),this.$resizeW=this.$("#resize-w"),this.$resizeH=this.$("#resize-h"),this.imageURL&&(this.getImageSize(this.initializeCropTool),e("#editView .tabbable > ul > li > a").bind("click",this.changedTab.bind(this)),e(window).resize(this.onResize.bind(this)),e(document).on("settings.ace",this.onResize.bind(this))),this.mode==="crop"&&this.newSelection?(this.$('input[name="crop-type"][value="crop"]').click(),this.$cropX.val(this.newSelection.x1),this.$cropX2.val(this.newSelection.x2),this.$cropY.val(this.newSelection.y1),this.$cropY2.val(this.newSelection.y2),this.$cropW.val(parseInt(this.newSelection.width)),this.$cropH.val(parseInt(this.newSelection.height)),setTimeout(function(){this.changeCropValue()}.bind(this),210)):this.mode==="resize"&&this.newSelection&&(this.$('input[name="crop-type"][value="resize"]').click(),this.$resizeW.val(parseInt(this.newSelection.width)),this.$resizeH.val(parseInt(this.newSelection.height)))},onResize:function(){var e=this;this.cropTool&&(clearTimeout(this.resizeTimeout),this.cropTool.cancelSelection(),this.resetCropValues(),this.resizeTimeout=setTimeout(function(){e.checkImageScale(e.originalSize.width),e.resetCropTool()},300))},changedTab:function(t){var n=e(t.currentTarget),r=n.attr("href"),i=/variants$/.test(r);!i&&this.cropTool&&(this.cropTool.cancelSelection(),this.mode="crop")},preventDefault:function(e){e.preventDefault()},initializeCropTool:function(e){if(!this.$image)return;this.cropTool=this.$image.imgAreaSelect({instance:!0,keys:!0,handles:!0,resizeMargin:20,fadeSpeed:200,imageWidth:e.width,imageHeight:e.height,onSelectStart:this.onSelectStart,onSelectEnd:this.onSelectEnd,onSelectChange:this.onSelectChange,context:this,parent:"#crop-image-container"})},changeCropType:function(t){var n=this,r=e(t.currentTarget),i=r.val();this.$(".crop, .resize").hide(),this.$("."+i).fadeIn(300),this.mode=i,i==="crop"?(this.initializeCropTool(this.originalSize),this.checkImageScale(this.originalSize.width),this.$cropX.val()!==""&&this.$cropY.val()!==""&&setTimeout(function(){n.changeCropValue()},210)):(this.cropTool&&this.cropTool.cancelSelection(),this.$image.imgAreaSelect({remove:!0}),this.$(".scale-warning").slideUp(200))},onSelectStart:function(e,t){},onSelectEnd:function(e,t){this.context.setCropPosition(t)},onSelectChange:function(t,n){var r=parseInt(e("#crop-w").val()),i=parseInt(e("#crop-h").val()),s=this.context.checkCropMode();this.context.setCropPosition(n);if(s!=="unconstrained"){var o=r+":"+i;this.context.cropTool.setOptions({aspectRatio:o})}},setCropPosition:function(e){var t=this,n=t.checkCropMode();n==="unconstrained"&&(this.$cropW.val(e.width),this.$cropH.val(e.height)),this.$cropX.val(e.x1),this.$cropY.val(e.y1)},changeCropOptions:function(e){var n=this,r=n.$(e.currentTarget),i=r.val(),s=r.find("option:selected").attr("data-width"),o=r.find("option:selected").attr("data-height"),u=[this.$cropW,this.$cropH];i==="unconstrained"?t.each(u,function(e){e.prop("readonly",!0)}):i==="custom"?t.each(u,function(e){e.prop("readonly",!1)}):(t.each(u,function(e){e.prop("readonly",!0)}),this.$cropW.val(parseInt(s)),this.$cropH.val(parseInt(o))),n.checkImageScale()},changeResizeOptions:function(e){var n=this,r=n.$(e.currentTarget),i=r.val(),s=r.find("option:selected").attr("data-width"),o=r.find("option:selected").attr("data-height"),u=[this.$resizeW,this.$resizeH];i==="custom"?t.each(u,function(e){e.prop("readonly",!1)}):(t.each(u,function(e){e.prop("readonly",!0)}),this.$resizeW.val(parseInt(s)),this.$resizeH.val(parseInt(o)))},changeCropValue:function(){var t=[];this.$(".crop-value").each(function(){var n=e(this).val()||0,r=parseInt(n,10);n&&t.push(r)}),t.length&&(t.pop(),t.pop(),this.cropTool.setOptions({show:!0}),this.cropTool.setSelection.apply(this.cropTool,t),this.cropTool.update())},checkCropMode:function(){return this.mode==="crop"?this.$(".crop-options").select2("val"):this.$(".resize-options").select2("val")},changeResizeValue:function(t){var n=this.$("#maintain-aspect"),r=n.prop("checked");if(r){var i=e(t.currentTarget),s=i.val()||0,o=parseInt(s,10),u=i.data("property"),a=u==="width"?"#resize-h":"#resize-w",f=u==="width"?"height":"width",l=this.$(a),c=o/this.originalSize[u],h=Math.round(this.originalSize[f]*c);l.val(h)}},getImageSize:function(t){var n=this;e("<img/>").attr("src",this.$image.attr("src")).load(function(){n.originalSize.width=this.width,n.originalSize.height=this.height,n.checkImageScale(),t&&t.call(n,n.originalSize)}).error(this.onImageError.bind(this))},checkImageScale:function(){var e=this,t=e.originalSize.width,n=e.checkCropMode(),r=this.$("img").width()||0,i=this.$(".scale-warning");e.resetCropTool(),r&&r<t&&this.mode==="crop"&&n==="unconstrained"?i.slideDown(200):i.slideUp(200)},checkAspectRatio:function(){},checkedMaintainAspect:function(t){var n=e(t.currentTarget);n.prop("checked")&&this.$(".resize-value").val("")},onImageError:function(){this.$image.replaceWith('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> Image could not be loaded</div>')},getSelection:function(){var e={mode:this.mode,variantMode:this.checkCropMode()},t,n;if(this.mode==="crop"){var r=this.checkCropMode();if(r==="unconstrained")e.selection=this.cropTool.getSelection();else{t=parseInt(this.$cropW.val()||0,10),n=parseInt(this.$cropH.val()||0,10);var i=this.cropTool.getSelection();e.selection={height:n,width:t,x1:i.x1,x2:i.x2,y1:i.y1,y2:i.y2}}}else t=parseInt(this.$resizeW.val()||0,10),n=parseInt(this.$resizeH.val()||0,10),e.selection={width:t,height:n};return e},setSelection:function(e,t){this.mode=e,this.newSelection=t},setImage:function(e){this.imageURL=e,this.render()},resetCropValues:function(){this.$cropX.val(""),this.$cropY.val(""),this.$cropW.val(""),this.$cropH.val("")},resetCropTool:function(){this.$image&&(this.$image.imgAreaSelect({remove:!0}),this.initializeCropTool(this.originalSize))}})}),define("module/common/media/model/variant",["jquery","underscore","backbone"],function(e,t,n){return n.Model.extend({cropUrl:function(){return n.SERVICE_BASE_URL+"/media/"+this.id+"/"+this.language+"/variant/crop"},resizeUrl:function(){return n.SERVICE_BASE_URL+"/media/"+this.id+"/"+this.language+"/variant/resize"},editUrl:function(){return n.SERVICE_BASE_URL+"/media/"+this.id+"/"+this.language+"/variant/"+this.mode+"/modify"},isCrop:function(){return this.mode==="crop"},isResize:function(){return this.mode==="resize"},edit:function(e,t,n,r,i){n=n.selection,this.cleanUp();var s;this.isCrop()?s=[n.x1,n.y1,n.x2,n.y2,n.width,n.height]:s=[n.width,n.height],this.save({variantName:e,variantDescription:t,dimensions:s,parentID:r,variantMode:i},{type:"put",url:this.editUrl()})},duplicate:function(e,t,n,r,i){n=n.selection,this.mode=this.get("mode"),this.clear(),this.id=r,this.isCrop()?this.crop(e,t,n,i):this.resize(e,t,n,i)},cleanUp:function(){var e=this.toJSON();this.clear(),this.id=e.id,this.mode=e.mode,this.set({id:e.id,thumbnailURL:e.thumbnailURL,language:this.language,dimensionsLabel:e.dimensionsLabel})},crop:function(e,t,n,r){this.save({variantName:e,variantDescription:t,dimensions:[n.x1,n.y1,n.x2,n.y2,n.width,n.height],variantMode:r},{type:"post",url:this.cropUrl()})},resize:function(e,t,n,r){this.save({variantName:e,variantDescription:t,dimensions:[n.width,n.height],variantMode:r},{type:"post",url:this.resizeUrl()})},parse:function(e){if(e&&e.dimensionsLabel){var t=e.dimensionsLabel.split(/[:\/]/);t.length===3?(e.mode="resize",e.selection={width:t[0],height:t[1]}):(e.mode="crop",e.selection={x1:t[0],y1:t[1],x2:t[2],y2:t[3],width:t[4],height:t[5]}),e.selection.width&&e.selection.height?e.dimensionsString=e.selection.width+"x"+e.selection.height:e.dimensionsString=""}return e&&e.variantName&&(e.name=e.variantName,delete e.variantName),e&&e.variantDescription&&(e.description=e.variantDescription,delete e.variantDescription),e}})}),define("module/common/media/model/variants",["jquery","underscore","backbone","module/common/media/model/variant"],function(e,t,n,r){return n.Collection.extend({model:r,url:function(){return n.SERVICE_BASE_URL+"/media/"+this.id+"/"+this.language+"/variant/list"}})}),define("hbars!module/common/media/template/edit/variants",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){return'<h3 class="green lighter">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.variants.title",{name:"t",hash:{},data:r}))+"</h3>\n<p>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.variants.description",{name:"t",hash:{},data:r}))+'</p>\n\n<div class="hr hr10"></div>\n'},3:function(e,t,n,r){var i;return(i=t.unless.call(e,e!=null?e.inModal:e,{name:"unless",hash:{},fn:this.program(4,r,0),inverse:this.noop,data:r}))!=null?i:""},4:function(e,t,n,r){var i;return"\n"+((i=t["if"].call(e,e!=null?e.duplicate:e,{name:"if",hash:{},fn:this.program(5,r,0),inverse:this.program(7,r,0),data:r}))!=null?i:"")+'\n<div class="hr hr10"></div>\n'},5:function(e,t,n,r){return'    <h3 class="green lighter">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.variants.duplicate.title",{name:"t",hash:{},data:r}))+"</h3>\n"},7:function(e,t,n,r){return'    <h3 class="green lighter">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.variants.edit.title",{name:"t",hash:{},data:r}))+"</h3>\n"},9:function(e,t,n,r){return"col-lg-6"},11:function(e,t,n,r){return"col-xs-12"},13:function(e,t,n,r){return" hide "},15:function(e,t,n,r){var i;return((i=t.unless.call(e,e!=null?e.inEdit:e,{name:"unless",hash:{},fn:this.program(16,r,0),inverse:this.noop,data:r}))!=null?i:"")+((i=t["if"].call(e,e!=null?e.inEdit:e,{name:"if",hash:{},fn:this.program(18,r,0),inverse:this.noop,data:r}))!=null?i:"")},16:function(e,t,n,r){return'      <div class="text-right">\n        <a href="#" class="btn btn-sm btn-success">\n          <i class="fa fa-plus"></i>\n          '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.variants.edit.label.add",{name:"t",hash:{},data:r}))+"\n        </a>\n      </div>\n"},18:function(e,t,n,r){var i;return'      <div class="form-actions text-right">\n        <a href="#" class="btn btn-default cancel-variant">\n          <i class="fa fa-undo"></i>\n          '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.cancel",{name:"t",hash:{},data:r}))+'\n        </a>\n        <a href="#" class="btn btn-primary main-action save-variant">\n          <i class="fa fa-save"></i>\n'+((i=t["if"].call(e,e!=null?e.duplicate:e,{name:"if",hash:{},fn:this.program(19,r,0),inverse:this.program(21,r,0),data:r}))!=null?i:"")+"        </a>\n      </div>\n"},19:function(e,t,n,r){return"            "+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.duplicate",{name:"t",hash:{},data:r}))+"\n"},21:function(e,t,n,r){return"            "+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.save",{name:"t",hash:{},data:r}))+"\n"},23:function(e,t,n,r){var i;return'  <div class="col-lg-6">\n    <h4 class="green lighter">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.variants.list.title",{name:"t",hash:{},data:r}))+'</h4>\n    <table class="table table-striped table-bordered table-hover dt-responsive dataTable no-footer">\n      <thead>\n      <tr>\n        <th>'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.variants.list.headers.preview",{name:"t",hash:{},data:r}))+'</th>\n        <th class="table-span-7">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.variants.list.headers.variantName",{name:"t",hash:{},data:r}))+'</th>\n        <th class="table-span-3">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.variants.list.headers.type",{name:"t",hash:{},data:r}))+'</th>\n        <th class="table-span-3">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.variants.list.headers.dimensions",{name:"t",hash:{},data:r}))+'</th>\n        <th class="table-span-2">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.variants.list.headers.metadata",{name:"t",hash:{},data:r}))+"</th>\n        <th></th>\n      </tr>\n      </thead>\n      <tbody>\n"+((i=t.each.call(e,e!=null?e.variants:e,{name:"each",hash:{},fn:this.program(24,r,0),inverse:this.noop,data:r}))!=null?i:"")+"      </tbody>\n    </table>\n  </div>\n"},24:function(e,t,n,r){var i,s,o,u="        <tr>\n          <td>\n";return i=(s=(s=t.readOnlyView||(e!=null?e.readOnlyView:e))!=null?s:t.helperMissing,o={name:"readOnlyView",hash:{},fn:this.program(25,r,0),inverse:this.program(27,r,0),data:r},typeof s=="function"?s.call(e,o):s),t.readOnlyView||(i=t.blockHelperMissing.call(e,i,o)),i!=null&&(u+=i),u+="          </td>\n          <td>\n",i=(s=(s=t.readOnlyView||(e!=null?e.readOnlyView:e))!=null?s:t.helperMissing,o={name:"readOnlyView",hash:{},fn:this.program(29,r,0),inverse:this.program(31,r,0),data:r},typeof s=="function"?s.call(e,o):s),t.readOnlyView||(i=t.blockHelperMissing.call(e,i,o)),i!=null&&(u+=i),u+"          </td>\n          <td>"+this.escapeExpression(this.lambda(e!=null?e.mode:e,e))+"</td>\n          <td>"+this.escapeExpression(this.lambda(e!=null?e.dimensionsString:e,e))+"</td>\n          <td>"+this.escapeExpression((s=(s=t.meta||(e!=null?e.meta:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"meta",hash:{},data:r}):s))+'</td>\n          <td>\n            <div class="btn-group">\n'+((i=t["with"].call(e,e,{name:"with",hash:{},fn:this.program(33,r,0),inverse:this.noop,data:r}))!=null?i:"")+"            </div>\n          </td>\n"},25:function(e,t,n,r){var i;return'              <span  data-id="'+this.escapeExpression((i=(i=t.id||(e!=null?e.id:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"id",hash:{},data:r}):i))+'">\n                 <img src="'+this.escapeExpression((i=(i=t.thumbnailURL||(e!=null?e.thumbnailURL:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"thumbnailURL",hash:{},data:r}):i))+'" class="img-responsive">\n             </span>\n'},27:function(e,t,n,r){var i;return'\n            <a href="#" class="edit-variant" data-id="'+this.escapeExpression((i=(i=t.id||(e!=null?e.id:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"id",hash:{},data:r}):i))+'">\n              <img src="'+this.escapeExpression((i=(i=t.thumbnailURL||(e!=null?e.thumbnailURL:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"thumbnailURL",hash:{},data:r}):i))+'" class="img-responsive">\n            </a>\n'},29:function(e,t,n,r){var i;return'             <span data-id="'+this.escapeExpression((i=(i=t.id||(e!=null?e.id:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"id",hash:{},data:r}):i))+'">'+this.escapeExpression(this.lambda(e!=null?e.name:e,e))+' <span class="badge badge-default pull-right">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.id",{name:"t",hash:{},data:r}))+":"+this.escapeExpression(this.lambda(e!=null?e.id:e,e))+"</span></span>\n"},31:function(e,t,n,r){var i;return'            <a href="#" class="edit-variant" data-id="'+this.escapeExpression((i=(i=t.id||(e!=null?e.id:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"id",hash:{},data:r}):i))+'">'+this.escapeExpression((t.decode||e&&e.decode||t.helperMissing).call(e,e!=null?e.name:e,{name:"decode",hash:{},data:r}))+' <span class="badge badge-default pull-right">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.id",{name:"t",hash:{},data:r}))+":"+this.escapeExpression(this.lambda(e!=null?e.id:e,e))+"</span></a>\n"},33:function(e,t,n,r){var i,s,o,u="";return i=(s=(s=t.actionButton||(e!=null?e.actionButton:e))!=null?s:t.helperMissing,o={name:"actionButton",hash:{},fn:this.program(34,r,0),inverse:this.noop,data:r},typeof s=="function"?s.call(e,o):s),t.actionButton||(i=t.blockHelperMissing.call(e,i,o)),i!=null&&(u+=i),u},34:function(e,t,n,r){var i,s,o,u="";return i=(s=(s=t.readOnlyView||(e!=null?e.readOnlyView:e))!=null?s:t.helperMissing,o={name:"readOnlyView",hash:{},fn:this.program(35,r,0),inverse:this.program(37,r,0),data:r},typeof s=="function"?s.call(e,o):s),t.readOnlyView||(i=t.blockHelperMissing.call(e,i,o)),i!=null&&(u+=i),u},35:function(e,t,n,r){return"                    "+this.escapeExpression((t.actionLink||e&&e.actionLink||t.helperMissing).call(e,{name:"actionLink",hash:{language:e!=null?e.language:e,id:e!=null?e.id:e,"class":"download",text:"common:action.download",icon:"cloud-download",link:"#"},data:r}))+"\n"},37:function(e,t,n,r){return"                    "+this.escapeExpression((t.actionLink||e&&e.actionLink||t.helperMissing).call(e,{name:"actionLink",hash:{id:e!=null?e.id:e,"class":"edit-variant",text:"media:action.editVariant",icon:"edit",link:"#"},data:r}))+"\n                    "+this.escapeExpression((t.actionLink||e&&e.actionLink||t.helperMissing).call(e,{name:"actionLink",hash:{id:e!=null?e.id:e,"class":"duplicate-variant",text:"common:action.duplicate",icon:"copy",link:"#"},data:r}))+"\n                    "+this.escapeExpression((t.actionLink||e&&e.actionLink||t.helperMissing).call(e,{name:"actionLink",hash:{language:e!=null?e.language:e,id:e!=null?e.id:e,"class":"download",text:"common:action.download",icon:"cloud-download",link:"#"},data:r}))+"\n                    "+this.escapeExpression((t.actionLink||e&&e.actionLink||t.helperMissing).call(e,{name:"actionLink",hash:{divider:!0},data:r}))+"\n                    "+this.escapeExpression((t.actionLink||e&&e.actionLink||t.helperMissing).call(e,{name:"actionLink",hash:{id:e!=null?e.id:e,"class":"erase-variant",text:"common:action.erase",icon:"trash-o",link:"#"},data:r}))+"\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i,s,o,u=((i=t.unless.call(e,e!=null?e.inEdit:e,{name:"unless",hash:{},fn:this.program(1,r,0),inverse:this.noop,data:r}))!=null?i:"")+((i=t["if"].call(e,e!=null?e.inEdit:e,{name:"if",hash:{},fn:this.program(3,r,0),inverse:this.noop,data:r}))!=null?i:"")+'<div class="crop-tool"></div>\n\n<div class="hr hr10"></div>\n\n<div class="row">\n  <div class="'+((i=t.unless.call(e,e!=null?e.inEdit:e,{name:"unless",hash:{},fn:this.program(9,r,0),inverse:this.noop,data:r}))!=null?i:"")+((i=t["if"].call(e,e!=null?e.inEdit:e,{name:"if",hash:{},fn:this.program(11,r,0),inverse:this.noop,data:r}))!=null?i:"")+" ";return i=(s=(s=t.readOnlyView||(e!=null?e.readOnlyView:e))!=null?s:t.helperMissing,o={name:"readOnlyView",hash:{},fn:this.program(13,r,0),inverse:this.noop,data:r},typeof s=="function"?s.call(e,o):s),t.readOnlyView||(i=t.blockHelperMissing.call(e,i,o)),i!=null&&(u+=i),u+'">\n    <form class="form-horizontal">\n\n      <div class="form-group">\n        <label class="col-xs-12">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.variants.edit.label.name",{name:"t",hash:{},data:r}))+" "+((i=(s=(s=t.required||(e!=null?e.required:e))!=null?s:t.helperMissing,typeof s==="function"?s.call(e,{name:"required",hash:{},data:r}):s))!=null?i:"")+'</label>\n        <div class="col-xs-12">\n           <span class="block">\n             <input name="variant-name" type="text" placeholder="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.variants.edit.placeholder.name",{name:"t",hash:{},data:r}))+'" class="width-100" value="'+this.escapeExpression((t.decode||e&&e.decode||t.helperMissing).call(e,(i=e!=null?e.variant:e)!=null?i.name:i,{name:"decode",hash:{},data:r}))+'">\n           </span>\n        </div>\n      </div>\n\n      <div class="form-group">\n        <label class="col-xs-12">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.variants.edit.label.description",{name:"t",hash:{},data:r}))+'</label>\n        <div class="col-xs-12">\n           <span class="block">\n             <input name="variant-description" type="text" placeholder="'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.variants.edit.placeholder.description",{name:"t",hash:{},data:r}))+'" class="width-100" value="'+this.escapeExpression((t.decode||e&&e.decode||t.helperMissing).call(e,(i=e!=null?e.variant:e)!=null?i.description:i,{name:"decode",hash:{},data:r}))+'">\n           </span>\n        </div>\n      </div>\n'+((i=t.unless.call(e,e!=null?e.inModal:e,{name:"unless",hash:{},fn:this.program(15,r,0),inverse:this.noop,data:r}))!=null?i:"")+"    </form>\n  </div>\n"+((i=t.unless.call(e,e!=null?e.inEdit:e,{name:"unless",hash:{},fn:this.program(23,r,0),inverse:this.noop,data:r}))!=null?i:"")+"</div>\n"},useData:!0})}),define("module/common/media/view/edit/variants",["require","jquery","underscore","backbone","i18n","Handlebars","helper/makeup","module/common/media/view/cropTool","module/common/media/model/variant","module/common/media/model/variants","hbars!module/common/media/template/edit/variants"],function(e){var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("i18n"),s=e("Handlebars"),o=e("helper/makeup"),u=e("module/common/media/view/cropTool"),a=e("module/common/media/model/variant"),f=e("module/common/media/model/variants"),l=e("hbars!module/common/media/template/edit/variants");return r.View.extend({template:l,events:{"click .btn-success":"save","click .edit-variant":"notifyEdit","click .duplicate-variant":"notifyDuplicate","click .erase-variant":"notifyErase","click .save-variant":"notifySave","click .cancel-variant":"back"},initialize:function(e){this.options=e||{},this.moduleName=this.options.moduleName,this.model=this.options.model,this.navigator=this.options.navigator,this.parent=this.options.parent,this.cropToolView=new u({}),this.collection=new f,this.variantModel=new a,this.mode="add",this.collection.on("sync:read",this.refresh.bind(this)),this.variantModel.on("sync:update",this.notifyAdded.bind(this)),r.on("media:variant:validationError",this.notifyValidationError.bind(this)),r.on("media:variant:edit",this.editVariant.bind(this)),r.on("media:variant:erased",this.fetched.bind(this)),r.on("media:edit:variants",this.listVariant.bind(this)),r.trigger("notifier:subscribe","media:variant:added"),r.trigger("notifier:subscribe","media:variant:edited"),r.trigger("notifier:subscribe","media:variant:erased"),r.trigger("notifier:subscribe","media:variant:duplicated")},serialize:function(){return{variants:this.collection.toJSON(),inModal:this.inModal,inEdit:this.variantsMode==="edit",variant:this.variant?this.variant.toJSON():this.variant,duplicate:this.duplicate}},beforeRender:function(){this.insertView(".crop-tool",this.cropToolView),this.$("table").each(function(){t(this).dataTable().fnDestroy()}),this.$("select").each(function(){t(this).select2("destroy")})},afterRender:function(){var e=this.variant?this.variant.get("dimensionsLabel"):undefined,t=undefined!=e?e.split("/")[1]:"";o.createSelect({el:this.$(".crop-options")}),this.$(".crop-options").select2("val",t||"unconstrained"),o.createSelect({el:this.$(".resize-options")}),this.$(".resize-options").select2("val",t||"custom"),o.createActionDataTable({el:this.$("table")})},save:function(e){e.preventDefault();var t=this.$('[name="variant-name"]').val(),n=this.$('[name="variant-description"]').val(),s=this.cropToolView.getSelection();if(!t||""===t)return r.trigger("media:variant:validationError",{"variant-name":i.t("media:edit.variants.validation.name")}),!1;this.variantModel[s.mode](t,n,s.selection,s.variantMode)},getSelection:function(e){e.preventDefault()},fetched:function(){this.cropToolView.setImage(this.model.get("mediaURL")),this.collection.id=this.model.get("id"),this.collection.language=this.model.get("language"),this.collection.fetch(),this.variantModel.id=this.model.id,this.variantModel.language=this.model.get("language")},notifyCancel:function(){this.cropToolView&&this.cropToolView.cropTool&&this.cropToolView.cropTool.cancelSelection()},notifyEdit:function(e){e.preventDefault();var n=t(e.currentTarget),r=n.data("id");this.navigator.editVariant(this.model.get("id"),this.model.get("language"),r)},notifyDuplicate:function(e){e.preventDefault();var n=t(e.currentTarget),r=n.data("id");this.navigator.duplicateVariant(this.model.get("id"),this.model.get("language"),r)},notifyErase:function(e){e.preventDefault();var n=t(e.currentTarget),i=n.data("id"),s=this.collection.get(i),o=s?s.toJSON():{};r.trigger("media:variant:erase",o,{categoryID:this.model.get("categories")[0]})},notifySave:function(e){e.preventDefault();var t=this.$('[name="variant-name"]').val(),n=this.$('[name="variant-description"]').val(),r=this.cropToolView.getSelection()||{};this.variant.language=this.model.get("language"),this.duplicate?this.variant.duplicate(t,n,r,this.model.id,r.variantMode):this.variant.edit(t,n,r,this.model.id,r.variantMode)},notifyAdded:function(){this.fetched(),r.trigger("media:variant:added")},notifyEdited:function(){this.variantsMode="list",this.navigator.edit(this.model.id,this.model.get("language"),"variants"),this.fetched(),r.trigger("media:variant:"+(this.duplicate?"duplicated":"edited"))},notifyValidationError:function(){var e=this,t=arguments[0];Object.keys(t).forEach(function(n){r.Validation.callbacks.invalid(e,n,t[n],"name")})},back:function(e){e.preventDefault(),this.navigator.back()},refresh:function(){this.variantsMode==="edit"?this.editVariant(this.model.get("id"),this.language,this.variantID,this.inModal,this.duplicate):this.render()},editVariant:function(e,t,n,r,i){this.variantID=parseInt(n,10),this.language=t,this.variant=this.collection.get(this.variantID),this.variantsMode="edit",this.duplicate=!!i,this.inModal=!!r;if(this.variant){this.variant._events["sync:update"]||this.variant.on("sync:update",this.notifyEdited,this);var s=this.variant.get("selection");this.cropToolView.setSelection(this.variant.get("mode"),s)}this.render()},listVariant:function(){this.inModal=!1,this.variantsMode="list",this.duplicate=!1,this.variant=null,this.cropToolView.setSelection("crop",null),this.render()}})}),define("hbars!module/common/media/template/edit/categorisation",["Handlebars"],function(e){return e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){return'<div class="row">\n  <div class="col-xs-12">\n    <h3 class="green lighter">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.categorisation.title",{name:"t",hash:{},data:r}))+"</h3>\n    <p>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.categorisation.description",{name:"t",hash:{},data:r}))+'</p>\n    <div id="categorisation"></div>\n  </div>\n</div>'},useData:!0})}),define("module/common/media/view/edit/categorisation",["require","backbone","hbars!module/common/media/template/edit/categorisation","module/common/category/tree/view/tree"],function(e){var t=e("backbone"),n=e("hbars!module/common/media/template/edit/categorisation"),r=e("module/common/category/tree/view/tree");return t.View.extend({template:n,initialize:function(e){this.options=e||{},this.moduleName=this.options.moduleName,this.model=this.options.model,this.categoriesView=new r({moduleName:this.moduleName,showActions:!1,showCheckboxes:!0,altModuleName:"edit",folderSelect:!1}),t.trigger("notifier:subscribe","media:warning:noCategory")},serialize:function(){return{}},beforeRender:function(){this.insertView("#categorisation",this.categoriesView)},fetched:function(){this.categoriesView.setCategories(this.model.get("categories"))},getFormData:function(){var e=this.categoriesView.getSelected().join(",");return e?{categories:e}:(t.trigger("media:warning:noCategory"),!1)}})}),define("hbars!module/common/media/template/edit/history",["Handlebars"],function(e){return e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){return'<div class="row">\n  <div class="col-xs-12">\n    <div id="versions"></div>\n  </div>\n</div>'},useData:!0})}),define("module/common/media/model/mediaHistory",["underscore","jquery","backbone"],function(e,t,n){return n.Collection.extend({url:function(){return n.SERVICE_BASE_URL+"/media/"+this.id+"/"+this.language+"/versions"}})}),define("module/common/media/view/edit/history",["require","backbone","hbars!module/common/media/template/edit/history","module/common/version/view/list","module/common/media/model/mediaHistory"],function(e){var t=e("backbone"),n=e("hbars!module/common/media/template/edit/history"),r=e("module/common/version/view/list"),i=e("module/common/media/model/mediaHistory");return t.View.extend({template:n,initialize:function(e){this.options=e||{},this.moduleName=this.options.moduleName,this.model=this.options.model,this.collection=new i,this.collection.on("sync:read",this.refresh.bind(this))},serialize:function(){return{}},beforeRender:function(){this.versionsView&&(this.versionsView.isLoading=!1,this.insertView("#versions",this.versionsView))},fetched:function(){this.collection.id=this.model.get("id"),this.collection.language=this.model.get("language"),this.collection.fetch()},refresh:function(){this.model.set("versions",this.collection.toJSON()),this.versionsView=new r({moduleName:this.moduleName,model:this.model,canCompare:!1}),this.render()}})}),define("hbars!module/common/media/template/edit/usage",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){return"<th></th>"},3:function(e,t,n,r,i,s){var o;return"      <tr>\n        <td>"+this.escapeExpression(this.lambda(e!=null?e.contentName:e,e))+"</td>\n        <td>"+this.escapeExpression(this.lambda(e!=null?e.assetType:e,e))+"</td>\n        <td>"+this.escapeExpression(this.lambda(e!=null?e.variant:e,e))+"</td>\n        <td>"+((o=this.lambda(e!=null?e.location:e,e))!=null?o:"")+"</td>\n        <td>"+this.escapeExpression(this.lambda(e!=null?e.occurrences:e,e))+"</td>\n"+((o=(t.hasAccessToAny||e&&e.hasAccessToAny||t.helperMissing).call(e,s[1]!=null?s[1].usage:s[1],{name:"hasAccessToAny",hash:{},fn:this.program(4,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+">\n      </tr>\n"},4:function(e,t,n,r){var i;return"        <td>\n"+((i=t["if"].call(e,e!=null?e.hasAccess:e,{name:"if",hash:{},fn:this.program(5,r,0),inverse:this.noop,data:r}))!=null?i:"")+"        </td>\n        "},5:function(e,t,n,r){var i,s;return'          <div class="btn-group">\n            <button data-toggle="dropdown" class="btn btn-info btn-xs dropdown-toggle">\n              <i class="fa fa-cog"></i>\n              '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.actions",{name:"t",hash:{},data:r}))+'\n              <span class="ace-icon fa fa-caret-down icon-on-right"></span>\n            </button>\n            <ul class="dropdown-menu dropdown-menu-right dropdown-caret pull-right">\n              <li>\n                <a href="'+((i=this.lambda(e!=null?e.getUrl:e,e))!=null?i:"")+'" class="edit-variant" data-id="'+this.escapeExpression((s=(s=t.id||(e!=null?e.id:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"id",hash:{},data:r}):s))+'">\n                  <i class="fa fa-edit"></i>\n                  '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:action.editContent",{name:"t",hash:{},data:r}))+"\n                </a>\n              </li>\n            </ul>\n          </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r,i,s){var o;return'<div class="row">\n  <div class="col-xs-12">\n    <h3 class="lighter green">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.usage.title",{name:"t",hash:{},data:r}))+'</h3>\n\n    <table class="table table-striped table-bordered table-hover dt-responsive dataTable no-footer">\n      <thead>\n      <tr>\n        <th>'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.usage.list.headers.contentName",{name:"t",hash:{},data:r}))+"</th>\n        <th>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.usage.list.headers.assetType",{name:"t",hash:{},data:r}))+"</th>\n        <th>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.usage.list.headers.variant",{name:"t",hash:{},data:r}))+"</th>\n        <th>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.usage.list.headers.location",{name:"t",hash:{},data:r}))+"</th>\n        <th>"+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.usage.list.headers.occurrences",{name:"t",hash:{},data:r}))+"</th>\n        "+((o=(t.hasAccessToAny||e&&e.hasAccessToAny||t.helperMissing).call(e,e!=null?e.usage:e,{name:"hasAccessToAny",hash:{},fn:this.program(1,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+">\n      </tr>\n      </thead>\n      <tbody>\n"+((o=t.each.call(e,e!=null?e.usage:e,{name:"each",hash:{},fn:this.program(3,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"      </tbody>\n    </table>\n  </div>\n</div>\n"},useData:!0,useDepths:!0})}),define("module/common/media/model/mediaUsage",["underscore","jquery","backbone"],function(e,t,n){return n.Collection.extend({url:function(){return n.SERVICE_BASE_URL+"/media/"+this.id+"/"+this.language+"/usage"},parse:function(t){return e.each(t||[],function(e){var t=e.location.split("\n");t[t.length-1]||t.pop(),e.location=t.join("<br>")}),t}})}),define("module/common/media/view/edit/usage",["require","jquery","underscore","backbone","i18n","Handlebars","helper/makeup","hbars!module/common/media/template/edit/usage","helper/redirectHelper","module/common/media/model/mediaUsage"],function(e){var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("i18n"),s=e("Handlebars"),o=e("helper/makeup"),u=e("hbars!module/common/media/template/edit/usage"),a=e("helper/redirectHelper"),f=e("module/common/media/model/mediaUsage");return r.View.extend({template:u,events:{"click .edit-variant":"editVariant"},initialize:function(e){this.options=e||{},this.moduleName=this.options.moduleName,this.model=this.options.model,this.collection=new f,this.collection.on("sync:read",this.render.bind(this)),this.registerHelpers()},editVariant:function(e){var t=e.currentTarget.href;e.preventDefault(),a.redirectTo(t)},serialize:function(){var e=n.map(this.collection.toJSON(),function(e){return e.getUrl=this.getUrl(e),e},this);return{usage:e}},getUrl:function(e){return e.assetType==="media"?e.assetType+"#edit/"+e.contentID+"/"+e.language:e.assetType==="content"?e.assetType+"#edit/"+e.sectionID+"/"+e.contentID:e.assetType+"#edit/"+e.contentID},beforeRender:function(){this.$("table").each(function(){t(this).dataTable().fnDestroy()})},afterRender:function(){o.createActionDataTable({el:this.$("table")})},fetched:function(){this.collection.id=this.model.get("id"),this.collection.language=this.model.get("language"),this.collection.fetch()},registerHelpers:function(){s.registerHelper("hasAccessToAny",function(e,t){var r=n.filter(e,function(e){return e.hasAccess}),i=r&&r.length>0;return i?t.fn(this):t.inverse(this)})}})}),define("hbars!module/common/media/template/edit",["Handlebars"],function(e){return e.template({1:function(e,t,n,r,i,s){var o,u,a,f='    <div class="tabbable">\n        <ul class="nav nav-tabs">\n            <li class="active">\n                <a href="#media-general">\n                    <i class="ace-icon fa fa-sliders"></i>\n                    <span class="hidden-xs">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.tabs.general",{name:"t",hash:{},data:r}))+"</span>\n                </a>\n            </li>\n\n";return o=(u=(u=t.inEdit||(e!=null?e.inEdit:e))!=null?u:t.helperMissing,a={name:"inEdit",hash:{},fn:this.program(2,r,0,i,s),inverse:this.noop,data:r},typeof u=="function"?u.call(e,a):u),t.inEdit||(o=t.blockHelperMissing.call(e,o,a)),o!=null&&(f+=o),f+="\n",o=(u=(u=t.inEdit||(e!=null?e.inEdit:e))!=null?u:t.helperMissing,a={name:"inEdit",hash:{},fn:this.program(10,r,0,i,s),inverse:this.program(12,r,0,i,s),data:r},typeof u=="function"?u.call(e,a):u),t.inEdit||(o=t.blockHelperMissing.call(e,o,a)),o!=null&&(f+=o),f+'        </ul>\n\n    <div class="tab-content">\n        <div id="spinner"></div>\n        <div id="media-general" class="tab-pane active"></div>\n        <div id="media-editor" class="tab-pane"></div>\n'},2:function(e,t,n,r,i,s){var o;return((o=(t.showEditor||e&&e.showEditor||t.helperMissing).call(e,e!=null?e.model:e,{name:"showEditor",hash:{},fn:this.program(3,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+((o=(t.showVariants||e&&e.showVariants||t.helperMissing).call(e,e!=null?e.model:e,{name:"showVariants",hash:{},fn:this.program(6,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"\n"+((o=t.unless.call(e,s[2]!=null?s[2].readOnly:s[2],{name:"unless",hash:{},fn:this.program(8,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"\n"},3:function(e,t,n,r,i,s){var o;return(o=t.unless.call(e,s[2]!=null?s[2].readOnly:s[2],{name:"unless",hash:{},fn:this.program(4,r,0,i,s),inverse:this.noop,data:r}))!=null?o:""},4:function(e,t,n,r){return'                        <li>\n                            <a href="#media-editor">\n                                <i class="ace-icon fa fa-edit"></i>\n                                <span class="hidden-xs">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.tabs.editor",{name:"t",hash:{},data:r}))+"</span>\n                            </a>\n                        </li>\n"},6:function(e,t,n,r){return'                    <li>\n                        <a href="#media-variants">\n                            <i class="ace-icon fa fa-crop"></i>\n                            <span class="hidden-xs">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.tabs.variants",{name:"t",hash:{},data:r}))+"</span>\n                        </a>\n                    </li>\n"},8:function(e,t,n,r){return'                    <li>\n                        <a href="#media-categorisation">\n                            <i class="ace-icon fa fa-sitemap"></i>\n                            <span class="hidden-xs">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.tabs.categorisation",{name:"t",hash:{},data:r}))+"</span>\n                        </a>\n                    </li>\n"},10:function(e,t,n,r){return'\n                <li>\n                    <a href="#media-history">\n                        <i class="ace-icon fa fa-clock-o"></i>\n                        <span class="hidden-xs">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.tabs.history",{name:"t",hash:{},data:r}))+'</span>\n                    </a>\n                </li>\n\n                <li>\n                    <a href="#media-usage">\n                        <i class="ace-icon fa fa-list"></i>\n                        <span class="hidden-xs">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.tabs.usage",{name:"t",hash:{},data:r}))+"</span>\n                    </a>\n                </li>\n"},12:function(e,t,n,r){return""},14:function(e,t,n,r,i,s){var o;return'        <div id="media-categorisation" class="tab-pane"></div>\n        <div id="media-history" class="tab-pane"></div>\n        <div id="media-usage" class="tab-pane"></div>\n    </div>\n    </div>\n'+((o=t.unless.call(e,e!=null?e.hideActions:e,{name:"unless",hash:{},fn:this.program(15,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")},15:function(e,t,n,r,i,s){var o;return'        <div class="form-actions text-right">\n'+((o=t["if"].call(e,s[2]!=null?s[2].readOnly:s[2],{name:"if",hash:{},fn:this.program(16,r,0,i,s),inverse:this.program(18,r,0,i,s),data:r}))!=null?o:"")+"        </div>\n"},16:function(e,t,n,r){return'                <a href="#" class="btn btn-default cancel">\n                    <i class="fa fa-undo"></i>\n                    '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.cancel",{name:"t",hash:{},data:r}))+"\n                </a>\n"},18:function(e,t,n,r){var i,s,o,u='                <a href="#" class="btn btn-default cancel">\n                    <i class="fa fa-undo"></i>\n                    '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.cancel",{name:"t",hash:{},data:r}))+'\n                </a>\n\n                <button class="btn btn-primary main-action save-media" type="submit">\n                    <i class="fa fa-save"></i>\n                    '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.save",{name:"t",hash:{},data:r}))+"\n                </button>\n";return i=(s=(s=t.inEdit||(e!=null?e.inEdit:e))!=null?s:t.helperMissing,o={name:"inEdit",hash:{},fn:this.program(19,r,0),inverse:this.noop,data:r},typeof s=="function"?s.call(e,o):s),t.inEdit||(i=t.blockHelperMissing.call(e,i,o)),i!=null&&(u+=i),u},19:function(e,t,n,r){return'                    <a href="#" class="btn btn-danger pull-left erase">\n                        <i class="fa fa-trash-o"></i>\n                        '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.erase",{name:"t",hash:{},data:r}))+"\n                    </a>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r,i,s){var o,u,a,f="";return o=(u=(u=t.hideInVariants||(e!=null?e.hideInVariants:e))!=null?u:t.helperMissing,a={name:"hideInVariants",hash:{},fn:this.program(1,r,0,i,s),inverse:this.noop,data:r},typeof u=="function"?u.call(e,a):u),t.hideInVariants||(o=t.blockHelperMissing.call(e,o,a)),o!=null&&(f+=o),f+='    <div id="media-variants" class="tab-pane"></div>\n',o=(u=(u=t.hideInVariants||(e!=null?e.hideInVariants:e))!=null?u:t.helperMissing,a={name:"hideInVariants",hash:{},fn:this.program(14,r,0,i,s),inverse:this.noop,data:r},typeof u=="function"?u.call(e,a):u),t.hideInVariants||(o=t.blockHelperMissing.call(e,o,a)),o!=null&&(f+=o),f},useData:!0,useDepths:!0})}),define("hbars!module/tools/spinner/template/spinner",["Handlebars"],function(e){return e.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){return'<div class="t4-de-loading-overlay"></div>\n<div class="t4-de-loading-spinner">\n  <div class="loading text-center">\n    <div class="space-32"></div>\n    <br>\n    <div class="space-32"></div>\n    <br>\n    <div class="space-32"></div>\n    <i class="fa fa-spinner fa-3x fa-spin" style="z-index: 10001"></i>\n    <br>'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.loading",{name:"t",hash:{},data:r}))+"\n  </div>\n</div>\n<style>\n  .t4-de-loading-spinner{\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 10001;\n    color: white;\n  }\n\n  .t4-de-loading-overlay{\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: #000;\n    filter:alpha(opacity=50);\n    -moz-opacity:0.5;\n    -khtml-opacity: 0.5;\n    opacity: 0.5;\n    z-index: 10000;\n  }\n\n  #gritter-notice-wrapper {\n    z-index:10002;\n  }\n</style>"},useData:!0})}),define("module/tools/spinner/view/spinner",["require","backbone","jquery","hbars!module/tools/spinner/template/spinner"],function(e){var t=e("backbone"),n=e("jquery"),r=e("hbars!module/tools/spinner/template/spinner");return t.View.extend({template:r,initialize:function(e){e=e||{},this.showSpinnerEvent=e.showSpinnerEvent||"spinner:show",this.hideSpinnerEvent=e.hideSpinnerEvent||"spinner:hide",this.listenTo(t,this.showSpinnerEvent,this.showSpinner),this.listenTo(t,this.hideSpinnerEvent,this.hideSpinner)},afterRender:function(){this.hideSpinner()},showSpinner:function(){this.$(".t4-de-loading-spinner").show(),this.$(".t4-de-loading-overlay").show()},hideSpinner:function(){this.$(".t4-de-loading-spinner").hide(),this.$(".t4-de-loading-overlay").hide()}})}),define("module/common/media/view/edit",["require","jquery","underscore","backbone","Handlebars","module/common/media/model/media","module/common/media/view/edit/general","module/common/media/view/edit/editor","module/common/media/view/edit/variants","module/common/media/view/edit/categorisation","module/common/media/view/edit/history","module/common/media/view/edit/usage","hbars!module/common/media/template/edit","module/tools/spinner/view/spinner","helper/redirectHelper"],function(e){var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("Handlebars"),s=e("module/common/media/model/media"),o=e("module/common/media/view/edit/general"),u=e("module/common/media/view/edit/editor"),a=e("module/common/media/view/edit/variants"),f=e("module/common/media/view/edit/categorisation"),l=e("module/common/media/view/edit/history"),c=e("module/common/media/view/edit/usage"),h=e("hbars!module/common/media/template/edit"),p=e("module/tools/spinner/view/spinner"),d=e("helper/redirectHelper");return r.View.extend({template:h,events:{"click .save-media":"save","click .cancel":"notifyCancel","click .tabbable > ul > li > a":"clickTab","click .erase":"notifyErase","shown.bs.tab .nav-tabs a":"focusCodeMirror"},initialize:function(e){this.options=e||{},this.moduleName=this.options.moduleName,this.navigator=this.options.navigator,this.hideActions=this.options.hideActions,this.modal=this.options.modal,this.model=new s,r.trigger("notifier:subscribe","media:added"),r.trigger("notifier:subscribe","media:edited"),r.trigger("notifier:subscribe","media:erased"),this.initializeViews(),this.registerListeners(),this.registerHelpers(),this.hide()},initializeViews:function(){this.ev=t.extend({},r.Events);var e={moduleName:this.moduleName,model:this.model,navigator:this.navigator,parent:this,ev:this.ev};this.generalView=new o(e),this.editorView=new u(e),this.variantsView=new a(e),this.categorisationView=new f(e),this.historyView=new l(e),this.usageView=new c(e),this.spinner=new p},registerListeners:function(){r.on(this.moduleName+":home",this.hide.bind(this)),r.on(this.moduleName+":edit",this.showEdit.bind(this)),r.on(this.moduleName+":add",this.showAdd.bind(this)),r.on(this.moduleName+":save:validationError",this.notifyError.bind(this)),r.on(this.moduleName+":variant:edit",this.showEditVariant.bind(this)),r.on(this.moduleName+":category:add",this.hide.bind(this)),r.on(this.moduleName+":category:edit",this.hide.bind(this)),r.on(this.moduleName+":variants",this.hide.bind(this)),r.on(this.moduleName+":search",this.hide.bind(this)),r.on(this.moduleName+":home:open",this.hide.bind(this)),this.listenTo(r,this.moduleName+":edit:readOnly",this.showViewOnly),this.listenTo(r,this.moduleName+":readOnly",this.showViewOnly),this.model.on("sync:read",this.modelReceived.bind(this)),this.model.on("sync:create",this.notifyAdded.bind(this)),r.on("media:created:form",this.mediaCreatedByForm.bind(this)),this.model.on("sync:update",this.notifyEdited.bind(this)),r.on("media:updated:form",this.notifyEdited.bind(this))},registerHelpers:function(){var e=this;i.registerHelper("inEdit",function(t){return e.mode==="edit"?t.fn(this):t.inverse(this)}),i.registerHelper("inAdd",function(t){return e.mode==="add"?t.fn(this):t.inverse(this)}),i.registerHelper("showVariants",function(e,t){return e.mediaCanHaveVariants?t.fn(this):t.inverse(this)}),i.registerHelper("showEditor",function(t,r){var i=n.find(e.generalView.mediaTypes.toJSON(),function(e){return t.type===e.id});return i&&i.binary?r.inverse(this):r.fn(this)}),i.registerHelper("hideInVariants",function(t){return e.variants?t.inverse(this):t.fn(this)}),i.registerHelper("showInVariants",function(t){return e.variants?t.fn(this):t.inverse(this)}),i.registerHelper("readOnlyView",function(t){return Boolean(e.readOnly)===!0?t.fn(this):t.inverse(this)})},notifyViews:function(){this.isFetched=!0,this.generalView.fetched.call(this.generalView),this.editorView.fetched.call(this.editorView,this.generalView.mediaTypes.toJSON()),this.variantsView.fetched.call(this.variantsView),this.usageView.fetched.call(this.usageView),this.historyView.fetched.call(this.historyView),this.categorisationView.fetched.call(this.categorisationView),this.render()},modelReceived:function(){var e=this.model.get("mediaURL");if(this.model.forAdd){this.model.forAdd=!1;return}this.model.set("mediaURL",""),this.notifyViews(),this.setDataImage(e)},setDataImage:function(e){this.model.set("mediaURL",e),this.notifyViews()},beforeRender:function(){this.insertView("#media-general",this.generalView),this.insertView("#media-editor",this.editorView),this.insertView("#media-variants",this.variantsView),this.insertView("#media-categorisation",this.categorisationView),this.insertView("#media-history",this.historyView),this.insertView("#media-usage",this.usageView),this.insertView("#spinner",this.spinner)},afterRender:function(){this.tabName&&(this.isFetched||this.mode==="add")&&this.showTab(this.tabName),this.$('[name="dependency"]').prop("disabled",this.mode==="edit"),this.$(".save-media").size()?this.$button=this.$(".save-media"):setTimeout(function(){this.$button=t(".save")}.bind(this),0)},serialize:function(){return{mediaID:this.mediaID,mode:this.mode,hideActions:this.hideActions,model:this.model.toJSON(),variants:this.variants,readOnly:this.readOnly}},clickTab:function(e){e.preventDefault();var n=t(e.currentTarget),r=n.attr("href"),i=r.match(/(\w+)$/)[0];this.mode==="add"?this.navigator.add(this.categoryID,i):this.readOnly?this.navigator.readOnly(this.mediaID,this.language,i,this.inModal,this.categoryID):this.navigator.edit(this.mediaID,this.language,i,this.inModal)},showTab:function(e){this.$('a[href="#media-'+e+'"]').tab("show")},showEdit:function(e,t,n,r,i){var s=this.mode!=="edit"||this.mediaID!==e,o=this.variants;this.mode&&this.reset(),this.categoryID=i,this.ev.trigger("categoryID",this.categoryID),this.mode="edit",this.inModal=!!r,this.language=t,this.mediaID=e,s&&this.fetch(e,t),this.tabName=n||"general",this.variants=!1,this.showTab(this.tabName),this.show(),o&&this.render(),s&&(this.model.clear(),this.render())},showAdd:function(e,t){var n=this.mode!=="add";this.categorisationView.categoriesView.setCategories([e]),this.mode&&this.reset(),this.mode="add",this.categoryID=e,t?this.tabName=t:this.tabName="general",this.variants=!1,this.showTab(this.tabName),this.show(),n&&(this.model.clear(),this.render())},showEditVariant:function(e,t){var n=this.mode!=="edit",r=!this.variants;this.mode&&this.reset(),this.variants=!0,this.mode="edit",this.language=t,this.mediaID=e,this.isFetched||this.fetch(e,t),this.tabName="variants",this.showTab(this.tabName),this.show(),r&&this.render(),n&&(this.model.clear(),this.render())},showViewOnly:function(e,t,n,r){this.readOnly=!0,this.showEdit(e,t,n,null,r)},fetch:function(e,t){this.model.set({id:e,language:t}),this.model.fetch()},save:function(e,t){e.preventDefault();var r=this.generalView.getFormData(),i=this.categorisationView.getFormData(),s=this,o=n.find(this.generalView.mediaTypes.toJSON(),function(e){return s.model.attributes.type===e.id}),u=o&&o.binary?"":this.editorView.getFormData();this.select=!!t;if(r&&i){this.$button.prop("disabled",!0),this.spinner.showSpinner();if(!this.generalView.$dropzone.supported){this.generalView.submit(n.extend({},r,i));return}this.mode==="edit"?this.model.update(n.extend({},r,i,u)):this.model.create(n.extend({},r,i))}},editVariant:function(e){this.variantsView.notifySave(e)},notifyCancel:function(e){e.preventDefault(),this.navigator.home(),this.variantsView.notifyCancel(),this.readOnly=!1,r.trigger("media:edit:cancel",this.model.id)},notifyError:function(e){this.spinner.hideSpinner(),this.$button.prop("disabled",!1),this.generalView.notifyError(e)},notifyErase:function(e){e.preventDefault(),r.trigger("media:erase",this.model.toJSON()),r.trigger("unlock",this.model.id)},reset:function(){this.mediaID=null,this.tabName=null,this.language=null},notifyAdded:function(){this.generalView.file=null,this.model.forAdd=!0,this.model.fetch({success:function(){if(this.select){var e=new s;e.set(this.model.toJSON()),this.navigator.variants(e)}else{var t=this.model.get("categories");this.navigator.home(),r.trigger("media:added",t[0])}}.bind(this)})},notifyEdited:function(){this.generalView.file=null,this.$button.prop("disabled",!1),this.spinner.hideSpinner();if(this.inModal){r.trigger("media:close"),r.trigger("media:edited"),r.trigger("unlock",this.model.id);return}if(this.select){var e=new s;e.set(this.model.toJSON()),this.navigator.variants(e)}else{var t=this.model.get("categories");this.navigator.home(),r.trigger("media:edited",this.model.id)}},focusCodeMirror:function(e){var t=this.$(e.currentTarget),n=t.attr("href"),r=/editor/i.test(n),i=this.$(n);if(!r)return;i.find("textarea").focus(),i.find(".CodeMirror").click(),setTimeout(this.editorView.editor.refresh(),100)},show:function(){this.$el.fadeIn(400)},hide:function(){this.isFetched=!1,this.mode=null,this.select=null,this.reset(),this.$el.hide(),this.model.clear()},mediaCreatedByForm:function(e){this.model.set("id",e),this.notifyAdded()}})}),define("hbars!module/common/media/template/variants/list",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){return'  <div class="loading text-center">\n    <div class="space-32"></div>\n    <i class="fa fa-spinner fa-3x fa-spin"></i>\n    <div class="space-32"></div>\n  </div>\n'},3:function(e,t,n,r,i,s){var o;return'<table class="table table-striped table-bordered table-hover dt-responsive dataTable no-footer">\n  <thead>\n  <tr>\n    <th>'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.variants.list.headers.preview",{name:"t",hash:{},data:r}))+'</th>\n    <th class="table-span-7">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.variants.list.headers.variantName",{name:"t",hash:{},data:r}))+'</th>\n    <th class="table-span-3">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.variants.list.headers.type",{name:"t",hash:{},data:r}))+'</th>\n    <th class="table-span-3">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.variants.list.headers.dimensions",{name:"t",hash:{},data:r}))+'</th>\n    <th class="table-span-2">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.variants.list.headers.metadata",{name:"t",hash:{},data:r}))+"</th>\n    <th></th>\n  </tr>\n  </thead>\n  <tbody>\n"+((o=t.each.call(e,e!=null?e.variants:e,{name:"each",hash:{},fn:this.program(4,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"  </tbody>\n</table>\n"},4:function(e,t,n,r,i,s){var o,u;return'  <tr>\n    <td>\n      <a href="#" class="select" data-id="'+this.escapeExpression((u=(u=t.id||(e!=null?e.id:e))!=null?u:t.helperMissing,typeof u=="function"?u.call(e,{name:"id",hash:{},data:r}):u))+'">\n        <img src="'+this.escapeExpression((t.thumbnailHelper||e&&e.thumbnailHelper||t.helperMissing).call(e,e,{name:"thumbnailHelper",hash:{},data:r}))+'" class="img-responsive">\n      </a>\n    </td>\n    <td>\n      <a href="#" class="select" data-id="'+this.escapeExpression((u=(u=t.id||(e!=null?e.id:e))!=null?u:t.helperMissing,typeof u=="function"?u.call(e,{name:"id",hash:{},data:r}):u))+'">\n        '+this.escapeExpression(this.lambda(e!=null?e.name:e,e))+'\n        <span class="badge badge-default pull-right">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"common.id",{name:"t",hash:{},data:r}))+":"+this.escapeExpression(this.lambda(e!=null?e.id:e,e))+"</span>\n      </a>\n    </td>\n    <td>"+((o=t["if"].call(e,e!=null?e.mode:e,{name:"if",hash:{},fn:this.program(5,r,0,i,s),inverse:this.program(7,r,0,i,s),data:r}))!=null?o:"")+"</td>\n    <td>"+this.escapeExpression(this.lambda(e!=null?e.dimensionsString:e,e))+"</td>\n    <td>"+this.escapeExpression((u=(u=t.meta||(e!=null?e.meta:e))!=null?u:t.helperMissing,typeof u=="function"?u.call(e,{name:"meta",hash:{},data:r}):u))+'</td>\n    <td>\n      <div class="btn-group">\n        <button data-toggle="dropdown" class="btn btn-info btn-xs dropdown-toggle">\n          <i class="fa fa-cog"></i>\n          '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.actions",{name:"t",hash:{},data:r}))+'\n          <span class="ace-icon fa fa-caret-down icon-on-right"></span>\n        </button>\n        <ul class="dropdown-menu dropdown-menu-right dropdown-caret pull-right">\n'+((o=t.unless.call(e,e!=null?e.original:e,{name:"unless",hash:{},fn:this.program(9,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+((o=t["if"].call(e,s[1]!=null?s[1].showLayoutsButton:s[1],{name:"if",hash:{},fn:this.program(11,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+((o=t.unless.call(e,e!=null?e.original:e,{name:"unless",hash:{},fn:this.program(13,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"        </ul>\n      </div>\n    </td>\n  </tr>\n"},5:function(e,t,n,r){return this.escapeExpression(this.lambda(e!=null?e.mode:e,e))},7:function(e,t,n,r){return this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:edit.variants.original",{name:"t",hash:{},data:r}))},9:function(e,t,n,r){var i;return'          <li>\n            <a href="#" class="edit-variant" data-id="'+this.escapeExpression((i=(i=t.id||(e!=null?e.id:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"id",hash:{},data:r}):i))+'">\n              <i class="fa fa-edit"></i>\n              '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:action.editVariant",{name:"t",hash:{},data:r}))+'\n            </a>\n          </li>\n          <li>\n            <a href="#">\n              <i class="fa fa-copy"></i>\n              '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.duplicate",{name:"t",hash:{},data:r}))+'\n            </a>\n          </li>\n          <li class="divider"></li>\n'},11:function(e,t,n,r){return'          <li>\n            <a href="#" class="contentLayouts" data-id="'+this.escapeExpression(this.lambda(e!=null?e.id:e,e))+'" data-language="'+this.escapeExpression(this.lambda(e!=null?e.language:e,e))+'">\n              <i class="fa fa-cubes"></i>\n              '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:action.selectLayout",{name:"t",hash:{},data:r}))+"\n            </a>\n          </li>\n"},13:function(e,t,n,r){return'          <li class="divider"></li>\n          <li>\n            <a href="#" class="erase">\n              <i class="fa fa-trash-o"></i>\n              '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.erase",{name:"t",hash:{},data:r}))+"\n            </a>\n          </li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r,i,s){var o;return((o=t["if"].call(e,e!=null?e.isLoading:e,{name:"if",hash:{},fn:this.program(1,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")+"\n"+((o=t.unless.call(e,e!=null?e.isLoading:e,{name:"unless",hash:{},fn:this.program(3,r,0,i,s),inverse:this.noop,data:r}))!=null?o:"")},useData:!0,useDepths:!0})}),define("module/common/media/view/variants/list",["require","underscore","jquery","backbone","hbars!module/common/media/template/variants/list","helper/makeup","helper/language","module/common/media/model/variants","Handlebars"],function(e){var t=e("underscore"),n=e("jquery"),r=e("backbone"),i=e("hbars!module/common/media/template/variants/list"),s=e("helper/makeup"),o=e("helper/language"),u=e("module/common/media/model/variants"),a=e("Handlebars");return r.View.extend({template:i,events:{"click .select":"selectVariant","click .edit-variant":"notifyEdit","click .contentLayouts":"notifyLayouts"},initialize:function(e){this.options=e||{},this.moduleName=this.options.moduleName,this.usageContext=this.options.usageContext,this.navigator=this.options.navigator,this.modal=this.options.modal,this.collection=new u,this.registerListeners(),this.registerHandlebars()},registerListeners:function(){r.on(this.moduleName+":add",this.hide.bind(this)),r.on(this.moduleName+":home",this.hide.bind(this)),r.on(this.moduleName+":edit",this.hide.bind(this)),r.on(this.moduleName+":variant:edit",this.hide.bind(this)),r.on(this.moduleName+":home:open",this.hide.bind(this)),r.on(this.moduleName+":variants",this.fetch.bind(this)),this.collection.on("sync:read",this.fetched.bind(this))},notifyLayouts:function(e){e.preventDefault();var t=n(e.currentTarget),i=t.data("id"),s=this.collection.get(i);s.set("language",o.getCurrentLanguage()),r.trigger("media:showLayouts",s)},registerHandlebars:function(){a.registerHelper("thumbnailHelper",function(e){return e.thumbnailURL?e.thumbnailURL:e.thumbnail})},serialize:function(){return{showLayoutsButton:t.contains(["content","directedit"],this.usageContext),variants:this.collection.toJSON(),isLoading:this.isLoading}},beforeRender:function(){this.$("table").each(function(){n(this).dataTable().fnDestroy()})},afterRender:function(){s.createActionDataTable({el:this.$("table")})},fetch:function(e,t){this.show(),this.model=e,this.model.set("layout",t),this.collection.id=e.id,this.collection.language=e.get("language"),this.collection.fetch()},fetched:function(){var e=this;setTimeout(function(){e.collection.models.length?(e.isLoading=!1,e.model.set({original:!0}),e.collection.add(e.model,{at:0}),e.render()):(r.trigger("media:selected",e.collection.id,e.collection.language,e.model.get("layout"),e.modal.instance,e.modal.elementIdentifier),r.trigger("media:close"))},0)},selectVariant:function(e){e.preventDefault();var t=n(e.currentTarget),i=t.data("id");r.trigger("media:selected",i,this.collection.language,"",this.modal.instance,this.modal.elementIdentifier),r.trigger("media:close")},notifyEdit:function(e){e.preventDefault();var t=n(e.currentTarget),r=t.data("id");this.navigator.editVariant(this.model.get("id"),this.model.get("binaryLanguage"),r)},show:function(){this.isLoading=!0,this.render(),this.$el.fadeIn(400)},hide:function(){this.$el.hide()}})}),define("hbars!module/common/media/template/search/list",["Handlebars"],function(e){return e.template({1:function(e,t,n,r){return'<h3 class="green lighter">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:search.title",{name:"t",hash:{},data:r}))+"</h3>"},3:function(e,t,n,r){var i,s;return'  <tr data-id="'+this.escapeExpression((s=(s=t.id||(e!=null?e.id:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"id",hash:{},data:r}):s))+'">\n  <td>\n'+((i=t["if"].call(e,e!=null?e.readOnly:e,{name:"if",hash:{},fn:this.program(4,r,0),inverse:this.program(6,r,0),data:r}))!=null?i:"")+"    </td>\n    <td>"+this.escapeExpression((s=(s=t.type||(e!=null?e.type:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"type",hash:{},data:r}):s))+"</td>\n    <td>"+((i=t["if"].call(e,e!=null?e.version:e,{name:"if",hash:{},fn:this.program(8,r,0),inverse:this.program(10,r,0),data:r}))!=null?i:"")+"</td>\n    <td>"+this.escapeExpression((s=(s=t.template||(e!=null?e.template:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"template",hash:{},data:r}):s))+'</td>\n    <td><span class="badge badge-grey pull-right">'+this.escapeExpression((s=(s=t.lang||(e!=null?e.lang:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"lang",hash:{},data:r}):s))+"</span></td>\n    <td>"+this.escapeExpression((s=(s=t.lastModified||(e!=null?e.lastModified:e))!=null?s:t.helperMissing,typeof s=="function"?s.call(e,{name:"lastModified",hash:{},data:r}):s))+'</td>\n  <td>\n  <div class="btn-group">\n      <button data-toggle="dropdown" class="btn btn-info btn-xs dropdown-toggle">\n          <i class="fa fa-cog"></i>\n          '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.actions",{name:"t",hash:{},data:r}))+'\n          <span class="ace-icon fa fa-caret-down icon-on-right"></span>\n      </button>\n'+((i=t["if"].call(e,e!=null?e.readOnly:e,{name:"if",hash:{},fn:this.program(12,r,0),inverse:this.program(14,r,0),data:r}))!=null?i:"")+"  </div>\n  </td>\n"},4:function(e,t,n,r){var i;return'  <a class="readOnly">'+this.escapeExpression((i=(i=t.name||(e!=null?e.name:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"name",hash:{},data:r}):i))+" "+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:search.list.headers.readOnly",{name:"t",hash:{},data:r}))+'</a><br><small class="grey">'+this.escapeExpression((i=(i=t.path||(e!=null?e.path:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"path",hash:{},data:r}):i))+"</small>\n"},6:function(e,t,n,r){var i;return'  <a href="#" class="edit">'+this.escapeExpression((i=(i=t.name||(e!=null?e.name:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"name",hash:{},data:r}):i))+'</a><br><small class="grey">'+this.escapeExpression((i=(i=t.path||(e!=null?e.path:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"path",hash:{},data:r}):i))+"</small>\n"},8:function(e,t,n,r){var i;return this.escapeExpression((i=(i=t.version||(e!=null?e.version:e))!=null?i:t.helperMissing,typeof i=="function"?i.call(e,{name:"version",hash:{},data:r}):i))},10:function(e,t,n,r){return"N/A"},12:function(e,t,n,r){return'    <ul class="dropdown-menu dropdown-menu-right dropdown-caret pull-right">\n        <li>\n          <a href="#" class="readOnly" data-id="'+this.escapeExpression(this.lambda(e!=null?e.id:e,e))+'">\n            <i class="fa fa-eye"></i>\n             '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.view",{name:"t",hash:{},data:r}))+"\n          </a>\n        </li>\n    </ul>\n\n"},14:function(e,t,n,r){return'     <ul class="dropdown-menu dropdown-menu-right dropdown-caret pull-right">\n         <li>\n           <a href="#" class="edit" data-id="'+this.escapeExpression(this.lambda(e!=null?e.id:e,e))+'">\n             <i class="fa fa-edit"></i>\n              '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.edit",{name:"t",hash:{},data:r}))+"\n           </a>\n          </li>\n     </ul>\n\n"},16:function(e,t,n,r){return'<div class="form-actions text-left">\n  <a href="#" class="btn btn-default">\n    <i class="fa fa-arrow-left"></i>\n    '+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.back",{name:"t",hash:{},data:r}))+"\n  </a>\n</div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i;return((i=t.unless.call(e,e!=null?e.inModal:e,{name:"unless",hash:{},fn:this.program(1,r,0),inverse:this.noop,data:r}))!=null?i:"")+'\n\n<table class="table table-striped table-bordered table-hover dt-responsive dataTable no-footer">\n  <thead>\n  <tr>\n    <th class="all table-span-6">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:search.list.headers.name",{name:"t",hash:{},data:r}))+'</th>\n    <th class="min-tablet-p table-span-2">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:search.list.headers.type",{name:"t",hash:{},data:r}))+'</th>\n    <th class="min-tablet-p table-span-1">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:search.list.headers.version",{name:"t",hash:{},data:r}))+'</th>\n    <th class="min-tablet-p table-span-1">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:search.list.headers.contentType",{name:"t",hash:{},data:r}))+'</th>\n    <th class="min-tablet-p">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:search.list.headers.language",{name:"t",hash:{},data:r}))+'</th>\n    <th class="min-tablet-p table-span-3">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"media:search.list.headers.lastModified",{name:"t",hash:{},data:r}))+'</th>\n    <th class="min-tablet-p">'+this.escapeExpression((t.t||e&&e.t||t.helperMissing).call(e,"action.actions",{name:"t",hash:{},data:r}))+"</th>\n  </tr>\n  </thead>\n  <tbody>\n"+((i=t.each.call(e,e!=null?e.model:e,{name:"each",hash:{},fn:this.program(3,r,0),inverse:this.noop,data:r}))!=null?i:"")+"  </tbody>\n</table>\n"+((i=t.unless.call(e,e!=null?e.inModal:e,{name:"unless",hash:{},fn:this.program(16,r,0),inverse:this.noop,data:r}))!=null?i:"")},useData:!0})}),define("module/search/model/search",["underscore","backbone","i18n","jquery"],function(e,t,n,r){return t.Model.extend({url:t.SERVICE_BASE_URL+"/cmssearch",parse:function(e){return{result:e}},search:function(e){var t=this.preparedQuery(e.query,e.types);this.fetch({data:r.param({query:t,allLanguages:e.allLanguages,maxResults:100,allVersions:e.allVersions})})},preparedQuery:function(e,t){return t.section&&t.content&&t.media?e="(sm_type:section OR sm_type:content OR sm_type:media) AND "+e:t.section&&t.content?e="(sm_type:section OR sm_type:content) AND "+e:t.section&&t.media?e="(sm_type:section OR sm_type:media) AND  "+e:t.content&&t.media?e="(sm_type:content OR sm_type:media) AND  "+e:t.section?e="sm_type:section AND "+e:t.content?e="sm_type:content AND "+e:t.media&&(e="sm_type:media AND "+e),e}})}),define("module/common/media/view/search/list",["underscore","jquery","backbone","hbars!module/common/media/template/search/list","helper/makeup","module/search/model/search","module/common/media/model/media"],function(e,t,n,r,i,s,o){return n.View.extend({template:r,events:{"click .edit":"clicked","click .readOnly":"readOnlyView"},initialize:function(e){this.options=e||{},this.model=new s,this.moduleName=this.options.moduleName,this.inModal=!!this.options.inModal,this.navigator=this.options.navigator,this.media=new o,this.mediaItems=[],this.registerListeners(),this.hide()},registerListeners:function(){n.on(this.moduleName+":home",this.hide.bind(this)),n.on(this.moduleName+":edit",this.hide.bind(this)),n.on(this.moduleName+":add",this.hide.bind(this)),n.on(this.moduleName+":category:add",this.hide.bind(this)),n.on(this.moduleName+":category:edit",this.hide.bind(this)),n.on(this.moduleName+":variant:edit",this.hide.bind(this)),n.on(this.moduleName+":variants",this.hide.bind(this)),n.on(this.moduleName+":search",this.fetch.bind(this)),n.on(this.moduleName+":home:open",this.hide.bind(this)),this.listenTo(n,this.moduleName+":edit:readOnly",this.hide),this.model.on("sync:read",this.render.bind(this)),this.media.on("sync:read",this.select.bind(this))},serialize:function(){var t=this.model.toJSON()||{},n=this,r=t.result||[];return e.each(r,function(e){e.type==="Media"&&n.mediaItems.push(e)}),{model:e.uniq(n.mediaItems),inModal:this.inModal}},fetch:function(e){this.show(),this.model.search({query:e,allLanguages:!0,maxResults:100,allVersions:!0,types:{media:!0,content:!1,section:!1}})},clicked:function(e){e.preventDefault();var n=t(e.currentTarget),r=n.closest("[data-id]"),i=r.data("id"),s=r.find("span").text()||"smxx";this.media.set({id:i,language:s}),this.media.fetch()},readOnlyView:function(e){e.preventDefault();var n=t(e.currentTarget),r=n.closest("[data-id]"),i=r.data("id"),s=r.find("span").text()||"smxx";this.navigator.readOnly(i,s,null,null)},select:function(){var e=this.media.get("id"),t=this.media.get("binaryLanguage");this.inModal?this.navigator.variants(this.media):this.navigator.edit(e,t)},beforeRender:function(){this.mediaItems=[],this.$("table").each(function(){t(this).dataTable().fnDestroy()})},afterRender:function(){i.createDataTable({el:this.$("table")})},hide:function(){this.mediaItems=[],this.$el.hide()},show:function(){this.$el.fadeIn(400)}})}),define("module/common/media/navigator",["underscore","backbone"],function(e,t){var n=function(e){e=e||{},this.eventBased=e.eventBased};return e.extend(n.prototype,{_history:[],home:function(e){if(this.eventBased){var n="media:home",r=n+":open";e?(this._history.push([r,e]),t.trigger(r,e)):(this._history.push([n]),t.trigger(n))}else location.hash=e||""},add:function(e,n){if(this.eventBased){var r="media:add";this._history.push([r,e,n]),t.trigger(r,e,n)}else n=n?"/"+n:"",location.hash="add/"+e+n},edit:function(e,n,r,i,s){if(this.eventBased){var o="media:edit";this._history.push([o,e,n,r,i]),t.trigger(o,e,n,r,i,s)}else{var u=r?"/"+r:"";location.hash="edit/"+e+"/"+n+u}},readOnly:function(e,n,r,i,s){var o="media:edit:readOnly";this._history.push([o,e,n,r,i]),t.trigger(o,e,n,r,s)},variants:function(e,n){var r="media:variants";this._history.push([r,e]),t.trigger("media:variants",e,n)},editVariant:function(e,n,r){if(this.eventBased){var i="media:variant:edit";this._history.push([i,e,n,r,!0]),t.trigger(i,e,n,r,!0)}else location.hash="edit/"+e+"/"+n+"/variants/edit/"+r},duplicateVariant:function(e,n,r){if(this.eventBased){var i="media:variant:edit";this._history.push([i,e,n,r,!0,!0]),t.trigger(i,e,n,r,!0,!0)}else location.hash="edit/"+e+"/"+n+"/variants/duplicate/"+r},search:function(e){if(this.eventBased){var n="media:search";this._history.push([n,e]),t.trigger(n,e)}else location.hash="search/?q="+encodeURI(e)},back:function(){if(this.eventBased){this._history.pop();var e=this._history[this._history.length-1];t.trigger.apply(t,e)}else history.back()}}),n}),define("module/common/media/view/modal",["require","jquery","underscore","i18n","backbone","hbars!module/common/media/template/modal","hbars!module/common/media/template/modal/homeFooter","hbars!module/common/media/template/modal/editFooter","hbars!module/common/media/template/modal/variantsFooter","hbars!module/common/media/template/modal/variantsEditFooter","hbars!module/common/media/template/modal/searchFooter","module/common/media/view/list","module/common/media/view/edit","module/common/media/view/variants/list","module/common/media/view/search/list","module/common/media/navigator","module/common/media/model/categories","helper/media"],function(e){var t=e("jquery"),n=e("underscore"),r=e("i18n"),i=e("backbone"),s=e("hbars!module/common/media/template/modal"),o=e("hbars!module/common/media/template/modal/homeFooter"),u=e("hbars!module/common/media/template/modal/editFooter"),a=e("hbars!module/common/media/template/modal/variantsFooter"),f=e("hbars!module/common/media/template/modal/variantsEditFooter"),l=e("hbars!module/common/media/template/modal/searchFooter"),c=e("module/common/media/view/list"),h=e("module/common/media/view/edit"),p=e("module/common/media/view/variants/list"),d=e("module/common/media/view/search/list"),v=e("module/common/media/navigator"),m=e("module/common/media/model/categories"),g=e("helper/media");return i.View.extend({template:s,events:{"click .cancel":"notifyCancel","click .cancel-close":"notifyClose","click .save":"save","click .save-variant":"saveVariant","click .cancel-variant":"notifyCancelVariant","click .cancel-search":"notifyCancelSearch","hidden.bs.modal .modal":"notifyClosed"},initialize:function(e){e=e||{},this.usageContext=e.usageContext,this.directEdit=e.directEdit,this.navigator=new v({eventBased:!0}),this.router=e.router,this.categories=new m,this.mediaPathlanguage="en",g.fetchAsyncMediaPathLanguage().done(function(e){this.mediaPathlanguage=e}.bind(this)),i.trigger("notifier:subscribe","media:selected"),this.initializeViews(),this.registerListeners()},initializeViews:function(){var e="media";this.listView=new c({id:"listView",moduleName:e,usageContext:this.usageContext,navigator:this.navigator,router:this.router,actions:!1,selectMode:!0,showPending:!1}),this.editView=new h({id:"editView",moduleName:e,navigator:this.navigator,hideActions:!0,modal:this}),this.variantsListView=new p({moduleName:e,usageContext:this.usageContext,navigator:this.navigator,modal:this}),this.searchListView=new d({moduleName:e,navigator:this.navigator,inModal:!0})},registerListeners:function(){this.listenTo(i,"media:layoutSelected",this.hide),this.listenTo(i,"media:open",this.show),this.listenTo(i,"media:close",this.hide),this.listenTo(i,"media:add",this.addEvent),this.listenTo(i,"media:edit",this.editEvent),this.listenTo(i,"media:home",this.homeEvent),this.listenTo(i,"media:variants",this.variantsEvent),this.listenTo(i,"media:variant:edit",this.variantsEditEvent),this.listenTo(i,"media:search",this.searchEvent)},modalTitle:function(e){return r.t("media:modal."+e+".title")},editEvent:function(e,t,n){this.show(),this.$footer.empty(),this.$footer.append(u()),this.$title.text(this.modalTitle("edit")),this.$icon.removeClass().addClass("fa fa-edit"),this.$save=this.$(".save")},addEvent:function(){this.show(),this.$footer.empty(),this.$footer.append(u()),this.$title.text(this.modalTitle("add")),this.$icon.removeClass().addClass("fa fa-plus"),this.$save=this.$(".save")},homeEvent:function(e,t){this.show(),e&&(this.instance=e),this.elementIdentifier=t,this.$footer.empty(),this.$footer.append(o()),this.$title.text(this.modalTitle("home")),this.$icon.removeClass().addClass("fa fa-external-link-square")},variantsEvent:function(){var e="media:modal.variant.title";this.show(),this.$footer.empty(),this.$footer.append(a()),this.$title.text(this.modalTitle("variant")),this.$icon.removeClass().addClass("fa fa-check")},variantsEditEvent:function(e,t,n,i,s){var o=s?"media:edit.variants.duplicate.title":"media:edit.variants.edit.title";this.show(),this.$footer.empty(),this.$footer.append(f()),this.$title.text(r.t(o)),this.$icon.removeClass().addClass("fa fa-edit")},searchEvent:function(){this.show(),this.$footer.empty(),this.$footer.append(l()),this.$title.text(this.modalTitle("search")),this.$icon.removeClass().addClass("fa fa-search")},notifyCancel:function(e){e.preventDefault();if(this.directEdit)return this.hide();i.trigger("media:home")},notifyClose:function(e){e.preventDefault(),this.hide()},notifyClosed:function(){this.editView.variantsView.cropToolView.cropTool&&this.editView.variantsView.cropToolView.cropTool.cancelSelection(),i.trigger("media:closed")},notifyCancelVariant:function(e){e.preventDefault(),this.navigator.back()},notifyCancelSearch:function(e){e.preventDefault(),this.navigator.home()},beforeRender:function(){this.insertView(".media-list",this.listView),this.insertView(".media-edit",this.editView),this.insertView(".variants-list",this.variantsListView),this.insertView(".search-list",this.searchListView)},afterRender:function(){this.$modal=this.$(".modal"),this.$footer=this.$(".modal-footer"),this.$title=this.$(".modal-title > span"),this.$icon=this.$(".modal-title > i")},save:function(e){this.editView.save(e)},saveVariant:function(e){this.editView.editVariant(e)},getSaveButton:function(){return this.$save},show:function(){this.$modal&&this.$modal.modal("show")},hide:function(){this.$modal&&this.$modal.modal("hide")}})}),define("module/assets/pageLayout/page",["module/common/page/adminPage","hbars!module/common/layout/template/column_12","helper/countdown/getContentLockDuration","module/common/feedback/view/notifier","module/common/share/view/modal","module/common/layout/view/crudOpening","module/assets/pageLayout/view/list","module/assets/pageLayout/view/edit","module/assets/pageLayout/view/erase","module/common/confirm/view/confirm","module/assets/pageLayout/router","module/common/compare/view/compare","module/content/compare/view/code","module/common/tagBuilder/view/modal","module/common/media/view/modal"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v="pageLayout",m=new l;return e.createPage({template:t,moduleName:v,userLevel:2,views:{".page-content > .row > .col-xs-12":[new r({moduleName:v,isCRUD:!0}),new s({id:"openingView",module:v}),new o({id:"listView",router:m}),new u({id:"editView"}),new a({id:"eraseView"}),new i({moduleName:v}),new f({id:"confirmView",moduleName:v,altModuleName:"versions"}),new c({id:"compareView",moduleName:v,router:m}),new p,new d,new h({id:"codeCompare",moduleName:v,router:m})]},router:m,breadcrumbKeys:["nav.asset","nav.pageLayout"],subscribeBreadcrumb:function(e){e.subscribeForCrudOn(v)},beforeRouterStart:function(){return n().then(function(e){m.updateLockHelper({contentLockTimeout:e})})},serialize:{backwardCompatibility:!0,linkToOldVersion:"../SiteManager?ctfn=style"},onUser:function(e){var t=e.getViews({id:"codeCompare"})}})});